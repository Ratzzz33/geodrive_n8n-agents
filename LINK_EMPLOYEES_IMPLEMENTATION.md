# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ Telegram ‚Üî RentProg

**–î–∞—Ç–∞:** 2025-11-05  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## –ü—Ä–æ–±–ª–µ–º–∞

–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ Jarvis (Telegram) –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å RentProg employee IDs. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ Telegram –±–æ—Ç–µ
2. –°–≤—è–∑—ã–≤–∞—Ç—å –∏—Ö —Å RentProg –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤—è–∑—å –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## –†–µ—à–µ–Ω–∏–µ: –ö–æ–º–∞–Ω–¥–∞ `/link_rentprog`

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram User  ‚îÇ
‚îÇ   (tg_user_id)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ /start
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   employees     ‚îÇ
‚îÇ   (Jarvis DB)   ‚îÇ
‚îÇ  ‚Ä¢ id (UUID)    ‚îÇ
‚îÇ  ‚Ä¢ tg_user_id   ‚îÇ
‚îÇ  ‚Ä¢ name         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ /link_rentprog 14714
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ external_refs   ‚îÇ
‚îÇ ‚Ä¢ system='rp'   ‚îÇ
‚îÇ ‚Ä¢ entity_type   ‚îÇ
‚îÇ ‚Ä¢ entity_id ‚îÄ‚îÄ‚îÄ‚îÄ‚îò (link)
‚îÇ ‚Ä¢ external_id='14714'
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ (–∏–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ bookings)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RentProg API    ‚îÇ
‚îÇ booking.issue_  ‚îÇ
‚îÇ employee_id     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 1. `/start` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `src/bot/commands/start.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ `tg_user_id`
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `employees`:
  - `name` –∏–∑ Telegram (first_name + last_name)
  - `tg_user_id` = Telegram User ID
  - `tg_username` = @username
  - `role` = 'employee'

**–ü—Ä–∏–º–µ—Ä:**
```
/start

üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É Jarvis!

üë§ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üÜî –í–∞—à ID: 123e4567-...

–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1Ô∏è‚É£ –°–≤—è–∂–∏—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç —Å RentProg:
   /link_rentprog <–≤–∞—à_RentProg_ID>

2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
   /myinfo
```

---

### 2. `/link_rentprog <ID>` - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `src/bot/commands/link_rentprog.ts`

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
- `<ID>` - RentProg employee ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, 14714)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Jarvis
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è RentProg ID –≤ `external_refs`
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ RentProg ID –Ω–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º RentProg ID
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `external_refs.entity_id`

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ù–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Üí "–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ /start"
- RentProg ID –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí "–í–∞—Å –µ—â–µ –Ω–µ —É–ø–æ–º–∏–Ω–∞–ª–∏ –≤ –±—Ä–æ–Ω—è—Ö"
- ID –∑–∞–Ω—è—Ç ‚Üí "–°–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º"
- –£–∂–µ —Å–≤—è–∑–∞–Ω ‚Üí "–í—ã —É–∂–µ —Å–≤—è–∑–∞–Ω—ã —Å –¥—Ä—É–≥–∏–º ID"

**–ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—Ö–∞:**
```
/link_rentprog 14714

‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–≤—è–∑–∞–Ω–æ!

üë§ Jarvis: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üîó RentProg: Ivane Ivanishvili (ID: 14714)

üéâ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:
‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞—à–∏—Ö –±—Ä–æ–Ω—è—Ö
‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã
```

---

### 3. `/myinfo` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–§–∞–π–ª:** `src/bot/commands/myinfo.ts`

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –î–∞–Ω–Ω—ã–µ –∏–∑ `employees` (Jarvis)
- –°–≤—è–∑—å —Å RentProg —á–µ—Ä–µ–∑ `external_refs`
- –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–∏–º–µ—Ä:**
```
/myinfo

üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å

Jarvis:
‚Ä¢ ID: 123e4567-...
‚Ä¢ –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
‚Ä¢ Telegram ID: 123456789
‚Ä¢ –†–æ–ª—å: employee
‚Ä¢ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: 05.11.2025

RentProg:
‚Ä¢ ‚úÖ –°–≤—è–∑–∞–Ω
‚Ä¢ ID: 14714
‚Ä¢ –ò–º—è: Ivane Ivanishvili

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
‚Ä¢ /myinfo - —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ /help - –ø–æ–º–æ—â—å
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –¢–∞–±–ª–∏—Ü–∞ `employees`

```sql
CREATE TABLE employees (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  role TEXT DEFAULT 'employee',
  branch_id UUID REFERENCES branches(id),
  tg_user_id BIGINT UNIQUE,  -- Telegram User ID
  tg_username TEXT,           -- @username
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_employees_tg_user_id ON employees(tg_user_id);
```

### –¢–∞–±–ª–∏—Ü–∞ `external_refs`

```sql
CREATE TABLE external_refs (
  id BIGSERIAL PRIMARY KEY,
  system TEXT NOT NULL,           -- 'rentprog'
  entity_type TEXT NOT NULL,      -- 'employee'
  entity_id UUID,                 -- employees.id (NULL –¥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è)
  external_id TEXT NOT NULL,      -- RentProg employee ID
  data JSONB,                     -- {"name": "Ivane Ivanishvili"}
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  CONSTRAINT external_refs_unique 
    UNIQUE (system, entity_type, external_id)
);

CREATE INDEX idx_external_refs_lookup 
  ON external_refs(system, entity_type, entity_id);
CREATE INDEX idx_external_refs_external_id 
  ON external_refs(system, entity_type, external_id);
```

---

## –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è RentProg employee IDs

### –ò—Å—Ç–æ—á–Ω–∏–∫: Bookings

RentProg **–Ω–µ –∏–º–µ–µ—Ç** –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.

–ú—ã –∏–∑–≤–ª–µ–∫–∞–µ–º –∏—Ö –∏–∑ **bookings** –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ:

**Webhook payload:**
```json
{
  "id": "470049",
  "issue_employee_id": "14714",
  "issue_employee_name": "Ivane Ivanishvili",
  "return_employee_id": "14715",
  "return_employee_name": "Giorgi Giorgadze"
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. Webhook –æ—Ç RentProg ‚Üí n8n
2. n8n ‚Üí Jarvis API `/process-event`
3. Jarvis:
   ```typescript
   // –ò–∑–≤–ª–µ—á—å employee IDs
   const issueEmployeeId = booking.issue_employee_id;
   const returnEmployeeId = booking.return_employee_id;
   
   // Upsert –≤ external_refs
   await upsertExternalRef({
     system: 'rentprog',
     entity_type: 'employee',
     external_id: issueEmployeeId,
     data: { name: booking.issue_employee_name }
   });
   ```

**–í–∞–∂–Ω–æ:**
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –±—Ä–æ–Ω–∏
- –î–æ —ç—Ç–æ–≥–æ –∫–æ–º–∞–Ω–¥–∞ `/link_rentprog <ID>` –≤–µ—Ä–Ω–µ—Ç "–Ω–µ –Ω–∞–π–¥–µ–Ω"

---

## –§–ª–æ—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–Ω–∞—á–∞–ª–∞ Telegram, –ø–æ—Ç–æ–º RentProg

```
1. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí /start
   ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ employees (entity_id = UUID)

2. (–≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–¥–∏—Ç, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞–∑–Ω–∞—á–∞—é—Ç –Ω–∞ –±—Ä–æ–Ω—å –≤ RentProg)

3. RentProg ‚Üí webhook
   ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ external_refs (entity_id = NULL)

4. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí /link_rentprog 14714
   ‚ùå "RentProg ID –Ω–µ –Ω–∞–π–¥–µ–Ω"
   
   (–∂–¥–µ–º –ø–æ–∫–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç webhook)

5. –ü–æ–≤—Ç–æ—Ä–Ω–æ ‚Üí /link_rentprog 14714
   ‚úÖ –°–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞ (external_refs.entity_id = employees.id)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–Ω–∞—á–∞–ª–∞ RentProg, –ø–æ—Ç–æ–º Telegram

```
1. –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞–∑–Ω–∞—á–∞—é—Ç –Ω–∞ –±—Ä–æ–Ω—å –≤ RentProg

2. RentProg ‚Üí webhook
   ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ external_refs (entity_id = NULL)

3. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí /start
   ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ employees

4. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí /link_rentprog 14714
   ‚úÖ –°–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞ (external_refs.entity_id = employees.id)
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

### –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/index.ts`

```typescript
import { startCommand } from './commands/start.js';
import { linkRentprogCommand } from './commands/link_rentprog.js';
import { myinfoCommand } from './commands/myinfo.js';

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
bot.command('start', startCommand);
bot.command('link_rentprog', linkRentprogCommand);
bot.command('myinfo', myinfoCommand);
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∞ `/help`

```
üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

–õ–∏—á–Ω—ã–µ:
/start - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ
/myinfo - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å
/link_rentprog <ID> - –°–≤—è–∑–∞—Ç—å —Å RentProg –∞–∫–∫–∞—É–Ω—Ç–æ–º

–°–∏—Å—Ç–µ–º–∞:
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
/status - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
/sync_rentprog - –ü–µ—Ä–≤–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è RentProg
```

---

## –§–∞–π–ª—ã

### –°–æ–∑–¥–∞–Ω—ã

1. ‚úÖ `src/bot/commands/start.ts` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
2. ‚úÖ `src/bot/commands/link_rentprog.ts` - —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ
3. ‚úÖ `src/bot/commands/myinfo.ts` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
4. ‚úÖ `src/bot/commands/index.ts` - —ç–∫—Å–ø–æ—Ä—Ç –∫–æ–º–∞–Ω–¥
5. ‚úÖ `docs/BOT_COMMANDS.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω—ã

1. ‚úÖ `src/bot/index.ts` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
2. ‚úÖ `src/db/schema.ts` - —Ç–∞–±–ª–∏—Ü—ã employees, external_refs

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –í Telegram –±–æ—Ç–µ
/start

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ employees
# ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
SELECT * FROM employees 
WHERE tg_user_id = <–≤–∞—à_telegram_id>;
```

---

### –¢–µ—Å—Ç 2: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º RentProg ID

```bash
/link_rentprog 99999

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# ‚ùå "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å RentProg ID 99999 –Ω–µ –Ω–∞–π–¥–µ–Ω"
```

---

### –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ external_ref —á–µ—Ä–µ–∑ webhook

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç**

```bash
node setup/link_employees_tables.mjs
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ bookings
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `external_refs`

**–í–∞—Ä–∏–∞–Ω—Ç B: –ñ–¥–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π webhook**

–ö–æ–≥–¥–∞ –ø—Ä–∏–¥–µ—Ç webhook –æ—Ç RentProg —Å `issue_employee_id`, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –∑–∞–ø–∏—Å—å.

---

### –¢–µ—Å—Ç 4: –£—Å–ø–µ—à–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ

```bash
# –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è external_ref
/link_rentprog 14714

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# ‚úÖ "–£—Å–ø–µ—à–Ω–æ —Å–≤—è–∑–∞–Ω–æ!"
# ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–≤—è–∑–∏
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
SELECT 
  e.name AS jarvis_name,
  er.external_id AS rentprog_id,
  er.data->>'name' AS rentprog_name
FROM employees e
JOIN external_refs er ON er.entity_id = e.id
WHERE er.system = 'rentprog' 
  AND er.entity_type = 'employee';
```

---

### –¢–µ—Å—Ç 5: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ

```bash
/link_rentprog 14714

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# ‚úÖ "–í—ã —É–∂–µ —Å–≤—è–∑–∞–Ω—ã —Å —ç—Ç–∏–º RentProg –∞–∫–∫–∞—É–Ω—Ç–æ–º!"
```

---

### –¢–µ—Å—Ç 6: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

```bash
/myinfo

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# ‚úÖ –ü–æ–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ Jarvis
# ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–∞ —Å–≤—è–∑—å —Å RentProg
# ‚úÖ –ü–æ–∫–∞–∑–∞–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```

---

## SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏

```sql
SELECT 
  e.id,
  e.name AS jarvis_name,
  e.tg_user_id,
  e.tg_username,
  er.external_id AS rentprog_id,
  er.data->>'name' AS rentprog_name,
  e.created_at AS registered_at
FROM employees e
JOIN external_refs er ON er.entity_id = e.id
WHERE er.system = 'rentprog' 
  AND er.entity_type = 'employee'
ORDER BY e.created_at DESC;
```

### –ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ RentProg —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏

```sql
SELECT 
  external_id AS rentprog_id,
  data->>'name' AS rentprog_name,
  created_at AS first_seen
FROM external_refs
WHERE system = 'rentprog' 
  AND entity_type = 'employee'
  AND entity_id IS NULL
ORDER BY created_at DESC;
```

### –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–æ –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

```sql
SELECT 
  e.id,
  e.name,
  e.tg_user_id,
  e.tg_username,
  e.created_at
FROM employees e
WHERE e.tg_user_id IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM external_refs er
    WHERE er.entity_id = e.id
      AND er.system = 'rentprog'
      AND er.entity_type = 'employee'
  )
ORDER BY e.created_at DESC;
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
- [ ] –ü–æ–ø—Ä–æ—Å–∏—Ç—å 2-3 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–≤—è–∑–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

**–ê–≥–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –±—Ä–æ–Ω–µ–π:**
```typescript
// –ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
const employee = await getEmployeeByRentProgId(booking.issue_employee_id);

if (employee?.tg_user_id) {
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
  await bot.telegram.sendMessage(
    employee.tg_user_id,
    `‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –≤—ã–¥–∞—á–∞ –∞–≤—Ç–æ —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç\n` +
    `üöó ${carName}\n` +
    `üìç ${booking.branch}`
  );
}
```

**–î–Ω–µ–≤–Ω–æ–π –ø–ª–∞–Ω:**
```typescript
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±—Ä–æ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
const todayBookings = await getEmployeeBookingsForDate(
  employee.id, 
  new Date()
);

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞–Ω
await sendDailyPlan(employee.tg_user_id, todayBookings);
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
# –ò–∑–≤–ª–µ—á—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö bookings
node setup/link_employees_tables.mjs

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ –°–æ–∑–¥–∞–Ω—ã external_refs –¥–ª—è –≤—Å–µ—Ö —É–ø–æ–º—è–Ω—É—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
# ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Å–≤—è–∑—ã–≤–∞–Ω–∏—é –∫–æ–º–∞–Ω–¥–æ–π /link_rentprog
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ RentProg ID —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```
‚úÖ New employee registered: UUID (–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤)
‚úÖ Linked: employee UUID (–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤) ‚Üí rentprog 14714
```

### Error Handling

–í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully:
- Database errors ‚Üí "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ"
- Invalid input ‚Üí –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- Edge cases ‚Üí –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ `docs/BOT_COMMANDS.md`:
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
- SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ù–∞–ø–∏—Å–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ì–æ—Ç–æ–≤—ã —Ç–µ—Å—Ç—ã

üöÄ **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
npm run dev

# –í Telegram:
/start
/link_rentprog <–≤–∞—à_RentProg_ID>
/myinfo
```

üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞: `docs/BOT_COMMANDS.md`
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `ARCHITECTURE.md`
- –ê–≥–µ–Ω—Ç—ã: `AGENTS.md`

