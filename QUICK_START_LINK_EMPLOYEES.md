# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

## –î–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:

```
/start
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ:
```
üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É Jarvis!

üë§ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üÜî –í–∞—à ID: 123e4567-...

–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1Ô∏è‚É£ –°–≤—è–∂–∏—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç —Å RentProg:
   /link_rentprog <–≤–∞—à_RentProg_ID>
```

### –®–∞–≥ 2: –£–∑–Ω–∞—Ç—å —Å–≤–æ–π RentProg ID

**–í–∞—Ä–∏–∞–Ω—Ç 1:** –°–ø—Ä–æ—Å–∏—Ç—å —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–í–∞—Ä–∏–∞–Ω—Ç 2:** –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ RentProg
- –ó–∞–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID

**–í–∞—Ä–∏–∞–Ω—Ç 3:** –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ë–î (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
```sql
SELECT 
  external_id AS rentprog_id,
  data->>'name' AS name
FROM external_refs
WHERE system = 'rentprog' 
  AND entity_type = 'employee'
ORDER BY data->>'name';
```

### –®–∞–≥ 3: –°–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –±–æ—Ç–∞:

```
/link_rentprog 14714
```

(–∑–∞–º–µ–Ω–∏—Ç–µ 14714 –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID)

–í—ã –ø–æ–ª—É—á–∏—Ç–µ:
```
‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–≤—è–∑–∞–Ω–æ!

üë§ Jarvis: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üîó RentProg: Ivane Ivanishvili (ID: 14714)

üéâ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:
‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞—à–∏—Ö –±—Ä–æ–Ω—è—Ö
‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞

```
/myinfo
```

–í—ã —É–≤–∏–¥–∏—Ç–µ —Å–≤–æ—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å—Ç–∞—Ç—É—Å —Å–≤—è–∑–∏.

---

## –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
cd /path/to/geodrive_n8n-agents
npm run dev
```

### –®–∞–≥ 2: –ò–∑–≤–ª–µ—á—å RentProg employee IDs

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å external_refs –¥–ª—è –≤—Å–µ—Ö —É–ø–æ–º—è–Ω—É—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:

```bash
node setup/link_employees_tables.mjs
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ò–∑–≤–ª–µ—á–µ—Ç –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ `issue_employee_id` –∏ `return_employee_id` –∏–∑ bookings
- –°–æ–∑–¥–∞—Å—Ç –∑–∞–ø–∏—Å–∏ –≤ `external_refs` (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```sql
-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑ RentProg –±–µ–∑ Telegram —Å–≤—è–∑–∏
SELECT 
  external_id AS rentprog_id,
  data->>'name' AS rentprog_name,
  created_at AS first_seen
FROM external_refs
WHERE system = 'rentprog' 
  AND entity_type = 'employee'
  AND entity_id IS NULL
ORDER BY data->>'name';
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã—Ö

```sql
-- –£—Å–ø–µ—à–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
SELECT 
  e.name AS jarvis_name,
  e.tg_username,
  er.external_id AS rentprog_id,
  er.data->>'name' AS rentprog_name
FROM employees e
JOIN external_refs er ON er.entity_id = e.id
WHERE er.system = 'rentprog' 
  AND er.entity_type = 'employee'
ORDER BY e.name;
```

---

## Troubleshooting

### "RentProg ID –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—â–µ –Ω–µ —É–ø–æ–º–∏–Ω–∞–ª–∏ –≤ –±—Ä–æ–Ω—è—Ö, –ª–∏–±–æ —Å–∏—Å—Ç–µ–º–∞ –µ—â–µ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞ webhook.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å –≤ RentProg
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ–≥–æ –Ω–∞–∑–Ω–∞—á–∞–ª–∏ –Ω–∞ –±—Ä–æ–Ω—å
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å snapshot sync
4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞

### "–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/start`

**–†–µ—à–µ–Ω–∏–µ:**
```
/start
```

### "–≠—Ç–æ—Ç RentProg ID —É–∂–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º"

**–ü—Ä–∏—á–∏–Ω–∞:** –î–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞ –ø—ã—Ç–∞—é—Ç—Å—è —Å–≤—è–∑–∞—Ç—å—Å—è —Å –æ–¥–Ω–∏–º RentProg ID

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ID
- –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## FAQ

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤—è–∑—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è?

A: –°–µ–π—á–∞—Å –Ω–µ—Ç. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î:

```sql
-- –û—Ç–≤—è–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å–≤—è–∑—å
UPDATE external_refs
SET entity_id = NULL
WHERE external_id = '14714' 
  AND system = 'rentprog' 
  AND entity_type = 'employee';

-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–æ–∂–µ—Ç —Å–Ω–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å /link_rentprog
```

### Q: –ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ —É –º–µ–Ω—è –Ω–µ—Å–∫–æ–ª—å–∫–æ RentProg –∞–∫–∫–∞—É–Ω—Ç–æ–≤?

A: –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–≤—è–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ. –û–¥–∏–Ω Telegram ‚Üí –æ–¥–∏–Ω RentProg ID.

### Q: –ú–æ–∂–Ω–æ –ª–∏ —Å–≤—è–∑–∞—Ç—å –±–µ–∑ Telegram?

A: –ù–µ—Ç, —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

### Q: –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å —Å–≤—è–∑—å?

A: –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```sql
UPDATE external_refs
SET entity_id = NULL
WHERE external_id = '14714' 
  AND system = 'rentprog' 
  AND entity_type = 'employee';
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Dashboard query

```sql
SELECT 
  COUNT(*) FILTER (WHERE tg_user_id IS NOT NULL) AS telegram_registered,
  COUNT(*) FILTER (
    WHERE EXISTS (
      SELECT 1 FROM external_refs er
      WHERE er.entity_id = employees.id
        AND er.system = 'rentprog'
        AND er.entity_type = 'employee'
    )
  ) AS linked_to_rentprog
FROM employees;
```

–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```
telegram_registered | linked_to_rentprog
--------------------+-------------------
        15          |         12
```

---

## –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:** `docs/BOT_COMMANDS.md`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `LINK_EMPLOYEES_IMPLEMENTATION.md`
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `ARCHITECTURE.md`

