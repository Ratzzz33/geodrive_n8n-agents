# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–µ–±—Ö—É–∫–æ–≤ RentProg (2025-11-09)

## –ü—Ä–æ–±–ª–µ–º–∞

RentProg –ø–æ–ª—É—á–∞–ª –æ—Ç –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ —É—Å–ø–µ—à–Ω–æ–≥–æ ACK:
- **Error 503:** `{"code":503,"message":"Database is not ready!"}`
- **Error 0:** `{"code":0,"message":"There was a problem executing the workflow"}`

## –ü—Ä–∏—á–∏–Ω–∞

Workflow –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –≤–µ–±—Ö—É–∫ –≤ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**:
```
Webhook ‚Üí [Parse & Validate + Respond] (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
```

–ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –∏–ª–∏ –∑–∞–ø–∏—Å—å –≤ –ë–î –ø–∞–¥–∞–ª–∏, RentProg –ø–æ–ª—É—á–∞–ª –æ—à–∏–±–∫—É –≤–º–µ—Å—Ç–æ ACK.

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ 1. –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
Webhook ‚Üí Respond (Fast Ack) ‚Üí Parse & Validate ‚Üí ...
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** RentProg **–≤—Å–µ–≥–¥–∞** –ø–æ–ª—É—á–∞–µ—Ç ACK `{"ok":true,"received":true}` –≤ —Ç–µ—á–µ–Ω–∏–µ < 100ms, **–¥–æ –Ω–∞—á–∞–ª–∞** –ª—é–±–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### ‚úÖ 2. –î–æ–±–∞–≤–ª–µ–Ω retry –¥–ª—è PostgreSQL

–£–∑–ª—ã "Log Error to DB" –∏ "Save Event":
```json
{
  "retryOnFail": true,
  "maxTries": 3,
  "waitBetweenTries": 2000
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Neon (cold start) n8n –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç –∑–∞–ø—Ä–æ—Å 3 —Ä–∞–∑–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 2 —Å–µ–∫—É–Ω–¥—ã.

### ‚úÖ 3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Neon Pooler URL

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **pooler URL** –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```
Host: ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech
Database: neondb
User: neondb_owner
SSL: Enable
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π pool —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ù–µ—Ç cold start –∑–∞–¥–µ—Ä–∂–µ–∫
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

```bash
cd C:\Users\33pok\geodrive_n8n-agents
python setup/deploy_webhook_fixes.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Neon credentials:

```bash
python setup/check_neon_credentials.py
```

## –§–∞–π–ª—ã

- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π workflow:** `n8n-workflows/rentprog-webhooks-monitor.json`
- **–°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è:** `setup/deploy_webhook_fixes.py`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ credentials:** `setup/check_neon_credentials.py`
- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/WEBHOOK_FIXES_2025-11-09.md`
- **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `setup/WEBHOOK_FIXES_README.md`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n UI
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫: Webhook ‚Üí Respond ‚Üí Parse
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π webhook
4. –£–±–µ–¥–∏—Ç–µ—Å—å: –Ω–µ—Ç –æ—à–∏–±–æ–∫ 503/0

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
SELECT ts, phase, error, event_type 
FROM webhook_error_log 
WHERE ts > NOW() - INTERVAL '1 hour';

-- –°–æ–±—ã—Ç–∏—è —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
SELECT ts, type, rentprog_id, reason 
FROM events 
WHERE ok = false AND ts > NOW() - INTERVAL '1 hour';
```

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ 503** - retry –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î  
‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ 0** - –æ—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥–æ –ª—é–±–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏  
‚úÖ **–ë—ã—Å—Ç—Ä—ã–π ACK** - RentProg –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç < 100ms  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ—è—Ö  

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é  
**–î–∞—Ç–∞:** 2025-11-09  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π (–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)

