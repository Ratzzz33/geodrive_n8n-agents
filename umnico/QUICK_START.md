# üöÄ Umnico Integration - Quick Start

## ‚úÖ –†–∞–∑–≤–µ–¥–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

**–î–∞—Ç–∞:** 2025-11-09  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

1. **`auth_profile.json`** - –ü—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (credentials, cookies, localStorage)
2. **`endpoints_spec.json`** - –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API endpoints (deals, messages, contacts)
3. **`UMNICO_RECONNAISSANCE_REPORT.md`** - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è **–í UMNICO** (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç AmoCRM!)
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ UI
- –ò–∑–≤–ª–µ—á–µ–Ω–æ **42 —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è** –∏–∑ WhatsApp –¥–∏–∞–ª–æ–≥–∞
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ DOM –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- –°–æ–±—Ä–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (session cookies)

### üîë –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:
```
Email: geodrive.ge@gmail.com
Password: 2GeoDriveumnicopassword!!))
URL: https://umnico.com/login
```

### üåê Base URL:
```
API: https://umnico.com/api/v1/
UI: https://umnico.com/app/inbox/deals/inbox
```

---

## üîó –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ö–ª—é—á —Å–≤—è–∑–∏:** –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞

### –ü—Ä–∏–º–µ—Ä:
```
Umnico:   +919810558569 (WhatsApp)
   ‚Üì
AmoCRM:   Contact ID + Custom Fields (rentprog_client_id, rentprog_booking_id)
   ‚Üì
RentProg: Client ID 12345, Booking ID 470049
   ‚Üì
Jarvis DB: UUID –≤ clients + external_refs –¥–ª—è –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º
```

---

## üìä –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä)

**Conversation ID:** 61965921  
**Client:** +919810558569  
**Channel:** WhatsApp (995599001665)

```
[10:40] üë§ Hi
[10:42] üí¨ Good afternoon! What kind of car are you interested in?
[10:43] üë§ 12 NOV - ARRIVING FROM AIRPORT AND DROP AT HOTEL
[10:43] üë§ hope u have understand our itinerary
[10:50] üí¨ https://geodrive.info/kurslari/tproduct/147607768192-honda-hr-v-2024
[11:04] üë§ These r with driver and for excursion with a driver
[11:06] üí¨ we have a driver service for $39 per day (9-hour working day)
[11:14] üë§ Yes driver with the entire rental period
```

**–í—Å–µ–≥–æ:** 42 —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–µ

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. Playwright Scraper (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π login flow
- ‚úÖ Session cookies —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ UI –∏ API

**–ö–æ–¥:**
```typescript
import { chromium } from 'playwright';

async function scrapeUmnico() {
  const browser = await chromium.launch();
  const page = await browser.newPage();
  
  // Login
  await page.goto('https://umnico.com/login');
  await page.fill('input[name="email"]', 'geodrive.ge@gmail.com');
  await page.fill('input[type="password"]', '2GeoDriveumnicopassword!!))');
  await page.click('button[type="submit"]');
  
  // Get messages
  await page.goto('https://umnico.com/app/inbox/deals/inbox/details/61965921');
  const messages = await page.$$eval('.im-stack__messages-item-wrap', wraps => 
    wraps.map(wrap => ({
      text: wrap.querySelector('.im-message__text')?.textContent,
      time: wrap.querySelector('.im-info__date')?.textContent,
      direction: wrap.querySelector('.im-message_out') ? 'outgoing' : 'incoming'
    }))
  );
  
  return messages;
}
```

---

### 2. –¢–∞–±–ª–∏—Ü—ã –ë–î

```sql
-- –ö–ª–∏–µ–Ω—Ç—ã (–µ–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)
CREATE TABLE clients (
  id UUID PRIMARY KEY,
  phone TEXT UNIQUE,
  telegram_username TEXT,
  name TEXT
);

-- –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏
CREATE TABLE external_refs (
  entity_type TEXT,  -- 'client'
  entity_id UUID,    -- clients.id
  system TEXT,       -- 'umnico' | 'amocrm' | 'rentprog'
  external_id TEXT,  -- —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ ID
  UNIQUE(entity_type, system, external_id)
);

-- –î–∏–∞–ª–æ–≥–∏
CREATE TABLE conversations (
  id UUID PRIMARY KEY,
  client_id UUID REFERENCES clients(id),
  umnico_conversation_id TEXT UNIQUE,
  amocrm_scope_id TEXT,
  status TEXT
);

-- –°–æ–æ–±—â–µ–Ω–∏—è
CREATE TABLE messages (
  id UUID PRIMARY KEY,
  client_id UUID REFERENCES clients(id),
  conversation_id UUID REFERENCES conversations(id),
  direction TEXT,
  channel TEXT,
  text TEXT,
  sent_at TIMESTAMPTZ
);
```

---

### 3. Cron Job

```
–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:
1. Playwright login –≤ Umnico
2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞:
   - –ò–∑–≤–ª–µ—á—å —Ç–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞
   - –ù–∞–π—Ç–∏/—Å–æ–∑–¥–∞—Ç—å –≤ clients
   - –î–æ–±–∞–≤–∏—Ç—å external_ref –¥–ª—è Umnico
   - –°–≤—è–∑–∞—Ç—å —Å AmoCRM (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –°–≤—è–∑–∞—Ç—å —Å RentProg (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ messages
```

---

## üé¨ DOM Selectors (–¥–ª—è Playwright)

```css
/* –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ */
.card-message-preview__item          /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–∏–∞–ª–æ–≥–∞ */
.message-preview__user-name          /* –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞ */
.deals-integration                   /* –ù–æ–º–µ—Ä –∫–∞–Ω–∞–ª–∞ */

/* –°–æ–æ–±—â–µ–Ω–∏—è */
.im-stack__messages-item-wrap        /* –û–±–µ—Ä—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è */
.im-message__text                    /* –¢–µ–∫—Å—Ç */
.im-info__date                       /* –í—Ä–µ–º—è */
.im-message_out                      /* –ò—Å—Ö–æ–¥—è—â–µ–µ (outgoing) */
.im-source-item                      /* WhatsApp ‚Äî 995599001665 */
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **Session-based auth:** Cookies –º–æ–≥—É—Ç –∏—Å—Ç–µ—á—å ‚Üí –Ω—É–∂–µ–Ω –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π re-login
2. **Rate Limits:** –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ‚â§60 req/min
3. **UI Changes:** –ü–∞—Ä—Å–∏–Ω–≥ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è ‚Üí –Ω—É–∂–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º–æ—Ç—Ä–∏—Ç–µ **`UMNICO_RECONNAISSANCE_REPORT.md`** –¥–ª—è:
- –ü–æ–ª–Ω–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ API
- –ü—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞
- –°—Ö–µ–º—ã –ë–î
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

---

## üîú –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –†–∞–∑–≤–µ–¥–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
2. ‚è≠Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Playwright scraper
3. ‚è≠Ô∏è –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (conversations, messages)
4. ‚è≠Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron job –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
5. ‚è≠Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ UI
6. ‚è≠Ô∏è –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Jarvis API

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!

