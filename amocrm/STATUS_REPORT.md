# üìä –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å AmoCRM

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-09  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é (–±–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

---

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –†–∞–∑–≤–µ–¥–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–§–∞–π–ª—ã:**
- ‚úÖ `amocrm/RECONNAISSANCE_REPORT.md` - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ä–∞–∑–≤–µ–¥–∫–µ
- ‚úÖ `amocrm/endpoints_spec.json` - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API endpoints
- ‚úÖ `amocrm/auth_profile.json` - –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –≤—ã—è—Å–Ω–µ–Ω–æ:**
- ‚úÖ –¢–∏–ø –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: Session-based (cookie authentication)
- ‚úÖ Base URL: `https://geodrive.amocrm.ru`
- ‚úÖ –í–æ—Ä–æ–Ω–∫–∞ "–ü–µ—Ä–≤–∏—á–∫–∞": ID `8580102`, 21 —Å—Ç–∞—Ç—É—Å (19 –∞–∫—Ç–∏–≤–Ω—ã—Ö + 2 —Å–∫—Ä—ã—Ç—ã—Ö)
- ‚úÖ –°–∫—Ä—ã—Ç—ã–µ —Å—Ç–∞—Ç—É—Å—ã: `142` (–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ), `143` (–ó–∞–∫—Ä—ã—Ç–æ –∏ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- ‚úÖ API endpoints: `/api/v4/leads`, `/api/v4/contacts`, `/api/v4/leads/pipelines`
- ‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ß–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Umnico, AmoCRM —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (scope_id, lead_id)

---

### 2. Playwright Service –¥–ª—è AmoCRM

**–§–∞–π–ª:** `services/playwright-amocrm.ts`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –≤ `/data/amocrm-session.json`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π re-login –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
- ‚úÖ HTTP API –Ω–∞ –ø–æ—Ä—Ç—É 3002 –¥–ª—è n8n workflow

**API Endpoints:**
```http
GET  /health                          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
GET  /api/pipelines/:id              # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–æ—Ä–æ–Ω–∫–∏
GET  /api/deals?pipeline_id=...      # –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫
GET  /api/deals/:id                  # –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏
GET  /api/deals/:id/notes            # –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏
GET  /api/inbox                      # –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
POST /api/relogin                    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π re-login
```

**Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ `docker-compose.yml` –∫–∞–∫ `playwright-amocrm`
- ‚úÖ –ü–æ—Ä—Ç: `3002`
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `AMOCRM_EMAIL`, `AMOCRM_PASSWORD`, `AMOCRM_SUBDOMAIN`
- ‚úÖ Volume –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏: `playwright_amocrm_data:/data`

---

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Neon PostgreSQL)

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `sql/conversations_schema.sql`

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

#### `amocrm_deals` ‚úÖ
- –•—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- –ü–æ–ª—è: `amocrm_deal_id`, `pipeline_id`, `status_id`, `status_label`, `price`, `custom_fields`
- –ò–Ω–¥–µ–∫—Å—ã: –ø–æ `client_id`, `amocrm_deal_id`, `status_label`, `custom_fields` (GIN)

#### `amocrm_contacts` ‚úÖ
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏–∑ AmoCRM
- –ü–æ–ª—è: `amocrm_contact_id`, `name`, `phone`, `email`, `custom_fields`
- –ò–Ω–¥–µ–∫—Å—ã: –ø–æ `client_id`, `amocrm_contact_id`, `phone`

#### `conversations` ‚úÖ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∞)
- –ü–æ–ª–µ `amocrm_scope_id` –¥–ª—è —Å–≤—è–∑–∏ —Å –¥–∏–∞–ª–æ–≥–∞–º–∏ AmoCRM
- –ò–Ω–¥–µ–∫—Å –ø–æ `amocrm_scope_id`

#### `messages` ‚úÖ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∞)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `channel='amocrm_note'` –¥–ª—è –ø—Ä–∏–º–µ—á–∞–Ω–∏–π –∏–∑ AmoCRM
- –ü–æ–ª–µ `amocrm_note_id` –¥–ª—è —Å–≤—è–∑–∏ —Å –ø—Ä–∏–º–µ—á–∞–Ω–∏—è–º–∏

#### `external_refs` ‚úÖ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–≤—è–∑–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å AmoCRM: `system='amocrm'`, `external_id=contact_id`

#### `sync_state` ‚úÖ
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: `workflow_name='amocrm_deals_scraper'`, `system='amocrm'`

---

### 4. n8n Workflow: AmoCRM Deals Scraper

**–§–∞–π–ª:** `n8n-workflows/amocrm-deals-scraper.json`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏–º–ø–æ—Ä—Ç—É

**–¢—Ä–∏–≥–≥–µ—Ä:** Cron (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–æ–ª—É—á–∏—Ç—å `last_sync` timestamp –∏–∑ –ë–î
2. –ü–æ–ª—É—á–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (status 142) –∏–∑ Playwright Service
3. –ü–æ–ª—É—á–∏—Ç—å –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (status 143) –∏–∑ Playwright Service
4. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–±–µ –≥—Ä—É–ø–ø—ã
5. –î–ª—è –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏:
   - –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏ (—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏)
   - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏—è (notes)
   - –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ: —Ç–µ–ª–µ—Ñ–æ–Ω, custom fields (rentprog_client_id, rentprog_booking_id)
   - Upsert –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
   - –î–æ–±–∞–≤–∏—Ç—å external_refs (amocrm + rentprog)
   - Upsert —Å–¥–µ–ª–∫—É –≤ `amocrm_deals`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å notes –∫–∞–∫ messages (channel='amocrm_note')
6. –û–±–Ω–æ–≤–∏—Ç—å `sync_state`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ Incremental updates (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏)
- ‚úÖ –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ `external_refs`
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ custom fields –¥–ª—è —Å–≤—è–∑–∏ —Å RentProg
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–π –∫–∞–∫ messages –¥–ª—è RAG

---

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–§–∞–π–ª—ã:**
- ‚úÖ `docs/WORKFLOWS_SPEC.md` - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è workflows
- ‚úÖ `docs/WORKFLOWS_README.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- ‚úÖ `ARCHITECTURE.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã (—É–ø–æ–º–∏–Ω–∞–Ω–∏—è AmoCRM)
- ‚úÖ `AGENTS.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö AmoCRM

---

## üöß –ß—Ç–æ –≤ –ø–ª–∞–Ω–∞—Ö (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### 1. –ù–æ—á–Ω–æ–π –∞–≥–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂ (AmoCRM-only MVP)

**–°—Ç–∞—Ç—É—Å:** üöß –í –ø–ª–∞–Ω–∞—Ö

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ü–æ–∏—Å–∫ –¥–∏–∞–ª–æ–≥–æ–≤, –æ–∂–∏–¥–∞—é—â–∏—Ö –æ—Ç–≤–µ—Ç–∞, —á–µ—Ä–µ–∑ AmoCRM "–ß–∞—Ç—ã –≤ CRM"
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ RAG (–ø–æ–±–µ–¥–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –≤ AmoCRM

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–Ω–æ:** AmoCRM –Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Umnico API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ò–ª–∏: –ü–∞—Ä—Å–∏–Ω–≥ iframe —á–µ—Ä–µ–∑ Playwright (–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- AmoCRM API v4 ("–°–¥–µ–ª–∫–∏", "–ß–∞—Ç—ã –≤ CRM")
- Neon (pgvector) –¥–ª—è RAG
- n8n AI Agent/Ollama –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

---

### 2. –ê–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂

**–°—Ç–∞—Ç—É—Å:** üöß –í –ø–ª–∞–Ω–∞—Ö

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂ –≤ AmoCRM
- –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã
- –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ —Å—Ç—Ä–∞—Ö–æ–≤–æ–∫
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ —Å–¥–µ–ª–∫–∞–º
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** AmoCRM API, Telegram

---

### 3. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫

**–°—Ç–∞—Ç—É—Å:** üöß –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- POST `/api/v4/leads` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫
- PATCH `/api/v4/leads/:id` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–π —á–µ—Ä–µ–∑ POST `/api/v4/leads/:id/notes`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –∏–∑ RentProg –±—Ä–æ–Ω–µ–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á

---

### 4. Webhook –æ—Ç AmoCRM ‚Üí Jarvis

**–°—Ç–∞—Ç—É—Å:** üöß –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ AmoCRM
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π: —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫, –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Jarvis API `/process-event`

---

### 5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** üöß –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ß—Ç–æ –µ—Å—Ç—å:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `amocrm_contacts` —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏–∑ —Å–¥–µ–ª–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- ‚ö†Ô∏è –û—Ç–¥–µ–ª—å–Ω—ã–π workflow –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ –∏–∑ —Å–¥–µ–ª–æ–∫)
- ‚ö†Ô∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

## üìã Checklist –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ì–æ—Ç–æ–≤–æ ‚úÖ
- [x] –†–∞–∑–≤–µ–¥–∫–∞ AmoCRM API
- [x] Playwright Service –¥–ª—è AmoCRM
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (amocrm_deals, amocrm_contacts)
- [x] n8n Workflow: AmoCRM Deals Scraper
- [x] Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –í –ø–ª–∞–Ω–∞—Ö üöß
- [ ] –ù–æ—á–Ω–æ–π –∞–≥–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂ (MVP)
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ —á–µ—Ä–µ–∑ API
- [ ] Webhook –æ—Ç AmoCRM
- [ ] –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- [ ] –ê–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RentProg (–∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫)

---

## üîß –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ó–∞–ø—É—Å–∫ Playwright Service

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env
AMOCRM_EMAIL=geodrive.ge@gmail.com
AMOCRM_PASSWORD=wnr3c4%UqN@jY23
AMOCRM_SUBDOMAIN=geodrive

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ docker-compose
docker-compose up -d playwright-amocrm

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health
curl http://46.224.17.15:3002/health
```

### 2. –ò–º–ø–æ—Ä—Ç n8n Workflow

```bash
# –ß–µ—Ä–µ–∑ n8n UI:
# 1. –û—Ç–∫—Ä—ã—Ç—å https://n8n.rentflow.rentals
# 2. Workflows ‚Üí Import from File
# 3. –í—ã–±—Ä–∞—Ç—å n8n-workflows/amocrm-deals-scraper.json
# 4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
SELECT * FROM sync_state WHERE workflow_name = 'amocrm_deals_scraper';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫
SELECT status_label, COUNT(*) FROM amocrm_deals GROUP BY status_label;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ AmoCRM notes
SELECT COUNT(*) FROM messages WHERE channel = 'amocrm_note';
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. –ß–∞—Ç—ã —á–µ—Ä–µ–∑ AmoCRM

**–ü—Ä–æ–±–ª–µ–º–∞:** AmoCRM –Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (scope_id, lead_id)

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Umnico API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ö†Ô∏è –ò–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ iframe —á–µ—Ä–µ–∑ Playwright (–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–º. `amocrm/RECONNAISSANCE_REPORT.md` —Ä–∞–∑–¥–µ–ª "–ß–∞—Ç—ã (Talks / Amojo)"

### 2. Session-based –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Cookies –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ `access_token_expires_at`

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π re-login –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –≤ —Ñ–∞–π–ª
- ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π re-login —á–µ—Ä–µ–∑ POST `/api/relogin`

### 3. Rate limits

**–ü—Ä–æ–±–ª–µ–º–∞:** Rate limits –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (max 5-7 req/sec)
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ incremental updates

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–†–∞–∑–≤–µ–¥–∫–∞:** `amocrm/RECONNAISSANCE_REPORT.md`
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è workflows:** `docs/WORKFLOWS_SPEC.md`
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** `docs/WORKFLOWS_README.md`
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `ARCHITECTURE.md`
- **–ê–≥–µ–Ω—Ç—ã:** `AGENTS.md` (—Ä–∞–∑–¥–µ–ª—ã 20, 35)

---

## üéØ –ò—Ç–æ–≥

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** ‚úÖ **–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ (—É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–π –∫–∞–∫ messages –¥–ª—è RAG
- ‚úÖ –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ external_refs
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ custom fields –¥–ª—è —Å–≤—è–∑–∏ —Å RentProg

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- üöß –ù–æ—á–Ω–æ–π –∞–≥–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂ (—Ç—Ä–µ–±—É–µ—Ç Umnico API)
- üöß –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫
- üöß Webhook –æ—Ç AmoCRM
- üöß –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-09  
**–ê–≤—Ç–æ—Ä:** Jarvis AI Agent

