# –û—Ç—á—ë—Ç –ø–æ —Ä–∞–∑–≤–µ–¥–∫–µ AmoCRM (—á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä)

**–î–∞—Ç–∞:** 2025-11-09  
**–ê–∫–∫–∞—É–Ω—Ç:** geodrive.amocrm.ru  
**–ú–µ—Ç–æ–¥:** Chrome DevTools + –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ª–æ–≥–∏–Ω  

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

1. ‚úÖ **–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –≤–µ–±-—Ñ–æ—Ä–º—É
2. ‚úÖ **–°–æ–±—Ä–∞–Ω—ã cookies** (14 –∫–ª—é—á–µ–≤—ã—Ö cookie)
3. ‚úÖ **–°–æ–±—Ä–∞–Ω—ã localStorage keys** (23 –∫–ª—é—á–∞, –≤–∫–ª—é—á–∞—è `amojo_token`)
4. ‚úÖ **–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏** –¥–ª—è AJAX
5. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ—Ä–æ–Ω–∫–∏ "–ü–µ—Ä–≤–∏—á–∫–∞"**
6. ‚úÖ **–ù–∞–π–¥–µ–Ω—ã ID —Å–∫—Ä—ã—Ç—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤** (—É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ)
7. ‚úÖ **–ö–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã API endpoints** –∏–∑ Network

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –¢–∏–ø
**Session-based (cookie authentication)**

### –ü—Ä–æ—Ü–µ—Å—Å –ª–æ–≥–∏–Ω–∞
1. GET `https://geodrive.amocrm.ru/` ‚Üí –ø–æ–ª—É—á–∏—Ç—å `csrf_token` –∏–∑ HTML
2. POST —Ñ–æ—Ä–º–∞ —Å credentials:
   - `username`: `geodrive.ge@gmail.com`
   - `password`: `wnr3c4%UqN@jY23`
   - `csrf_token`: –∏–∑ —à–∞–≥–∞ 1
3. Cookies –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º
4. –î–ª—è —á–∞—Ç–æ–≤: `amojo_token` –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ `localStorage`

### –ö–ª—é—á–µ–≤—ã–µ cookies

```
last_login
access_token_expires_at
user_lang
LAST_PLACE_TODO
LAST_PLACE_DEALS
LAST_PLACE_CONTACTS
server_time
```

### localStorage –∫–ª—é—á–∏

**–ö—Ä–∏—Ç–∏—á–Ω—ã–π –¥–ª—è —á–∞—Ç–æ–≤:**
```javascript
amojo_token = {
  "expiredAt": 1762926664,
  "refreshToken": "0bb9fe5c-118e-4547-b899-6795a5ecf010",
  "token": "ca8405c3-f1c0-4a1d-9a30-8ab432f8ad56",
  "user": 11479478
}
```

**–î—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ:**
- `amojo_templates` - —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- `amojo_next_page_link` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è —á–∞—Ç–æ–≤
- `NOVA_SERVER` - —Å–µ—Ä–≤–µ—Ä –¥–ª—è WebSocket
- `amocrm_write_first_lead_sources` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

```http
X-Requested-With: XMLHttpRequest  (–¥–ª—è AJAX!)
Content-Type: application/json
Referer: https://geodrive.amocrm.ru/
Origin: https://geodrive.amocrm.ru
Cookie: [session cookies]
```

---

## üó∫Ô∏è –ö–∞—Ä—Ç–∞ API Endpoints

### –ë–∞–∑–æ–≤—ã–π URL
```
https://geodrive.amocrm.ru
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

#### 1. –í–æ—Ä–æ–Ω–∫–∏ (Pipelines)

**–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤–æ—Ä–æ–Ω–∫–∏:**
```http
GET /api/v4/leads/pipelines
```

**–ü–æ–ª—É—á–∏—Ç—å –≤–æ—Ä–æ–Ω–∫—É "–ü–µ—Ä–≤–∏—á–∫–∞" —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏:**
```http
GET /api/v4/leads/pipelines/8580102
```

**–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
- `id`: 8580102
- `name`: "–ü–µ—Ä–≤–∏—á–∫–∞"
- `is_main`: true
- `_embedded.statuses[]`: –º–∞—Å—Å–∏–≤ –∏–∑ 21 —Å—Ç–∞—Ç—É—Å–∞

#### 2. –°–¥–µ–ª–∫–∏ (Leads)

**–°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫:**
```http
GET /api/v4/leads?filter[pipeline_id]=8580102
```

**–û–¥–Ω–∞ —Å–¥–µ–ª–∫–∞:**
```http
GET /api/v4/leads/38617385
```

**–§–∞–π–ª—ã —Å–¥–µ–ª–∫–∏:**
```http
GET /ajax/v4/leads/38617385/files
```

#### 3. –ö–æ–Ω—Ç–∞–∫—Ç—ã

```http
GET /api/v4/contacts
GET /api/v4/contacts/{id}
```

#### 4. –ö–∞—Ç–∞–ª–æ–≥–∏

```http
GET /api/v4/catalogs/5915/elements
GET /ajax/v1/catalog_elements/list/?catalog_id=5915&json=1&page=1
```

#### 5. –ß–∞—Ç—ã ‚ö†Ô∏è (–û–ì–†–ê–ù–ò–ß–ï–ù)

**–†–∞–±–æ—Ç–∞—é—â–∏–π endpoint:**
```http
GET /ajax/v2/talks
```

**–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```http
GET /api/v4/talks/chats  ‚Üí 404 Not Found
```

**–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π:**
```http
GET /ajax/v4/chats/templates?with=favorite
```

**–ë–æ—Ç—ã:**
```http
GET /api/v4/bots?with=favorite
```

#### 6. –§–∞–π–ª—ã

**–¢–æ–∫–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏:**
```http
GET /ajax/v4/files/issue_token
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:**
```http
GET https://drive-b.amocrm.ru/v1.0/files?filter[uuid]=69a48579-dec2-4a56-b2de-42ef71bece29
```

#### 7. –ê–∫–∫–∞—É–Ω—Ç

```http
GET /api/v4/account
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 31933214,
  "subdomain": "geodrive",
  "currency": "GEL",
  ...
}
```

---

## üìä –í–æ—Ä–æ–Ω–∫–∞ "–ü–µ—Ä–≤–∏—á–∫–∞" (ID: 8580102)

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **ID:** `8580102`
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** "–ü–µ—Ä–≤–∏—á–∫–∞"
- **–¢–∏–ø:** –û—Å–Ω–æ–≤–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞ (`is_main: true`)
- **–í—Å–µ–≥–æ —Å—Ç–∞—Ç—É—Å–æ–≤:** 21

### –ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã (19)

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | Sort | –¶–≤–µ—Ç | –¢–∏–ø |
|----|----------|------|------|-----|
| 69641334 | –ù–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω–æ–µ | 10 | #c1c1c1 | –°–∏—Å—Ç–µ–º–Ω—ã–π |
| 76072006 | –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Å–¥–µ–ª–∫–∏ | 20 | #fff000 | –û–±—ã—á–Ω—ã–π |
| 76057418 | –û–±—ä–µ–¥–∏–Ω–∏ —Å–¥–µ–ª–∫—É | 30 | #87f2c0 | –û–±—ã—á–Ω—ã–π |
| 69641338 | –ù–æ–≤—ã–π –ª–∏–¥ | 40 | #ff8f92 | –û–±—ã—á–Ω—ã–π |
| 69641342 | –í–∑—è—Ç –≤ —Ä–∞–±–æ—Ç—É | 50 | #eb93ff | –û–±—ã—á–Ω—ã–π |
| 75648530 | –ü–æ–¥–±–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω | 60 | #99ccff | –û–±—ã—á–Ω—ã–π |
| 69695126 | –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ | 70 | #ccc8f9 | –û–±—ã—á–Ω—ã–π |
| 75558642 | –§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç | 80 | #f3beff | –û–±—ã—á–Ω—ã–π |
| 70390022 | –ù–µ –æ—Ç–≤–µ—á–∞—é—Ç | 90 | #87f2c0 | –û–±—ã—á–Ω—ã–π |
| 70363398 | –û–∂–∏–¥–∞–µ–º –î–æ–∫–∏ | 100 | #ebffb1 | –û–±—ã—á–Ω—ã–π |
| 69717006 | –ü–æ–ª—É—á–µ–Ω—ã –¥–æ–∫–∏ | 110 | #c1e0ff | –û–±—ã—á–Ω—ã–π |
| 72457238 | –ë—Ä–æ–Ω–∏ –∏–∑ Rentprog | 120 | #ff8f92 | –û–±—ã—á–Ω—ã–π |
| 71150590 | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Rentprog | 130 | #ffc8c8 | –û–±—ã—á–Ω—ã–π |
| 69695130 | –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–æ–≥ | 140 | #ffce5a | –û–±—ã—á–Ω—ã–π |
| 70724666 | –í—ã–¥–∞—á–∞ | 150 | #99ccff | –û–±—ã—á–Ω—ã–π |
| 72177974 | –ê—Ä–µ–Ω–¥–∞ | 160 | #99ccff | –û–±—ã—á–Ω—ã–π |
| 70724674 | –ü—Ä–∏–µ–º–∫–∞ | 170 | #99ccff | –û–±—ã—á–Ω—ã–π |
| 75235938 | –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä | 180 | #99ccff | –û–±—ã—á–Ω—ã–π |
| 71480394 | –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - –Ω–µ —É–¥–∞–ª—è—Ç—å | 190 | #99ccff | –û–±—ã—á–Ω—ã–π |

### –°–∫—Ä—ã—Ç—ã–µ —Å—Ç–∞—Ç—É—Å—ã (2) ‚≠ê

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | Sort | –¶–≤–µ—Ç | –§–∏–ª—å—Ç—Ä |
|----|----------|------|------|--------|
| **142** | **–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** | 10000 | #CCFF66 | `filter[pipe][8580102][]=142` |
| **143** | **–ó–∞–∫—Ä—ã—Ç–æ –∏ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** | 11000 | #D5D8DB | `filter[pipe][8580102][]=143` |

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —Å—Ç–∞—Ç—É—Å—ã

**–ß–µ—Ä–µ–∑ —Ñ–∏–ª—å—Ç—Ä URL:**
```
–£—Å–ø–µ—à–Ω—ã–µ:
https://geodrive.amocrm.ru/leads/pipeline/8580102/?filter[pipe][8580102][]=142&useFilter=y

–ù–µ—É—Å–ø–µ—à–Ω—ã–µ:
https://geodrive.amocrm.ru/leads/pipeline/8580102/?filter[pipe][8580102][]=143&useFilter=y
```

**–ß–µ—Ä–µ–∑ API:**
```http
GET /api/v4/leads/pipelines/8580102
```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å–µ** —Å—Ç–∞—Ç—É—Å—ã, –≤–∫–ª—é—á–∞—è —Å–∫—Ä—ã—Ç—ã–µ.

---

## üí¨ –ß–∞—Ç—ã (Talks / Amojo)

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ù–ê–•–û–î–ö–ê

**–í–°–ï –°–û–û–ë–©–ï–ù–ò–Ø –•–†–ê–ù–Ø–¢–°–Ø –í UMNICO!**

AmoCRM **–ù–ï –•–†–ê–ù–ò–¢** —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –û–Ω —Ç–æ–ª—å–∫–æ:
1. –•—Ä–∞–Ω–∏—Ç `scope_id` (ID –¥–∏–∞–ª–æ–≥–∞) –∏ `lead_id` (ID —Å–¥–µ–ª–∫–∏)
2. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç iframe —Å Umnico –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–∞—Ç–æ–≤

```
–ö–ª–∏–µ–Ω—Ç ‚Üí WhatsApp/Telegram/Instagram
    ‚Üì
Umnico (—Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è)
    ‚Üì (—Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
AmoCRM (scope_id + lead_id)
    ‚Üì (iframe –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
Umnico Widget (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
```

### AmoCRM endpoints (—Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)

**–°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤:**
```http
GET /ajax/v4/inbox/list?limit=50&order[sort_by]=last_message_at&order[sort_type]=desc
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ URL:**
```
/imbox/{scope_id}/leads/detail/{lead_id}
–ü—Ä–∏–º–µ—Ä: /imbox/38187/leads/detail/38638793
```

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ —á–∞—Ç–æ–≤:**
```http
GET /ajax/v4/sources?only=chats
```

**‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (404):**
```http
GET /api/v4/talks/chats
GET /ajax/v4/scopes/{scope_id}/messages
GET /ajax/v4/inbox/{scope_id}/messages
```

### Umnico Integration (–ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è)

**Base URL:** `https://umnico.com/api`

**–¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- ‚ùå AmoCRM cookies –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è Umnico
- ‚úÖ –ù—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π Umnico –∞–∫–∫–∞—É–Ω—Ç —Å API –∫–ª—é—á–æ–º

**Endpoints:**
```http
GET /user/manage
GET /user/integrations
GET /integrations/amocrm3/sources
GET /integrations/amocrm3/settings/1?domain=geodrive.amocrm.ru
```

**Widget –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `umnico_plugin_id`: `92e8c9f4-05d5-423a-bce5-fda956d1cfb4`
- `umnico_user_id`: `11479478`

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–π iframe

AmoCRM –∑–∞–≥—Ä—É–∂–∞–µ—Ç Umnico —á–µ—Ä–µ–∑ iframe:
```html
<iframe src="data:text/html;charset=utf-8,<html lang='ru'><body><script>
  window.location='https://umnico.com/deals?umnico_plugin_id=92e8c9f4-05d5-423a-bce5-fda956d1cfb4&umnico_user_id=11479478&showHandShake=1'
</script></body></html>">
```

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ AmoCRM API**
   - AmoCRM —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
   - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¢–û–õ–¨–ö–û –≤ Umnico

2. **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ Umnico**
   - –û—Ç–¥–µ–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - API –∫–ª—é—á Umnico
   - –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

3. **–ë–µ–∑ Umnico –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ:**
   - ‚úÖ –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ (scope_id)
   - ‚úÖ –°–≤—è–∑—å –¥–∏–∞–ª–æ–≥ ‚Üî —Å–¥–µ–ª–∫–∞
   - ‚úÖ –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   - ‚ùå –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

### –†–µ—à–µ–Ω–∏—è

**–í–∞—Ä–∏–∞–Ω—Ç 1: Umnico API** ‚≠ê (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á Umnico
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Umnico API –Ω–∞–ø—Ä—è–º—É—é
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü–∞—Ä—Å–∏–Ω–≥ iframe —á–µ—Ä–µ–∑ Playwright**
- –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ AmoCRM
- –û—Ç–∫—Ä—ã—Ç—å imbox —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –ò–∑–≤–ª–µ—á—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ iframe
- ‚ö†Ô∏è –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–í–∞—Ä–∏–∞–Ω—Ç 3: Webhook –æ—Ç Umnico**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook Umnico ‚Üí Jarvis
- –ü–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ real-time
- ‚ö†Ô∏è –ù–µ –¥–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### 1. –ü–æ–ª—É—á–∏—Ç—å –≤–æ—Ä–æ–Ω–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏

```http
GET /api/v4/leads/pipelines/8580102
Cookie: [session cookies]
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 8580102,
  "name": "–ü–µ—Ä–≤–∏—á–∫–∞",
  "is_main": true,
  "_embedded": {
    "statuses": [
      {
        "id": 69641338,
        "name": "–ù–æ–≤—ã–π –ª–∏–¥",
        "sort": 40,
        "color": "#ff8f92"
      },
      ...
      {
        "id": 142,
        "name": "–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ",
        "sort": 10000,
        "color": "#CCFF66"
      }
    ]
  }
}
```

### 2. –ü–æ–ª—É—á–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏

```http
GET /api/v4/leads?filter[pipeline_id]=8580102&filter[status_id]=142&limit=50
Cookie: [session cookies]
```

### 3. –ü–æ–ª—É—á–∏—Ç—å amojo_token

```javascript
const amojoToken = JSON.parse(localStorage.getItem('amojo_token'));
// {
//   "token": "ca8405c3-f1c0-4a1d-9a30-8ab432f8ad56",
//   "refreshToken": "0bb9fe5c-118e-4547-b899-6795a5ecf010",
//   "expiredAt": 1762926664,
//   "user": 11479478
// }
```

### 4. AJAX –∑–∞–ø—Ä–æ—Å –∫ —á–∞—Ç–∞–º

```http
GET /ajax/v2/talks?limit=10
Cookie: [session cookies]
X-Requested-With: XMLHttpRequest
```

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫

1. **–ß–∞—Ç—ã —á–µ—Ä–µ–∑ Amojo - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã**
   - `/api/v4/talks/chats` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (404)
   - –¢–æ–ª—å–∫–æ `/ajax/v2/talks` –¥–æ—Å—Ç—É–ø–µ–Ω
   - **Mitigation:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Umnico API

2. **Session-based auth - –∏—Å—Ç–µ–∫–∞–µ—Ç**
   - Cookies –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ `access_token_expires_at`
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
   - **Mitigation:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å—Ç–µ—á–µ–Ω–∏—è + –∞–≤—Ç–æ—Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç

### –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫

1. **CSRF —Ç–æ–∫–µ–Ω —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º**
   - –ù—É–∂–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–∑ HTML –ø–µ—Ä–µ–¥ –ª–æ–≥–∏–Ω–æ–º
   - **Mitigation:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Playwright –¥–ª—è –∞–≤—Ç–æ-–ª–æ–≥–∏–Ω–∞

2. **Amojo —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è**
   - `expiredAt` timestamp
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `refreshToken`
   - **Mitigation:** –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

### –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫

1. **Rate limits –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã**
   - –ù–µ—Ç —è–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
   - **Mitigation:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (max 5-7 req/sec)

---

## üìã Checklist –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [x] Playwright —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ-–ª–æ–≥–∏–Ω–∞
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ session cookies
- [x] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ amojo_token
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏ –∞–≤—Ç–æ—Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç

### API –∑–∞–ø—Ä–æ—Å—ã
- [x] –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–æ—Ä–æ–Ω–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å–æ–≤
- [x] –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- [x] –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–π

### –ß–∞—Ç—ã
- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Amojo API
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Umnico (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- [ ] –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–∞—Ä—Å–∏–Ω–≥ HTML —á–∞—Ç–æ–≤

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Jarvis
- [ ] Mapping —Å—Ç–∞—Ç—É—Å–æ–≤ AmoCRM ‚Üî RentProg
- [ ] Webhook –æ—Ç AmoCRM ‚Üí Jarvis
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –∏–∑ RentProg –±—Ä–æ–Ω–µ–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

## üìÅ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

–°–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

1. **`auth_profile.json`** - –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - Credentials
   - Cookies –∏ localStorage –∫–ª—é—á–∏
   - –ó–∞–≥–æ–ª–æ–≤–∫–∏
   - Amojo —Ç–æ–∫–µ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

2. **`endpoints_spec.json`** - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è endpoints
   - –í—Å–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ API –ø—É—Ç–∏
   - –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ—Ä–æ–Ω–∫–∏ "–ü–µ—Ä–≤–∏—á–∫–∞"
   - ID –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (–≤–∫–ª—é—á–∞—è —Å–∫—Ä—ã—Ç—ã–µ)
   - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ workarounds

3. **`RECONNAISSANCE_REPORT.md`** - —ç—Ç–æ—Ç –æ—Ç—á—ë—Ç

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (MVP)

1. ‚úÖ Playwright —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ-–ª–æ–≥–∏–Ω–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è cookies
2. ‚úÖ Mapping —Å—Ç–∞—Ç—É—Å–æ–≤ –≤–æ—Ä–æ–Ω–∫–∏ "–ü–µ—Ä–≤–∏—á–∫–∞"
3. ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ —á–µ—Ä–µ–∑ API v4
4. ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Umnico –¥–ª—è —á–∞—Ç–æ–≤

### –ö–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫

1. Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ (AmoCRM ‚Üí Jarvis)
2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –∏–∑ RentProg –±—Ä–æ–Ω–µ–π
3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
4. –ë–∞–∑–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å —á–∞—Ç–∞–º–∏ (–µ—Å–ª–∏ Umnico –¥–æ—Å—Ç—É–ø–µ–Ω)

### –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫

1. –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –Ω–æ—á–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ–¥–∞–∂
3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≤–æ—Ä–æ–Ω–∫–µ
4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ Umnico

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–†–∞–∑–≤–µ–¥–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.** –ü–æ–ª—É—á–µ–Ω—ã:
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (cookies, tokens, headers)
- ‚úÖ –ö–∞—Ä—Ç–∞ API endpoints —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ—Ä–æ–Ω–∫–∏ "–ü–µ—Ä–≤–∏—á–∫–∞" —Å–æ –≤—Å–µ–º–∏ 21 —Å—Ç–∞—Ç—É—Å–æ–º
- ‚úÖ ID —Å–∫—Ä—ã—Ç—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (—É—Å–ø–µ—à–Ω—ã–µ 142, –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ 143)
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Amojo API (—Ç—Ä–µ–±—É–µ—Ç—Å—è Umnico –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤)

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** ‚úÖ –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.

**–ö—Ä–∏—Ç–∏—á–Ω—ã–π –º–æ–º–µ–Ω—Ç:** –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Umnico –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ HTML.

