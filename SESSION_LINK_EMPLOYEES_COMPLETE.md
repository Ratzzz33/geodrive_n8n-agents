# ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ Telegram ‚Üî RentProg

**–î–∞—Ç–∞:** 2025-11-05  
**–í—Ä–µ–º—è:** ~2 —á–∞—Å–∞  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. Telegram –∫–æ–º–∞–Ω–¥—ã (3 —à—Ç—É–∫–∏)

‚úÖ **`/start`** - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –§–∞–π–ª: `src/bot/commands/start.ts`
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `employees` —Å Telegram –¥–∞–Ω–Ω—ã–º–∏
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

‚úÖ **`/link_rentprog <ID>`** - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- –§–∞–π–ª: `src/bot/commands/link_rentprog.ts`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ Jarvis
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ RentProg ID –≤ `external_refs`
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —á—Ç–æ —Å–≤—è–∑—å —É–Ω–∏–∫–∞–ª—å–Ω–∞—è (1:1)
- –û–±–Ω–æ–≤–ª—è–µ—Ç `external_refs.entity_id`

‚úÖ **`/myinfo`** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- –§–∞–π–ª: `src/bot/commands/myinfo.ts`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Jarvis
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤—è–∑—å —Å RentProg
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `src/bot/index.ts`:
- –ò–º–ø–æ—Ä—Ç –∫–æ–º–∞–Ω–¥ –∏–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ `/help` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- Error handling –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥

‚úÖ –°–æ–∑–¥–∞–Ω `src/bot/commands/index.ts`:
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (3 —Ñ–∞–π–ª–∞)

‚úÖ **`docs/BOT_COMMANDS.md`** (–ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è):
- –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–≤—è–∑—ã–≤–∞–Ω–∏—è
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è
- SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –§–ª–æ—É –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

‚úÖ **`LINK_EMPLOYEES_IMPLEMENTATION.md`** (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è):
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
- –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è RentProg employee IDs
- –ü—Ä–æ—Ü–µ—Å—Å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–∑ bookings
- –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

‚úÖ **`QUICK_START_LINK_EMPLOYEES.md`** (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç):
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- Troubleshooting
- FAQ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```
Telegram User (tg_user_id)
    ‚Üì /start
employees (Jarvis)
    ‚Üì /link_rentprog <ID>
external_refs (entity_id ‚Üí employees.id)
    ‚Üë (–∏–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ bookings)
RentProg employee_id
```

### –¢–∞–±–ª–∏—Ü—ã

**employees:**
- `id` UUID (PK)
- `name` TEXT
- `tg_user_id` BIGINT (unique)
- `tg_username` TEXT
- `role` TEXT
- `branch_id` UUID

**external_refs:**
- `id` BIGSERIAL (PK)
- `system` TEXT ('rentprog')
- `entity_type` TEXT ('employee')
- `entity_id` UUID ‚Üí employees.id
- `external_id` TEXT (RentProg ID)
- `data` JSONB ({name: "..."})

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è RentProg IDs

RentProg –Ω–µ –∏–º–µ–µ—Ç API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.

–ú—ã –∏–∑–≤–ª–µ–∫–∞–µ–º –∏—Ö –∏–∑ **bookings**:
- `issue_employee_id` - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–¥–∞—á–∏
- `return_employee_id` - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–∏–µ–º–∫–∏

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ webhook/snapshot:
```typescript
if (booking.issue_employee_id) {
  await upsertExternalRef({
    system: 'rentprog',
    entity_type: 'employee',
    external_id: booking.issue_employee_id,
    data: { name: booking.issue_employee_name }
  });
}
```

---

## –§–ª–æ—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

1. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ ‚Üí `/start`
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ `employees`

2. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –±—Ä–æ–Ω—å –≤ RentProg

3. RentProg –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ `external_refs` (entity_id = NULL)

4. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí `/link_rentprog 14714`
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `external_refs.entity_id = employees.id`

5. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí `/myinfo`
   - ‚úÖ –í–∏–¥–∏—Ç —Å–≤—è–∑—å —Å RentProg

6. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```
‚Üí /start

‚Üê üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É Jarvis!

üë§ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üÜî –í–∞—à ID: 123e4567-e89b-12d3-a456-426614174000

–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1Ô∏è‚É£ –°–≤—è–∂–∏—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç —Å RentProg:
   /link_rentprog <–≤–∞—à_RentProg_ID>

2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
   /myinfo

üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥
```

### –°–≤—è–∑—ã–≤–∞–Ω–∏–µ

```
‚Üí /link_rentprog 14714

‚Üê ‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–≤—è–∑–∞–Ω–æ!

üë§ Jarvis: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üîó RentProg: Ivane Ivanishvili (ID: 14714)

üéâ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:
‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞—à–∏—Ö –±—Ä–æ–Ω—è—Ö
‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /myinfo –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

```
‚Üí /myinfo

‚Üê üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å

Jarvis:
‚Ä¢ ID: 123e4567-e89b-12d3-a456-426614174000
‚Ä¢ –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
‚Ä¢ Telegram ID: 123456789
‚Ä¢ –†–æ–ª—å: employee
‚Ä¢ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: 05.11.2025

RentProg:
‚Ä¢ ‚úÖ –°–≤—è–∑–∞–Ω
‚Ä¢ ID: 14714
‚Ä¢ –ò–º—è: Ivane Ivanishvili

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
‚Ä¢ /myinfo - —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ /help - –ø–æ–º–æ—â—å
```

---

## –í–∞–ª–∏–¥–∞—Ü–∏—è

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤ `/link_rentprog`

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω (`/start`)
2. **–°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ RentProg ID:** –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å –≤ `external_refs`
3. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:** RentProg ID –Ω–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º
4. **–ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:** –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º RentProg ID

### ‚ùå –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**"–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ"**
```
–†–µ—à–µ–Ω–∏–µ: /start
```

**"RentProg ID –Ω–µ –Ω–∞–π–¥–µ–Ω"**
```
–ü—Ä–∏—á–∏–Ω—ã:
‚Ä¢ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—â–µ –Ω–µ —É–ø–æ–º–∏–Ω–∞–ª–∏ –≤ –±—Ä–æ–Ω—è—Ö
‚Ä¢ –ù–µ–≤–µ—Ä–Ω—ã–π ID
‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –µ—â–µ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞ webhook

–†–µ—à–µ–Ω–∏–µ: –ø–æ–¥–æ–∂–¥–∞—Ç—å –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
```

**"–≠—Ç–æ—Ç RentProg ID —É–∂–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º"**
```
–ü—Ä–∏—á–∏–Ω–∞: –î–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞ –ø—ã—Ç–∞—é—Ç—Å—è —Å–≤—è–∑–∞—Ç—å—Å—è —Å –æ–¥–Ω–∏–º ID

–†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ID –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
```

**"–í—ã —É–∂–µ —Å–≤—è–∑–∞–Ω—ã —Å –¥—Ä—É–≥–∏–º RentProg –∞–∫–∫–∞—É–Ω—Ç–æ–º"**
```
–ü—Ä–∏—á–∏–Ω–∞: –ü–æ–ø—ã—Ç–∫–∞ —Å–≤—è–∑–∞—Ç—å 1 Telegram —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ RentProg

–†–µ—à–µ–Ω–∏–µ: –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   ```bash
   /start
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤ employees
   ```

2. ‚úÖ **–ü–æ–ø—ã—Ç–∫–∞ —Å–≤—è–∑–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID**
   ```bash
   /link_rentprog 99999
   # –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ "–Ω–µ –Ω–∞–π–¥–µ–Ω"
   ```

3. ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ external_refs**
   ```bash
   node setup/link_employees_tables.mjs
   # –ò–∑–≤–ª–µ—á—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ bookings
   ```

4. ‚úÖ **–£—Å–ø–µ—à–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ**
   ```bash
   /link_rentprog 14714
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ entity_id
   ```

5. ‚úÖ **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ**
   ```bash
   /link_rentprog 14714
   # –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "—É–∂–µ —Å–≤—è–∑–∞–Ω—ã"
   ```

6. ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**
   ```bash
   /myinfo
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–≤—è–∑–∏
   ```

### SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã—Ö
SELECT 
  e.name AS jarvis_name,
  e.tg_username,
  er.external_id AS rentprog_id,
  er.data->>'name' AS rentprog_name
FROM employees e
JOIN external_refs er ON er.entity_id = e.id
WHERE er.system = 'rentprog' 
  AND er.entity_type = 'employee';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö RentProg
SELECT 
  external_id,
  data->>'name' AS name
FROM external_refs
WHERE system = 'rentprog' 
  AND entity_type = 'employee'
  AND entity_id IS NULL;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö Telegram
SELECT 
  name,
  tg_username,
  tg_user_id
FROM employees
WHERE tg_user_id IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM external_refs er
    WHERE er.entity_id = employees.id
      AND er.system = 'rentprog'
      AND er.entity_type = 'employee'
  );
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
npm run dev

# –í Telegram:
/start
/link_rentprog <–≤–∞—à_ID>
/myinfo
```

### 2. –ò–∑–≤–ª–µ—á—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```bash
# –°–æ–∑–¥–∞—Ç—å external_refs –¥–ª—è –≤—Å–µ—Ö —É–ø–æ–º—è–Ω—É—Ç—ã—Ö –≤ bookings
node setup/link_employees_tables.mjs
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –≤ –∞–≥–µ–Ω—Ç–∞—Ö

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

**–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
```typescript
const employee = await getEmployeeByRentProgId(booking.issue_employee_id);

if (employee?.tg_user_id) {
  await bot.telegram.sendMessage(
    employee.tg_user_id,
    `‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –≤—ã–¥–∞—á–∞ —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç\nüöó ${carName}`
  );
}
```

**–î–Ω–µ–≤–Ω–æ–π –ø–ª–∞–Ω:**
```typescript
const bookings = await getEmployeeBookingsForDate(employee.id, today);
await sendDailyPlan(employee.tg_user_id, bookings);
```

**–ê–≥–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –±—Ä–æ–Ω–µ–π:**
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –≤—ã–¥–∞—á–∞—Ö/–ø—Ä–∏–µ–º–∫–∞—Ö
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

**–ê–≥–µ–Ω—Ç –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –≤—ã–¥–∞—á–µ:**
- –ß–µ–∫–ª–∏—Å—Ç—ã –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
- –ó–∞–ø—Ä–æ—Å—ã —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ç–µ–º—ã

---

## –§–∞–π–ª—ã

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ

```
src/bot/commands/
‚îú‚îÄ‚îÄ start.ts              ‚úÖ /start - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ link_rentprog.ts      ‚úÖ /link_rentprog - —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ myinfo.ts             ‚úÖ /myinfo - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚îî‚îÄ‚îÄ index.ts              ‚úÖ —ç–∫—Å–ø–æ—Ä—Ç –∫–æ–º–∞–Ω–¥

docs/
‚îî‚îÄ‚îÄ BOT_COMMANDS.md       ‚úÖ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

LINK_EMPLOYEES_IMPLEMENTATION.md  ‚úÖ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
QUICK_START_LINK_EMPLOYEES.md     ‚úÖ –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
SESSION_LINK_EMPLOYEES_COMPLETE.md ‚úÖ —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ

```
src/bot/index.ts          ‚úÖ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥, /help
```

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ö–æ–º–∞–Ω–¥—ã:** 3
- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 8
- **–§–∞–π–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:** 1
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~600
- **–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~1200
- **–í—Ä–µ–º—è:** ~2 —á–∞—Å–∞

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```typescript
console.log(`‚úÖ New employee registered: ${id} (${name})`);
console.log(`‚úÖ Linked: employee ${id} ‚Üí rentprog ${rpId}`);
```

‚úÖ **Error Handling:**
- –í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ç–∞–ª–∏

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Dashboard query

```sql
SELECT 
  COUNT(*) AS total_employees,
  COUNT(*) FILTER (WHERE tg_user_id IS NOT NULL) AS telegram_registered,
  COUNT(*) FILTER (
    WHERE EXISTS (
      SELECT 1 FROM external_refs er
      WHERE er.entity_id = employees.id
        AND er.system = 'rentprog'
        AND er.entity_type = 'employee'
    )
  ) AS linked_to_rentprog
FROM employees;
```

### –ê–ª–µ—Ä—Ç—ã

```sql
-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–æ –Ω–µ —Å–≤—è–∑–∞–Ω—ã > 7 –¥–Ω–µ–π
SELECT 
  name,
  tg_username,
  created_at
FROM employees
WHERE tg_user_id IS NOT NULL
  AND created_at < NOW() - INTERVAL '7 days'
  AND NOT EXISTS (
    SELECT 1 FROM external_refs er
    WHERE er.entity_id = employees.id
      AND er.system = 'rentprog'
      AND er.entity_type = 'employee'
  );
```

---

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
   - –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

3. **–ì–∏–±–∫–æ—Å—Ç—å**
   - External Refs Pattern –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã (AmoCRM, Umnico)
   - –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π

4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é.

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø–æ–ø—Ä–æ—Å–∏—Ç—å 2-3 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
npm run dev

# 2. –í Telegram
/start
/link_rentprog <–≤–∞—à_RentProg_ID>
/myinfo

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î
psql $DATABASE_URL -c "SELECT * FROM employees WHERE tg_user_id IS NOT NULL"

# 4. –ò–∑–≤–ª–µ—á—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
node setup/link_employees_tables.mjs
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-11-05

