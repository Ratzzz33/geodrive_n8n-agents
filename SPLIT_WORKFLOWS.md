# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ workflows –Ω–∞ –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö

**–î–∞—Ç–∞:** 2025-11-07  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é

---

## üéØ –¶–µ–ª—å

–†–∞–∑–¥–µ–ª–∏—Ç—å –æ–¥–∏–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π workflow –Ω–∞ –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç–∏.

---

## üìã –ë—ã–ª–æ

**–û–¥–∏–Ω workflow:** `RentProg Monitor - Cash & Events`
- –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ü–∞—Ä—Å–∏–ª –∏ –∫–∞—Å—Å—É, –∏ —Å–æ–±—ã—Ç–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü—Ä–æ–±–ª–µ–º—ã —Å Merge –Ω–æ–¥–∞–º–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å Switch/IF –Ω–æ–¥–∞–º–∏

---

## üìã –°—Ç–∞–ª–æ

### 1. **RentProg Monitor - Company Cash** üí∞

**–§–∞–π–ª:** `n8n-workflows/rentprog-monitor-company-cash.json`

**–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ 4 —Ñ–∏–ª–∏–∞–ª–∞–º (tbilisi, batumi, kutaisi, service-center)
2. GET –∑–∞–ø—Ä–æ—Å –∫ `/company_counts_v2` (–≤—á–µ—Ä–∞ + —Å–µ–≥–æ–¥–Ω—è)
3. –ü–∞—Ä—Å–∏–Ω–≥ –ø–ª–∞—Ç–µ–∂–µ–π –∏–∑ –æ—Ç–≤–µ—Ç–∞
4. –ü—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `payments` —Ç–∞–±–ª–∏—Ü—É
5. Telegram –∞–ª–µ—Ä—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–ù–æ–¥—ã:**
- Every 3 Minutes (Schedule Trigger)
- Prepare Branches (Code)
- Build URLs (Code) - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç URL —Å –¥–∞—Ç–∞–º–∏
- Get Company Cash (HTTP Request)
- Process Cash Data (Code)
- If Has Data (IF)
- Save Payment to DB (Postgres)
- Format Result (Code)
- If Error (IF)
- Send Error Alert (Telegram)

---

### 2. **RentProg Monitor - Booking Events** üìÖ

**–§–∞–π–ª:** `n8n-workflows/rentprog-monitor-booking-events.json`

**–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ 4 —Ñ–∏–ª–∏–∞–ª–∞–º
2. GET –∑–∞–ø—Ä–æ—Å –∫ `/bookings` (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç)
3. –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –∏–∑ –æ—Ç–≤–µ—Ç–∞
4. –ü—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `events` —Ç–∞–±–ª–∏—Ü—É
5. Telegram –∞–ª–µ—Ä—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–ù–æ–¥—ã:**
- Every 3 Minutes (Schedule Trigger)
- Prepare Branches (Code)
- Get Recent Bookings (HTTP Request)
- Process Events Data (Code)
- If Has Data (IF)
- Save Event to DB (Postgres)
- Format Result (Code)
- If Error (IF)
- Send Error Alert (Telegram)

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

### 1. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–º workflow –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å Merge –Ω–æ–¥–∞–º–∏
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

### 2. –ü—Ä–æ—Å—Ç–æ—Ç–∞
- ‚úÖ –ö–∞–∂–¥—ã–π workflow –¥–µ–ª–∞–µ—Ç –æ–¥–Ω—É –≤–µ—â—å
- ‚úÖ –ü—Ä–æ—â–µ –æ—Ç–ª–∞–¥–∫–∞
- ‚úÖ –ü—Ä–æ—â–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ö–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 5 (–±–æ–ª—å—à–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏)
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (—Ä–∞–∑–Ω—ã–µ workflows)
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫–∞–∂–¥—ã–π workflow

### 4. –£–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å
- ‚úÖ –ú–æ–∂–Ω–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω, –æ—Å—Ç–∞–≤–∏–≤ –¥—Ä—É–≥–æ–π
- ‚úÖ –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- ‚úÖ –ú–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üöÄ –î–µ–ø–ª–æ–π

### 1. –ò–º–ø–æ—Ä—Ç workflows

```bash
node setup/import_split_workflows.mjs
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ–±–∞ workflow –≤ n8n
- –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∏—Ö
- –í—ã–≤–æ–¥–∏—Ç ID –∏ URL

### 2. –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ workflow

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–æ–≤—ã—Ö workflows:

```bash
# –ù–∞–π—Ç–∏ ID —Å—Ç–∞—Ä–æ–≥–æ workflow
# –í n8n UI: RentProg Monitor - Cash & Events (K9e80NPPxABA4aJy)

# –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ MCP –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ UI
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Telegram –∞–ª–µ—Ä—Ç—ã

–û–±–∞ workflow –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∞–ª–µ—Ä—Ç—ã –≤ —á–∞—Ç:
- Chat ID: `-1003251225615` (–û—à–∏–±–∫–∏ n8n)
- Bot: `@n8n_alert_geodrive_bot`

**–§–æ—Ä–º–∞—Ç –∞–ª–µ—Ä—Ç–æ–≤:**

**Cash:**
```
üí∞ CASH: TBILISI
–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: 15
‚ö†Ô∏è –û—à–∏–±–æ–∫: 2
```

**Events:**
```
üìÖ EVENTS: BATUMI
–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: 8
```

### Error Handler

–û–±–∞ workflow –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞:
- `errorWorkflow`: `H3UBEp425F5SMyrX` (Error Handler with AI Agent)
- –í—Å–µ executions —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

---

## üóÑÔ∏è –¢–∞–±–ª–∏—Ü—ã –ë–î

### payments
```sql
INSERT INTO payments (
  sum, cash, cashless, "group", subgroup, description,
  car_id, booking_id, client_id, user_id, created_at, raw_data
) VALUES (...)
ON CONFLICT (created_at, user_id, sum)
DO UPDATE SET
  description = EXCLUDED.description,
  raw_data = EXCLUDED.raw_data,
  updated_at = NOW()
```

### events
```sql
INSERT INTO events (
  branch, type, ext_id, ok, reason
) VALUES (...)
ON CONFLICT (branch, type, ext_id) DO UPDATE SET
  ok = true,
  ts = NOW()
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ workflow

### –î–æ –¥–µ–ø–ª–æ—è
1. ‚úÖ –°—Ç–∞—Ä—ã–π workflow —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
2. ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
1. ‚úÖ –î–≤–∞ –Ω–æ–≤—ã—Ö workflow —Ä–∞–±–æ—Ç–∞—é—Ç (–∫–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã)
2. ‚úÖ –°—Ç–∞—Ä—ã–π workflow –º–æ–∂–Ω–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
3. ‚úÖ –°—Ç–∞—Ä—ã–π workflow –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)

### –ü—Ä–æ–≤–µ—Ä–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å executions –æ–±–æ–∏—Ö workflows (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å–ø–µ—à–Ω—ã–º–∏)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î (payments, events)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –∞–ª–µ—Ä—Ç—ã (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫)

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢–æ–∫–µ–Ω—ã Bearer (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–ª—è –æ–±–æ–∏—Ö workflows)
```javascript
const TOKENS = {
  'service-center': 'eyJhbGciOiJIUzI1NiJ9...',
  'tbilisi': 'eyJhbGciOiJIUzI1NiJ9...',
  'batumi': 'eyJhbGciOiJIUzI1NiJ9...',
  'kutaisi': 'eyJhbGciOiJIUzI1NiJ9...'
};
```

### –ü–µ—Ä–∏–æ–¥—ã –ø–∞—Ä—Å–∏–Ω–≥–∞

**Cash:** –í—á–µ—Ä–∞ + –°–µ–≥–æ–¥–Ω—è
```javascript
const now = new Date();
const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
```

**Events:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
```javascript
updated_at_from: $now.minus({minutes: 10}).toISO()
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–ù–µ –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ timezone** - `Asia/Tbilisi`
2. **–ù–µ –º–µ–Ω—è—Ç—å executionOrder** - `v1`
3. **–ù–µ —É–¥–∞–ª—è—Ç—å Error Handler** - `H3UBEp425F5SMyrX`
4. **–¢–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –¥–æ** - ~2025-12-02 (–ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–∏—Ç—å)

---

## üêõ Troubleshooting

### Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é –≤ n8n UI
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron trigger (–∫–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã)

### –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å executions –≤ n8n
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –∞–ª–µ—Ä—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Error Handler

### 403/404 –æ—à–∏–±–∫–∏ API
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω—ã (–º–æ–≥–ª–∏ –∏—Å—Ç–µ—á—å)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Headers (Origin, Referer, User-Agent)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** `node setup/import_split_workflows.mjs`

