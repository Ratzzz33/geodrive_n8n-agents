# ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ UI —Å–æ–±—ã—Ç–∏–π RentProg - –ì–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É

**–î–∞—Ç–∞:** 5 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** Workflows –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ MCP

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

1. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:**
   - ‚úÖ `005_add_employee_cash_fields.sql` - –ø–æ–ª—è –∫–∞—Å—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
   - ‚úÖ `006_create_event_processing_log.sql` - –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è UI —Å–æ–±—ã—Ç–∏–π
   - ‚úÖ `007_create_payments_table.sql` - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–ª–∞—Ç–µ–∂–µ–π

2. **Jarvis API –æ–±–Ω–æ–≤–ª–µ–Ω:**
   - ‚úÖ Endpoint `/process-ui-event` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
   - ‚úÖ –°–µ—Ä–≤–∏—Å—ã: `eventParsers`, `cashRegisterService`, `taskService`
   - ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ

3. **n8n Workflows —Å–æ–∑–¥–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ MCP:**
   - ‚úÖ **RentProg Events Scraper** (ID: `nZPD1AcSbLo3eSgr`)
     - –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–°–æ–±—ã—Ç–∏—è" –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
     - 4 —Ñ–∏–ª–∏–∞–ª–∞: Tbilisi, Batumi, Kutaisi, Service Center
   
   - ‚úÖ **Cash Register Reconciliation** (ID: `9Nrec3H5j2fIQ3Ma`)
     - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–µ—Ä–∫–∞ –∫–∞—Å—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ 04:00 Tbilisi
     - –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ + Telegram –∞–ª–µ—Ä—Ç—ã
   
   - ‚úÖ **Company Cash Register Parser** (ID: `x1z3p5QMQ421UPEY`)
     - –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Å—Å—ã –∫–æ–º–ø–∞–Ω–∏–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
     - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É `payments`

4. **–ö–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω:**
   - ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí GitHub
   - ‚úÖ GitHub ‚Üí –°–µ—Ä–≤–µ—Ä Hetzner
   - ‚úÖ `npm run build` –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è

### –ü–æ—á–µ–º—É –Ω—É–∂–Ω–∞ —Ä—É—á–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è?

n8n API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é workflow —á–µ—Ä–µ–∑ MCP. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç PATCH –∑–∞–ø—Ä–æ—Å.

### –ö–∞–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflows

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ n8n UI (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n: https://n8n.rentflow.rentals
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ workflow:
   - **RentProg Events Scraper**
   - **Cash Register Reconciliation**
   - **Company Cash Register Parser**
   
   –í—ã–ø–æ–ª–Ω–∏—Ç–µ:
   - –ù–∞–π–¥–∏—Ç–µ workflow –≤ —Å–ø–∏—Å–∫–µ
   - –û—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Activate"** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ç–∞–ª –∑–µ–ª–µ–Ω—ã–º

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ n8n API (Curl)

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤—Å–µ—Ö 3 workflows –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
curl -X PATCH "https://n8n.rentflow.rentals/api/v1/workflows/nZPD1AcSbLo3eSgr" \
  -H "X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{"active": true}'

curl -X PATCH "https://n8n.rentflow.rentals/api/v1/workflows/9Nrec3H5j2fIQ3Ma" \
  -H "X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{"active": true}'

curl -X PATCH "https://n8n.rentflow.rentals/api/v1/workflows/x1z3p5QMQ421UPEY" \
  -H "X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{"active": true}'
```

---

## üéØ –ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

### –ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

1. **–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (Events Scraper):**
   - Playwright –∑–∞—Ö–æ–¥–∏—Ç –≤ RentProg UI –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
   - –ü–∞—Ä—Å–∏—Ç –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Jarvis API `/process-ui-event`
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î

2. **–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (Company Cash Parser):**
   - Playwright –ø–∞—Ä—Å–∏—Ç –∫–∞—Å—Å—É –∫–æ–º–ø–∞–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
   - –ò—â–µ—Ç –Ω–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `payments`
   - Telegram –∞–ª–µ—Ä—Ç –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–ª–∞—Ç–µ–∂–µ

3. **–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 04:00 Tbilisi (Cash Reconciliation):**
   - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –ë–î
   - –ü–∞—Ä—Å–∏—Ç –∏—Ö –∫–∞—Å—Å—ã –∏–∑ RentProg UI
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —Ä–∞—Å—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö
   - Telegram –∞–ª–µ—Ä—Ç –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**Telegram –∞–ª–µ—Ä—Ç—ã (Chat ID: -5004140602):**
- ‚ö†Ô∏è –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –∫–∞—Å—Å–∞—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- üí∞ –ù–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –≤ –∫–∞—Å—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏
- ‚ùå –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π

**–õ–æ–≥–∏ n8n:**
- Executions ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏
- –û—à–∏–±–∫–∏ –≤–∏–¥–Ω—ã –≤ —Å–ø–∏—Å–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î:**
```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
SELECT * FROM event_processing_log 
ORDER BY processed_at DESC LIMIT 10;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∏
SELECT * FROM payments 
ORDER BY parsed_at DESC LIMIT 10;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Å—Å
SELECT id, name, cash_gel, cash_usd, cash_eur, cash_last_synced 
FROM employees 
WHERE cash_last_synced IS NOT NULL 
ORDER BY cash_last_synced DESC;
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π

- ‚úÖ Jarvis API —Ä–∞–±–æ—Ç–∞–µ—Ç: `http://46.224.17.15:3000/health`
- ‚úÖ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞: –≤—Å–µ 3 –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ Credentials n8n –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
  - ‚úÖ PostgreSQL (Neon)
  - ‚úÖ Telegram Bot (@n8n_alert_geodrive_bot)
- ‚úÖ Playwright —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ n8n

### –ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

- [ ] –í—Å–µ 3 workflows –∞–∫—Ç–∏–≤–Ω—ã (–∑–µ–ª–µ–Ω—ã–π toggle)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ Executions –∑–∞ –ø–µ—Ä–≤—ã–µ 10 –º–∏–Ω—É—Ç
- [ ] Telegram –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–±—ã—Ç–∏—è)
- [ ] –¢–∞–±–ª–∏—Ü–∞ `event_processing_log` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è
- [ ] –¢–∞–±–ª–∏—Ü–∞ `payments` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflows –≤ n8n UI
# 2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 5 –º–∏–Ω—É—Ç
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
SELECT COUNT(*) FROM event_processing_log; -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0
SELECT COUNT(*) FROM payments; -- –ú–æ–∂–µ—Ç –±—ã—Ç—å 0, –µ—Å–ª–∏ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –∞–ª–µ—Ä—Ç—ã
# –ó–∞–π—Ç–∏ –≤ —á–∞—Ç -5004140602 –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `ARCHITECTURE.md`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:** `STRUCTURE.md`
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** `setup/migrations/`
- **Workflows:** `n8n-workflows/`
- **Jarvis API:** `src/api/routes/processUIEvent.ts`

---

## üîß Troubleshooting

### Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Workflow –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ executions –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ trigger node (cron expression)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å timezone (Asia/Tbilisi)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å workflow (Deactivate ‚Üí Activate)

### –û—à–∏–±–∫–∞ –≤ Playwright

**–ü—Ä–æ–±–ª–µ–º–∞:** `Error: Executable doesn't exist at /usr/bin/chromium-browser`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ n8n —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright
npm install -g playwright
npx playwright install chromium
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Jarvis API

**–ü—Ä–æ–±–ª–µ–º–∞:** `ECONNREFUSED 46.224.17.15:3000`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ Hetzner –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Jarvis API
cd /root/geodrive_n8n-agents
pm2 restart jarvis-api
pm2 logs jarvis-api
```

### –ù–µ—Ç Telegram –∞–ª–µ—Ä—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è, –Ω–æ –∞–ª–µ—Ä—Ç–æ–≤ –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram credentials –≤ n8n
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Chat ID: `-5004140602`
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç

---

## ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞!

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ **–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 3 workflows** –≤ n8n UI.

–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—á–Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–±–∏—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∏–∑ RentProg UI
- –ü–∞—Ä—Å–∏—Ç—å –∫–∞—Å—Å—É –∫–æ–º–ø–∞–Ω–∏–∏
- –°–≤–µ—Ä—è—Ç—å –∫–∞—Å—Å—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å Telegram –∞–ª–µ—Ä—Ç—ã

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û—Ç–∫—Ä–æ–π—Ç–µ https://n8n.rentflow.rentals –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflows!

