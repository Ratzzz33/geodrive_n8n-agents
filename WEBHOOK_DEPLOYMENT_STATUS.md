# –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤–µ–±—Ö—É–∫–æ–≤ RentProg

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–µ–º—É –≤–µ–±—Ö—É–∫–æ–≤

**Netlify Functions —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç:**
- URL: `https://geodrive.netlify.app/webhooks/rentprog/{branch}`
- –§—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç **200 OK** —Å—Ä–∞–∑—É –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–µ–±—Ö—É–∫–∞
- RentProg **–ù–ï –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ

### ‚ö†Ô∏è –ù–æ –µ—Å—Ç—å –Ω—é–∞–Ω—Å

Netlify Function –¥–µ–ª–∞–µ—Ç **–±—ã—Å—Ç—Ä—ã–π ACK (200 OK)** RentProg, –∞ –∑–∞—Ç–µ–º –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–∑–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP. –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ –∏–ª–∏ `ORCHESTRATOR_URL` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –Ω–æ RentProg –Ω–µ —É–≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É.

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
```bash
# –ù–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ (–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ —Å ngrok/—Ç—É–Ω–Ω–µ–ª–µ–º)
npm run start
# –∏–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç:
- Telegram –±–æ—Ç–∞
- HTTP API —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É `API_PORT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3000)

**2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ORCHESTRATOR_URL –≤ Netlify:**

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Netlify (Site settings ‚Üí Environment variables) –¥–æ–±–∞–≤–∏—Ç—å:
```
ORCHESTRATOR_URL = https://your-server.com
# –∏–ª–∏ –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ ngrok:
ORCHESTRATOR_URL = https://your-ngrok-id.ngrok.io
```

**3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**

–í `.env` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:
```env
API_PORT=3000
DATABASE_URL=postgresql://...
RENTPROG_BRANCH_KEYS={...}
# –∏ –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```

**4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î:**
```bash
npm run db:push
# –∏–ª–∏
npm run db:migrate
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏–µ–º, –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏)

–ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ, –º–æ–∂–Ω–æ —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤ RentProg:

**‚úÖ –í–µ–±—Ö—É–∫–∏ –±—É–¥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è** (Netlify Function –≤–µ—Ä–Ω–µ—Ç 200 OK)

**‚ùå –ù–æ –Ω–µ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è** (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Netlify, –Ω–æ —Ä–µ–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç)

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–∏ –Ω–∞—á–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Netlify Function

```bash
# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ –≤–µ–±—Ö—É–∫—É
curl -X POST https://geodrive.netlify.app/webhooks/rentprog/tbilisi \
  -H "Content-Type: application/json" \
  -d '{"id":"test","event":"booking.issue.planned"}'

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
# {"ok":true,"queued":true,"syncMs":<–≤—Ä–µ–º—è>}
```

–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ 200 OK - Netlify Function —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:3000/

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
# {"status":"ok","service":"jarvis-bot"}
```

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ - —É–≤–∏–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç ‚úÖ

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤
curl -X POST http://localhost:3000/webhook/rentprog \
  -H "Content-Type: application/json" \
  -d '{"branch":"tbilisi","type":"booking.issue.planned","payload":{"id":"test"}}'

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
# {"ok":true,"processed":true}
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Netlify

–í Netlify Dashboard ‚Üí Functions ‚Üí rentprog-webhook ‚Üí Logs

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:
- `Event logged (ORCHESTRATOR_URL not configured)` - ‚ö†Ô∏è –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å ORCHESTRATOR_URL
- `Event sent to orchestrator via HTTP` - ‚úÖ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
```bash
npm run db:push
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
npm run start
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–∏–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
```
‚úÖ DB connected
üåê API server listening on port 3000
ü§ñ Bot started
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ORCHESTRATOR_URL –≤ Netlify

**–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø—É–±–ª–∏—á–Ω—ã–º IP:**
```
ORCHESTRATOR_URL = http://your-server-ip:3000
```

**–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ (—á–µ—Ä–µ–∑ ngrok):**
```bash
ngrok http 3000
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io)
```

–í Netlify:
```
ORCHESTRATOR_URL = https://abc123.ngrok.io
```

**–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ (Heroku, Railway, etc.):**
```
ORCHESTRATOR_URL = https://your-app.herokuapp.com
```

### –®–∞–≥ 4: –ü—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤ RentProg

```
https://geodrive.netlify.app/webhooks/rentprog/tbilisi
https://geodrive.netlify.app/webhooks/rentprog/batumi
https://geodrive.netlify.app/webhooks/rentprog/kutaisi
https://geodrive.netlify.app/webhooks/rentprog/service-center
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ RentProg
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Netlify Function

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **RentProg –Ω–µ —É–≤–∏–¥–∏—Ç –æ—à–∏–±–æ–∫**, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ
   - Netlify Function –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK
   - –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ Netlify, –Ω–æ –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤ RentProg

2. **–í–µ–±—Ö—É–∫–∏ –±—É–¥—É—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è –≤ –ª–æ–≥–∞—Ö**, –µ—Å–ª–∏ ORCHESTRATOR_URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
   - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è

3. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**, –ø–æ—Ç–æ–º –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤ RentProg
   - –ù–æ –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–ª–∏ - –Ω–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ, –Ω–∞—á–Ω—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

4. **–î–ª—è production** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π URL (–Ω–µ ngrok)
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ cloud hosting (Heroku, Railway, Fly.io –∏ —Ç.–¥.)

## üöÄ –ò—Ç–æ–≥–æ

**–ú–æ–∂–µ—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤ RentProg:**
- ‚úÖ Netlify Functions –≥–æ—Ç–æ–≤—ã
- ‚úÖ –í–µ–±—Ö—É–∫–∏ –±—É–¥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è (200 OK)
- ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–Ω–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ORCHESTRATOR_URL

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ORCHESTRATOR_URL –≤ Netlify
3. –ü—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤ RentProg
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

