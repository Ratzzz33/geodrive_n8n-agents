# üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π –≤ —Å–∏—Å—Ç–µ–º—É

**–î–∞—Ç–∞:** 2025-11-13  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–≤–æ–º—É –∑–∞–ø—É—Å–∫—É

---

## üìã –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `bookings`:
- `is_technical` (BOOLEAN) - —Ñ–ª–∞–≥ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –±—Ä–æ–Ω–∏
- `technical_type` (TEXT) - —Ç–∏–ø: `regular`, `technical`, `technical_repair`
- `technical_purpose` (TEXT) - —Ü–µ–ª—å: `service`, `repair`, `employee_trip`

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `setup/add_technical_booking_fields.sql`

### 2. ‚úÖ Workflow –ø–∞—Ä—Å–∏–Ω–≥–∞
–û–±–Ω–æ–≤–ª–µ–Ω workflow `P3BnmX7Nrmh1cusF` —Å:
- –õ–æ–≥–∏–∫–æ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –ë–î
- –£–±—Ä–∞–Ω —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞

**Workflow:** https://n8n.rentflow.rentals/workflow/P3BnmX7Nrmh1cusF

### 3. ‚úÖ –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
```javascript
function getTechnicalType(attrs) {
  const clientName = `${attrs.first_name} ${attrs.last_name}`.toLowerCase();
  const description = (attrs.description || '').toLowerCase();
  
  // –ù–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è
  if (!clientName.includes('—Å–µ—Ä–≤–∏—Å') && !clientName.includes('—Å–æ—Ç—Ä—É–¥–Ω–∏–∫')) {
    return { is_technical: false, technical_type: 'regular' };
  }
  
  // –î–ª—è —Ä–µ–º–æ–Ω—Ç–∞
  if (clientName.includes('—Å–µ—Ä–≤–∏—Å') || description.includes('—Ä–µ–º–æ–Ω—Ç')) {
    return { 
      is_technical: true, 
      technical_type: 'technical_repair',
      technical_purpose: 'repair'
    };
  }
  
  // –°–ª—É–∂–µ–±–Ω–∞—è
  return { 
    is_technical: true, 
    technical_type: 'technical',
    technical_purpose: 'employee_trip'
  };
}
```

---

## üöÄ –ó–∞–ø—É—Å–∫

### –®–∞–≥ 1: –ü–µ—Ä–≤—ã–π –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ (–ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞)

```bash
# 1. –û—Ç–∫—Ä—ã—Ç—å workflow –≤ n8n
https://n8n.rentflow.rentals/workflow/P3BnmX7Nrmh1cusF

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é (Execute Workflow)
# –≠—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –í–°–ï –±—Ä–æ–Ω–∏ –∏–∑ RentProg (–º–æ–∂–µ—Ç –±—ã—Ç—å 10000+)

# 3. –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 5-10 –º–∏–Ω—É—Ç
# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å execution: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å SUCCESS
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
- –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π
cd C:\Users\33pok\geodrive_n8n-agents
node setup/check_technical_bookings_stats.mjs
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π:

üîπ –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

   –í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π: 15230
   –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö: 485 (3.2%)
   - –î–ª—è —Ä–µ–º–æ–Ω—Ç–∞: 152
   - –°–ª—É–∂–µ–±–Ω—ã—Ö: 333
   –û–±—ã—á–Ω—ã—Ö: 14745

üîπ –ü–æ —Ñ–∏–ª–∏–∞–ª–∞–º:

   TBILISI         8567 –±—Ä–æ–Ω–µ–π
      ‚îî‚îÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö: 267 (—Ä–µ–º–æ–Ω—Ç: 89, —Å–ª—É–∂–µ–±–Ω—ã–µ: 178)
   BATUMI          3892 –±—Ä–æ–Ω–µ–π
      ‚îî‚îÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö: 124 (—Ä–µ–º–æ–Ω—Ç: 38, —Å–ª—É–∂–µ–±–Ω—ã–µ: 86)
   ...
```

---

### –®–∞–≥ 3: –í–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∞ 30 –¥–Ω–µ–π

```bash
# –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ - –≤–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
node setup/enable_date_filter_30_days.mjs
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
- Workflow –±—É–¥–µ—Ç –ø–∞—Ä—Å–∏—Ç—å —Ç–æ–ª—å–∫–æ –±—Ä–æ–Ω–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—Å—è –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å 5-10 –º–∏–Ω—É—Ç –¥–æ 30-60 —Å–µ–∫—É–Ω–¥)
- Workflow –º–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∫–∞–∂–¥—ã–µ 60 –º–∏–Ω—É—Ç

---

## üìä –í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π

### –í RentProg UI:
- **–ò–∫–æ–Ω–∫–∞:** `mdi-alpha-a-circle-outline` (–±—É–∫–≤–∞ A –≤ –∫—Ä—É–≥–µ)
  - –û–±—ã—á–Ω—ã–µ: `mdi-car` (–º–∞—à–∏–Ω–∞)
  - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ: `mdi-alpha-a-circle-outline` (–±—É–∫–≤–∞ A)
  
- **–ö–ª–∏–µ–Ω—Ç:**
  - "–°–µ—Ä–≤–∏—Å –ê." ‚Üí —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞
  - "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ G." ‚Üí —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ª—É–∂–µ–±–Ω–∞—è
  
### –í API –¥–∞–Ω–Ω—ã—Ö:
```javascript
{
  first_name: "–°–µ—Ä–≤–∏—Å",
  last_name: "–ê.",
  rental_cost: 0,  // —á–∞—Å—Ç–æ 0 –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö
  description: "—Ä–µ–º–æ–Ω—Ç —Ç–æ—Ä–º–æ–∑–æ–≤"  // –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
}
```

---

## üìà –¢–∏–ø—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π

| –¢–∏–ø | `technical_type` | `technical_purpose` | –ü—Ä–∏–∑–Ω–∞–∫–∏ |
|-----|------------------|---------------------|----------|
| **–û–±—ã—á–Ω–∞—è** | `regular` | `null` | –ö–ª–∏–µ–Ω—Ç –Ω–µ "–°–µ—Ä–≤–∏—Å" –∏ –Ω–µ "–°–æ—Ç—Ä—É–¥–Ω–∏–∫" |
| **–°–ª—É–∂–µ–±–Ω–∞—è** | `technical` | `employee_trip` | –ö–ª–∏–µ–Ω—Ç "–°–æ—Ç—Ä—É–¥–Ω–∏–∫", –±–µ–∑ —Å–ª–æ–≤ "—Ä–µ–º–æ–Ω—Ç" |
| **–î–ª—è —Ä–µ–º–æ–Ω—Ç–∞** | `technical_repair` | `repair` | –ö–ª–∏–µ–Ω—Ç "–°–µ—Ä–≤–∏—Å" –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç "—Ä–µ–º–æ–Ω—Ç" |

---

## üîç –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### –ù–∞–π—Ç–∏ –≤—Å–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –±—Ä–æ–Ω–∏:
```sql
SELECT * FROM bookings 
WHERE is_technical = TRUE
ORDER BY created_at DESC;
```

### –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞:
```sql
SELECT * FROM bookings 
WHERE technical_type = 'technical_repair'
ORDER BY created_at DESC;
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º:
```sql
SELECT 
  branch,
  COUNT(*) FILTER (WHERE technical_type = 'technical_repair') as repair,
  COUNT(*) FILTER (WHERE technical_type = 'technical') as service,
  COUNT(*) FILTER (WHERE technical_type = 'regular') as regular
FROM bookings
GROUP BY branch;
```

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∞–≥–µ–Ω—Ç–∞—Ö

### –ü—Ä–∏–º–µ—Ä: –∏—Å–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑ –æ—Ç—á–µ—Ç–æ–≤ –ø—Ä–æ–¥–∞–∂
```javascript
const clientBookings = await sql`
  SELECT * FROM bookings
  WHERE client_id = ${clientId}
    AND is_technical = FALSE  -- —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ
  ORDER BY created_at DESC
`;
```

### –ü—Ä–∏–º–µ—Ä: –æ—Ç—á–µ—Ç –ø–æ —Å–ª—É–∂–µ–±–Ω—ã–º –ø–æ–µ–∑–¥–∫–∞–º
```javascript
const employeeTrips = await sql`
  SELECT * FROM bookings
  WHERE technical_type = 'technical'
    AND start_date >= ${dateFrom}
  ORDER BY start_date DESC
`;
```

### –ü—Ä–∏–º–µ—Ä: –æ—Ç—á–µ—Ç –ø–æ —Ä–µ–º–æ–Ω—Ç–∞–º
```javascript
const repairs = await sql`
  SELECT * FROM bookings
  WHERE technical_type = 'technical_repair'
    AND start_date >= ${dateFrom}
  ORDER BY start_date DESC
`;
```

---

## üìù –°–∫—Ä–∏–ø—Ç—ã

### –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î:
```bash
node setup/apply_technical_fields_migration.mjs
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ workflow:
```bash
node setup/update_workflow_with_technical_fields.mjs
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
```bash
node setup/check_technical_bookings_stats.mjs
```

### –í–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ 30 –¥–Ω–µ–π:
```bash
node setup/enable_date_filter_30_days.mjs
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
2. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
   - –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ (–≤—Å–µ –±—Ä–æ–Ω–∏): 5-10 –º–∏–Ω—É—Ç
   - –° —Ñ–∏–ª—å—Ç—Ä–æ–º (30 –¥–Ω–µ–π): 30-60 —Å–µ–∫—É–Ω–¥
3. **Batch insert** - –≤—Å–µ –±—Ä–æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–±—ã—Å—Ç—Ä–æ!)
4. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏
5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö** - ON CONFLICT –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏

---

## üîó –°—Å—ã–ª–∫–∏

- **Workflow:** https://n8n.rentflow.rentals/workflow/P3BnmX7Nrmh1cusF
- **–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ:** `setup/technical_bookings_FINAL_REPORT.md`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** Neon PostgreSQL
- **–¢–∞–±–ª–∏—Ü–∞:** `bookings`

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É!

1. ‚úÖ –ë–î –≥–æ—Ç–æ–≤–∞ (–ø–æ–ª—è –¥–æ–±–∞–≤–ª–µ–Ω—ã)
2. ‚úÖ Workflow –æ–±–Ω–æ–≤–ª–µ–Ω (–ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞)
3. ‚úÖ –§–∏–ª—å—Ç—Ä –≤—ã–∫–ª—é—á–µ–Ω (–¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞)
4. ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

**‚ñ∂Ô∏è –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç—å workflow –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞!

