# ‚úÖ –°–∏—Å—Ç–µ–º–∞ UI Events —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞!

**–î–∞—Ç–∞:** 2025-11-05  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü:
  - `employees` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –∫–∞—Å—Å (`cash_gel`, `cash_usd`, `cash_eur`)
  - `event_processing_log` - –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è UI —Å–æ–±—ã—Ç–∏–π
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã

### 2. ‚úÖ Jarvis API –∑–∞–ø—É—â–µ–Ω
- **URL:** `http://46.224.17.15:3000`
- **–°—Ç–∞—Ç—É—Å:** üü¢ Online
- **PM2:** –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:**
- `GET  /health`
- `GET  /rentprog/health`
- `POST /process-webhook`
- `POST /update-entity`
- `POST /process-event`
- `POST /process-ui-event` (–Ω–æ–≤—ã–π!)

### 3. ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤
- –í—Å–µ TypeScript —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:
  - `src/services/eventParsers.ts` - –ø–∞—Ä—Å–∏–Ω–≥ UI —Å–æ–±—ã—Ç–∏–π
  - `src/services/cashRegisterService.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Å–∞–º–∏
  - `src/services/taskService.ts` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á
  - `src/api/routes/processUIEvent.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ UI —Å–æ–±—ã—Ç–∏–π
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
- n8n workflows –≥–æ—Ç–æ–≤—ã –∫ –∏–º–ø–æ—Ä—Ç—É

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é)

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å credentials –≤ n8n

–û—Ç–∫—Ä–æ–π—Ç–µ: `https://n8n.rentflow.rentals` –∏ —Å–æ–∑–¥–∞–π—Ç–µ 4 Generic Credentials:

#### Service Center
```
Name: RentProg UI - Service Center
Login: sofia2020eliseeva@gmail.com
Password: x2tn7hks
URL: https://web.rentprog.ru/service-center
```

#### Tbilisi
```
Name: RentProg UI - Tbilisi
Login: eliseevaleksei32@gmail.com
Password: a0babuz0
URL: https://web.rentprog.ru/tbilisi
```

#### Kutaisi
```
Name: RentProg UI - Kutaisi
Login: geodrivekutaisi2@gmail.com
Password: 8fia8mor
URL: https://web.rentprog.ru/kutaisi
```

#### Batumi
```
Name: RentProg UI - Batumi
Login: ceo@geodrive.rent
Password: a6wumobt
URL: https://web.rentprog.ru/batumi
```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `docs/CREDENTIALS_SETUP.md`

---

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow –≤ n8n

#### 2.1. RentProg Events Scraper
- –§–∞–π–ª: `n8n-workflows/rentprog-events-scraper.json`
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–°–æ–±—ã—Ç–∏—è" –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –¥–ª—è –≤—Å–µ—Ö 4 —Ñ–∏–ª–∏–∞–ª–æ–≤
- –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow

#### 2.2. Cash Register Reconciliation
- –§–∞–π–ª: `n8n-workflows/cash-register-reconciliation.json`
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–µ—Ä–∫–∞ –∫–∞—Å—Å –≤ 04:00 –ø–æ –¢–±–∏–ª–∏—Å–∏
- –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ CLI:**
```bash
cd /root/geodrive_n8n-agents
node setup/import_ui_workflows.mjs
```

---

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 3.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Jarvis API
```bash
curl http://46.224.17.15:3000/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "timestamp": "2025-11-05T...",
  "uptime": 123.456
}
```

#### 3.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å workflow
1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://n8n.rentflow.rentals`
2. –ù–∞–π–¥–∏—Ç–µ workflow "RentProg Events Scraper"
3. –ù–∞–∂–º–∏—Ç–µ "Execute Workflow"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### 3.3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
```bash
node setup/check_event_processing_log.mjs
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
1. **QUICK_START_GUIDE.md** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å–∏—Å—Ç–µ–º—ã
2. **docs/UI_EVENTS_SYSTEM.md** - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
3. **docs/CREDENTIALS_SETUP.md** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ credentials
4. **IMPLEMENTATION_SUMMARY.md** - –°–≤–æ–¥–∫–∞ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **src/services/eventParsers.ts** - –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π
- **src/services/cashRegisterService.ts** - –ö–∞—Å—Å—ã
- **src/services/taskService.ts** - –ó–∞–¥–∞—á–∏

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- `setup/migrations/005_add_employee_cash_fields.sql`
- `setup/migrations/006_create_event_processing_log.sql`

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Jarvis API
```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–∞
python setup/server_ssh.py "pm2 status"

# –õ–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫)
python setup/server_ssh.py "pm2 logs jarvis-api --lines 50 --nostream"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
python setup/server_ssh.py "pm2 restart jarvis-api"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ n8n workflows
```bash
# –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö workflows
node setup/check_active_workflows.mjs

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
node setup/check_recent_executions.mjs
```

---

## ‚öôÔ∏è –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Å–æ–±—ã—Ç–∏–π

–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ª–∏—á–Ω—ã–µ)
2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –¢–û (completed/created)
3. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ç–∞—Ç—É—Å—ã –±—Ä–æ–Ω–µ–π (–≤—ã–¥–∞—á–∞/–ø—Ä–∏–µ–º–∫–∞ —Å–µ–≥–æ–¥–Ω—è-–∑–∞–≤—Ç—Ä–∞)

---

## üö® Telegram Alerts

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —á–∞—Ç: **TG Alert Chat** (ID: `-5004140602`)

**–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
- ‚ùå –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–æ–±—ã—Ç–∏–π
- ‚ö†Ô∏è –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∫–∞—Å—Å (—Ä–∞–∑–Ω–∏—Ü–∞ > 1%)
- üìä –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∫–∞—Å—Å–∞–º (04:00)
- üîß –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ –¢–û

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ credentials –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç–µ workflows:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–æ–±—ã—Ç–∏–π (–ø–µ—Ä–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç)
2. –î–æ–∂–¥–∏—Ç–µ—Å—å 04:00 —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤–µ—Ä–∫–∏ –∫–∞—Å—Å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ `event_processing_log`
4. –°–ª–µ–¥–∏—Ç–µ –∑–∞ Telegram alerts

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤—ã—à–µ.

**–í–∞–∂–Ω–æ:** –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –®–∞–≥ 1 –∏ –®–∞–≥ 2 –∏–∑ —Å–µ–∫—Ü–∏–∏ "–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏"!

