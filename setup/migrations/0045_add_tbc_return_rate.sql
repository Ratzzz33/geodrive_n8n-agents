-- =====================================================
-- Миграция 0045: Добавление поля курса возврата TBC Bank
-- =====================================================
-- Дата: 2025-01-20
-- Описание: Добавляем поле для хранения курса возврата из TBC Bank
--           (GEL → RUB, курс продажи рубля)
--           
--           tbc_return_rate: курс для возврата баланса клиента в рублях
--           Используется когда клиент просит вернуть его оставшийся баланс рублями.
--           Это курс продажи рубля (нижний курс) - сколько GEL стоит 1 RUB.
--           Парсится с tbcbank.ge/en/treasury-products?amount=100&ccyFrom=RUR&ccyTo=GEL

BEGIN;

-- =====================================================
-- 1. Добавление поля курса возврата TBC Bank
-- =====================================================

ALTER TABLE exchange_rates
  ADD COLUMN IF NOT EXISTS tbc_return_rate DECIMAL(10, 6);

-- =====================================================
-- 2. Комментарии к полю
-- =====================================================

COMMENT ON COLUMN exchange_rates.tbc_return_rate IS 'Курс возврата из лари в рубли через TBC Bank (GEL за 1 RUB, курс продажи рубля - нижний курс). Используется для возврата баланса клиента в рублях. Парсится с tbcbank.ge/en/treasury-products?amount=100&ccyFrom=RUR&ccyTo=GEL';

-- =====================================================
-- 3. Обновление комментария таблицы
-- =====================================================

COMMENT ON TABLE exchange_rates IS 'Курсы валют из RentProg, KoronaPay и TBC Bank. RentProg парсятся с /company_profile, KoronaPay парсятся с koronapay.com/transfers/, TBC Bank парсятся с tbcbank.ge/en/treasury-products';

COMMIT;

