# Umnico Telegram Integration: –û—Ç—á–µ—Ç –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## ‚úÖ –®–∞–≥ 1: –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î - –í–´–ü–û–õ–ù–ï–ù–û

–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! –í—Å–µ –ø–æ–ª—è –∏ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã:

- ‚úÖ 7 –ø–æ–ª–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `conversations`
- ‚úÖ 3 –∏–Ω–¥–µ–∫—Å–∞ —Å–æ–∑–¥–∞–Ω–æ
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
node setup/apply_umnico_telegram_migration.mjs
```

---

## ‚ö†Ô∏è –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è - –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ —Ñ–∞–π–ª `.env` –≤—Ä—É—á–Ω—É—é.

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:

```env
# Umnico Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
UMNICO_FORUM_CHAT_ID=-5015844768
UMNICO_POLLING_INTERVAL=5
WEB_APP_URL=https://conversations.rentflow.rentals
PLAYWRIGHT_UMNICO_URL=http://localhost:3001
```

3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
node setup/check_umnico_env.mjs
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å ‚úÖ –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–æ–∫–µ–Ω –±–æ—Ç–∞ —É–∂–µ –Ω–∞–π–¥–µ–Ω (`TELEGRAM_BOT_TOKEN`), —ç—Ç–æ —Ö–æ—Ä–æ—à–æ!

---

## ‚ö†Ô∏è –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram —á–∞—Ç–∞ - –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram —á–∞—Ç–∞ –Ω—É–∂–Ω–æ:

1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `N8N_ALERTS_TELEGRAM_BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ `.env`
   (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TELEGRAM_BOT_TOKEN`)

2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:
```bash
node setup/check_telegram_chat_type.mjs
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ß–∞—Ç —è–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ä—É–º–æ–º (supergroup —Å is_forum=true)
- ‚úÖ –ë–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ–º—ã —á–µ—Ä–µ–∑ createForumTopic API

**–ï—Å–ª–∏ —á–∞—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ä—É–º–æ–º:**
- –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
- –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã "Umnico + TG BOT"
- –í—ã–±–µ—Ä–∏—Ç–µ "–¢–∏–ø –≥—Ä—É–ø–ø—ã" ‚Üí "–§–æ—Ä—É–º"
- –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é

---

## ‚ö†Ô∏è –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ - –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:

### 4.1. Playwright Service (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker ps | grep playwright

# –ó–∞–ø—É—Å–∫ (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω)
docker compose up -d playwright-umnico

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs playwright-umnico --tail 50 -f
```

### 4.2. Jarvis API

```bash
# –°–±–æ—Ä–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
npm run build

# –ó–∞–ø—É—Å–∫
npm start

# –ò–ª–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞:**
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ Umnico Realtime Sync started`
- –ï—Å–ª–∏ `UMNICO_FORUM_CHAT_ID` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –±—É–¥–µ—Ç: `Umnico Realtime Sync skipped`

---

## ‚ö†Ô∏è –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç:

1. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Umnico** –æ—Ç –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Jarvis API:**
   ```bash
   docker logs jarvis-api --tail 100 -f
   ```
   
   –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   ```
   Found X new messages in conversation CONVERSATION_ID
   Creating new topic for conversation CONVERSATION_ID
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram-–≥—Ä—É–ø–ø—É:**
   - –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤–∞—è —Ç–µ–º–∞
   - –í —Ç–µ–º–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Ç–µ–º–µ

### –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:

–°–º. `docs/UMNICO_TELEGRAM_TESTING.md`

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] ‚ö†Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.env`
- [ ] ‚ö†Ô∏è Telegram —á–∞—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ —Ñ–æ—Ä—É–º
- [ ] ‚ö†Ô∏è Playwright Service –∑–∞–ø—É—â–µ–Ω
- [ ] ‚ö†Ô∏è Jarvis API –∑–∞–ø—É—â–µ–Ω
- [ ] ‚ö†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
node setup/check_umnico_env.mjs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ Telegram —á–∞—Ç–∞
node setup/check_telegram_chat_type.mjs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
node setup/apply_umnico_telegram_migration.mjs
```

### –õ–æ–≥–∏

```bash
# –õ–æ–≥–∏ Jarvis API
docker logs jarvis-api --tail 100 -f

# –õ–æ–≥–∏ Playwright Service
docker logs playwright-umnico --tail 100 -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –≤ –ë–î

```sql
SELECT 
  umnico_conversation_id,
  client_name,
  tg_topic_id,
  session_expires_at,
  status
FROM conversations 
WHERE session_expires_at > NOW() 
  AND status = 'active';
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `docs/UMNICO_TELEGRAM_BRIDGE.md`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** `setup/UMNICO_TELEGRAM_SETUP.md`
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** `docs/UMNICO_TELEGRAM_TESTING.md`
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** `docs/WEB_INTERFACE_SETUP.md`
- **–°–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** `docs/UMNICO_TELEGRAM_IMPLEMENTATION_SUMMARY.md`

---

## ‚ö†Ô∏è –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`** (—Å–º. –®–∞–≥ 2)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram —á–∞—Ç** (—Å–º. –®–∞–≥ 3)
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã** (—Å–º. –®–∞–≥ 4)
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** (—Å–º. –®–∞–≥ 5)

---

**–°—Ç–∞—Ç—É—Å:** –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ ‚úÖ | –û—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

