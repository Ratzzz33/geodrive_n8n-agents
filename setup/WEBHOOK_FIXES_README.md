# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–µ–±—Ö—É–∫–æ–≤ RentProg

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

---

## üöÄ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
cd C:\Users\33pok\geodrive_n8n-agents
python setup/deploy_webhook_fixes.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. ‚úÖ –ù–∞–π–¥–µ—Ç workflow "RentProg Webhooks Monitor"
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç workflow —á–µ—Ä–µ–∑ n8n API
4. ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç workflow (–µ—Å–ª–∏ –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω)

---

## üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Neon credentials

```bash
python setup/check_neon_credentials.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç PostgreSQL credentials –≤ n8n
2. ‚úÖ –î–∞—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ pooler URL
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Neon

---

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞:
RentProg –ø–æ–ª—É—á–∞–ª –æ—à–∏–±–∫–∏:
- `{"code":503,"message":"Database is not ready!"}`
- `{"code":0,"message":"There was a problem executing the workflow"}`

### –†–µ—à–µ–Ω–∏–µ:

#### 1. –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
**–ë—ã–ª–æ:** Webhook ‚Üí [Parse + Respond] –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ  
**–°—Ç–∞–ª–æ:** Webhook ‚Üí **Respond** ‚Üí Parse

‚úÖ –¢–µ–ø–µ—Ä—å RentProg **–≤—Å–µ–≥–¥–∞** –ø–æ–ª—É—á–∞–µ—Ç ACK –∑–∞ < 100ms

#### 2. –î–æ–±–∞–≤–ª–µ–Ω retry –¥–ª—è PostgreSQL
- 3 –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç cold start Neon

#### 3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pooler
- Host: `ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech`
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π pool —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ cold start

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n UI:**
   ```
   https://n8n.rentflow.rentals
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —É–∑–ª–æ–≤:**
   - Webhook ‚Üí Respond (Fast Ack) ‚Üí Parse & Validate Format

3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π webhook:**
   ```bash
   curl -X POST https://webhook.rentflow.rentals/webhook/rentprog-webhook \
     -H "Content-Type: application/json" \
     -d '{"event":"car_update","payload":"{\"id\":123,\"mileage\":5000}"}'
   ```

4. **–£–±–µ–¥–∏—Ç–µ—Å—å:**
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç `{"ok":true,"received":true}`
   - ‚úÖ –°–æ–±—ã—Ç–∏–µ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `events`
   - ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ executions

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –≤ –ë–î:

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤
SELECT ts, phase, kind, error, event_type, rentprog_id
FROM webhook_error_log
WHERE ts > NOW() - INTERVAL '1 hour'
ORDER BY ts DESC;

-- –°–æ–±—ã—Ç–∏—è —Å –æ—à–∏–±–∫–∞–º–∏
SELECT ts, company_id, type, rentprog_id, ok, reason
FROM events
WHERE ok = false AND ts > NOW() - INTERVAL '1 hour'
ORDER BY ts DESC;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ retry:

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n UI ‚Üí Executions
2. –ù–∞–π–¥–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å retry
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –ø–æ–ø—ã—Ç–∫–∏

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Neon credentials:**
   ```bash
   python setup/check_neon_credentials.py
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n:**
   ```bash
   python setup/server_ssh.py "docker logs n8n --tail 100"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check:**
   ```bash
   curl http://46.224.17.15:3000/health
   ```

---

## üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π](../docs/WEBHOOK_FIXES_2025-11-09.md)
- [SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É](./SSH_CONNECTION_GUIDE.md)
- [–†–∞–±–æ—Ç–∞—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞](../config/N8N_VARIABLES.md)

---

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ –ø–æ–º–æ–≥–ª–∏:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ workflow –≤ n8n UI
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `webhook_error_log` –≤ –ë–î
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Å–∏—Å—Ç–µ–º—ã Jarvis

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-09  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

