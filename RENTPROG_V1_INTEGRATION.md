# RentProg v1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏

**–î–∞—Ç–∞:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–í–µ—Ä—Å–∏—è:** 1.0.0

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RentProg API v1, –≤–∫–ª—é—á–∞—è:
- Multi-branch –ø–æ–¥–¥–µ—Ä–∂–∫—É (4 —Ñ–∏–ª–∏–∞–ª–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫—É –≤–µ–±—Ö—É–∫–æ–≤ —á–µ—Ä–µ–∑ Netlify Functions
- Per-branch health checks
- –ü–µ—Ä–≤–∏—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. Netlify Functions –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `netlify.toml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è redirects
- `netlify/functions/rentprog-webhook/index.ts` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–æ–≤
- `netlify/functions/rentprog-webhook/package.json` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

**–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤:**
- Query –ø–∞—Ä–∞–º–µ—Ç—Ä: `?t={secret}` –∏–∑ `RENTPROG_WEBHOOK_SECRETS[branch]`
- HMAC –ø–æ–¥–ø–∏—Å—å: –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Rentprog-Signature` (sha256)

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
- –ë—ã—Å—Ç—Ä—ã–π ACK (200 OK) ‚â§ 100ms
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ branch/—Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ HTTP –∫–æ–¥–∞–º–∏

**URL –≤–µ–±—Ö—É–∫–æ–≤:**
```
https://geodrive.netlify.app/webhooks/rentprog/tbilisi?t=<gen_s1>
https://geodrive.netlify.app/webhooks/rentprog/batumi?t=<gen_s2>
https://geodrive.netlify.app/webhooks/rentprog/kutaisi?t=<gen_s3>
https://geodrive.netlify.app/webhooks/rentprog/service-center?t=<gen_s4>
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RentProg API

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `src/integrations/rentprog.ts` - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `src/integrations/rentprog-webhook-parser.ts` - –ø–∞—Ä—Å–µ—Ä –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

**`getBranchToken(branchKey: string)`**
- –û–±–º–µ–Ω company token –Ω–∞ request token
- TTL ~240 —Å–µ–∫—É–Ω–¥
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 401/429 —Å backoff

**`getCachedBranchToken(branch: BranchName)`**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å –∑–∞–ø–∞—Å–æ–º 2 —Å–µ–∫—É–Ω–¥—ã
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**`apiFetch<T>(branch, path, params)`**
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ —Å:
  - Retry –¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫
  - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff
  - –¢–∞–π–º–∞—É—Ç—ã (configurable)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ 401

**`paginate<T>(branch, path, params)`**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ 10-20 —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ (–º–∞–∫—Å–∏–º—É–º 1000 —Å—Ç—Ä–∞–Ω–∏—Ü)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `since`/`updatedAt`

**`healthCheckBranch(branch)`**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
- –õ–µ–≥–∫–∏–π –∑–∞–ø—Ä–æ—Å (`/all_cars?limit=1`)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ok: boolean, error?: string}`

**`healthCheck()`**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç per-branch —Å—Ç–∞—Ç—É—Å—ã:
```typescript
{
  ok: boolean,
  error?: string,
  perBranch: {
    tbilisi: {ok: boolean, error?: string},
    batumi: {ok: boolean, error?: string},
    kutaisi: {ok: boolean, error?: string},
    'service-center': {ok: boolean, error?: string}
  }
}
```

#### –ü–∞—Ä—Å–µ—Ä –≤–µ–±—Ö—É–∫–æ–≤:

**`normalizeRentProgWebhook(branch, rawWebhook)`**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è –∏–∑ `event`/`type`/`name`
- –ü–∞—Ä—Å–∏–Ω–≥ payload (JSON –∏ Ruby-style —Ñ–æ—Ä–º–∞—Ç—ã)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–∏–ø—ã —Å–∏—Å—Ç–µ–º—ã:
  - `booking.issue.planned`
  - `booking.return.planned`
  - `booking.created`
  - `booking.updated`
  - `car.moved`
  - `cash.collected`
- –û–±–æ–≥–∞—â–µ–Ω–∏–µ payload –¥–∞–Ω–Ω—ã–º–∏ –æ —Ñ–∏–ª–∏–∞–ª–µ –∏ –∏—Å—Ö–æ–¥–Ω—ã—Ö –ø–æ–ª—è—Ö

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞

#### –ö–æ–º–∞–Ω–¥–∞ `/status`

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```
üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:

‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚úÖ RentProg tbilisi
‚úÖ RentProg batumi
‚úÖ RentProg kutaisi
‚úÖ RentProg service-center
‚úÖ Umnico API
‚úÖ Stripe API

‚è∞ –í—Ä–µ–º—è: [—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è]
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Per-branch —Å—Ç–∞—Ç—É—Å—ã RentProg —Å —ç–º–æ–¥–∑–∏ ‚úÖ/‚ùå
- –ö—Ä–∞—Ç–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ fail (–¥–æ 30 —Å–∏–º–≤–æ–ª–æ–≤)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤

#### –ö–æ–º–∞–Ω–¥–∞ `/sync_rentprog`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ `RENTPROG_POLL_SINCE_DAYS` –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 14)
- –ü–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞:
  - –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ (`/all_cars_full`)
  - –ö–ª–∏–µ–Ω—Ç—ã (`/clients`)
  - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (`/all_bookings`)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –û—Ç—á–µ—Ç –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
```
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

‚úÖ tbilisi: 50 –∞–≤—Ç–æ, 200 –∫–ª–∏–µ–Ω—Ç–æ–≤, 150 –±—Ä–æ–Ω–µ–π
‚úÖ batumi: 30 –∞–≤—Ç–æ, 120 –∫–ª–∏–µ–Ω—Ç–æ–≤, 80 –±—Ä–æ–Ω–µ–π
‚úÖ kutaisi: 25 –∞–≤—Ç–æ, 100 –∫–ª–∏–µ–Ω—Ç–æ–≤, 60 –±—Ä–æ–Ω–µ–π
‚úÖ service-center: 10 –∞–≤—Ç–æ, 40 –∫–ª–∏–µ–Ω—Ç–æ–≤, 20 –±—Ä–æ–Ω–µ–π
```

**–í—ã–≤–æ–¥ URL –≤–µ–±—Ö—É–∫–æ–≤:**
–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞ –≤ –ª–æ–≥–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è:
```
üîó RentProg Webhook URLs (–¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ RentProg UI):
  tbilisi: https://geodrive.netlify.app/webhooks/rentprog/tbilisi?t=<gen_s1>
  batumi: https://geodrive.netlify.app/webhooks/rentprog/batumi?t=<gen_s2>
  kutaisi: https://geodrive.netlify.app/webhooks/rentprog/kutaisi?t=<gen_s3>
  service-center: https://geodrive.netlify.app/webhooks/rentprog/service-center?t=<gen_s4>
```

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
# Netlify
NETLIFY_SITE=https://geodrive.netlify.app
NETLIFY_AUTH_TOKEN=nfp_qEKCco1mbpCjsso4gYDr4Rxx9YKTRjqtc741

# RentProg v1
RENTPROG_BASE_URL=https://api.rentprog.example
RENTPROG_BRANCH_KEYS={"tbilisi":"91b83b93963633649f29a04b612bab3f9fbb0471b5928622","batumi":"7ad345720f8d92f10c187122427c6a2c2bb9494c6bf14e8d","kutaisi":"5599ebb7b94827fdfd49ca3a5b7e259cfa99d8ea78edeb50","service-center":"5y4j4gcs75o9n5s1e2vrxx4a"}
RENTPROG_WEBHOOK_SECRETS={"tbilisi":"<gen_s1>","batumi":"<gen_s2>","kutaisi":"<gen_s3>","service-center":"<gen_s4>"}
RENTPROG_WEBHOOK_SIGNATURE_HEADER=X-Rentprog-Signature
RENTPROG_TIMEOUT_MS=10000
RENTPROG_PAGE_LIMIT=20
RENTPROG_POLL_SINCE_DAYS=14

# Neon API
NEON_API_KEY=napi_zwcney8v8p1k753p6tjaoj6hh77ekf5ptvec7sj6thoqz3ncc05hq1qkf5err7b9
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `src/config/index.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Å—Ö–µ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `env.example` - –ø—Ä–∏–º–µ—Ä—ã –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

**README.md:**
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "RentProg v1" —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –ü–æ–¥—Ä–∞–∑–¥–µ–ª "RentProg Webhooks (Netlify)" —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ URL
- –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞

**STRUCTURE.md:**
- –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "RentProg" ‚Üí "RentProg v1"
- –û–ø–∏—Å–∞–Ω–∏–µ multi-branch –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –û–ø–∏—Å–∞–Ω–∏–µ API —Ñ—É–Ω–∫—Ü–∏–π –∏ webhooks
- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**ORCHESTRATOR.md:**
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–°–æ–±—ã—Ç–∏—è –æ—Ç RentProg (Webhooks ‚Üí –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)"
- –§–æ—Ä–º–∞—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ (6 —à–∞–≥–æ–≤)
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤:

```
RentProg ‚Üí Netlify Function ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí –ë—ã—Å—Ç—Ä—ã–π ACK (200 OK)
                                    ‚Üì
                         –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
                                    ‚Üì
                         –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                                    ‚Üì
                         –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ –∞–≥–µ–Ω—Ç–∞–º
```

### –ü–æ—Ç–æ–∫ API –∑–∞–ø—Ä–æ—Å–æ–≤:

```
–ó–∞–ø—Ä–æ—Å ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ —Ç–æ–∫–µ–Ω–∞ ‚Üí –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω?
                                    ‚Üì –Ω–µ—Ç
                         –û–±–º–µ–Ω company token ‚Üí request token
                                    ‚Üì
                         –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (TTL 238 —Å–µ–∫)
                                    ‚Üì
                         –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
                                    ‚Üì
                         401? ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ ‚Üí Retry
                                    ‚Üì
                         –†–µ–∑—É–ª—å—Ç–∞—Ç
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:

```
.
‚îú‚îÄ‚îÄ netlify.toml                                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Netlify
‚îú‚îÄ‚îÄ netlify/
‚îÇ   ‚îî‚îÄ‚îÄ functions/
‚îÇ       ‚îî‚îÄ‚îÄ rentprog-webhook/
‚îÇ           ‚îú‚îÄ‚îÄ index.ts                            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–æ–≤
‚îÇ           ‚îî‚îÄ‚îÄ package.json                        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rentprog.ts                             # API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rentprog-webhook-parser.ts              # –ü–∞—Ä—Å–µ—Ä –≤–µ–±—Ö—É–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îÇ   ‚îî‚îÄ‚îÄ bot/
‚îÇ       ‚îî‚îÄ‚îÄ index.ts                                # –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ env.example                                      # –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ README.md                                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ STRUCTURE.md                                     # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îî‚îÄ‚îÄ ORCHESTRATOR.md                                  # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—ç—à–∞:** `Map<BranchName, {token: string, expiresAt: Date}>`
- **TTL:** 238 —Å–µ–∫—É–Ω–¥ (–∑–∞–ø–∞—Å 2 —Å–µ–∫—É–Ω–¥—ã –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ 401 –æ—à–∏–±–∫–∏

### Retry —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

- **–ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫:** 3
- **Backoff:** –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Å jitter
- **–ü–æ–≤—Ç–æ—Ä –ø—Ä–∏:** —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏, 5xx, 429 (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π), 401 (—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞)
- **–ù–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º:** 4xx –æ—à–∏–±–∫–∏ (–∫—Ä–æ–º–µ 401, 429)

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç 1: Query —Ç–æ–∫–µ–Ω**
```
GET /webhooks/rentprog/tbilisi?t=<secret>
```
- –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–í–∞—Ä–∏–∞–Ω—Ç 2: HMAC –ø–æ–¥–ø–∏—Å—å**
```
POST /webhooks/rentprog/tbilisi
Headers:
  X-Rentprog-Signature: <sha256_hmac>
```
- –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
- Constant-time —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π

**–í—Ö–æ–¥—è—â–∏–π —Ñ–æ—Ä–º–∞—Ç (RentProg):**
```json
{
  "event": "booking_update",
  "payload": "{\"id\":470049,\"state\":[\"–ù–æ–≤–∞—è\",\"–ê–∫—Ç–∏–≤–Ω–∞—è\"]}"
}
```

**–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π):**
```json
{
  "type": "booking.updated",
  "timestamp": "2025-01-XX...",
  "source": "rentprog",
  "payload": {
    "rentprog_id": 470049,
    "branch": "tbilisi",
    "booking_id": 470049,
    "state": ["–ù–æ–≤–∞—è", "–ê–∫—Ç–∏–≤–Ω–∞—è"],
    "raw_event": "booking_update"
  }
}
```

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í Netlify Dashboard:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Site settings ‚Üí Environment variables
2. –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `env.example`
3. –î–ª—è `RENTPROG_WEBHOOK_SECRETS` —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞

**–õ–æ–∫–∞–ª—å–Ω–æ (`.env`):**
```bash
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
```

### 2. –î–µ–ø–ª–æ–π Netlify Functions

**–ß–µ—Ä–µ–∑ Netlify CLI:**
```bash
npm install -g netlify-cli
netlify deploy --prod
```

**–ß–µ—Ä–µ–∑ GitHub Actions (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ):**
- Push –≤ main –≤–µ—Ç–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –¥–µ–ø–ª–æ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
```bash
curl https://geodrive.netlify.app/webhooks/rentprog/tbilisi?t=invalid
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401 Unauthorized
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –≤ RentProg

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `npm run dev`
2. –ù–∞–π–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö URL –≤–µ–±—Ö—É–∫–æ–≤
3. –í RentProg UI –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞:
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Webhooks
   - –î–æ–±–∞–≤—å—Ç–µ URL –∏–∑ –ª–æ–≥–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –≤–µ–±—Ö—É–∫ –∏–∑ RentProg –∏–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
curl -X POST https://geodrive.netlify.app/webhooks/rentprog/tbilisi?t=<secret> \
  -H "Content-Type: application/json" \
  -d '{"event":"booking_update","payload":"{\"id\":123}"}'
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–ß–µ—Ä–µ–∑ –±–æ—Ç–∞:**
```
/status
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:

‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚úÖ RentProg tbilisi
‚úÖ RentProg batumi
‚úÖ RentProg kutaisi
‚úÖ RentProg service-center
‚úÖ Umnico API
‚úÖ Stripe API

‚è∞ –í—Ä–µ–º—è: 15.01.2025, 15:30:00
```

### 5. –ü–µ—Ä–≤–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–ß–µ—Ä–µ–∑ –±–æ—Ç–∞:**
```
/sync_rentprog
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏–∑ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 14 –¥–Ω–µ–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–í –±—É–¥—É—â–µ–º:** –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç upsert –≤ –ë–î –ø–æ `rentprog_id` (—Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –≤–µ–±—Ö—É–∫–æ–≤

**–í–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω:**
```bash
curl -X POST \
  "https://geodrive.netlify.app/webhooks/rentprog/tbilisi?t=<valid_secret>" \
  -H "Content-Type: application/json" \
  -d '{"event":"booking_update","payload":"{\"id\":123}"}'
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: `200 OK` —Å `{"ok":true,"queued":true,"syncMs":<number>}`

**–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω:**
```bash
curl -X POST \
  "https://geodrive.netlify.app/webhooks/rentprog/tbilisi?t=invalid" \
  -H "Content-Type: application/json" \
  -d '{"event":"booking_update"}'
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: `401 Unauthorized`

### –¢–µ—Å—Ç /status

**–ö–æ–º–∞–Ω–¥–∞ –≤ –±–æ—Ç–µ:**
```
/status
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –í—Å–µ 4 —Ñ–∏–ª–∏–∞–ª–∞ RentProg –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å ‚úÖ –∏–ª–∏ ‚ùå
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ (–ø–µ—Ä–≤—ã–µ 30 —Å–∏–º–≤–æ–ª–æ–≤)

### –¢–µ—Å—Ç /sync_rentprog

**–ö–æ–º–∞–Ω–¥–∞ –≤ –±–æ—Ç–µ:**
```
/sync_rentprog
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö 4 —Ñ–∏–ª–∏–∞–ª–æ–≤
- –í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É—â–Ω–æ—Å—Ç–µ–π –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–ª–∏–∞–ª—É
- –û—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í–µ–±—Ö—É–∫–∏:**
```
[${branch}] Webhook received: ${eventType}
{
  branch: "tbilisi",
  eventType: "booking_update",
  payloadId: 470049
}
```

**API –∑–∞–ø—Ä–æ—Å—ã:**
```
[${branch}] –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: 50
[${branch}] –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: 200
[${branch}] –ó–∞–≥—Ä—É–∂–µ–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: 150
```

**–û—à–∏–±–∫–∏:**
```
[${branch}] –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ${errorMessage}
[${branch}] Health check failed: ${errorMessage}
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–±—É–¥—É—â–µ–µ)

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π
- Latency –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ (syncMs)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ API –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö health checks
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã:

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤:**
   - Query —Ç–æ–∫–µ–Ω –∏–ª–∏ HMAC –ø–æ–¥–ø–∏—Å—å
   - Constant-time —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–ª—è HMAC
   - –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞–∑ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

2. **–¢–æ–∫–µ–Ω—ã:**
   - –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ (–Ω–µ –≤ –ë–î/–ª–æ–≥–∞—Ö)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
   - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ù–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –ø–æ–ª–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
   - –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–°–µ–∫—Ä–µ—Ç—ã –≤–µ–±—Ö—É–∫–æ–≤:**
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª–∏–Ω–Ω—ã–µ —Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (32+ —Å–∏–º–≤–æ–ª–æ–≤)
   - –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Netlify

2. **HMAC –ø–æ–¥–ø–∏—Å–∏:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HMAC –≤–º–µ—Å—Ç–æ query —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è production
   - –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã

3. **Rate Limiting:**
   - –í –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Upsert –≤ –ë–î:**
   - –ö–æ–º–∞–Ω–¥–∞ `/sync_rentprog` –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
   - TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å upsert –ø–æ `rentprog_id`

2. **–û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π:**
   - –í–µ–±—Ö—É–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–æ –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏
   - TODO: –î–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å (Redis Streams/RabbitMQ) –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

3. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
   - –ù–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤–µ–±—Ö—É–∫–æ–≤
   - TODO: –î–æ–±–∞–≤–∏—Ç—å hash-based –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é (TTL 15 –º–∏–Ω—É—Ç)

4. **Auto-fetch –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   - –í–µ–±—Ö—É–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - TODO: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API

## üìö –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- [–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ RentProg](./docs/RENTPROG_COMPLETE_GUIDE.md)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](./ARCHITECTURE.md)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](./STRUCTURE.md)
- [–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä](./ORCHESTRATOR.md)

## ‚úÖ Definition of Done

–í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:

- [x] ‚úÖ 4 –≤–µ–±—Ö—É–∫–∞ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç —Å–æ–±—ã—Ç–∏—è, —Ä–æ—É—Ç—è—Ç –≤ orchestrator
- [x] ‚úÖ `/status` ‚Üí RentProg per-branch OK/Fail —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏
- [x] ‚úÖ `/sync_rentprog` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã `.env.example` –∏ README
- [x] ‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ `docs/RENTPROG_COMPLETE_GUIDE.md` –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [x] ‚úÖ TypeScript —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **Upsert –≤ –ë–î:**
   - –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü –¥–ª—è cars, clients, bookings
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å upsert –ø–æ `rentprog_id`
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã

2. **–û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis –∏–ª–∏ –¥—Ä—É–≥—É—é –æ—á–µ—Ä–µ–¥—å
   - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ —Ñ–æ–Ω–µ
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

3. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
   - Hash-based –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis —Å TTL 15 –º–∏–Ω—É—Ç

4. **Auto-fetch:**
   - –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–µ–±—Ö—É–∫–∞ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å –º–µ—Ç–∫–æ–π `details_fetched_at`

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –î–∞—à–±–æ—Ä–¥—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-XX  
**–ê–≤—Ç–æ—Ä:** Senior TS/Node Developer

