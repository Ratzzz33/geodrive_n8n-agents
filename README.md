# Jarvis Bot - Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–ø—Ä–æ–∫–∞—Ç–æ–º

MVP-—Å–∫–µ–ª–µ—Ç Telegram-–±–æ—Ç–∞ "Jarvis" –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–ø—Ä–æ–∫–∞—Ç–æ–º Geodrive.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

Jarvis - —ç—Ç–æ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∞–≤—Ç–æ–ø—Ä–æ–∫–∞—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —É–∑–∫–æ—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Telegram-–±–æ—Ç** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∫ –∞–≥–µ–Ω—Ç–∞–º
- **–ê–≥–µ–Ω—Ç—ã** - —É–∑–∫–æ—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º (RentProg, Umnico, Stripe –∏ –¥—Ä.)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - PostgreSQL/Neon –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [ARCHITECTURE.md](./ARCHITECTURE.md), [ORCHESTRATOR.md](./ORCHESTRATOR.md), [AGENTS.md](./AGENTS.md)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 18
- npm –∏–ª–∏ yarn
- PostgreSQL/Neon –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è MVP)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é)

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```bash
cp .env.example .env
```

4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env` –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
DATABASE_URL=postgresql://user:pass@host:port/db
# –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –¥–ª—è MVP
```

### –ó–∞–ø—É—Å–∫

#### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å hot-reload):
```bash
npm run dev
```

#### Production:
```bash
npm run build
npm start
```

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
- `/help` - –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `/status` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã (–ë–î, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, per-branch RentProg)
- `/sync_rentprog` - –ü–µ—Ä–≤–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ RentProg

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ bot/           # Telegram-–±–æ—Ç (Telegraf)
‚îú‚îÄ‚îÄ orchestrator/  # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ agents/        # –ê–≥–µ–Ω—Ç—ã (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
‚îú‚îÄ‚îÄ integrations/ # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
‚îú‚îÄ‚îÄ db/           # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (Drizzle)
‚îú‚îÄ‚îÄ types/        # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ utils/        # –£—Ç–∏–ª–∏—Ç—ã (–ª–æ–≥–≥–µ—Ä –∏ –¥—Ä.)
‚îú‚îÄ‚îÄ config/       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ index.ts      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## üîß –°–∫—Ä–∏–ø—Ç—ã

- `npm run dev` - –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (tsx watch)
- `npm run build` - –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (TypeScript ‚Üí JavaScript)
- `npm start` - –ó–∞–ø—É—Å–∫ —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `npm run lint` - –õ–∏–Ω—Ç–∏–Ω–≥ (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è MVP)

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### RentProg v1

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RentProg API v1:

- **Multi-branch –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: tbilisi, batumi, kutaisi, service-center
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –æ–±–º–µ–Ω company token –Ω–∞ request token —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º
- **Health check**: per-branch –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- **Webhooks**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ Netlify Functions

#### RentProg Webhooks (Netlify)

–í–µ–±—Ö—É–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ Netlify Functions –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ URL:

```
https://geodrive.netlify.app/webhooks/rentprog/{branch}
```

–ì–¥–µ `{branch}` - –æ–¥–∏–Ω –∏–∑ —Ñ–∏–ª–∏–∞–ª–æ–≤: `tbilisi`, `batumi`, `kutaisi`, `service-center`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤:**
- RentProg –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JSON –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
- Netlify Function –¥–µ–ª–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π ACK (200 OK)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ HTTP (`ORCHESTRATOR_URL`)
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä: –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è ‚Üí auto-fetch –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Üí upsert –≤ –ë–î

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```env
NETLIFY_SITE=https://geodrive.netlify.app
RENTPROG_BASE_URL=https://api.rentprog.example
RENTPROG_BRANCH_KEYS={"tbilisi":"...","batumi":"...","kutaisi":"...","service-center":"..."}
ORCHESTRATOR_URL=http://localhost:3000
DEDUP_TTL_MINUTES=15
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [docs/RENTPROG_COMPLETE_GUIDE.md](./docs/RENTPROG_COMPLETE_GUIDE.md)

#### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (External Refs)

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–Ω–∞—à—É –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—É—é** (UUID PK), –∞ –≤–Ω–µ—à–Ω–∏–µ ID (RentProg, AmoCRM –∏ —Ç.–¥.) —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ —Å—Å—ã–ª–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `external_refs`.

**–ë–∞–∑–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `branches`, `employees`, `clients`, `cars`, `bookings` - –Ω–∞—à–∏ —Å—É—â–Ω–æ—Å—Ç–∏ —Å UUID PK

**–¢–∞–±–ª–∏—Ü–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫:**
- `external_refs` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å –Ω–∞—à–∏—Ö UUID —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª—é–±—ã–µ —Å–∏—Å—Ç–µ–º—ã: `rentprog`, `amocrm`, `umnico`, –∏ —Ç.–¥.
  - –•—Ä–∞–Ω–∏—Ç `entity_type`, `entity_id` (–Ω–∞—à UUID), `system`, `external_id`, `branch_code`, `meta`

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤:**
- `webhook_dedup` - —Ö–µ—à–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### n8n –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ n8n –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:

**Workflows:**
1. **RentProg Webhooks Monitor** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–µ–±—Ö—É–∫–æ–≤ –≤ Data Table "events"
2. **Health & Status** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω
3. **Sync Progress** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ Data Table "sync_runs"

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

```env
N8N_EVENTS_URL=https://your-n8n-instance.com/webhook/events
N8N_ALERTS_URL=https://your-n8n-instance.com/webhook/alerts
N8N_ALERTS_TELEGRAM_BOT_TOKEN=your_bot_token
```

### –î—Ä—É–≥–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **Umnico** - –º–æ—Å—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —á–∞—Ç–æ–≤ (WhatsApp/Telegram)
- **Stripe** - —Å–æ–∑–¥–∞–Ω–∏–µ payment links

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Drizzle ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL/Neon.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ë–∞–∑–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã: `branches`, `employees`, `clients`, `cars`, `bookings` (UUID PK)
- –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏: `external_refs` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: `webhook_dedup` (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
```bash
npm run db:generate  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
npm run db:migrate  # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run db:push     # Push —Å—Ö–µ–º—ã –Ω–∞–ø—Ä—è–º—É—é (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `npm run dev`
2. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram –ø–æ —Ç–æ–∫–µ–Ω—É
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` - –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/status` - –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ARCHITECTURE.md](./ARCHITECTURE.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- [STRUCTURE.md](./STRUCTURE.md) - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- [ORCHESTRATOR.md](./ORCHESTRATOR.md) - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π
- [AGENTS.md](./AGENTS.md) - –°–ø–∏—Å–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤

## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å

üöß **MVP / –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ** - –≠—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

ISC
