# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –≤–µ–±—Ö—É–∫–∞–º–∏ RentProg

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–û–∂–∏–¥–∞–µ–º—ã–π URL –≤ RentProg:**
```
https://webhook.rentflow.rentals
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
RentProg ‚Üí https://webhook.rentflow.rentals ‚Üí Nginx ‚Üí n8n (localhost:5678/webhook/rentprog-webhook)
```

---

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–µ–±—Ö—É–∫–æ–≤

### 1. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –≤ RentProg

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö RentProg —É–∫–∞–∑–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –≤–µ–±—Ö—É–∫–∞.

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π URL:**
```
https://webhook.rentflow.rentals
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- ‚ùå `https://webhook.rentflow.rentals/` (—Å–æ —Å–ª—ç—à–µ–º –≤ –∫–æ–Ω—Ü–µ)
- ‚ùå `https://webhook.rentflow.rentals/webhook/rentprog-webhook` (—Å –ø–æ–ª–Ω—ã–º –ø—É—Ç–µ–º)
- ‚ùå `http://webhook.rentflow.rentals` (–±–µ–∑ HTTPS)
- ‚ùå `https://geodrive.netlify.app/webhook/rentprog-webhook` (—Å—Ç–∞—Ä—ã–π –∞–¥—Ä–µ—Å)

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í–æ–π–¥–∏—Ç–µ –≤ RentProg UI –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏** ‚Üí **Webhooks** (–∏–ª–∏ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–∫–∞–∑–∞–Ω–Ω—ã–π URL
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–µ—Ç–æ–¥: `POST`, —Ñ–æ—Ä–º–∞—Ç: `JSON`

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–∏—Ç–µ URL –≤ RentProg –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤ (–¢–±–∏–ª–∏—Å–∏, –ë–∞—Ç—É–º–∏, –ö—É—Ç–∞–∏—Å–∏, –°–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä)

---

### 2. ‚ùå Nginx –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** Nginx –Ω–µ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ n8n.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è webhook –∞–∫—Ç–∏–≤–Ω–∞
ls -la /etc/nginx/sites-enabled/ | grep webhook
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ï—Å–ª–∏ Nginx –Ω–µ –∑–∞–ø—É—â–µ–Ω
sudo systemctl start nginx
sudo systemctl enable nginx

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t  # –ü–æ–∫–∞–∂–µ—Ç –æ—à–∏–±–∫–∏
# –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ
sudo systemctl reload nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è webhook –∞–∫—Ç–∏–≤–Ω–∞
sudo ln -sf /etc/nginx/sites-available/webhook.rentflow.rentals.conf /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

### 3. ‚ùå n8n –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ workflow –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** n8n –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ workflow –æ—Ç–∫–ª—é—á–µ–Ω.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps | grep n8n

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs n8n --tail 50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ workflow –≤ UI
# –û—Ç–∫—Ä–æ–π—Ç–µ: http://46.224.17.15:5678
# Workflow "RentProg Webhooks Monitor" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Active
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω
cd /workspace
docker-compose up -d n8n

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ workflow –≤ UI
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ http://46.224.17.15:5678
# 2. –ù–∞–π–¥–∏—Ç–µ workflow "RentProg Webhooks Monitor"
# 3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω Active (–∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞)
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Webhook node - –ø—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: /webhook/rentprog-webhook
```

---

### 4. ‚ùå DNS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–º–µ–Ω `webhook.rentflow.rentals` –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
dig +short webhook.rentflow.rentals
nslookup webhook.rentflow.rentals

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 46.224.17.15
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è DNS (–≥–¥–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–æ–º–µ–Ω `rentflow.rentals`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ A-–∑–∞–ø–∏—Å—å:
   - **–¢–∏–ø:** A
   - **–ò–º—è:** webhook
   - **–ó–Ω–∞—á–µ–Ω–∏–µ:** 46.224.17.15
   - **TTL:** 3600
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (5-30 –º–∏–Ω—É—Ç)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–Ω–æ–≤–∞: `dig webhook.rentflow.rentals`

---

### 5. ‚ùå SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** RentProg –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å HTTPS –∑–∞–ø—Ä–æ—Å –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å SSL.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
echo | openssl s_client -connect webhook.rentflow.rentals:443 -servername webhook.rentflow.rentals 2>/dev/null | openssl x509 -noout -dates

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl
curl -vI https://webhook.rentflow.rentals
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
sudo certbot --nginx -d webhook.rentflow.rentals --non-interactive --agree-tos --email admin@rentflow.rentals --redirect

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo certbot renew --dry-run
```

---

### 6. ‚ùå –§–∞–π—Ä–≤–æ–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ä—Ç—ã 80 (HTTP) –∏–ª–∏ 443 (HTTPS) –∑–∞–∫—Ä—ã—Ç—ã —Ñ–∞–π—Ä–≤–æ–ª–æ–º.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep -E ':(80|443)'
# –∏–ª–∏
sudo ss -tlnp | grep -E ':(80|443)'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ UFW
sudo ufw status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ iptables
sudo iptables -L -n | grep -E '(80|443)'
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UFW
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è iptables (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞)
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT
```

---

### 7. ‚ùå Nginx –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** Nginx –Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å n8n.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cat /etc/nginx/sites-available/webhook.rentflow.rentals.conf | grep -A 5 "proxy_pass"

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# proxy_pass http://localhost:5678/webhook/rentprog-webhook;
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```nginx
location / {
    proxy_pass http://localhost:5678/webhook/rentprog-webhook;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `/etc/nginx/sites-available/webhook.rentflow.rentals.conf`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `proxy_pass` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Nginx: `sudo systemctl reload nginx`

---

### 8. ‚ùå Workflow –≤ n8n –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:** Webhook node –≤ workflow –∏–º–µ–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∏–ª–∏ Production URL.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n UI: http://46.224.17.15:5678
2. –û—Ç–∫—Ä–æ–π—Ç–µ workflow "RentProg Webhooks Monitor"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Webhook node:
   - **Path:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `rentprog-webhook` (–±–µ–∑ —Å–ª—ç—à–∞ –≤ –Ω–∞—á–∞–ª–µ)
   - **Production URL:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://webhook.rentflow.rentals`
   - **HTTP Method:** POST
   - **Response Mode:** "Respond to Webhook"

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Webhook node –≤ workflow
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
   - Path: `rentprog-webhook`
   - Production URL: `https://webhook.rentflow.rentals`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ workflow
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ workflow –∞–∫—Ç–∏–≤–µ–Ω (–∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "Active")

---

### 9. ‚ùå RentProg –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å (—Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)

**–ü—Ä–æ–±–ª–µ–º–∞:** RentProg –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑-–∑–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
curl -I https://webhook.rentflow.rentals

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Nginx –Ω–∞ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sudo tail -f /var/log/nginx/webhook-access.log
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ: `curl -I https://webhook.rentflow.rentals`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx –Ω–∞ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç RentProg
3. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –∏ DNS

---

### 10. ‚ùå Rate limiting –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** Nginx rate limiting —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ rate limiting
grep -A 5 "limit_req" /etc/nginx/sites-available/webhook.rentflow.rentals.conf

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ 429 –æ—à–∏–±–∫–∏
sudo tail -f /var/log/nginx/webhook-access.log | grep "429"
```

**–†–µ—à–µ–Ω–∏–µ:**
–ï—Å–ª–∏ –≤–∏–¥–Ω—ã –æ—à–∏–±–∫–∏ 429 (Too Many Requests), —É–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```nginx
limit_req_zone $binary_remote_addr zone=webhook_limit:10m rate=30r/s;
# ...
limit_req zone=webhook_limit burst=10 nodelay;
```

---

## üîß –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
cd /workspace
./check_rentprog_webhook_issues.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ DNS —Ä–µ–∑–æ–ª—é—Ü–∏—é
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–æ–º–µ–Ω–∞
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- ‚úÖ –°—Ç–∞—Ç—É—Å Nginx
- ‚úÖ –°—Ç–∞—Ç—É—Å n8n
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook endpoint
- ‚úÖ –õ–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ RentProg UI
1. –í–æ–π–¥–∏—Ç–µ –≤ RentProg –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Webhooks
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URL: `https://webhook.rentflow.rentals` (–±–µ–∑ —Å–ª—ç—à–∞ –∏ –ø—É—Ç–∏)
4. –ú–µ—Ç–æ–¥: POST, –§–æ—Ä–º–∞—Ç: JSON

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
./check_rentprog_webhook_issues.sh

# –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã - –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤—ã—à–µ
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ workflow –≤ n8n
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://46.224.17.15:5678
2. –ù–∞–π–¥–∏—Ç–µ workflow "RentProg Webhooks Monitor"
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω **Active**
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Webhook node - –ø—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `rentprog-webhook`

### –®–∞–≥ 4: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –≤–µ–±—Ö—É–∫
curl -X POST https://webhook.rentflow.rentals \
  -H "Content-Type: application/json" \
  -d '{"event":"test","payload":"{\"id\":\"test_123\"}"}'

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo tail -f /var/log/nginx/webhook-access.log
docker logs n8n --tail 20 -f
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ executions –≤ n8n
1. –í n8n UI –æ—Ç–∫—Ä–æ–π—Ç–µ workflow "RentProg Webhooks Monitor"
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "Executions"
3. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–æ–≤—ã–µ executions –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–µ–±—Ö—É–∫–∞
4. –ï—Å–ª–∏ executions –µ—Å—Ç—å - –≤–µ–±—Ö—É–∫–∏ –¥–æ—Ö–æ–¥—è—Ç –¥–æ n8n ‚úÖ
5. –ï—Å–ª–∏ executions –Ω–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ Nginx –∏–ª–∏ DNS ‚ùå

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤

### –õ–æ–≥–∏ Nginx
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã
sudo tail -f /var/log/nginx/webhook-access.log

# –û—à–∏–±–∫–∏
sudo tail -f /var/log/nginx/webhook-error.log
```

### –õ–æ–≥–∏ n8n
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
docker logs n8n --tail 50 -f

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
docker logs n8n --tail 100 2>&1 | grep -i error
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
SELECT * FROM events ORDER BY created_at DESC LIMIT 10;

-- –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
SELECT * FROM events WHERE processed = false;

-- –û—à–∏–±–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤
SELECT * FROM webhook_error_log ORDER BY ts DESC LIMIT 10;
```

---

## üéØ –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞: "Connection refused"
**–ü—Ä–∏—á–∏–Ω–∞:** n8n –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5678
**–†–µ—à–µ–Ω–∏–µ:** `docker-compose up -d n8n`

### –û—à–∏–±–∫–∞: "502 Bad Gateway"
**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ n8n
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ n8n –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ localhost:5678

### –û—à–∏–±–∫–∞: "404 Not Found"
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –≤ n8n workflow –∏–ª–∏ Nginx proxy_pass
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –≤ workflow (`rentprog-webhook`) –∏ –≤ Nginx (`/webhook/rentprog-webhook`)

### –û—à–∏–±–∫–∞: "SSL certificate problem"
**–ü—Ä–∏—á–∏–Ω–∞:** SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —á–µ—Ä–µ–∑ certbot

### –û—à–∏–±–∫–∞: "Timeout"
**–ü—Ä–∏—á–∏–Ω–∞:** n8n –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ Nginx –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n –Ω–∞ –æ—à–∏–±–∫–∏

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] DNS —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP (46.224.17.15)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
- [ ] Nginx –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è webhook –∞–∫—Ç–∏–≤–Ω–∞ –≤ Nginx
- [ ] n8n –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
- [ ] Workflow "RentProg Webhooks Monitor" –∞–∫—Ç–∏–≤–µ–Ω –≤ n8n
- [ ] Webhook node –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å (`rentprog-webhook`)
- [ ] Production URL –≤ workflow: `https://webhook.rentflow.rentals`
- [ ] –í RentProg —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL (`https://webhook.rentflow.rentals`)
- [ ] –ü–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç

---

## üìû –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `./check_rentprog_webhook_issues.sh`
2. –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏:
   ```bash
   # Nginx –ª–æ–≥–∏
   sudo tail -100 /var/log/nginx/webhook-access.log > webhook-access.log
   sudo tail -100 /var/log/nginx/webhook-error.log > webhook-error.log
   
   # n8n –ª–æ–≥–∏
   docker logs n8n --tail 100 > n8n-logs.txt
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ executions –≤ n8n UI
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î: `SELECT * FROM events ORDER BY created_at DESC LIMIT 20;`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-15
