# üöÄ –ó–∞–ø—É—Å–∫ Jarvis API –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–î–∞—Ç–∞:** 2025-11-05 05:00  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è API –Ω–µ –∑–∞–ø—É—â–µ–Ω, workflow –ø–∞–¥–∞–µ—Ç —Å timeout

---

## ‚ùó –ü—Ä–æ–±–ª–µ–º–∞

n8n workflow **"Service Center Processor"** –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π:
```
connect ETIMEDOUT 46.224.17.15:3000
```

**–ü—Ä–∏—á–∏–Ω–∞:** Jarvis API —Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É `:3000`

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ó–∞–ø—É—Å—Ç–∏—Ç—å Jarvis API

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@46.224.17.15
# Password: Geodrive2024SecurePass
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd /root/geodrive_n8n-agents
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)

```bash
npm install
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä

**–í–∞—Ä–∏–∞–Ω—Ç A: –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ —Å PM2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PM2 (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
npm install -g pm2

# –ó–∞–ø—É—Å—Ç–∏—Ç—å API
pm2 start npm --name "jarvis-api" -- run start:api

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
pm2 save
pm2 startup
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ó–∞–ø—É—Å–∫ –Ω–∞–ø—Ä—è–º—É—é (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)**

```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å!)
npm run start:api
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ nohup (—Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –±–µ–∑ PM2)**

```bash
nohup npm run start:api > /var/log/jarvis-api.log 2>&1 &
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
curl http://localhost:3000/

# –ò–ª–∏ –∏–∑–≤–Ω–µ
curl http://46.224.17.15:3000/
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "service": "jarvis-bot"
}
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### PM2

```bash
pm2 logs jarvis-api
pm2 status
```

### Nohup

```bash
tail -f /var/log/jarvis-api.log
```

### –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫

–õ–æ–≥–∏ –±—É–¥—É—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å

---

## üõ†Ô∏è Troubleshooting

### –ü–æ—Ä—Ç 3000 –∑–∞–Ω—è—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç
lsof -i :3000
netstat -tulpn | grep 3000

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>
```

### –û—à–∏–±–∫–∞ `Cannot find module`

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
rm -rf node_modules package-lock.json
npm install
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å connection string –≤ `.env`:
```bash
cat .env | grep DATABASE_URL
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
DATABASE_URL=postgresql://neondb_owner:npg_cHIT9Kxfk1Am@ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require
```

---

## ‚úÖ –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ API –æ—Ç–≤–µ—á–∞–µ—Ç: `curl http://46.224.17.15:3000/`
2. ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç workflow: `node setup/retry_booking_486033.mjs`
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç: `node setup/check_nested_processing_result.mjs`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ü–æ—Ä—Ç:** 3000 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)
- **External URL:** `http://46.224.17.15:3000` (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø, –±–µ–∑ Nginx)
- **Endpoints:**
  - `GET  /` - root (health check)
  - `POST /upsert-car` - upsert car —á–µ—Ä–µ–∑ dynamic_upsert_entity
  - `POST /upsert-client` - upsert client —á–µ—Ä–µ–∑ dynamic_upsert_entity
  - `POST /process-event` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π RentProg
  - `GET  /rentprog/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è RentProg API

---

**–ê–≤—Ç–æ—Ä:** Claude  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

