# –ê–Ω–∞–ª–∏–∑ execution #18129

## –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

### –ü–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ workflow:

1. **Fetch Kutaisi Cars** ‚úÖ
   - `itemsOutput: 11` - –ø–æ–ª—É—á–µ–Ω–æ 11 –º–∞—à–∏–Ω
   - –°—Ç–∞—Ç—É—Å: success

2. **Wrap Kutaisi Cars** ‚úÖ
   - `itemsOutput: 1` - –≤—Å–µ 11 –º–∞—à–∏–Ω —Å–æ–±—Ä–∞–Ω—ã –≤ –º–∞—Å—Å–∏–≤ `cars`
   - –°—Ç–∞—Ç—É—Å: success

3. **Merge All Branches** ‚úÖ
   - `itemsOutput: 1` - –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã
   - –°—Ç–∞—Ç—É—Å: success

4. **Normalize Cars** ‚úÖ
   - `itemsOutput: 11` - –≤—Å–µ 11 –º–∞—à–∏–Ω –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã
   - –°—Ç–∞—Ç—É—Å: success
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ 2 –º–∞—à–∏–Ω—ã (38191, 62396) –∏–∑-–∑–∞ –æ–±—Ä–µ–∑–∫–∏ –≤ summary mode

5. **Has Data?** ‚úÖ
   - `itemsOutput: 11` - –≤—Å–µ 11 –º–∞—à–∏–Ω –ø—Ä–æ—à–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É
   - –°—Ç–∞—Ç—É—Å: success

6. **Save Snapshot** ‚ö†Ô∏è
   - `itemsInput: 0` - **–°–¢–†–ê–ù–ù–û!** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 11
   - `itemsOutput: 1` - –≤–æ–∑–≤—Ä–∞—â–µ–Ω —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
   - `pairedItem: [0-10]` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ 11 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –°—Ç–∞—Ç—É—Å: success
   - **–ü–†–û–ë–õ–ï–ú–ê:** –í –ë–î –Ω–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å!

7. **Remove Price Values** ‚úÖ
   - `itemsOutput: 1` - –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ Save Snapshot
   - –°—Ç–∞—Ç—É—Å: success

8. **Save Cars** ‚ö†Ô∏è
   - `itemsInput: 0` - **–°–¢–†–ê–ù–ù–û!** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 11
   - `itemsOutput: 1` - –≤–æ–∑–≤—Ä–∞—â–µ–Ω —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
   - –°—Ç–∞—Ç—É—Å: success
   - **–ü–†–û–ë–õ–ï–ú–ê:** –í –ë–î —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å —Ç–æ–ª—å–∫–æ 2 –º–∞—à–∏–Ω—ã (38191, 62396) –≤–º–µ—Å—Ç–æ 11

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `rentprog_car_states_snapshot`
- –í –ë–î: 0 –∑–∞–ø–∏—Å–µ–π
- –û–∂–∏–¥–∞–ª–æ—Å—å: 11 –∑–∞–ø–∏—Å–µ–π

### 2. ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `cars`
- –í –ë–î: 2 –º–∞—à–∏–Ω—ã (38191, 62396)
- –û–∂–∏–¥–∞–ª–æ—Å—å: 11 –º–∞—à–∏–Ω
- –ü–æ—Ç–µ—Ä—è–Ω–æ: 9 –º–∞—à–∏–Ω

### 3. üîç –ü—Ä–æ–±–ª–µ–º–∞ –≤ SQL –∑–∞–ø—Ä–æ—Å–∞—Ö

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **SQL –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞**
   - Postgres –Ω–æ–¥–∞ —Å `executeQuery` –¥–æ–ª–∂–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ù–æ –≤–æ–∑–º–æ–∂–Ω–æ, —á—Ç–æ-—Ç–æ –∏–¥–µ—Ç –Ω–µ —Ç–∞–∫ —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º `$json`

2. **–û—à–∏–±–∫–∏ –≤ —Ç–∏–ø–∞—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–∏**
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –º–æ–≥—É—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –Ω—É–∂–Ω–æ–º—É —Ç–∏–ø—É
   - –ù–∞–ø—Ä–∏–º–µ—Ä: `(data->>'year')::integer` –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å, –µ—Å–ª–∏ year = null –∏–ª–∏ –Ω–µ —á–∏—Å–ª–æ

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º JSON**
   - `JSON.stringify($json).replace(/'/g, "''")` –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏–º–≤–æ–ª—ã
   - –û—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ–ª–µ–π —Å –∫–∞–≤—ã—á–∫–∞–º–∏ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏

4. **ON CONFLICT –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**
   - –í–æ–∑–º–æ–∂–Ω–æ, constraint `rentprog_id` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ò–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ INSERT –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –≤ CTE

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Postgres** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** –≤ SQL –∑–∞–ø—Ä–æ—Å—ã (TRY/CATCH –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ JSON
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Postgres –Ω–æ–¥** - –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å "Execute Once for All Items"
5. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ workflow –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è, –∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Postgres –Ω–æ–¥ –≤ workflow
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –≤—Ä—É—á–Ω—É—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ 11 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Ö–æ–¥—è—Ç –¥–æ Save –Ω–æ–¥

