# Настройка агентов в n8n

Это руководство поможет вам настроить AI агентов в n8n с помощью Cursor через MCP.

## Что такое агенты в n8n?

Агенты в n8n - это автономные AI-ассистенты, которые могут:
- Выполнять задачи автоматически
- Принимать решения на основе контекста
- Взаимодействовать с внешними сервисами
- Обрабатывать сложные workflow с использованием AI

## Предварительные требования

1. ✅ n8n установлен и запущен
2. ✅ MCP сервер настроен (см. [MCP_SETUP.md](MCP_SETUP.md))
3. ✅ API ключ n8n получен и настроен

## Шаг 1: Создание базового агента через MCP

Через Cursor вы можете попросить:

```
Создай workflow в n8n для агента, который:
1. Принимает текстовый запрос
2. Обрабатывает его через AI (OpenAI/Anthropic)
3. Выполняет действия на основе ответа
4. Возвращает результат
```

MCP автоматически создаст workflow со следующими узлами:
- **Webhook** - для приема запросов
- **AI Model Node** - для обработки запросов
- **Code Node** - для логики агента
- **HTTP Request** - для внешних API (при необходимости)

## Шаг 2: Настройка агента для обработки задач

### Пример 1: Агент для обработки email запросов

```
Создай агента в n8n, который:
- Получает email через IMAP
- Извлекает задачу из письма
- Обрабатывает через AI модель
- Выполняет действия (создает задачи, отправляет ответы)
- Отправляет результат обратно по email
```

### Пример 2: Агент-оркестратор для управления workflow

```
Создай агента-оркестратора, который:
- Получает задачу высокого уровня
- Разбивает ее на подзадачи
- Назначает подзадачи другим агентам
- Собирает результаты
- Возвращает финальный результат
```

## Шаг 3: Настройка AI моделей для агентов

### Использование OpenAI

В n8n workflow добавьте узел "OpenAI":

```
Настрой узел OpenAI в workflow ID 123 для:
- Модель: gpt-4
- Температура: 0.7
- Максимальные токены: 2000
- Системный промпт: "Ты агент для обработки задач..."
```

### Использование Anthropic Claude

```
Добавь узел Anthropic в workflow:
- Модель: claude-3-opus
- Максимальные токены: 4000
```

## Шаг 4: Создание агента через команды Cursor

### Базовая структура агента

```
Создай workflow в n8n со следующими узлами:

1. Trigger Node (Webhook)
   - Метод: POST
   - Путь: /agent/task

2. AI Model Node (OpenAI)
   - Модель: gpt-4
   - Промпт: "Обработай задачу: {{ $json.task }}"

3. Code Node
   - Обработка ответа AI
   - Извлечение действий

4. HTTP Request Node (для выполнения действий)
   - На основе ответа AI

5. Response Node
   - Возврат результата
```

### Агент с памятью

```
Создай агента с памятью:
- Сохраняет контекст разговора в базе данных
- Использует историю при следующих запросах
- Обрабатывает многошаговые задачи
```

## Шаг 5: Оркестрация агентов

### Создание оркестратора

Оркестратор управляет несколькими специализированными агентами:

```
Создай workflow-оркестратор, который:
1. Принимает сложную задачу
2. Анализирует, какие агенты нужны
3. Создает подзадачи для каждого агента
4. Запускает агентов параллельно или последовательно
5. Собирает результаты
6. Объединяет результаты в финальный ответ
```

### Пример структуры оркестратора

```
Оркестратор (Webhook)
  ↓
Анализ задачи (AI Node)
  ↓
Определение агентов (Switch Node)
  ├─→ Агент A (HTTP Request к workflow A)
  ├─→ Агент B (HTTP Request к workflow B)
  └─→ Агент C (HTTP Request к workflow C)
  ↓
Объединение результатов (Code Node)
  ↓
Ответ (Response Node)
```

## Шаг 6: Практические примеры

### Пример 1: Агент для автоматизации работы

```
Создай агента для автоматизации работы:

Задача: Приходит запрос на создание задачи в Jira

Агент должен:
1. Извлечь информацию из запроса (через AI)
2. Определить приоритет и метки
3. Создать задачу в Jira через API
4. Отправить подтверждение обратно
```

### Пример 2: Агент для обработки данных

```
Создай агента для обработки данных:

Функции:
- Анализирует входящие данные
- Определяет структуру данных
- Применяет необходимые трансформации
- Сохраняет в нужное место
- Создает отчет
```

### Пример 3: Агент для поддержки клиентов

```
Создай агента поддержки:

Возможности:
- Отвечает на вопросы клиентов
- Ищет информацию в базе знаний
- Эскалирует сложные вопросы
- Создает тикеты при необходимости
```

## Шаг 7: Мониторинг и отладка

### Просмотр выполнения агентов

```
Покажи последние 10 выполнений workflow агента с ID 123
```

### Просмотр логов

```
Покажи логи последнего выполнения агента
```

### Проверка статуса агентов

```
Покажи все активные агенты и их статус
```

## Лучшие практики

1. **Разделение ответственности**: Создавайте специализированных агентов для конкретных задач
2. **Обработка ошибок**: Всегда добавляйте обработку ошибок в workflow
3. **Логирование**: Логируйте важные действия для отладки
4. **Тестирование**: Тестируйте агентов перед продакшеном
5. **Мониторинг**: Отслеживайте производительность агентов

## Следующие шаги

- [N8N_ORCHESTRATOR_SETUP.md](N8N_ORCHESTRATOR_SETUP.md) - Детальная настройка оркестратора
- [MCP_SETUP.md](MCP_SETUP.md) - Настройка MCP для Cursor

## Полезные команды для Cursor

```
- "Создай агента для [задача]"
- "Настрой AI модель в workflow [ID]"
- "Добавь обработку ошибок в агента [ID]"
- "Покажи структуру агента [ID]"
- "Оптимизируй производительность агента [ID]"
```

