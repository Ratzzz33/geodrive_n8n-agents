# üìÅ RentProg Processors

–ì—Ä—É–ø–ø–∞ –∏–∑ 4 –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç RentProg –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º.

## –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤

| –§–∏–ª–∏–∞–ª | Workflow ID | –ù–∞–∑–≤–∞–Ω–∏–µ | Webhook URL | –°—Ç–∞—Ç—É—Å |
|--------|-------------|----------|-------------|--------|
| Service Center | `PbDKuU06H7s2Oem8` | Service Center Processor Rentprog | `https://n8n.rentflow.rentals/webhook/service-center-webhook` | ‚úÖ Active |
| Tbilisi | `P65bXE5Xhupkxxw6` | Tbilisi Processor Rentprog | `https://n8n.rentflow.rentals/webhook/tbilisi-webhook` | ‚úÖ Active |
| Batumi | `YsBma7qYsdsDykTq` | Batumi Processor Rentprog | `https://n8n.rentflow.rentals/webhook/batumi-webhook` | ‚úÖ Active |
| Kutaisi | `gJPvJwGQSi8455s9` | Kutaisi Processor Rentprog | `https://n8n.rentflow.rentals/webhook/kutaisi-webhook` | ‚úÖ Active |

## –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏

- **n8n UI:** https://n8n.rentflow.rentals
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** –í –ø–æ–∏—Å–∫–µ n8n –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Processor Rentprog` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö 4 –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ UI)

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n: https://n8n.rentflow.rentals
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:
   - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ workflow
   - –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ç–µ–≥–∞
   - –î–æ–±–∞–≤—å—Ç–µ —Ç–µ–≥: `RentProg Processors`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–µ–≥–∏ —á–µ—Ä–µ–∑ REST API –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è (read-only), –ø–æ—ç—Ç–æ–º—É –∏—Ö –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ UI.

## –ß—Ç–æ –¥–µ–ª–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã

1. **–ü—Ä–∏–Ω–∏–º–∞—é—Ç –≤–µ–±—Ö—É–∫–∏** –æ—Ç RentProg –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∞–¥—Ä–µ—Å–∞–º
2. **–ü–∞—Ä—Å—è—Ç —Å–æ–±—ã—Ç–∏—è** (create/update/destroy –¥–ª—è car/client/booking)
3. **–°–æ—Ö—Ä–∞–Ω—è—é—Ç –≤ –ë–î:**
   - –°–æ–±—ã—Ç–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É `events`
   - –°—É—â–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `dynamic_upsert_entity`
   - –°–≤—è–∑–∏ —á–µ—Ä–µ–∑ `external_refs`
4. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - –î–ª—è booking –∏–∑–≤–ª–µ–∫–∞—é—Ç car –∏ client
   - –°–æ–∑–¥–∞—é—Ç/–æ–±–Ω–æ–≤–ª—è—é—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
   - –û–±–Ω–æ–≤–ª—è—é—Ç foreign keys –≤ bookings
5. **–û—Ç–ø—Ä–∞–≤–ª—è—é—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** ‚ú® NEW
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç —Å–æ–±—ã—Ç–∏—è –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥
   - –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å—Ç–∞—Ä–æ–µ ‚Üí –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
   - –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç –≤ —á–∞—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)

–í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- **Webhook node** (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞)
- **Parse Webhook** (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ entity_type –∏ operation)
- **Save to Events** (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è)
- **Switch by Operation** (create/update/destroy)
- **Switch by Entity** (car/client/booking)
- **Fetch from RentProg API** (–µ—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞)
- **Insert Fetched Entity** ‚Üí **Respond Success**

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ Telegram –∞–ª–µ—Ä—Ç–æ–≤: ‚ú®
- **Parse Webhook** ‚Üí
- **Format Telegram Alert** (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è) ‚Üí
- **Send Telegram Alert** (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram)

**–í–∞–∂–Ω–æ:**
1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ nested –¥–∞–Ω–Ω—ã—Ö** (car/client –∏–∑ booking) –ø–µ—Ä–µ–ª–æ–∂–µ–Ω–∞ –Ω–∞ PostgreSQL —Ç—Ä–∏–≥–≥–µ—Ä `process_booking_nested_entities`
2. **Telegram –∞–ª–µ—Ä—Ç—ã** –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ Parse Webhook –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å `[old, new]` –º–∞—Å—Å–∏–≤–∞–º–∏
3. **–ê–ª–µ—Ä—Ç—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç** –æ—Å–Ω–æ–≤–Ω–æ–π workflow (continueOnFail: true)

## Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- **–ß–∞—Ç ID:** `-5004140602` (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `$env.TELEGRAM_ALERT_CHAT_ID`)
- **–ë–æ—Ç:** Telegram account credential
- **–§–æ—Ä–º–∞—Ç:** –°–º. –ø—Ä–∏–º–µ—Ä—ã –≤ `TELEGRAM_ALERTS_GUIDE.md`

### –ü—Ä–∏–º–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã:**
```
üöó SERVICE-CENTER | car.update
üÜî ID: 52138

üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è:
‚Ä¢ company_id: 9247 ‚Üí 11163
‚Ä¢ mileage: 197000 ‚Üí 200500
```

**–ù–æ–≤–∞—è –±—Ä–æ–Ω—å:**
```
üìÖ BATUMI | booking.create
üÜî ID: 507616

‚ú® –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç:
‚Ä¢ car_name: Volkswagen Tiguan
‚Ä¢ client_id: 368848
‚Ä¢ start_date: 2025-11-10 01:30:00
‚Ä¢ state: –ù–æ–≤–∞—è
‚Ä¢ price: 105
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–û—Ç–∫–ª—é—á–∏—Ç—å –∞–ª–µ—Ä—Ç—ã:**
- –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–¥—ã "Format Telegram Alert" –∏ "Send Telegram Alert" –≤ n8n UI

**–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç:**
```bash
node setup/fix_alert_format_code.mjs
```

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** –°–º. `TELEGRAM_ALERTS_GUIDE.md`

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìä **–û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** `SESSION_REPORT_TELEGRAM_ALERTS_2025-11-05.md`
- üìñ **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–ª–µ—Ä—Ç–∞–º:** `TELEGRAM_ALERTS_GUIDE.md`
- üîß **–†–∞–±–æ—á–∏–µ —Ä–µ—à–µ–Ω–∏—è:** `claude.md`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-05

