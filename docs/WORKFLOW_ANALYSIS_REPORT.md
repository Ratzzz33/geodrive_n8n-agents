# üìä –û—Ç—á–µ—Ç: –ê–Ω–∞–ª–∏–∑ workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ Tbilisi

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-21  
**Workflow ID:** `P65bXE5Xhupkxxw6`  
**–ù–∞–∑–≤–∞–Ω–∏–µ:** –¢–±–∏–ª–∏—Å–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤

---

## üîç –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:

1. **Webhook (Tbilisi)** ‚Üí –ü—Ä–∏–µ–º POST –∑–∞–ø—Ä–æ—Å–∞
2. **Respond Fast ACK** ‚Üí –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (< 100ms)
3. **Parse Webhook** ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ payload
4. **Save to Events** ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É `events`
5. **Pass Data** ‚Üí –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞–ª—å—à–µ
6. **Switch by Operation** ‚Üí –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º:
   - `create` ‚Üí Prepare Create ‚Üí Insert Entity
   - `update` ‚Üí Check Exists ‚Üí If Exists ‚Üí [Prepare Update / Get RentProg Token]
   - `destroy` ‚Üí Mark as Deleted

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 1. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**‚úÖ Parse Webhook:**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç Ruby-—Ñ–æ—Ä–º–∞—Ç (`=>`, `nil`)
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `entity_type` (car/client/booking)
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `operation` (create/update/destroy)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `event_hash` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç `rentprog_id` –∏–∑ payload

**‚úÖ Save to Events:**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é: `UNIQUE (company_id, type, rentprog_id)`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `processed = false` –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `execution_id` –∏ `execution_url`

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π

**‚úÖ Prepare Create:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `table_name` (cars/clients/bookings)
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—ã –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ DD-MM-YYYY –≤ ISO
- –§–æ—Ä–º–∏—Ä—É–µ—Ç `payload_json` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é

**‚úÖ Insert Entity:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `dynamic_upsert_entity()`
- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç UUID –¥–ª—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `external_refs`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É
- –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ü–µ–ª–µ–≤—É—é —Ç–∞–±–ª–∏—Ü—É

**‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏:**
- –ü—Ä–∏ `operation = 'update'` –∏ `exists = false` ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ `Get RentProg Token`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ RentProg API:
  - `Fetch Car` ‚Üí `/cars/{rentprog_id}`
  - `Fetch Client` ‚Üí `/search_clients?query={id}`
  - `Fetch Booking` ‚Üí `/search_bookings?query={id}`
- `Extract Result` ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Ç–≤–µ—Ç–∞ API
- `Insert Fetched Entity` ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ `dynamic_upsert_entity()`

**‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ/–∫–ª–∏–µ–Ω—Ç–µ/–±—Ä–æ–Ω–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ API endpoints
- –ü–µ—Ä–µ–¥–∞–µ—Ç `Authorization: Bearer {token}`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç API –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**‚úÖ Prepare Update:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –º–∞—Å—Å–∏–≤–æ–≤ `[old, new]`
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç `updates` —Å –Ω–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –°–æ–∑–¥–∞–µ—Ç `updates_json` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –ë–î

**‚úÖ Update Entity (external_refs):**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `data = data || $1::jsonb` (–º–µ—Ä–∂ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ **–ù–ï –∑–∞—Ç–∏—Ä–∞–µ—Ç** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ JSONB

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–∏—Å–∫–∏

### 1. –ó–∞—Ç–∏—Ä–∞–Ω–∏–µ NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:**

**–ú–µ—Å—Ç–æ:** –§—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity()` –≤ –ë–î

**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
v_set_clause := v_set_clause || format('%I = %L', v_key, p_data->>v_key);
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ï—Å–ª–∏ –≤ `payload` –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–ª–µ —Å `null` –∏–ª–∏ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π, –æ–Ω–æ **–∑–∞—Ç–∏—Ä–∞–µ—Ç** —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ë–î
- –ù–∞–ø—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ `plate = null` –≤ payload, —Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≥–æ—Å–Ω–æ–º–µ—Ä –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω

**–ü—Ä–∏–º–µ—Ä –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
- `booking #515772`: –ø–æ–ª—è `responsible` –∏ `responsible_id` —Å–æ–¥–µ—Ä–∂–∞—Ç `[null, null]`
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —ç—Ç–∏ NULL –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞—Ç–∏—Ä–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –í–º–µ—Å—Ç–æ:
v_set_clause := v_set_clause || format('%I = %L', v_key, p_data->>v_key);

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
IF p_data->>v_key IS NOT NULL AND p_data->>v_key != '' THEN
  v_set_clause := v_set_clause || format('%I = %L', v_key, p_data->>v_key);
END IF;
```

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ NULL –≤ Prepare Update

**‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê:**

**–ú–µ—Å—Ç–æ:** –ù–æ–¥–∞ "Prepare Update" –≤ workflow

**–ö–æ–¥:**
```javascript
for (const [key, value] of Object.entries(payload)) {
  if (Array.isArray(value) && value.length === 2) {
    updates[key] = value[1];  // ‚Üê –ë–µ—Ä–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–æ null
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `value[1] === null`, —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `updates`
- –ó–∞—Ç–µ–º –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `dynamic_upsert_entity()`
- –ò –∑–∞—Ç–∏—Ä–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
if (Array.isArray(value) && value.length === 2) {
  const newValue = value[1];
  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º null –∏ undefined, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  if (newValue !== null && newValue !== undefined) {
    updates[key] = newValue;
  }
}
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –±–µ–∑ –∑–∞—â–∏—Ç—ã

**‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê:**

**–ú–µ—Å—Ç–æ:** –§—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity()` –≤ –ë–î

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
- –û–±–Ω–æ–≤–ª—è–µ—Ç –í–°–ï –ø–æ–ª—è –∏–∑ `p_data`, –≤–∫–ª—é—á–∞—è NULL
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ NULL –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏

**–†–∏—Å–∫:**
- –ï—Å–ª–∏ RentProg –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è + NULL –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö)
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞—Ç–µ—Ä—Ç—ã NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ NULL –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ SET clause
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `COALESCE` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `dynamic_upsert_entity()`

**–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç NULL:**
```sql
FOR v_key IN SELECT jsonb_object_keys(p_data)
LOOP
  -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è
  IF v_key IN ('id', 'created_at', 'updated_at', 'car_id', 'client_id', 'booking_id') THEN
    CONTINUE;
  END IF;
  
  -- –ü–†–û–ë–õ–ï–ú–ê: p_data->>v_key –º–æ–∂–µ—Ç –±—ã—Ç—å NULL
  -- –†–ï–®–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ SET clause
  IF p_data->>v_key IS NOT NULL AND p_data->>v_key != '' THEN
    IF NOT v_first_set_item THEN
      v_set_clause := v_set_clause || ', ';
    END IF;
    v_set_clause := v_set_clause || format('%I = %L', v_key, p_data->>v_key);
    v_first_set_item := FALSE;
  END IF;
END LOOP;
```

### 2. –£–ª—É—á—à–∏—Ç—å –Ω–æ–¥—É "Prepare Update"

**–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é NULL:**
```javascript
for (const [key, value] of Object.entries(payload)) {
  if (Array.isArray(value) && value.length === 2) {
    const newValue = value[1];
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º null –∏ undefined
    if (newValue !== null && newValue !== undefined) {
      updates[key] = newValue;
    }
  } else if (key !== 'id' && value !== null && value !== undefined) {
    updates[key] = value;
  }
}
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ NULL –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:
1. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ webhook
2. ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
3. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API
4. ‚úÖ –ú–µ—Ä–∂ –¥–∞–Ω–Ω—ã—Ö –≤ `external_refs` (–Ω–µ –∑–∞—Ç–∏—Ä–∞–µ—Ç)

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
1. üî¥ **–ö–†–ò–¢–ò–ß–ù–û:** –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ç–∏—Ä–∞–Ω–∏—è NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –≤ `dynamic_upsert_entity()`
2. ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è NULL –≤ –Ω–æ–¥–µ "Prepare Update"
3. ‚ö†Ô∏è **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ external_refs:** 13,959
- **–°–æ–∑–¥–∞–Ω–æ –∑–∞ 24 —á–∞—Å–∞:** 139 –∑–∞–ø–∏—Å–µ–π
- **–û–±–Ω–æ–≤–ª–µ–Ω–æ –∑–∞ 24 —á–∞—Å–∞:** 10 –∑–∞–ø–∏—Å–µ–π
- **–ü—Ä–∏–º–µ—Ä—ã UPDATE —Å NULL:** –Ω–∞–π–¥–µ–Ω—ã (booking #515772)

---

**–í—ã–≤–æ–¥:** Workflow —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ü–µ–ª–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –µ—Å—Ç—å **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞** —Å –∑–∞—Ç–∏—Ä–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `dynamic_upsert_entity()` –∏ –Ω–æ–¥—É "Prepare Update".

