# –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-09  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üìã –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥—É–ª–µ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –∏–∑ `docs/LINTING_AND_TESTING.md`.

---

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. `src/utils/logger.test.ts` - –¢–µ—Å—Ç—ã –ª–æ–≥–≥–µ—Ä–∞

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö (debug, info, warn, error)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ LOG_LEVEL
- ‚úÖ –§–æ—Ä–º–∞—Ç timestamp (ISO)
- ‚úÖ –ò–µ—Ä–∞—Ä—Ö–∏—è —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ –ª–æ–≥–∞—Ö

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–æ–∫–∏—Ä—É–µ—Ç `console.log` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–∑–æ–≤–æ–≤
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö `LOG_LEVEL`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

---

### 2. `src/config/index.test.ts` - –¢–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (TELEGRAM_BOT_TOKEN)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è enum (logLevel)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è URL –ø–æ–ª–µ–π
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ Singleton –ø–∞—Ç—Ç–µ—Ä–Ω
- ‚úÖ RentProg –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ n8n –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–∫–∏ –¥–ª—è `dotenv`
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ Zod schema
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

---

### 3. `src/services/cashRegisterService.test.ts` - –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –∫–∞—Å—Å

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Å—ã (add/subtract –æ–ø–µ—Ä–∞—Ü–∏–∏)
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å–æ –≤—Å–µ–º–∏ –≤–∞–ª—é—Ç–∞–º–∏ (GEL, USD, EUR)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `cash_last_updated`
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Å—Å—ã –ø–æ ID
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Å—Å—ã –ø–æ –∏–º–µ–Ω–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–æ–∫–∏—Ä—É–µ—Ç `postgres` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç –ë–î
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –º–æ–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –≤–∞–ª—é—Ç—ã

---

### 4. `src/db/upsert.test.ts` - –¢–µ—Å—Ç—ã upsert —Ñ—É–Ω–∫—Ü–∏–π

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ `resolveByExternalRef` - –ø–æ–∏—Å–∫ –ø–æ –≤–Ω–µ—à–Ω–µ–π —Å—Å—ã–ª–∫–µ
- ‚úÖ `linkExternalRef` - —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Å—ã–ª–æ–∫
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `branch_code` –∏ `meta`
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ (external_id –≤ —Å—Ç—Ä–æ–∫—É)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–æ–∫–∏—Ä—É–µ—Ç Drizzle ORM
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç edge cases

---

### 5. `src/integrations/rentprog.test.ts` - –¢–µ—Å—Ç—ã RentProg –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π —Ñ–∏–ª–∏–∞–ª–æ–≤
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ Health check –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–æ–∫–∏—Ä—É–µ—Ç `axios` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç —Å–µ—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

---

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã

```bash
npm test
```

### –° watch —Ä–µ–∂–∏–º–æ–º

```bash
npm run test:watch
```

### –° coverage

```bash
npm run test:coverage
```

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª

```bash
npx vitest src/utils/logger.test.ts
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 55 —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –º–æ–¥—É–ª–µ–π:** 5 –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** Vitest
- **–ü–∞—Ç—Ç–µ—Ä–Ω—ã:** –ú–æ–∫–∏, –∏–∑–æ–ª—è—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, edge cases
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

---

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### `vitest.config.ts`

–û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
- ‚úÖ –¢–µ—Å—Ç–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `tests/`
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Å —Å–µ—Ç—å—é/–ë–î
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ coverage

---

## üìù –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ú–æ–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```typescript
vi.mock('../utils/logger', () => ({
  logger: {
    debug: vi.fn(),
    info: vi.fn(),
    // ...
  },
}));
```

### 2. –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

```typescript
beforeEach(() => {
  vi.clearAllMocks();
});

afterEach(() => {
  vi.restoreAllMocks();
});
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–æ–≤

```typescript
expect(mockFunction).toHaveBeenCalled();
expect(mockFunction).toHaveBeenCalledWith(expectedArgs);
```

### 4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```typescript
it('–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å async –æ–ø–µ—Ä–∞—Ü–∏—é', async () => {
  const result = await asyncFunction();
  expect(result).toBeDefined();
});
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è:

1. **API Routes** (`src/api/routes/`)
   - `entityTimeline.test.ts`
   - `eventLinks.test.ts`
   - `syncEmployeeCash.test.ts`
   - `syncBookings.test.ts`

2. **Services** (`src/services/`)
   - `eventParsers.test.ts`
   - `historyProcessor.test.ts`
   - `taskService.test.ts`

3. **Integrations** (`src/integrations/`)
   - `rentprog-webhook-parser.test.ts`
   - `n8n.test.ts`

4. **Orchestrator** (`src/orchestrator/`)
   - –†–∞—Å—à–∏—Ä–∏—Ç—å `index.test.ts` (—É–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ú–æ–∫–∏ –ë–î:** –í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
2. **–ú–æ–∫–∏ —Å–µ—Ç–∏:** –í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
3. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** –¢–µ—Å—Ç—ã –æ—á–∏—â–∞—é—Ç `process.env` –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
4. **Singleton:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ —Ç—Ä–µ–±—É—é—Ç `vi.resetModules()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `docs/LINTING_AND_TESTING.md` - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ª–∏–Ω—Ç–∏–Ω–≥—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- `vitest.config.ts` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
- `package.json` - –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ —Å–ª–µ–¥—É—é—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º Vitest. –í—Å–µ —Ç–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ë–î, API, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞).

