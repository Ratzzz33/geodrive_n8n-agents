# üì° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Starline API

**–î–∞—Ç–∞:** 2025-01-XX  
**AppId:** 40884  
**Secret:** 55t6wDYPs800o3UCRfjd_kW27f2eI1fL  
**Base URL:** https://developer.starline.ru

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

Starline API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OAuth 2.0 –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞

**Endpoint:** `POST /oauth/v1/access_token`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "appId": "40884",
  "appSecret": "55t6wDYPs800o3UCRfjd_kW27f2eI1fL"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "xxx",
  "refresh_token": "xxx",
  "expires_in": 3600,
  "token_type": "Bearer"
}
```

**–í–∞–∂–Ω–æ:** –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 1 —á–∞—Å, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `refresh_token`.

---

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ Endpoints

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**Endpoint:** `GET /json/v1/devices`

**Headers:**
```
Authorization: Bearer {access_token}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "devices": [
    {
      "device_id": 864326066742275,
      "alias": "MB GLE OB700OB",
      "imei": "864326066742275",
      "phone": "+995...",
      "sn": "...",
      "device_type": 1,
      "fw_version": "..."
    }
  ]
}
```

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**Endpoint:** `GET /json/v1/device/{device_id}/data`

**Headers:**
```
Authorization: Bearer {access_token}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "device_id": 864326066742275,
  "alias": "MB GLE OB700OB",
  "position": {
    "lat": 41.65376,
    "lng": 41.638368,
    "sat_qty": 12,
    "timestamp": 1705123456
  },
  "status": {
    "ignition_on": false,
    "engine_running": false,
    "parking_brake": true,
    "alarm_state": "off"
  },
  "sensors": {
    "gps_level": 85,
    "gsm_level": 90,
    "battery_voltage": 12.5
  },
  "speed": 0,
  "course": 180
}
```

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π

**Endpoint:** `POST /json/v1/device/{device_id}/events`

**Headers:**
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**Body:**
```json
{
  "from": 1705123456,
  "to": 1705209856
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "events": [
    {
      "event_id": 12345,
      "event_type": "alarm_on",
      "timestamp": 1705123456,
      "data": {
        "reason": "door_opened"
      }
    }
  ]
}
```

**–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:**
- `alarm_on` - –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –æ—Ö—Ä–∞–Ω—É
- `alarm_off` - –°–Ω—è—Ç–∏–µ —Å –æ—Ö—Ä–∞–Ω—ã
- `ignition_on` - –í–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–∂–∏–≥–∞–Ω–∏—è
- `ignition_off` - –í—ã–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–∂–∏–≥–∞–Ω–∏—è
- `engine_start` - –ó–∞–ø—É—Å–∫ –¥–≤–∏–≥–∞—Ç–µ–ª—è
- `engine_stop` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è
- `door_opened` - –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–∏
- `door_closed` - –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–∏
- `motion_detected` - –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–µ
- `gps_lost` - –ü–æ—Ç–µ—Ä—è GPS —Å–∏–≥–Ω–∞–ª–∞
- `gps_restored` - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ GPS —Å–∏–≥–Ω–∞–ª–∞
- `low_battery` - –ù–∏–∑–∫–∏–π –∑–∞—Ä—è–¥ –ê–ö–ë
- `geofence_enter` - –í—ä–µ–∑–¥ –≤ –≥–µ–æ–∑–æ–Ω—É
- `geofence_exit` - –í—ã–µ–∑–¥ –∏–∑ –≥–µ–æ–∑–æ–Ω—ã

---

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞

**Endpoint:** `POST /json/v1/device/{device_id}/route`

**Headers:**
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**Body:**
```json
{
  "from": 1705123456,
  "to": 1705209856
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "points": [
    {
      "lat": 41.65376,
      "lng": 41.638368,
      "timestamp": 1705123456,
      "speed": 60,
      "course": 180,
      "sat_qty": 12
    }
  ]
}
```

---

### 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É

**Endpoint:** `POST /json/v1/device/{device_id}/command`

**Headers:**
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**Body:**
```json
{
  "command": "alarm_on" | "alarm_off" | "engine_start" | "engine_stop" | ...
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "message": "Command sent"
}
```

---

## üíæ –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

### –¢–∞–±–ª–∏—Ü–∞ `starline_devices` (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- `device_type` - –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (INT) ‚úÖ —É–∂–µ –µ—Å—Ç—å
- `fw_version` - –í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ (TEXT) ‚úÖ —É–∂–µ –µ—Å—Ç—å
- `phone` - –¢–µ–ª–µ—Ñ–æ–Ω SIM-–∫–∞—Ä—Ç—ã (TEXT) ‚úÖ —É–∂–µ –µ—Å—Ç—å
- `sn` - –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä (TEXT) ‚úÖ —É–∂–µ –µ—Å—Ç—å
- `last_api_sync` - –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ API (TIMESTAMPTZ) - **–î–û–ë–ê–í–ò–¢–¨**
- `api_token_expires_at` - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (TIMESTAMPTZ) - **–î–û–ë–ê–í–ò–¢–¨**

---

### –¢–∞–±–ª–∏—Ü–∞ `gps_tracking` (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API:**
- `course` - –ö—É—Ä—Å –¥–≤–∏–∂–µ–Ω–∏—è (–≥—Ä–∞–¥—É—Å—ã) - **–î–û–ë–ê–í–ò–¢–¨**
- `alarm_state` - –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ö—Ä–∞–Ω—ã (TEXT: 'on' | 'off' | 'partial') - **–î–û–ë–ê–í–ò–¢–¨**
- `geofence_status` - –°—Ç–∞—Ç—É—Å –≥–µ–æ–∑–æ–Ω—ã (TEXT) - **–î–û–ë–ê–í–ò–¢–¨**

---

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `starline_events` (—Å–æ–∑–¥–∞—Ç—å)

**–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π:**

```sql
CREATE TABLE starline_events (
  id BIGSERIAL PRIMARY KEY,
  device_id BIGINT NOT NULL REFERENCES starline_devices(device_id),
  event_id BIGINT UNIQUE NOT NULL, -- ID —Å–æ–±—ã—Ç–∏—è –∏–∑ Starline API
  event_type TEXT NOT NULL, -- alarm_on, ignition_on, etc.
  timestamp TIMESTAMPTZ NOT NULL,
  data JSONB, -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
  processed BOOLEAN DEFAULT FALSE, -- –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ª–∏ —Å–æ–±—ã—Ç–∏–µ
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_starline_events_device_id ON starline_events(device_id);
CREATE INDEX idx_starline_events_timestamp ON starline_events(timestamp DESC);
CREATE INDEX idx_starline_events_type ON starline_events(event_type);
CREATE INDEX idx_starline_events_processed ON starline_events(processed) WHERE processed = FALSE;
```

**–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
- `alarm_on` / `alarm_off` - –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ —Å –æ—Ö—Ä–∞–Ω—ã
- `ignition_on` / `ignition_off` - –ó–∞–∂–∏–≥–∞–Ω–∏–µ
- `engine_start` / `engine_stop` - –î–≤–∏–≥–∞—Ç–µ–ª—å
- `door_opened` / `door_closed` - –î–≤–µ—Ä–∏
- `motion_detected` - –î–≤–∏–∂–µ–Ω–∏–µ
- `gps_lost` / `gps_restored` - GPS —Å–∏–≥–Ω–∞–ª
- `low_battery` - –ù–∏–∑–∫–∏–π –∑–∞—Ä—è–¥
- `geofence_enter` / `geofence_exit` - –ì–µ–æ–∑–æ–Ω—ã

---

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `starline_routes` (—Å–æ–∑–¥–∞—Ç—å)

**–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤:**

```sql
CREATE TABLE starline_routes (
  id BIGSERIAL PRIMARY KEY,
  device_id BIGINT NOT NULL REFERENCES starline_devices(device_id),
  lat NUMERIC(10, 7) NOT NULL,
  lng NUMERIC(10, 7) NOT NULL,
  timestamp TIMESTAMPTZ NOT NULL,
  speed NUMERIC(6, 2), -- –∫–º/—á
  course NUMERIC(5, 2), -- –≥—Ä–∞–¥—É—Å—ã
  sat_qty INT, -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø—É—Ç–Ω–∏–∫–æ–≤
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_starline_routes_device_id ON starline_routes(device_id);
CREATE INDEX idx_starline_routes_timestamp ON starline_routes(timestamp DESC);
CREATE INDEX idx_starline_routes_device_timestamp ON starline_routes(device_id, timestamp DESC);
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
- –ê–Ω–∞–ª–∏–∑ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –ø—Ä–æ–±–µ–≥–∞
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
- –ì–µ–æ–∑–æ–Ω—ã –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –º–∞—Ä—à—Ä—É—Ç–∞

---

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `starline_api_tokens` (—Å–æ–∑–¥–∞—Ç—å)

**–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞:**

```sql
CREATE TABLE starline_api_tokens (
  id BIGSERIAL PRIMARY KEY,
  access_token TEXT NOT NULL,
  refresh_token TEXT NOT NULL,
  expires_at TIMESTAMPTZ NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  is_active BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_starline_api_tokens_active ON starline_api_tokens(is_active) WHERE is_active = TRUE;
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- –ò—Å—Ç–æ—Ä–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∞—É–¥–∏—Ç–∞

---

## üîÑ Workflow –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API

### –û—Å–Ω–æ–≤–Ω–æ–π workflow: "Starline API Sync"

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã (–∫–∞–∫ —Ç–µ–∫—É—â–∏–π)

**–®–∞–≥–∏:**
1. **–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω** (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
2. **–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤** (`GET /json/v1/devices`)
3. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
   - –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (`GET /json/v1/device/{device_id}/data`)
   - –û–±–Ω–æ–≤–∏—Ç—å `gps_tracking`
   - –û–±–Ω–æ–≤–∏—Ç—å `starline_devices`
4. **–ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è** (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç)
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `starline_events`
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–ª–µ—Ä—Ç—ã**

---

## üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –ß—Ç–æ –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

1. **–ß–∞—Å—Ç–æ—Ç–∞ —Å–æ–±—ã—Ç–∏–π:**
   - –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ö—Ä–∞–Ω–∞
   - –ß–∞—Å—Ç–æ—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –∑–∞–∂–∏–≥–∞–Ω–∏—è
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–µ–∑–¥–æ–∫

2. **–ü—Ä–æ–±–µ–≥:**
   - –†–∞—Å—á–µ—Ç –ø–æ –º–∞—Ä—à—Ä—É—Ç—É
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–¥–æ–º–µ—Ç—Ä–æ–º

3. **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è:**
   - –°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∑–∞ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é
   - –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏

4. **–ì–µ–æ–∑–æ–Ω—ã:**
   - –í—Ä–µ–º—è –≤ –∫–∞–∂–¥–æ–π –≥–µ–æ–∑–æ–Ω–µ
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤

5. **–°–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
   - –£—Ä–æ–≤–µ–Ω—å GPS/GSM —Å–∏–≥–Ω–∞–ª–∞
   - –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –ê–ö–ë
   - –°—Ç–∞—Ç—É—Å –æ—Ö—Ä–∞–Ω—ã

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ API

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
   - –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞/Playwright
   - –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Å—Å–∏—è–º–∏
   - –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

2. **–°–∫–æ—Ä–æ—Å—Ç—å:**
   - –ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
   - –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –Ω–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

3. **–î–∞–Ω–Ω—ã–µ:**
   - –î–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π
   - –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
   - –õ–µ–≥–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API

1. **Rate Limiting:**
   - –ù—É–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –Ω–µ –±–æ–ª–µ–µ 5 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫

2. **–¢–æ–∫–µ–Ω—ã:**
   - –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 1 —á–∞—Å
   - –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `refresh_token`

3. **–ö–≤–æ—Ç—ã:**
   - –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
   - –ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Starline API
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π workflow –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
4. ‚è≥ –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î (`0023_starline_api_tables.sql`)
5. ‚è≥ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow –≤ n8n
6. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
7. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
9. ‚è≥ –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π workflow –Ω–∞ –Ω–æ–≤—ã–π (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
psql $DATABASE_URL -f setup/migrations/0023_starline_api_tables.sql
```

### 2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow –≤ n8n

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞
node setup/import_workflow_2025.mjs n8n-workflows/starline-api-sync.json
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å credentials –≤ n8n

- **PostgreSQL** - –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ credentials
- **Telegram** - –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ credentials –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤

### 4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow –≤ n8n.

---

## üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –ß—Ç–æ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å:

1. **–°–æ–±—ã—Ç–∏—è (`starline_events`):**
   - –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ —Å –æ—Ö—Ä–∞–Ω—ã
   - –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–∂–∏–≥–∞–Ω–∏—è
   - –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è
   - –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–µ–π
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
   - –ü–æ—Ç–µ—Ä—è/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ GPS
   - –ù–∏–∑–∫–∏–π –∑–∞—Ä—è–¥ –ê–ö–ë
   - –í—ä–µ–∑–¥/–≤—ã–µ–∑–¥ –∏–∑ –≥–µ–æ–∑–æ–Ω—ã

2. **–ú–∞—Ä—à—Ä—É—Ç—ã (`starline_routes`):**
   - –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ç–æ—á–µ–∫ GPS
   - –°–∫–æ—Ä–æ—Å—Ç—å –≤ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ
   - –ö—É—Ä—Å –¥–≤–∏–∂–µ–Ω–∏—è
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø—É—Ç–Ω–∏–∫–æ–≤

3. **–ú–µ—Ç—Ä–∏–∫–∏ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `starline_metrics`):**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏
   - –û–±—â–∏–π –ø—Ä–æ–±–µ–≥
   - –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è
   - –í—Ä–µ–º—è –≤ –≥–µ–æ–∑–æ–Ω–∞—Ö

4. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ `gps_tracking`:**
   - `course` - –ö—É—Ä—Å –¥–≤–∏–∂–µ–Ω–∏—è (0-360¬∞)
   - `alarm_state` - –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ö—Ä–∞–Ω—ã
   - `geofence_status` - –°—Ç–∞—Ç—É—Å –≥–µ–æ–∑–æ–Ω—ã

5. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ `starline_devices`:**
   - `last_api_sync` - –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ API
   - `api_token_expires_at` - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

```sql
SELECT 
  event_type,
  timestamp,
  data
FROM starline_events
WHERE device_id = 864326066742275
  AND processed = FALSE
ORDER BY timestamp DESC
LIMIT 10;
```

### –ü–æ–ª—É—á–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –∑–∞ –¥–µ–Ω—å

```sql
SELECT 
  lat,
  lng,
  timestamp,
  speed,
  course
FROM starline_routes
WHERE device_id = 864326066742275
  AND timestamp >= CURRENT_DATE
ORDER BY timestamp ASC;
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–±—ã—Ç–∏—è–º

```sql
SELECT 
  event_type,
  COUNT(*) as count,
  MIN(timestamp) as first_event,
  MAX(timestamp) as last_event
FROM starline_events
WHERE device_id = 864326066742275
  AND timestamp >= CURRENT_DATE
GROUP BY event_type
ORDER BY count DESC;
```

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-01-XX

