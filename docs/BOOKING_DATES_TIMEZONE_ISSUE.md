# –ü—Ä–æ–±–ª–µ–º–∞ —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏ –≤ –¥–∞—Ç–∞—Ö –±—Ä–æ–Ω–µ–π

**–î–∞—Ç–∞:** 2025-11-21  
**–°—Ç–∞—Ç—É—Å:** üî¥ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –¥–∞—Ç –∏–∑ RentProg —Ñ—É–Ω–∫—Ü–∏—è `parseRentProgDate` —Å–æ–∑–¥–∞–µ—Ç –¥–∞—Ç—É **–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏.

### –ü—Ä–∏–º–µ—Ä –∏–∑ –ë–î (–±—Ä–æ–Ω—å QZ101QQ):

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `start_at`: `Sat Nov 22 2025 01:00:00 GMT+0400` ‚úÖ (Asia/Tbilisi)
- `end_at`: `Sun Nov 23 2025 01:00:00 GMT+0400` ‚úÖ (Asia/Tbilisi)

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `start_date`: `2025-11-21 21:00:00+00` ‚ùå (UTC, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `2025-11-22 01:00:00+04`)
- `end_date`: `2025-11-22 21:00:00+00` ‚ùå (UTC, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `2025-11-23 01:00:00+04`)

---

## üîß –ü—Ä–∏—á–∏–Ω–∞

### –§—É–Ω–∫—Ü–∏—è `parseRentProgDate` (src/db/upsert.ts:315-319):

```typescript
// –§–æ—Ä–º–∞—Ç RentProg: "25-01-2022 10:00"
const match = dateStr.match(/(\d{2})-(\d{2})-(\d{4})\s+(\d{2}):(\d{2})/);
if (match) {
  const [, day, month, year, hour, minute] = match;
  return new Date(`${year}-${month}-${day}T${hour}:${minute}:00`);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–µ—Ç—Å—è –¥–∞—Ç–∞ –±–µ–∑ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ (`T${hour}:${minute}:00`), JavaScript –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ –∫–∞–∫ **–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞** (–≤–µ—Ä–æ—è—Ç–Ω–æ UTC), –∞ –Ω–µ –∫–∞–∫ –≤—Ä–µ–º—è –≤ **Asia/Tbilisi**.

---

## üìã –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∏–∑ –ª–æ–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

```
21-11-2025 14:42:24 –î–∞–Ω–∏—è—Ä –ë–∞–π–±–∞–∫–æ–≤
  –ü–∞—Ä–∞–º–µ—Ç—Ä: responsible, –±—ã–ª–æ: –ù–∏–∫–æ–ª–∞–π –§–æ–º–∏–Ω, —Å—Ç–∞–ª–æ: –î–∞–Ω–∏—è—Ä –ë–∞–π–±–∞–∫–æ–≤
  –ü–∞—Ä–∞–º–µ—Ç—Ä: responsible_id, –±—ã–ª–æ: 15938, —Å—Ç–∞–ª–æ: 16003

21-11-2025 13:08:56 Eliseev Aleksei Jr
  –ü–∞—Ä–∞–º–µ—Ç—Ä: responsible, –±—ã–ª–æ: –î–∞–Ω–∏—è—Ä –ë–∞–π–±–∞–∫–æ–≤, —Å—Ç–∞–ª–æ: –ù–∏–∫–æ–ª–∞–π –§–æ–º–∏–Ω
  –ü–∞—Ä–∞–º–µ—Ç—Ä: responsible_id, –±—ã–ª–æ: 16003, —Å—Ç–∞–ª–æ: 15938

20-11-2025 21:09:18 –î–∞–Ω–∏—è—Ä –ë–∞–π–±–∞–∫–æ–≤
  –ü–∞—Ä–∞–º–µ—Ç—Ä: responsible, –±—ã–ª–æ: null, —Å—Ç–∞–ª–æ: –î–∞–Ω–∏—è—Ä –ë–∞–π–±–∞–∫–æ–≤
  –ü–∞—Ä–∞–º–µ—Ç—Ä: responsible_id, –±—ã–ª–æ: null, —Å—Ç–∞–ª–æ: 16003

20-11-2025 20:47:57 –°–æ—Ñ–∏—è
  –ü–∞—Ä–∞–º–µ—Ç—Ä: end_date, –±—ã–ª–æ: 24-11-2025 00:00, —Å—Ç–∞–ª–æ: 22-11-2025 21:00
  –ü–∞—Ä–∞–º–µ—Ç—Ä: start_date, –±—ã–ª–æ: 22-11-2025 00:00, —Å—Ç–∞–ª–æ: 21-11-2025 21:00
  –ü–∞—Ä–∞–º–µ—Ç—Ä: updated_from_api, –±—ã–ª–æ: true, —Å—Ç–∞–ª–æ: false
```

**–í–æ–ø—Ä–æ—Å:** –í—Å–µ –ª–∏ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –æ—Ç RentProg?

**–û—Ç–≤–µ—Ç:** –î–∞, —Å—É–¥—è –ø–æ `updated_from_api: false` –∏ –Ω–∞–ª–∏—á–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–°–æ—Ñ–∏—è, –î–∞–Ω–∏—è—Ä –ë–∞–π–±–∞–∫–æ–≤, Eliseev Aleksei Jr), —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ RentProg History API.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `parseRentProgDate`

–î–æ–±–∞–≤–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å `+04:00` (Asia/Tbilisi) –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ:

```typescript
// –§–æ—Ä–º–∞—Ç RentProg: "25-01-2022 10:00" (–≤—Ä–µ–º—è –≤ Asia/Tbilisi)
const match = dateStr.match(/(\d{2})-(\d{2})-(\d{4})\s+(\d{2}):(\d{2})/);
if (match) {
  const [, day, month, year, hour, minute] = match;
  // –í–ê–ñ–ù–û: RentProg –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Asia/Tbilisi (UTC+4)
  return new Date(`${year}-${month}-${day}T${hour}:${minute}:00+04:00`);
}
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `start_date` –∏ `end_date`

–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è `start_date` –∏ `end_date` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º:

```typescript
// –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ start_date/end_date –∏–∑ start_at/end_at
const startDateStr = startAt.toLocaleString('ru-RU', {
  timeZone: 'Asia/Tbilisi',
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit',
  hour12: false
}) + '+04:00';
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:

```sql
TO_CHAR(start_at AT TIME ZONE 'Asia/Tbilisi', 'YYYY-MM-DD HH24:MI:SS') || '+04'
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. ‚úÖ –ù–æ–≤—ã–µ –±—Ä–æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º
2. ‚úÖ `start_date` –∏ `end_date` —Å–æ–¥–µ—Ä–∂–∞—Ç `+04` –≤–º–µ—Å—Ç–æ `+00`
3. ‚úÖ –í—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É `start_at`/`end_at` –∏ `start_date`/`end_date`

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ RentProg (History API –∏–ª–∏ Webhooks)
2. **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:** RentProg –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Asia/Tbilisi` (UTC+4)
3. **–ü–æ–ª—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
   - `parseRentProgDate` –≤ `src/db/upsert.ts`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `start_date`/`end_date` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/db/upsert.ts` - —Ñ—É–Ω–∫—Ü–∏—è `parseRentProgDate`
- `db/migrations/002_normalize_bookings_dates.sql` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç
- `setup/check_booking_changes_qz101qq.mjs` - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

