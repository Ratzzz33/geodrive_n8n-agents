# –û—Ç—á–µ—Ç: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è starline_devices —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ cars

**–î–∞—Ç–∞:** 2025-11-12  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ê–≤—Ç–æ—Ä:** Jarvis AI Agent

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

### –ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

–ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ GPS –¥–∞–Ω–Ω—ã—Ö –æ—Ç Starline –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞: **–¥–ª—è –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã (–ø–æ –Ω–æ–º–µ—Ä—É `plate`) –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å —Ä–∞–∑–Ω—ã–º–∏ `brand` –∏ `model`**, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ø—É—Ç–∞–Ω–∏—Ü—É.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**
- –î–ª—è `plate: "0C7000C"` –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å:
  - `alias: "Toyota Camry DK700DK"`, `brand: "Santafe Black"`, `model: "Toyota Camry DK700DK"`
  - `alias: "MB GLE OB7000B"`, `brand: "Santafe Black"`, `model: "Santafe Black"`
  - `alias: "Santafe Black OC7000C"`, `brand: "Santafe Black"`, `model: "Santafe Black"`

### –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

1. **`alias` –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω** ‚Äî –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –≤ Starline, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
2. **–ù–µ—Å–∫–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤** –±—ã–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
3. **–î–∞–Ω–Ω—ã–µ –≤ `starline_devices`** –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ `cars` –∏ `gps_tracking`

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–≤–µ–Ω–æ ‚Äî `device_id`

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `device_id` (IMEI —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞) –∫–∞–∫ **—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –∑–≤–µ–Ω–∞** –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

**–ü–æ—á–µ–º—É `device_id`:**
- ‚úÖ –ù–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π (IMEI —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚úÖ –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `alias` (–∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è)

### 2. –û–±—Ä–∞—Ç–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `starline_devices` –∏–∑ `gps_tracking`

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `sync_starline_devices_from_gps_tracking.mjs`, –∫–æ—Ç–æ—Ä—ã–π:

1. **–ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è** `(device_id, car_id)` –∏–∑ `gps_tracking`
2. **–û–±–Ω–æ–≤–ª—è–µ—Ç `starline_devices`** –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   - `car_id` ‚Äî –∏–∑ `gps_tracking`
   - `alias` ‚Äî –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞ (`gps_tracking.starline_alias`)
   - `extracted_model` ‚Äî –∏–∑ `cars.model` (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω—ã)
   - `plate` ‚Äî –∏–∑ `cars.plate` (–¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞)
   - `matched` = TRUE
   - `match_confidence` = 1.00
   - `match_method` = 'gps_tracking_sync'

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `plate` –≤ `starline_devices`

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `0014_add_plate_to_starline_devices.sql`

**–ó–∞—á–µ–º:**
- –£–¥–æ–±–Ω—ã–π –ø–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ –Ω–æ–º–µ—Ä—É –º–∞—à–∏–Ω—ã –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –ù–µ –Ω—É–∂–µ–Ω JOIN —Å `cars` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–æ–º–µ—Ä—É

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```sql
-- –ü–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ –Ω–æ–º–µ—Ä—É –º–∞—à–∏–Ω—ã
SELECT * FROM starline_devices WHERE plate = 'OB700OB';

-- –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –º–∞—à–∏–Ω—ã
SELECT * FROM starline_devices WHERE plate LIKE '%700%';
```

---

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```typescript
// –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
// 1. –ü–æ–ª—É—á–∞–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ Starline
// 2. –ò–∑–≤–ª–µ–∫–∞–ª–∏ –º–æ–¥–µ–ª—å –∏ —Ü–∏—Ñ—Ä—ã –∏–∑ alias
// 3. –ü—ã—Ç–∞–ª–∏—Å—å —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å cars –ø–æ plate/model
// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: alias –º–µ–Ω—è–µ—Ç—Å—è, —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–æ–º–∞–µ—Ç—Å—è
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```typescript
// –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–ü–†–ê–í–ò–õ–¨–ù–û):
// 1. –ü–æ–ª—É—á–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ Starline
// 2. –ò—â–µ–º –∫–∞–∂–¥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ starline_devices –ø–æ device_id
// 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ starline_devices
// ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç alias
```

**–ö–æ–¥ –≤ `starline-monitor.ts`:**

```typescript
async matchCars(): Promise<CarMatch[]> {
  // –ü–æ–ª—É—á–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ Starline
  const devices = await scraper.getDevices();
  
  // –ü–æ–ª—É—á–∞–µ–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–∑ starline_devices –ø–æ device_id
  const deviceMappings = await sqlConnection`
    SELECT 
      sd.device_id,
      sd.alias,
      sd.car_id,
      sd.matched,
      c.plate,
      c.car_visual_name as brand,
      c.model
    FROM starline_devices sd
    JOIN cars c ON c.id = sd.car_id
    WHERE sd.matched = TRUE
      AND sd.active = TRUE
  `;
  
  // –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∂–¥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–∑ Starline —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î
  for (const device of devices) {
    const mapping = deviceMappings.find(m => m.device_id === device.device_id);
    
    if (mapping && mapping.matched && mapping.car_id) {
      matches.push({
        carId: mapping.car_id,
        plate: mapping.plate,
        brand: mapping.brand || '',
        model: mapping.model,
        starlineDeviceId: device.device_id, // ‚Üê –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–≤–µ–Ω–æ!
        starlineAlias: device.alias // –¢–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      });
    }
  }
  
  return matches;
}
```

---

## üìä –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ

### –ü–æ–ª—è –≤ –æ—Ç–≤–µ—Ç–µ API `/starline/update-gps`:

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| `plate` | `cars.plate` | –ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã |
| `brand` | `cars.car_visual_name` | –ë—Ä–µ–Ω–¥ –º–∞—à–∏–Ω—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL) |
| `model` | `cars.model` | –ú–æ–¥–µ–ª—å –º–∞—à–∏–Ω—ã |
| `alias` | `starline_devices.alias` (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–∑ Starline) | –¢–µ–∫—É—â–∏–π alias –≤ Starline |
| `device_id` | `starline_devices.device_id` | IMEI —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–≤–µ–Ω–æ) |

**–í–∞–∂–Ω–æ:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `cars` —á–µ—Ä–µ–∑ JOIN —Å `starline_devices`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ `device_id`.

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `starline_devices` (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

```sql
CREATE TABLE starline_devices (
  id BIGSERIAL PRIMARY KEY,
  device_id BIGINT UNIQUE NOT NULL, -- IMEI —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–≤–µ–Ω–æ!)
  alias TEXT NOT NULL, -- –ù–∞–∑–≤–∞–Ω–∏–µ –≤ Starline (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ)
  plate TEXT, -- –ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã (–¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞)
  
  -- –°–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π cars
  car_id UUID REFERENCES cars(id),
  matched BOOLEAN DEFAULT FALSE,
  match_confidence NUMERIC(3, 2),
  match_method TEXT, -- 'auto' | 'manual' | 'gps_tracking_sync'
  match_notes TEXT,
  
  -- –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  extracted_model TEXT, -- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ cars.model
  extracted_digits TEXT,
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  imei TEXT,
  phone TEXT,
  sn TEXT,
  device_type INT,
  fw_version TEXT,
  
  -- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
  previous_aliases TEXT[],
  alias_changed_at TIMESTAMPTZ,
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  first_seen TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  last_seen TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

### –ò–Ω–¥–µ–∫—Å—ã

```sql
CREATE INDEX idx_starline_devices_device_id ON starline_devices(device_id);
CREATE INDEX idx_starline_devices_plate ON starline_devices(plate) WHERE plate IS NOT NULL;
CREATE INDEX idx_starline_devices_car_id ON starline_devices(car_id);
CREATE INDEX idx_starline_devices_matched ON starline_devices(matched);
```

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

1. **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π –≤—Ä—É—á–Ω—É—é** ‚Äî —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `starline_devices`
2. **–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π** ‚Äî –∫–æ–≥–¥–∞ `brand`/`model` –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏
3. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
node sync_starline_devices_from_gps_tracking.mjs
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è `(device_id, car_id)` –∏–∑ `gps_tracking`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `car_id` –≤ `starline_devices`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `alias` –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞
   - –ó–∞–ø–æ–ª–Ω—è–µ—Ç `extracted_model` –∏–∑ `cars.model`
   - –ó–∞–ø–æ–ª–Ω—è–µ—Ç `plate` –∏–∑ `cars.plate`
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `matched = TRUE`, `match_confidence = 1.00`
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### 1. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–≤–µ–Ω–æ ‚Äî `device_id`

**–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `device_id` –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –ù–ï `alias`!**

- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `WHERE device_id = 864326066742275`
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `WHERE alias = 'MB GLE OB700OB'` (alias –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è)

### 2. –û–¥–Ω–∞ –º–∞—à–∏–Ω–∞ ‚Äî –æ–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

**–°—Ç—Ä–æ–≥–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –û–¥–Ω–∞ –º–∞—à–∏–Ω–∞ (`car_id`) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –∫ –æ–¥–Ω–æ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É (`device_id`).

–ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π
2. –û—Ç–≤—è–∂–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `alias`

`alias` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö Starline. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî `alias` –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è, –Ω–æ `device_id` –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º.

### 4. –î–∞–Ω–Ω—ã–µ –∏–∑ `cars`

`brand`, `model`, `plate` –≤—Å–µ–≥–¥–∞ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `cars` —á–µ—Ä–µ–∑ JOIN. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ `cars` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –æ–Ω–∏ –±—É–¥—É—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏ –≤ –æ—Ç–≤–µ—Ç–µ API.

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ –Ω–æ–º–µ—Ä—É –º–∞—à–∏–Ω—ã

```sql
SELECT 
  sd.device_id,
  sd.alias,
  sd.plate,
  c.car_visual_name as brand,
  c.model
FROM starline_devices sd
LEFT JOIN cars c ON c.id = sd.car_id
WHERE sd.plate = 'OB700OB';
```

### –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –º–∞—à–∏–Ω—ã

```sql
SELECT 
  sd.device_id,
  sd.alias,
  sd.plate,
  sd.matched,
  c.car_visual_name as brand,
  c.model
FROM starline_devices sd
LEFT JOIN cars c ON c.id = sd.car_id
WHERE sd.plate LIKE '%700%'
ORDER BY sd.device_id;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π

```sql
SELECT 
  sd.device_id,
  sd.alias,
  sd.plate,
  sd.extracted_model,
  c.model as car_model,
  CASE 
    WHEN sd.extracted_model = c.model THEN '‚úÖ'
    ELSE '‚ö†Ô∏è'
  END as model_match
FROM starline_devices sd
LEFT JOIN cars c ON c.id = sd.car_id
WHERE sd.matched = TRUE
ORDER BY sd.device_id;
```

---

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ `brand`/`model` –≤ –æ—Ç–≤–µ—Ç–µ API

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `cars` –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ `starline_devices`.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ `starline_devices`:
   ```sql
   SELECT * FROM starline_devices WHERE device_id = <device_id>;
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ `cars`:
   ```sql
   SELECT * FROM cars WHERE id = <car_id>;
   ```
3. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ‚Äî –∏—Å–ø—Ä–∞–≤—å—Ç–µ –≤ `cars` –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –≤ `starline_devices`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é: `node sync_starline_devices_from_gps_tracking.mjs`

### –ü—Ä–æ–±–ª–µ–º–∞: –û–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –º–∞—à–∏–Ω–∞–º

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ —Ä—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ –º–∞—à–∏–Ω—ã –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
   ```sql
   SELECT * FROM gps_tracking WHERE starline_device_id = <device_id>;
   ```
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –º–∞—à–∏–Ω—É
3. –û–±–Ω–æ–≤–∏—Ç–µ `starline_devices`:
   ```sql
   UPDATE starline_devices 
   SET car_id = <–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π_car_id>, matched = TRUE
   WHERE device_id = <device_id>;
   ```
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **–ú–∏–≥—Ä–∞—Ü–∏—è:** `setup/migrations/0014_add_plate_to_starline_devices.sql`
- **–°–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:** `sync_starline_devices_from_gps_tracking.mjs`
- **–ö–æ–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:** `src/services/starline-monitor.ts`
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã:** `STARLINE_DEVICES_TABLE.md`

---

## ‚úÖ –ò—Ç–æ–≥–∏

1. ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–≤–µ–Ω–æ** ‚Äî `device_id` (–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π IMEI)
2. ‚úÖ **–û–±—Ä–∞—Ç–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ** ‚Äî `starline_devices` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏–∑ `gps_tracking`
3. ‚úÖ **–ü–æ–ª–µ `plate`** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
4. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** ‚Äî `brand` –∏ `model` –±–µ—Ä—É—Ç—Å—è –∏–∑ `cars` —á–µ—Ä–µ–∑ JOIN
5. ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ** ‚Äî –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–∑–º–µ–Ω—è—é—â–µ–≥–æ—Å—è `alias`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `device_id` –∫–∞–∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–≤–µ–Ω–æ, –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∏–∑ `gps_tracking`, –∏ –ø–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —É–ø—Ä–æ—â–µ–Ω –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–æ–ª—é `plate`.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 2025-11-12  
**–í–µ—Ä—Å–∏—è:** 1.0

