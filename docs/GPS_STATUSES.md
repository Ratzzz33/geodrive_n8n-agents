# –°—Ç–∞—Ç—É—Å—ã GPS —Ç—Ä–µ–∫–∏–Ω–≥–∞ (–ø–æ–ª–µ `status` –≤ —Ç–∞–±–ª–∏—Ü–µ `gps_tracking`)

## üìä –û–±–∑–æ—Ä

–í —Ç–∞–±–ª–∏—Ü–µ `gps_tracking` —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø–æ–ª–µ `status` —Ç–∏–ø–∞ `TEXT`, –∫–æ—Ç–æ—Ä–æ–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Starline.

**–ò—Å—Ç–æ—á–Ω–∏–∫:** –§—É–Ω–∫—Ü–∏—è `getCarStatus()` –≤ `src/utils/starline-helpers.ts`

---

## üîç –¢–∏–ø—ã —Å—Ç–∞—Ç—É—Å–æ–≤

### 1. `offline` 
**–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞ —Å–≤—è–∑–∏**

- **–£—Å–ª–æ–≤–∏–µ:** `device.status === 0`
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** Starline —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ë–î:** 15 –º–∞—à–∏–Ω
- **–¢–∏–ø–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
  - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤—ã–∫–ª—é—á–µ–Ω–æ
  - –ù–µ—Ç SIM-–∫–∞—Ä—Ç—ã –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω —Ç–∞—Ä–∏—Ñ
  - –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∏—Ç–∞–Ω–∏–µ–º
  - –ú–∞—à–∏–Ω–∞ –≤ –≥–ª—É–±–æ–∫–æ–º –ø–æ–¥–∑–µ–º–Ω–æ–º –ø–∞—Ä–∫–∏–Ω–≥–µ

---

### 2. `gps_offline`
**–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–∞ —Å–≤—è–∑–∏, –Ω–æ —Å–ª–∞–±—ã–π GPS —Å–∏–≥–Ω–∞–ª**

- **–£—Å–ª–æ–≤–∏–µ:** 
  - `device.status === 1` (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–Ω–ª–∞–π–Ω)
  - –ù–û: `device.gps_lvl === 0` –∏–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ GPS –Ω–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ë–î:** 3 –º–∞—à–∏–Ω—ã
- **–¢–∏–ø–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
  - –ú–∞—à–∏–Ω–∞ –≤ –∫—Ä—ã—Ç–æ–º –ø–∞—Ä–∫–∏–Ω–≥–µ
  - –ü–ª–æ—Ö–∏–µ –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
  - –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ GPS –∞–Ω—Ç–µ–Ω–Ω—ã
  - –ì–æ—Ä–æ–¥—Å–∫–∞—è –∑–∞—Å—Ç—Ä–æ–π–∫–∞ —Å –ø–ª–æ—Ö–æ–π –≤–∏–¥–∏–º–æ—Å—Ç—å—é –Ω–µ–±–∞

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (14.11.2025) —ç—Ç–æ—Ç —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–æ—á–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–ª—Å—è –º–∞—à–∏–Ω–∞–º –∏–∑-–∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ `sat_qty`, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `undefined`.

---

### 3. `moving`
**–ú–∞—à–∏–Ω–∞ –¥–≤–∏–∂–µ—Ç—Å—è**

- **–£—Å–ª–æ–≤–∏–µ (–ò–õ–ò, –ª—é–±–æ–µ –∏–∑):**
  1. `speed > 5` –∫–º/—á (–æ—Å–Ω–æ–≤–Ω–æ–π –∫—Ä–∏—Ç–µ—Ä–∏–π)
  2. `device.car_state.ign === true` –ò `device.car_state.run === true`
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** –ú–∞—à–∏–Ω–∞ –µ–¥–µ—Ç –∏–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ –µ—Ö–∞–ª–∞
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ë–î:** 6-7 –º–∞—à–∏–Ω
- **–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å:** 51.8 –∫–º/—á (–¥–∏–∞–ø–∞–∑–æ–Ω: 15-118 –∫–º/—á)

**–ü—Ä–∏–º–µ—Ä—ã:**
- Ford explorer 464 ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å 81-90 –∫–º/—á
- Forester ‚Äî –≤ –ø—É—Ç–∏
- Maserati levante SQ4 686 ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å 69 –∫–º/—á (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

**üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 14.11.2025:**
- –†–∞–Ω—å—à–µ: –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å —Ç–æ–ª—å–∫–æ `ign && run`
- –¢–µ–ø–µ—Ä—å: **—Å–∫–æ—Ä–æ—Å—Ç—å > 5 –∫–º/—á –ò–õ–ò (–∑–∞–∂–∏–≥–∞–Ω–∏–µ + –¥–≤–∏–≥–∞—Ç–µ–ª—å)**
- –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É: –º–∞—à–∏–Ω—ã —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º –∑–∞–∂–∏–≥–∞–Ω–∏–µ–º, –Ω–æ –¥–≤–∏–∂—É—â–∏–µ—Å—è –Ω–∞ —ç–≤–∞–∫—É–∞—Ç–æ—Ä–µ –∏–ª–∏ –±—É–∫—Å–∏—Ä–µ, —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞–∫ "moving"

---

### 4. `parked_on`
**–ú–∞—à–∏–Ω–∞ —Å—Ç–æ–∏—Ç —Å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º –∑–∞–∂–∏–≥–∞–Ω–∏–µ–º**

- **–£—Å–ª–æ–≤–∏–µ:**
  - `device.status === 1` (–æ–Ω–ª–∞–π–Ω)
  - `device.gps_lvl > 0` (GPS –µ—Å—Ç—å)
  - `speed <= 5` –∫–º/—á
  - `device.car_state.ign === true` (–∑–∞–∂–∏–≥–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ)
  - `device.car_state.run === false` (–¥–≤–∏–≥–∞—Ç–µ–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** –ú–∞—à–∏–Ω–∞ —Å—Ç–æ–∏—Ç, –∑–∞–∂–∏–≥–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (–ø—Ä–æ–≥—Ä–µ–≤, –æ–∂–∏–¥–∞–Ω–∏–µ –Ω–∞ —Å–≤–µ—Ç–æ—Ñ–æ—Ä–µ –∏ —Ç.–¥.)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ë–î:** 0 (—Å–µ–π—á–∞—Å)

**–¢–∏–ø–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- –ü—Ä–æ–≥—Ä–µ–≤ –¥–≤–∏–≥–∞—Ç–µ–ª—è
- –°—Ç–æ—è–Ω–∫–∞ –Ω–∞ —Å–≤–µ—Ç–æ—Ñ–æ—Ä–µ
- –ö–æ—Ä–æ—Ç–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —Ä–∞–±–æ—Ç–∞—é—â–∏–º –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º

---

### 5. `parked_off`
**–ú–∞—à–∏–Ω–∞ –ø—Ä–∏–ø–∞—Ä–∫–æ–≤–∞–Ω–∞ —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º –∑–∞–∂–∏–≥–∞–Ω–∏–µ–º**

- **–£—Å–ª–æ–≤–∏–µ:**
  - `device.status === 1` (–æ–Ω–ª–∞–π–Ω)
  - `device.gps_lvl > 0` (GPS –µ—Å—Ç—å)
  - `speed <= 5` –∫–º/—á
  - `device.car_state.ign === false` (–∑–∞–∂–∏–≥–∞–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ)
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** –ú–∞—à–∏–Ω–∞ —Å—Ç–æ–∏—Ç –Ω–∞ —Å—Ç–æ—è–Ω–∫–µ, –¥–≤–∏–≥–∞—Ç–µ–ª—å –≤—ã–∫–ª—é—á–µ–Ω
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ë–î:** 92-93 –º–∞—à–∏–Ω—ã (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ)
- **–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å:** 0.0 –∫–º/—á (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–∞—à–∏–Ω—ã –º–æ–≥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 0-2 –∫–º/—á –∏–∑-–∑–∞ –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ GPS)

**–¢–∏–ø–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- –ú–∞—à–∏–Ω–∞ –Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–µ –æ—Ñ–∏—Å–∞/–¥–æ–º–∞
- –ú–∞—à–∏–Ω–∞ –Ω–∞ —Å—Ç–æ—è–Ω–∫–µ –ø—Ä–æ–∫–∞—Ç–∞
- –û–∂–∏–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (–Ω–∞ 14.11.2025, 12:30)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –°—Ç–∞—Ç—É—Å          ‚îÇ –í—Å–µ–≥–æ ‚îÇ –î–≤–∏–∂–µ—Ç—Å—è ‚îÇ –°—Ç–æ–∏—Ç   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ parked_off      ‚îÇ    93 ‚îÇ        8 ‚îÇ      85 ‚îÇ ‚Üê –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–∞—à–∏–Ω
‚îÇ offline         ‚îÇ    15 ‚îÇ        1 ‚îÇ      14 ‚îÇ
‚îÇ moving          ‚îÇ     6 ‚îÇ        5 ‚îÇ       1 ‚îÇ ‚Üê –ê–∫—Ç–∏–≤–Ω–æ –µ–¥—É—Ç
‚îÇ gps_offline     ‚îÇ     3 ‚îÇ        0 ‚îÇ       3 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:**
- **93 –º–∞—à–∏–Ω—ã** –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `parked_off` (–ø—Ä–∏–ø–∞—Ä–∫–æ–≤–∞–Ω—ã)
- **6 –º–∞—à–∏–Ω** –∞–∫—Ç–∏–≤–Ω–æ –¥–≤–∏–∂—É—Ç—Å—è
- **15 –º–∞—à–∏–Ω** –æ—Ñ–ª–∞–π–Ω (–Ω–µ—Ç —Å–≤—è–∑–∏)
- **3 –º–∞—à–∏–Ω—ã** —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ GPS —Å–∏–≥–Ω–∞–ª–∞

---

## üîÑ –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

**–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑):**

```typescript
1. if (device.status === 0)           ‚Üí 'offline'
2. if (device.gps_lvl === 0)          ‚Üí 'gps_offline'
3. if (speed > 5 || (ign && run))     ‚Üí 'moving'
4. if (ign && !run)                   ‚Üí 'parked_on'
5. else                                ‚Üí 'parked_off'
```

---

## üîó –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—è–º–∏

### –ü–æ–ª–µ `is_moving` (boolean)
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –ø–æ–ª–µ!** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ **–∏–∑–º–µ–Ω–µ–Ω–∏—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**, –∞ –Ω–µ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- **–£—Å–ª–æ–≤–∏–µ:** `distanceMoved > 10` –º–µ—Ç—Ä–æ–≤ –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–µ—Ç –±—ã—Ç—å `true` –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–∑—Ä—ã–≤–∞—Ö –≤ –¥–∞–Ω–Ω—ã—Ö GPS

**–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:**
- `status='parked_off' && is_moving=true` ‚Äî 8 –º–∞—à–∏–Ω (GPS –ø—Ä–æ–±–µ–ª –≤ –¥–∞–Ω–Ω—ã—Ö)
- `status='moving' && is_moving=false` ‚Äî 1 –º–∞—à–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å)

### –ü–æ–ª–µ `speed` (integer)
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** `device.pos.s` –∏–ª–∏ `device.position.s` (–∫–º/—á)
- **–í–∞–∂–Ω–æ:** –ü–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `s`, –∞ –Ω–µ `speed` –≤ Starline API!
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ `moving` (> 5 –∫–º/—á)

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –°—Ç–∞—Ç—É—Å vs. –°–≤—è–∑—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
**–î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–Ω—è—Ç–∏—è:**
- **"–≤ —Å–µ—Ç–∏" / "–Ω–µ—Ç —Å–≤—è–∑–∏"** ‚Äî —Å—Ç–∞—Ç—É—Å **–°–í–Ø–ó–ò** —Å Starline —Å–µ—Ä–≤–µ—Ä–æ–º (`device.status`)
- **`moving` / `parked_off` / etc.** ‚Äî —Å—Ç–∞—Ç—É—Å **–î–í–ò–ñ–ï–ù–ò–Ø** –º–∞—à–∏–Ω—ã (–Ω–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è `getCarStatus()`)

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
- **–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** –ö–∞–∂–¥—ã–µ 2-5 –º–∏–Ω—É—Ç (n8n workflow "Starline API Sync")
- **–ó–∞–¥–µ—Ä–∂–∫–∞:** –î–æ 5 –º–∏–Ω—É—Ç –º–µ–∂–¥—É —Ä–µ–∞–ª—å–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –≤ –ë–î
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** Starline API ‚Üí `starline-monitor.ts` ‚Üí `gps_tracking`

### 3. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- –°—Ç–∞—Ç—É—Å—ã **–ù–ï –°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø** –≤ –∏—Å—Ç–æ—Ä–∏—é (–Ω–µ—Ç —Ç–∞–±–ª–∏—Ü—ã `status_history`)
- –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ `gps_tracking`
- –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `speed_history` (–∏—Å—Ç–æ—Ä–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏)

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è (14.11.2025)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `gps_offline`
**–ë—ã–ª–æ:**
```typescript
if (!device.gps_lvl || device.gps_lvl === 0 || 
    !device.pos?.sat_qty || device.pos.sat_qty === 0) {
  return 'gps_offline';
}
```

**–°—Ç–∞–ª–æ:**
```typescript
if (!device.gps_lvl || device.gps_lvl === 0) {
  return 'gps_offline';
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** `sat_qty` –º–æ–∂–µ—Ç –±—ã—Ç—å `undefined` –¥–∞–∂–µ –ø—Ä–∏ —Ö–æ—Ä–æ—à–µ–º GPS —Å–∏–≥–Ω–∞–ª–µ (11/31), —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –ª–æ–∂–Ω—ã–µ `gps_offline`.

---

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è `moving`
**–ë—ã–ª–æ:**
```typescript
if (device.car_state?.ign && device.car_state?.run) {
  return 'moving';
}
```

**–°—Ç–∞–ª–æ:**
```typescript
const speed = pos?.s ?? 0;
if (speed > 5 || (device.car_state?.ign && device.car_state?.run)) {
  return 'moving';
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∞—à–∏–Ω—ã —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º –∑–∞–∂–∏–≥–∞–Ω–∏–µ–º (`ign: false`), –Ω–æ –¥–≤–∏–∂—É—â–∏–µ—Å—è (—Å–∫–æ—Ä–æ—Å—Ç—å > 5 –∫–º/—á), –æ—à–∏–±–æ—á–Ω–æ –ø–æ–ª—É—á–∞–ª–∏ —Å—Ç–∞—Ç—É—Å `parked_off`.

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **–õ–æ–≥–∏–∫–∞:** `src/utils/starline-helpers.ts` ‚Üí —Ñ—É–Ω–∫—Ü–∏—è `getCarStatus()`
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** `src/services/starline-monitor.ts` ‚Üí —Å—Ç—Ä–æ–∫–∏ 436-511
- **–°—Ö–µ–º–∞ –ë–î:** `docs/DATABASE_SCHEMA.md` ‚Üí —Ç–∞–±–ª–∏—Ü–∞ `gps_tracking`
- **–¢–µ—Å—Ç—ã:** `check_statuses_in_db.mjs` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –≤ –ë–î

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
node check_statuses_in_db.mjs

# –ò–ª–∏ SQL –∑–∞–ø—Ä–æ—Å
SELECT status, COUNT(*) 
FROM gps_tracking 
WHERE status IS NOT NULL 
GROUP BY status 
ORDER BY COUNT(*) DESC;
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 14.11.2025, 12:30  
**–ê–≤—Ç–æ—Ä:** AI Agent (Cursor)  
**–í–µ—Ä—Å–∏—è:** 1.0

