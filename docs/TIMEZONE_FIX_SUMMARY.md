# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –Ω–∞ Asia/Tbilisi

**–î–∞—Ç–∞:** 2025-11-21  
**–°—Ç–∞—Ç—É—Å:** üî¥ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

1. **–§—É–Ω–∫—Ü–∏—è `parseRentProgDate`** ‚úÖ - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `+04:00` (Asia/Tbilisi)
2. **–¢—Ä–∏–≥–≥–µ—Ä `sync_booking_fields()`** ‚ùå - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UTC –≤–º–µ—Å—Ç–æ Asia/Tbilisi
3. **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏** ‚ùå - –≤—Å–µ 1926 –∑–∞–ø–∏—Å–µ–π –∏–º–µ—é—Ç —Ñ–æ—Ä–º–∞—Ç `+00` (UTC) –≤–º–µ—Å—Ç–æ `+04` (Asia/Tbilisi)

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º start_date:
   UTC —Ñ–æ—Ä–º–∞—Ç (+00): 1926
   Asia/Tbilisi —Ñ–æ—Ä–º–∞—Ç (+04): 0
   –î—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã: 0
```

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º:

```
start_at: Sat Nov 22 2025 01:00:00 GMT+0400 ‚úÖ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
start_date: 2025-11-21 21:00:00+00 ‚ùå (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2025-11-22 01:00:00+04)
```

---

## üîß –ü—Ä–∏—á–∏–Ω–∞

–ú–∏–≥—Ä–∞—Ü–∏—è **017** (`db/migrations/017_fix_bookings_dates_trigger.sql`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:

```sql
TO_CHAR(NEW.start_at AT TIME ZONE 'UTC', 'YYYY-MM-DD HH24:MI:SS') || '+00'
```

–í–º–µ—Å—Ç–æ:

```sql
TO_CHAR(NEW.start_at AT TIME ZONE 'Asia/Tbilisi', 'YYYY-MM-DD HH24:MI:SS') || '+04'
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è 018

**–§–∞–π–ª:** `db/migrations/018_fix_timezone_to_asia_tbilisi.sql`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏: `+00` ‚Üí `+04`
2. –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `sync_booking_fields()`: `UTC` ‚Üí `Asia/Tbilisi`
3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç—Ä–∏–≥–≥–µ—Ä–µ

**–ë—ã–ª–æ:**
```sql
NEW.start_date := TO_CHAR(NEW.start_at AT TIME ZONE 'UTC', 'YYYY-MM-DD HH24:MI:SS') || '+00';
```

**–°—Ç–∞–ª–æ:**
```sql
NEW.start_date := TO_CHAR(NEW.start_at AT TIME ZONE 'Asia/Tbilisi', 'YYYY-MM-DD HH24:MI:SS') || '+04';
```

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 018

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
psql $DATABASE_URL -f db/migrations/018_fix_timezone_to_asia_tbilisi.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:
```bash
node setup/apply_sql_file.mjs db/migrations/018_fix_timezone_to_asia_tbilisi.sql
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
node setup/check_timezone_usage.mjs
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Asia/Tbilisi`
- ‚úÖ –í—Å–µ –∑–∞–ø–∏—Å–∏ –∏–º–µ—é—Ç —Ñ–æ—Ä–º–∞—Ç `+04`
- ‚úÖ `start_date` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `start_at` –≤ Asia/Tbilisi

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
start_at: Sat Nov 22 2025 01:00:00 GMT+0400 ‚úÖ
start_date: 2025-11-21 21:00:00+00 ‚ùå (UTC, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
start_at: Sat Nov 22 2025 01:00:00 GMT+0400 ‚úÖ
start_date: 2025-11-22 01:00:00+04 ‚úÖ (Asia/Tbilisi, –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `db/migrations/017_fix_bookings_dates_trigger.sql` - –ø—Ä–æ–±–ª–µ–º–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç UTC)
- `db/migrations/018_fix_timezone_to_asia_tbilisi.sql` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Asia/Tbilisi)
- `src/db/upsert.ts` - —Ñ—É–Ω–∫—Ü–∏—è `parseRentProgDate` (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞)
- `setup/check_timezone_usage.mjs` - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ 018:
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –±—Ä–æ–Ω–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±—Ä–æ–Ω–∏ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Ñ–æ—Ä–º–∞—Ç `+04`
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—ã –≤ Asia/Tbilisi

