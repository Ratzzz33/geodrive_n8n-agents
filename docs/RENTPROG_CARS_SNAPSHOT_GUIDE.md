# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –ò–º–ø–æ—Ä—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏–∑ RentProg

## –û–ø–∏—Å–∞–Ω–∏–µ

Workflow **`RentProg Cars Snapshot`** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –µ–¥–∏–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏–∑ RentProg API –≤ –Ω–∞—à—É —Ç–∞–±–ª–∏—Ü—É `cars` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞ `external_refs` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤—è–∑–µ–π —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.

**–¢–∏–ø workflow:** Manual (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫, inactive)  
**–§–∏–ª–∏–∞–ª—ã:** tbilisi, batumi, kutaisi, service-center  
**–ü–∞–≥–∏–Ω–∞—Ü–∏—è:** 20 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –º–∞–∫—Å–∏–º—É–º 1000 —Å—Ç—Ä–∞–Ω–∏—Ü  
**Rate limiting:** 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)

---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º workflow –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `data` (JSONB) –≤ —Ç–∞–±–ª–∏—Ü—É `cars`:

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Node.js
node setup/migrations/run_001_migration.mjs
```

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:**
- –ü–æ–ª–µ `data` (JSONB) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ JSON –æ–±—ä–µ–∫—Ç–∞ –∏–∑ RentProg
- GIN –∏–Ω–¥–µ–∫—Å `idx_cars_data_gin` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ JSON –ø–æ–ª—è–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Neon Console:
```sql
-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: setup/migrations/001_add_cars_data_field.sql
ALTER TABLE cars ADD COLUMN IF NOT EXISTS data JSONB DEFAULT '{}'::jsonb;
CREATE INDEX IF NOT EXISTS idx_cars_data_gin ON cars USING GIN (data);
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ n8n –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:

**`RENTPROG_BRANCH_KEYS`** ‚Äî JSON –æ–±—ä–µ–∫—Ç —Å —Ç–æ–∫–µ–Ω–∞–º–∏ —Ñ–∏–ª–∏–∞–ª–æ–≤:
```json
{
  "tbilisi": "your_tbilisi_token",
  "batumi": "your_batumi_token",
  "kutaisi": "your_kutaisi_token",
  "service-center": "your_service_center_token"
}
```

**–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n UI: https://n8n.rentflow.rentals
2. Settings ‚Üí Environments
3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `RENTPROG_BRANCH_KEYS` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º JSON

### 3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow –≤ n8n

```powershell
# –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ PowerShell —Å–∫—Ä–∏–ø—Ç
powershell -ExecutionPolicy Bypass -File setup/import_cars_snapshot_workflow.ps1
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ MCP:**
```javascript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MCP —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
mcp_n8n_n8n_create_workflow({
  // ... JSON –∏–∑ n8n-workflows/rentprog-cars-snapshot.json
})
```

---

## –ó–∞–ø—É—Å–∫ workflow

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:**
   ```sql
   SELECT COUNT(*) FROM cars;
   SELECT COUNT(*) FROM external_refs WHERE system = 'rentprog' AND entity_type = 'car';
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ n8n UI
   - –û—Ç–∫—Ä–æ–π—Ç–µ workflow "RentProg Cars Snapshot"
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–æ–¥–∞ "Prepare Branches" –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç —Ç–æ–∫–µ–Ω—ã

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞)

1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n UI
2. –ù–∞–∂–º–∏—Ç–µ **"Execute Workflow"** (–∫–Ω–æ–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π "play")
3. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- ~1-3 –º–∏–Ω—É—Ç—ã –Ω–∞ —Ñ–∏–ª–∏–∞–ª (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π)
- ~5-15 –º–∏–Ω—É—Ç –Ω–∞ –≤—Å–µ 4 —Ñ–∏–ª–∏–∞–ª–∞

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–æ–¥–∏–Ω —Ñ–∏–ª–∏–∞–ª)

–î–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥ –Ω–æ–¥—ã "Prepare Branches":

```javascript
// –í –Ω–æ–¥–µ "Prepare Branches" –∏–∑–º–µ–Ω–∏—Ç–µ:
const branches = ['tbilisi'];  // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∏–ª–∏–∞–ª –¥–ª—è —Ç–µ—Å—Ç–∞
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É workflow –Ω–∞ –æ–¥–Ω–æ–º —Ñ–∏–ª–∏–∞–ª–µ –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow

### –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **Manual Trigger** ‚Üí –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
2. **Prepare Branches** ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤ —Ñ–∏–ª–∏–∞–ª–æ–≤ –∏–∑ ENV
3. **Loop Over Branches** ‚Üí –¶–∏–∫–ª –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º
4. **Get Request Token** ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ request token —á–µ—Ä–µ–∑ `/get_token`
5. **Extract Token** ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
6. **Loop Pages (Pagination)** ‚Üí –¶–∏–∫–ª –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
7. **Delay (Rate Limit)** ‚Üí –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è rate limit
8. **Fetch Cars Page** ‚Üí –ó–∞–ø—Ä–æ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π (`/all_cars_full?limit=20&page=N`)
9. **Process Page Response** ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
10. **Has More Pages?** ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
11. **Transform For Upsert** ‚Üí –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ë–î
12. **Generate Upsert SQL** ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –¥–ª—è batch upsert –≤ `cars`
13. **Upsert Cars to PostgreSQL** ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ upsert –≤ —Ç–∞–±–ª–∏—Ü—É `cars`
14. **Generate External Refs SQL** ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –¥–ª—è `external_refs`
15. **Upsert External Refs** ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ upsert –≤ `external_refs`
16. **Branch Summary** ‚Üí –û—Ç—á–µ—Ç –ø–æ —Ñ–∏–ª–∏–∞–ª—É
17. **Final Report** ‚Üí –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º —Ñ–∏–ª–∏–∞–ª–∞–º

### –õ–æ–≥–∏–∫–∞ upsert

**–¢–∞–±–ª–∏—Ü–∞ `cars`:**
```sql
INSERT INTO cars (id, branch_id, plate, vin, model, starline_id, data, created_at, updated_at)
VALUES (...)
ON CONFLICT (id) DO UPDATE SET
  branch_id = EXCLUDED.branch_id,
  plate = EXCLUDED.plate,
  vin = EXCLUDED.vin,
  model = EXCLUDED.model,
  starline_id = EXCLUDED.starline_id,
  data = EXCLUDED.data,
  updated_at = NOW();
```

**–¢–∞–±–ª–∏—Ü–∞ `external_refs`:**
```sql
INSERT INTO external_refs (id, entity_type, entity_id, system, external_id, branch_code, meta, created_at, updated_at)
VALUES (...)
ON CONFLICT (system, external_id) DO UPDATE SET
  entity_id = EXCLUDED.entity_id,
  branch_code = EXCLUDED.branch_code,
  meta = EXCLUDED.meta,
  updated_at = NOW();
```

### –ú–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö

**–ò–∑ RentProg ‚Üí –≤ —Ç–∞–±–ª–∏—Ü—É `cars`:**
- `id` (rentprog) ‚Üí –ø–æ–ª–µ `data->>'id'` + –∑–∞–ø–∏—Å—å –≤ `external_refs`
- `car_name` ‚Üí `model`
- `number` –∏–ª–∏ `car_number` ‚Üí `plate`
- `vin` ‚Üí `vin`
- `starline_id` ‚Üí `starline_id`
- –ü–æ–ª–Ω—ã–π JSON –æ–±—ä–µ–∫—Ç ‚Üí `data` (JSONB)

**branch_id:**
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ lookup: `SELECT id FROM branches WHERE code = '<branch_code>'`
- –ï—Å–ª–∏ —Ñ–∏–ª–∏–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ —Ç–∞–±–ª–∏—Ü—É `branches`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è workflow

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ n8n:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ executions workflow
   - –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–¥—É "Final Report" ‚Äî —Ç–∞–º –±—É–¥–µ—Ç –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéâ –ò–ú–ü–û–†–¢ –ó–ê–í–ï–†–®–ï–ù
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìä –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∏–ª–∏–∞–ª–æ–≤: 4
üöó –í—Å–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: 125

–î–µ—Ç–∞–ª–∏ –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º:
  - tbilisi: 45 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
  - batumi: 32 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
  - kutaisi: 28 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
  - service-center: 20 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `cars`:**
```sql
-- –í—Å–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
SELECT COUNT(*) as total_cars FROM cars;

-- –ü–æ —Ñ–∏–ª–∏–∞–ª–∞–º
SELECT 
  b.code as branch,
  COUNT(c.id) as cars_count
FROM cars c
LEFT JOIN branches b ON c.branch_id = b.id
GROUP BY b.code
ORDER BY cars_count DESC;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
SELECT 
  id,
  plate,
  model,
  data->>'car_name' as rentprog_name,
  data->>'id' as rentprog_id,
  created_at,
  updated_at
FROM cars
LIMIT 5;
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `external_refs`:**
```sql
-- –í—Å–µ–≥–æ external refs –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
SELECT COUNT(*) as total_refs 
FROM external_refs 
WHERE system = 'rentprog' AND entity_type = 'car';

-- –ü–æ —Ñ–∏–ª–∏–∞–ª–∞–º
SELECT 
  branch_code,
  COUNT(*) as refs_count
FROM external_refs
WHERE system = 'rentprog' AND entity_type = 'car'
GROUP BY branch_code
ORDER BY refs_count DESC;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π
SELECT 
  er.external_id as rentprog_id,
  er.branch_code,
  c.plate,
  c.model,
  c.data->>'car_name' as name
FROM external_refs er
JOIN cars c ON er.entity_id = c.id
WHERE er.system = 'rentprog' AND er.entity_type = 'car'
LIMIT 5;
```

---

## –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫

Workflow –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ ‚Äî –±–ª–∞–≥–æ–¥–∞—Ä—è `ON CONFLICT DO UPDATE` –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏:

- –ï—Å–ª–∏ `id` –∞–≤—Ç–æ–º–æ–±–∏–ª—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
- –ï—Å–ª–∏ `external_id` –≤ `external_refs` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ workflow –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ RentProg
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ (—Å–æ–±–ª—é–¥–∞–π—Ç–µ rate limiting)

---

## Troubleshooting

### –û—à–∏–±–∫–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å RENTPROG_BRANCH_KEYS"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `RENTPROG_BRANCH_KEYS` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ n8n Settings
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç JSON –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π:
   ```json
   {"tbilisi":"token1","batumi":"token2",...}
   ```

### –û—à–∏–±–∫–∞: "401 Unauthorized" –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ API

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π company token –¥–ª—è —Ñ–∏–ª–∏–∞–ª–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ `RENTPROG_BRANCH_KEYS`
2. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ workflow

### –û—à–∏–±–∫–∞: "–ù–µ –Ω–∞–π–¥–µ–Ω —Ñ–∏–ª–∏–∞–ª –≤ —Ç–∞–±–ª–∏—Ü–µ branches"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `branches` –¥–ª—è `branch_code`.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ–∏–ª–∏–∞–ª—ã
INSERT INTO branches (id, code, name, created_at, updated_at)
VALUES 
  (gen_random_uuid(), 'tbilisi', '–¢–±–∏–ª–∏—Å–∏', NOW(), NOW()),
  (gen_random_uuid(), 'batumi', '–ë–∞—Ç—É–º–∏', NOW(), NOW()),
  (gen_random_uuid(), 'kutaisi', '–ö—É—Ç–∞–∏—Å–∏', NOW(), NOW()),
  (gen_random_uuid(), 'service-center', '–°–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä', NOW(), NOW())
ON CONFLICT (code) DO NOTHING;
```

### –û—à–∏–±–∫–∞: "Rate limit exceeded (429)"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ RentProg API.

**–†–µ—à–µ–Ω–∏–µ:**
1. Workflow —É–∂–µ –∏–º–µ–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É 1 —Å–µ–∫ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
2. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è ‚Äî —É–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –≤ –Ω–æ–¥–µ "Delay (Rate Limit)" –¥–æ 2000 –º—Å
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º

### Workflow "–∑–∞–≤–∏—Å–∞–µ—Ç" –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–¥–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –í–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ —Ü–∏–∫–ª–∞ –∏–ª–∏ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ executions –≤ n8n UI
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ–¥—ã
3. –ï—Å–ª–∏ workflow –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–í –Ω–æ–¥–µ "Fetch Cars Page" –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `limit`:

```javascript
// –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: limit=20
// –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞: limit=10 –∏–ª–∏ limit=50
url: "https://rentprog.net/api/v1/public/all_cars_full?limit=20&page={{ $json.page }}"
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ limit > 50 ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—é rate limit.

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

–í –Ω–æ–¥–µ "Delay (Rate Limit)" –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `amount`:

```javascript
// –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 1000 –º—Å (1 —Å–µ–∫—É–Ω–¥–∞)
// –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞: 500 –º—Å (0.5 —Å–µ–∫) –∏–ª–∏ 2000 –º—Å (2 —Å–µ–∫)
amount: 1000
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∏–ª–∏–∞–ª–æ–≤

–í –Ω–æ–¥–µ "Prepare Branches" –∏–∑–º–µ–Ω–∏—Ç–µ –º–∞—Å—Å–∏–≤ `branches`:

```javascript
// –í—Å–µ —Ñ–∏–ª–∏–∞–ª—ã:
const branches = ['tbilisi', 'batumi', 'kutaisi', 'service-center'];

// –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∏–ª–∏–∞–ª:
const branches = ['tbilisi'];

// –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª–∏–∞–ª–æ–≤:
const branches = ['tbilisi', 'batumi'];
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-15 –º–∏–Ω—É—Ç –Ω–∞ –≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:** ~(–∫–æ–ª-–≤–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π / 20) * 4 —Ñ–∏–ª–∏–∞–ª–∞
3. **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** –î–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### –ê–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –≤ n8n –¥–ª—è:
- –û—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è workflow
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (> 30 –º–∏–Ω—É—Ç)
- –û—à–∏–±–æ–∫ 401, 429, 500 –æ—Ç RentProg API

---

## –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í–µ—Ä—Å–∏—è workflow:** 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-03  
**–ê–≤—Ç–æ—Ä:** Cursor Agent  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-03

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [RENTPROG_COMPLETE_GUIDE.md](./RENTPROG_COMPLETE_GUIDE.md) ‚Äî –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ RentProg API
- [ARCHITECTURE.md](../ARCHITECTURE.md) ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- [schema.ts](../src/db/schema.ts) ‚Äî –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫:
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:** `docs/`
- **–õ–æ–≥–∞–º n8n:** https://n8n.rentflow.rentals/executions
- **–ë–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:** Neon PostgreSQL Console

