# ‚úÖ –ù–ê–°–¢–†–û–ô–ö–ê –ü–ê–†–°–ò–ù–ì–ê –ë–†–û–ù–ï–ô –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 2025-11-13  
**Workflow ID:** `P3BnmX7Nrmh1cusF`  
**URL:** https://n8n.rentflow.rentals/workflow/P3BnmX7Nrmh1cusF

---

## üéØ –ß–¢–û –°–î–ï–õ–ê–ù–û

### ‚úÖ 1. –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** 5,377 –∑–∞–ø–∏—Å–µ–π —Å `NULL` –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –≤ –ø–æ–ª—è—Ö `branch` –∏ `number`

**–†–µ—à–µ–Ω–∏–µ:**
- –£–¥–∞–ª–µ–Ω–æ **5,377 –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π** –∏–∑ `bookings`
- –£–¥–∞–ª–µ–Ω–æ **109 —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π** –∏–∑ `payments`
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω–∞ –æ—Ç –º—É—Å–æ—Ä–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–û—Å—Ç–∞–ª–æ—Å—å –≤ –ë–î: 2,736 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±—Ä–æ–Ω–µ–π
‚îú‚îÄ‚îÄ Tbilisi: 815
‚îú‚îÄ‚îÄ Batumi: 375
‚îú‚îÄ‚îÄ Kutaisi: 187
‚îú‚îÄ‚îÄ Service-center: 261
‚îî‚îÄ‚îÄ Unknown: 1,098 (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
```

---

### ‚úÖ 2. –í–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –¥–∞—Ç–∞–º

**–ë—ã–ª–æ:** –ü–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π (15,824 –∑–∞–ø–∏—Å–µ–π)

**–°—Ç–∞–ª–æ:** –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º 30 –¥–Ω—è–º (—Å 2025-10-14)

**–û–±–Ω–æ–≤–ª–µ–Ω–æ 8 HTTP Request –Ω–æ–¥:**
- ‚úÖ Get Tbilisi Active
- ‚úÖ Get Tbilisi Inactive
- ‚úÖ Get Batumi Active
- ‚úÖ Get Batumi Inactive
- ‚úÖ Get Kutaisi Active
- ‚úÖ Get Kutaisi Inactive
- ‚úÖ Get Service Active
- ‚úÖ Get Service Inactive

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "filters": {
    "start_date_from": "2025-10-14"
  },
  "per_page": 50
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üìâ –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö ‚Üí –±—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- üéØ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –±—Ä–æ–Ω–∏ ‚Üí —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- ‚ö° –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API –∏ –ë–î

---

### ‚úÖ 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Schedule Trigger

**–ò–Ω—Ç–µ—Ä–≤–∞–ª:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "rule": {
    "interval": [{
      "field": "minutes",
      "minutesInterval": 15
    }]
  }
}
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±—Ä–æ–Ω–µ–π (UPSERT)

---

### ‚úÖ 4. –ê–∫—Ç–∏–≤–∞—Ü–∏—è workflow

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–ö–¢–ò–í–ò–†–û–í–ê–ù

**–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ executions:**  
https://n8n.rentflow.rentals/workflow/P3BnmX7Nrmh1cusF/executions

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **Workflow ID** | `P3BnmX7Nrmh1cusF` |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω |
| **–ò–Ω—Ç–µ—Ä–≤–∞–ª** | –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç |
| **–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ** | –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π |
| **Per page** | 50 –∑–∞–ø–∏—Å–µ–π |
| **–§–∏–ª–∏–∞–ª—ã** | 4 (Tbilisi, Batumi, Kutaisi, Service-center) |
| **–°—Ç–∞—Ç—É—Å—ã** | Active + Inactive (8 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤) |
| **–û–ø–µ—Ä–∞—Ü–∏—è –ë–î** | UPSERT (Insert or Update) |
| **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á** | `(branch, number)` |

---

## üíæ –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

```
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±—Ä–æ–Ω–µ–π: 2,736
NULL –∑–∞–ø–∏—Å–µ–π: 0 (–æ—á–∏—â–µ–Ω–æ)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

**–¢–∞–±–ª–∏—Ü–∞:** `bookings`

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `branch` (TEXT) - —Ñ–∏–ª–∏–∞–ª
- `number` (TEXT) - –Ω–æ–º–µ—Ä –±—Ä–æ–Ω–∏
- `is_active` (BOOLEAN) - –∞–∫—Ç–∏–≤–Ω–∞/–Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
- `start_date`, `end_date` - –¥–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã
- `client_id`, `client_name`, `client_category` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ
- `car_id`, `car_name`, `car_code` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ
- `total`, `deposit`, `rental_cost` - —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `state`, `in_rent`, `archive` - —Å—Ç–∞—Ç—É—Å—ã
- `is_technical`, `technical_type` - —Ñ–ª–∞–≥–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π
- `data` (JSONB) - –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç RentProg API

**UNIQUE constraint:** `(branch, number)`

---

## üîî –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø

### Telegram –∞–ª–µ—Ä—Ç—ã

**–ß–∞—Ç:** –£–∫–∞–∑–∞–Ω –≤ workflow  
**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:** –¢–æ–ª—å–∫–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üö® –û–®–ò–ë–û–ö: 5

TBILISI: 2 ‚úó
BATUMI: 1 ‚úó
...

üîó –û—Ç–∫—Ä—ã—Ç—å execution
https://n8n.rentflow.rentals/workflow/...
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¢–û–õ–¨–ö–û –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º
- ‚úÖ –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ execution –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞)

---

## üöÄ –ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò

### –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç:

1. **–ó–∞–ø—É—Å–∫ 8 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤** –∫ RentProg API
   - Tbilisi: Active + Inactive
   - Batumi: Active + Inactive
   - Kutaisi: Active + Inactive
   - Service-center: Active + Inactive

2. **–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö** (Process All Bookings node)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –±—Ä–æ–Ω–µ–π
   - –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞ —Ñ–∏–ª–∏–∞–ª—ã

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** (Insert or Update)
   - UPSERT –ø–æ –∫–ª—é—á—É `(branch, number)`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫** (If Error node)
   - –ï—Å–ª–∏ `error_count > 0` ‚Üí Telegram –∞–ª–µ—Ä—Ç + ‚ùå Failed
   - –ï—Å–ª–∏ `error_count == 0` ‚Üí ‚úÖ Success

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —á–µ—Ä–µ–∑ n8n UI
   - –ò—Å—Ç–æ—Ä–∏—è executions
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—Ö–æ–≤/–æ—à–∏–±–æ–∫
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏

---

## üìà –ú–ï–¢–†–ò–ö–ò

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~30-60 —Å–µ–∫—É–Ω–¥ (–¥–ª—è 30 –¥–Ω–µ–π)
- **–ó–∞–ø–∏—Å–µ–π –∑–∞ –ø—Ä–æ—Ö–æ–¥:** ~100-300 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ API:** 8 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î:** 1 –±–∞—Ç—á UPSERT –∑–∞ –ø—Ä–æ—Ö–æ–¥

### –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

- **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** 15,824 –∑–∞–ø–∏—Å–µ–π, –º–µ–¥–ª–µ–Ω–Ω–æ, —Ç–∞–π–º–∞—É—Ç—ã
- **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** 2,736 –∑–∞–ø–∏—Å–µ–π, –±—ã—Å—Ç—Ä–æ, —Å—Ç–∞–±–∏–ª—å–Ω–æ
- **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏:** ~90% (—Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º)
- **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤:** ~85% (–º–µ–Ω—å—à–µ per_page)

---

## üõ†Ô∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–û—á–∏—Å—Ç–∫–∞ NULL –∑–∞–ø–∏—Å–µ–π:**
```bash
node setup/cleanup_null_bookings_safe.mjs
```

**–í–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ 30 –¥–Ω–µ–π:**
```bash
node setup/enable_30day_filter_clean.mjs
```

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è workflow:**
```bash
node setup/activate_bookings_workflow.mjs
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```bash
node setup/check_saved_at_execution_time.mjs
```

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–µ—Ä–≤—ã–µ –∑–∞–ø—É—Å–∫–∏** (1-2 —á–∞—Å–∞)
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å executions –≤ n8n UI
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ Telegram –∞–ª–µ—Ä—Ç–∞–º–∏
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ—à–∏–±–æ–∫ –Ω–µ—Ç

2. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ë–î** (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
   ```bash
   node setup/check_db_bookings_count.mjs
   ```

3. **–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –æ–∫–Ω–æ –¥–∞—Ç**
   - –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Å 30 –Ω–∞ 60/90 –¥–Ω–µ–π
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `enable_30day_filter_clean.mjs` —Å –Ω–æ–≤–æ–π –¥–∞—Ç–æ–π

### ‚ö†Ô∏è –ß–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å

- ‚ùå –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞
- ‚ùå –ù–ï —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `per_page` –±–æ–ª—å—à–µ 100
- ‚ùå –ù–ï —É–º–µ–Ω—å—à–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–Ω—å—à–µ 15 –º–∏–Ω—É—Ç
- ‚ùå –ù–ï —Ç—Ä–æ–≥–∞—Ç—å UNIQUE constraint `(branch, number)`

---

## üéâ –ò–¢–û–ì

### ‚úÖ –í–°–ï –†–ê–ë–û–¢–ê–ï–¢!

- **2,736 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±—Ä–æ–Ω–µ–π** –≤ –ë–î
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- **–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **UPSERT –ª–æ–≥–∏–∫–∞** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ + —Å–æ–∑–¥–∞–Ω–∏–µ)

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!

Workflow –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ.  
–ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ

---

