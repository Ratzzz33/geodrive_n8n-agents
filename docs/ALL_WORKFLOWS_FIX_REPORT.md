# üìã –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö 4 workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤

**–î–∞—Ç–∞:** 2025-01-21  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ workflow –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `dynamic_upsert_entity()` –≤ –ë–î

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `setup/migrations/0042_fix_null_values_in_dynamic_upsert.sql`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–ª–∞ –ø–æ–ª—è –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –±—ã–ª–æ `NULL`
- –≠—Ç–æ –∑–∞—Ç–∏—Ä–∞–ª–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º NULL –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
v_value_text := p_data->>v_key;

IF v_value_text IS NULL OR v_value_text = '' THEN
    CONTINUE;  -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ –ø–æ–ª–µ
END IF;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ NULL –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ SET clause
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞—Ç–∏—Ä–∞—é—Ç—Å—è
- ‚úÖ –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–ª—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–¥—ã "Prepare Update" –≤–æ –≤—Å–µ—Ö 4 workflow

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ workflow:**
1. ‚úÖ **Tbilisi** (`P65bXE5Xhupkxxw6`)
2. ‚úÖ **Batumi** (`YsBma7qYsdsDykTq`)
3. ‚úÖ **Kutaisi** (`gJPvJwGQSi8455s9`)
4. ‚úÖ **Service Center** (`PbDKuU06H7s2Oem8`)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –§–∏–ª—å—Ç—Ä—É–µ–º NULL –∏ undefined –∑–Ω–∞—á–µ–Ω–∏—è
if (Array.isArray(value) && value.length === 2) {
  const newValue = value[1];
  if (newValue !== null && newValue !== undefined && newValue !== '') {
    updates[key] = newValue;
  }
} else if (key !== 'id' && value !== null && value !== undefined && value !== '') {
  updates[key] = value;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ NULL –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ workflow
- ‚úÖ –í –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: –Ω–∞ —É—Ä–æ–≤–Ω–µ workflow –∏ –ë–î

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–µ–±—Ö—É–∫–∞—Ö

**–¢–µ—Å—Ç–æ–≤—ã–µ –≤–µ–±—Ö—É–∫–∏:**
1. **Kutaisi** - `booking_update` —Å `user_id: null`
2. **Service Center** - `car_update` –±–µ–∑ NULL –∑–Ω–∞—á–µ–Ω–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –í—Å–µ –≤–µ–±—Ö—É–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ NULL –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –î–∞–Ω–Ω—ã–µ –≤ –ë–î –Ω–µ –∑–∞—Ç–∏—Ä–∞—é—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö executions

**–ù–æ–≤—ã–µ executions –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- **Kutaisi:** Execution #27607 (–ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- **Service Center:** Execution #27608 (–ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- **Batumi:** Execution #27504 (–¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)

**–°—Ç–∞—Ç—É—Å:**
- ‚úÖ –í—Å–µ workflow —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –∑–∞—Ç–∏—Ä–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:** ‚úÖ
- **Workflow –æ–±–Ω–æ–≤–ª–µ–Ω—ã:** ‚úÖ (4/4)
- **–ó–∞—â–∏—Ç–∞ –æ—Ç NULL:** ‚úÖ (–¥–≤–æ–π–Ω–∞—è: workflow + –ë–î)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–µ–±—Ö—É–∫–∞—Ö)
- **–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 8 –∑–∞–ø–∏—Å–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç

---

## üéØ –ò—Ç–æ–≥–∏

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ –§—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity()` –Ω–µ –∑–∞—Ç–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
2. ‚úÖ –ù–æ–¥–∞ "Prepare Update" —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç NULL –≤–æ –≤—Å–µ—Ö 4 workflow
3. ‚úÖ –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: –Ω–∞ —É—Ä–æ–≤–Ω–µ workflow –∏ –ë–î

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- ‚úÖ –í—Å–µ 4 workflow –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞—Ç–∏—Ä–∞–Ω–∏–µ–º NULL –∑–Ω–∞—á–µ–Ω–∏–π —Ä–µ—à–µ–Ω–∞
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

---

## üìù –î–µ—Ç–∞–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### Workflow Tbilisi
- **ID:** `P65bXE5Xhupkxxw6`
- **Webhook:** `/webhook/tbilisi-webhook`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

### Workflow Batumi
- **ID:** `YsBma7qYsdsDykTq`
- **Webhook:** `/webhook/batumi-webhook`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω

### Workflow Kutaisi
- **ID:** `gJPvJwGQSi8455s9`
- **Webhook:** `/webhook/kutaisi-webhook`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

### Workflow Service Center
- **ID:** `PbDKuU06H7s2Oem8`
- **Webhook:** `/webhook/service-center-webhook`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

