# –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚úÖ

## –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î - 100% —É—Å–ø–µ—à–Ω–æ
```
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ processed –≤ —Ç–∞–±–ª–∏—Ü—É events
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω unique constraint events_branch_type_ext_id_unique
‚úÖ –°–æ–∑–¥–∞–Ω –∏–Ω–¥–µ–∫—Å idx_events_processed
```

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
```
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏:
   ‚úÖ –ü–æ–ª–µ processed: –Ω–∞–π–¥–µ–Ω–æ
   ‚úÖ Unique constraint: –Ω–∞–π–¥–µ–Ω
```

**–°–ø–æ—Å–æ–± –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 
- –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `postgres`
- –°–∫—Ä–∏–ø—Ç: `setup/execute_migration_and_import.mjs`
- –í—ã–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑: `"C:\Program Files\nodejs\node.exe"`

### 2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `rentprog-upsert-processor.json` –≤ `setup/import_n8n_workflows.ts`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

### 3. ‚úÖ Workflow —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
–°–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–º—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é, workflow "RentProg Upsert Processor" —É–∂–µ –µ—Å—Ç—å –≤ n8n.

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ UI n8n

–û—Ç–∫—Ä–æ–π—Ç–µ: http://46.224.17.15:5678/workflows

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å **4 workflow**:
1. ‚úÖ RentProg Webhooks Monitor
2. ‚úÖ Sync Progress
3. ‚úÖ Health & Status
4. ‚úÖ RentProg Upsert Processor (–Ω–æ–≤—ã–π)

---

## –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–æ–≤—ã–π workflow –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –î–ª—è workflow "RentProg Upsert Processor":

1. **Credentials –Ω–∞–∑–Ω–∞—á–µ–Ω—ã:**
   - –í—Å–µ Postgres –Ω–æ–¥—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å credential "PostgreSQL"

2. **Workflow –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω:**
   - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "Active" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Cron:**
   - –î–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

4. **HTTP Request –Ω–æ–¥—ã:**
   - URL –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ORCHESTRATOR_URL` –∏–ª–∏ `http://46.224.17.15:3000/process-event`

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
RentProg –≤–µ–±—Ö—É–∫
    ‚Üì
Netlify (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ)
    ‚Üì
n8n: RentProg Webhooks Monitor
    ‚Üì
–¢–∞–±–ª–∏—Ü–∞ events (—Å processed = false)
    ‚Üì
n8n: RentProg Upsert Processor (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
    ‚Üì
Jarvis API /process-event
    ‚Üì
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ processed = true
```

---

## –ò—Ç–æ–≥–æ–≤—ã–π –∞–¥—Ä–µ—Å –≤–µ–±—Ö—É–∫–∞

**–î–ª—è –≤—Å–µ—Ö 4 —Ñ–∏–ª–∏–∞–ª–æ–≤ RentProg:**
```
https://geodrive.netlify.app/webhook/rentprog-webhook
```

---

## –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! üéâ

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ Workflow —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ n8n
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ

**–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–æ–≤—ã–π workflow –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!**

