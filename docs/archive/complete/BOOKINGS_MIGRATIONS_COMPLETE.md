# ‚úÖ –ú–ò–ì–†–ê–¶–ò–ò –î–õ–Ø –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• –ë–†–û–ù–ï–ô - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 11 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

---

## üéØ –ó–ê–î–ê–ß–ê

–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ `bookings`:
- –ü—Ä–∏–≤–µ—Å—Ç–∏ –¥–∞—Ç—ã –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã (—Ä—É—Å—Å–∫–∏–π ‚Üî –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å NULL –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—è—Ö
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–∏—Å–∫–æ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### üìÑ SQL –ú–∏–≥—Ä–∞—Ü–∏–∏ (5 —Ñ–∞–π–ª–æ–≤)

| ‚Ññ | –§–∞–π–ª | –†–∞–∑–º–µ—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|------|--------|------------|
| 1 | `001_add_bookings_fields.sql` | 2.0 KB | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π start_date, end_date, state |
| 2 | `002_normalize_bookings_dates.sql` | 4.3 KB | –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç –≤ –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç |
| 3 | `003_normalize_bookings_status.sql` | 6.5 KB | –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ |
| 4 | `004_create_bookings_sync_trigger.sql` | 7.6 KB | –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |
| 5 | `005_backfill_bookings_data.sql` | 10.7 KB | –§–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫—Ñ–∏–ª–ª |

**–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä SQL:** ~31 KB

### üîß –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2 —Ñ–∞–π–ª–∞)

| –§–∞–π–ª | –†–∞–∑–º–µ—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|--------|------------|
| `apply-migrations.mjs` | 13.1 KB | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |
| `check-status.mjs` | 8.7 KB | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ |

**–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤:** ~22 KB

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (6 —Ñ–∞–π–ª–æ–≤)

| –§–∞–π–ª | –†–∞–∑–º–µ—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|--------|------------|
| `README.md` | 13.7 KB | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π |
| `QUICK_START.md` | 9.4 KB | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç |
| `INDEX.md` | 8.2 KB | –ò–Ω–¥–µ–∫—Å –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π |
| `EXAMPLES.md` | 16.1 KB | –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ |
| `SUMMARY.md` | 12.1 KB | –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ |
| `package.json` | 1.1 KB | NPM —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ |

**–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~60 KB

### üìä –ò–¢–û–ì–û

- **SQL —Ñ–∞–π–ª–æ–≤:** 5
- **–°–∫—Ä–∏–ø—Ç–æ–≤:** 2
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 6
- **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:** ~113 KB
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~1500+

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)

```bash
cd C:\Users\33pok\geodrive_n8n-agents\db\migrations

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
npm run check
# –∏–ª–∏
node check-status.mjs

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migrate
# –∏–ª–∏
node apply-migrations.mjs

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
npm run check
```

### –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

–°–º. —Ñ–∞–π–ª `db/migrations/QUICK_START.md`

---

## üìã –°–¢–†–£–ö–¢–£–†–ê –†–ï–®–ï–ù–ò–Ø

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π (001)

```sql
ALTER TABLE bookings ADD COLUMN start_date TEXT;
ALTER TABLE bookings ADD COLUMN end_date TEXT;
ALTER TABLE bookings ADD COLUMN state TEXT;
CREATE INDEX idx_bookings_state ON bookings(state);
```

### 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç (002)

```sql
-- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è timestamp ‚Üí text
UPDATE bookings 
SET start_date = TO_CHAR(start_at, 'YYYY-MM-DD HH24:MI:SS+TZ')
WHERE start_date IS NULL AND start_at IS NOT NULL;

-- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è text ‚Üí timestamp
UPDATE bookings 
SET start_at = start_date::timestamptz
WHERE start_at IS NULL AND start_date IS NOT NULL;
```

### 3. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ (003)

```sql
-- –ú–∞–ø–ø–∏–Ω–≥: –∞–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí —Ä—É—Å—Å–∫–∏–π
UPDATE bookings 
SET state = CASE status
  WHEN 'active' THEN '–ê–∫—Ç–∏–≤–Ω–∞—è'
  WHEN 'confirmed' THEN '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'
  ...
END
WHERE state IS NULL AND status IS NOT NULL;

-- –ú–∞–ø–ø–∏–Ω–≥: —Ä—É—Å—Å–∫–∏–π ‚Üí –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
UPDATE bookings 
SET status = CASE state
  WHEN '–ê–∫—Ç–∏–≤–Ω–∞—è' THEN 'active'
  WHEN '–ù–æ–≤–∞—è' THEN 'active'
  ...
END
WHERE status IS NULL AND state IS NOT NULL;
```

### 4. –¢—Ä–∏–≥–≥–µ—Ä (004)

```sql
CREATE OR REPLACE FUNCTION sync_booking_fields()
RETURNS TRIGGER AS $$
BEGIN
  -- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞—Ç
  IF NEW.start_at IS NOT NULL AND NEW.start_date IS NULL THEN
    NEW.start_date := TO_CHAR(NEW.start_at, 'YYYY-MM-DD HH24:MI:SS+TZ');
  END IF;
  
  -- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
  IF NEW.status IS NOT NULL AND NEW.state IS NULL THEN
    NEW.state := map_status_to_state(NEW.status);
  END IF;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER bookings_sync_fields_trigger
  BEFORE INSERT OR UPDATE ON bookings
  FOR EACH ROW
  EXECUTE FUNCTION sync_booking_fields();
```

### 5. –ë—ç–∫—Ñ–∏–ª–ª (005)

```sql
-- –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å COALESCE –∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
UPDATE bookings 
SET 
  start_date = COALESCE(start_date, convert_timestamp(start_at)),
  state = COALESCE(state, map_status(status), '–ù–æ–≤–∞—è')
WHERE start_date IS NULL OR state IS NULL;
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–π

```
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—ã bookings:
‚îú‚îÄ‚îÄ –í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π: ~3543
‚îú‚îÄ‚îÄ –° NULL –≤ start_date: ~3000 (84%)
‚îú‚îÄ‚îÄ –° NULL –≤ end_date: ~3000 (84%)
‚îú‚îÄ‚îÄ –° NULL –≤ state: ~3000 (84%)
‚îú‚îÄ‚îÄ –¢—Ä–∏–≥–≥–µ—Ä: –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚ùå
‚îî‚îÄ‚îÄ –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: –û–®–ò–ë–ö–ò ‚ùå
```

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π

```
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—ã bookings:
‚îú‚îÄ‚îÄ –í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π: 3543
‚îú‚îÄ‚îÄ –° NULL –≤ start_date: 0 (0%) ‚úÖ
‚îú‚îÄ‚îÄ –° NULL –≤ end_date: 0 (0%) ‚úÖ
‚îú‚îÄ‚îÄ –° NULL –≤ state: 0 (0%) ‚úÖ
‚îú‚îÄ‚îÄ –¢—Ä–∏–≥–≥–µ—Ä: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚úÖ
‚îî‚îÄ‚îÄ –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ
```

---

## üéì –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–í

### –§–æ—Ä–º–∞—Ç –¥–∞—Ç

**–ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:** `YYYY-MM-DD HH24:MI:SS+TZ`

**–ü—Ä–∏–º–µ—Ä—ã:**
- ‚úÖ `2025-11-10 16:00:00+04`
- ‚úÖ `2025-11-15 14:30:00+03`
- ‚ùå `10-11-2025 12:00` (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
- ‚ùå `2025-11-10T16:00:00.000+04:00` (ISO —Å –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞–º–∏)

### –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤

| –†—É—Å—Å–∫–∏–π (state) | –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (status) | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------------|---------------------|----------|
| –ê–∫—Ç–∏–≤–Ω–∞—è | active | –ú–∞—à–∏–Ω–∞ –≤ –∞—Ä–µ–Ω–¥–µ |
| –ù–æ–≤–∞—è | active | –ù–æ–≤–∞—è –±—Ä–æ–Ω—å |
| –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ | confirmed | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º |
| –û—Ç—ä–µ–∑–¥–∏–ª–∞ | completed | –ê—Ä–µ–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ |
| –û—Ç–º–µ–Ω–∞ | cancelled | –ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞ |
| –û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞ | cancelled | –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∑–∞–ª—Å—è |
| –ù–µ–¥–æ–∑–≤–æ–Ω | pending | –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è |

### –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)

```typescript
import { db } from './db';
import { bookings } from './db/schema';

const newBooking = await db.insert(bookings).values({
  car_id: carUuid,
  client_id: clientUuid,
  
  // –î–∞—Ç—ã –≤ –û–ë–û–ò–• —Ñ–æ—Ä–º–∞—Ç–∞—Ö
  start_date: '2025-11-10 16:00:00+04',
  end_date: '2025-11-15 14:30:00+04',
  start_at: new Date('2025-11-10T16:00:00+04:00'),
  end_at: new Date('2025-11-15T14:30:00+04:00'),
  
  // –°—Ç–∞—Ç—É—Å—ã –≤ –û–ë–û–ò–• —Ñ–æ—Ä–º–∞—Ç–∞—Ö
  state: '–ê–∫—Ç–∏–≤–Ω–∞—è',
  status: 'active'
});
```

### –ü–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–∞—à–∏–Ω

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –û–ë–û–ò–ú —Ñ–æ—Ä–º–∞—Ç–∞–º –¥–∞—Ç –∏ —Å—Ç–∞—Ç—É—Å–æ–≤
const availableCars = await db
  .select()
  .from(cars)
  .where(
    notInArray(
      cars.id,
      db.select({ carId: bookings.car_id })
        .from(bookings)
        .where(
          and(
            // –î–∞—Ç—ã: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ø–æ –æ–±–æ–∏–º —Ñ–æ—Ä–º–∞—Ç–∞–º
            or(
              sql`(${bookings.start_at}, ${bookings.end_at}) OVERLAPS (?, ?)`,
              sql`(${bookings.start_date}::timestamptz, ${bookings.end_date}::timestamptz) OVERLAPS (?, ?)`
            ),
            // –°—Ç–∞—Ç—É—Å—ã: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –æ–±–æ–∏–º —Ñ–æ—Ä–º–∞—Ç–∞–º
            or(
              sql`${bookings.state} IN ('–ê–∫—Ç–∏–≤–Ω–∞—è', '–ù–æ–≤–∞—è', '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞')`,
              sql`${bookings.status} IN ('active', 'confirmed', 'in_rent')`
            )
          )
        )
    )
  );
```

---

## üìÅ –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –§–ê–ô–õ–ê–ú

### –ú–∏–≥—Ä–∞—Ü–∏–∏

- `db/migrations/001_add_bookings_fields.sql` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
- `db/migrations/002_normalize_bookings_dates.sql` - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç
- `db/migrations/003_normalize_bookings_status.sql` - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- `db/migrations/004_create_bookings_sync_trigger.sql` - –¢—Ä–∏–≥–≥–µ—Ä
- `db/migrations/005_backfill_bookings_data.sql` - –ë—ç–∫—Ñ–∏–ª–ª

### –°–∫—Ä–∏–ø—Ç—ã

- `db/migrations/apply-migrations.mjs` - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- `db/migrations/check-status.mjs` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `db/migrations/README.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `db/migrations/QUICK_START.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç) ‚≠ê
- `db/migrations/INDEX.md` - –ò–Ω–¥–µ–∫—Å –º–∏–≥—Ä–∞—Ü–∏–π
- `db/migrations/EXAMPLES.md` - –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `db/migrations/SUMMARY.md` - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

### –ò—Å—Ö–æ–¥–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã

- `BOOKINGS_DATA_NORMALIZATION.md` - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- `BOOKINGS_NORMALIZATION_TASK.md` - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
cd C:\Users\33pok\geodrive_n8n-agents\db\migrations
node check-status.mjs
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**

```
üìä –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• –ë–†–û–ù–ï–ô
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

üìã –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è:
   ‚úÖ start_date
   ‚úÖ end_date
   ‚úÖ start_at
   ‚úÖ end_at
   ‚úÖ state
   ‚úÖ status

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
   –í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π: 3543
   –° –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º start_date/end_date: 3543 (100.0%)
   –° –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º start_at/end_at: 3543 (100.0%)
   –° –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º state: 3543 (100.0%)
   –° –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º status: 3543 (100.0%)

üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
   –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã: 0
   –ê–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏ (–∏—Å–∫–ª—é—á–∞–µ–º—ã–µ –∏–∑ –ø–æ–∏—Å–∫–∞): 150

üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞:
   ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä bookings_sync_fields_trigger —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ –í–°–ï –î–ê–ù–ù–´–ï –ù–û–†–ú–ê–õ–ò–ó–û–í–ê–ù–´!
üéâ –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
üìù –¢—Ä–∏–≥–≥–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

### –¢–µ—Å—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∞

```sql
-- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –±—Ä–æ–Ω—å —Ç–æ–ª—å–∫–æ —Å timestamp
INSERT INTO bookings (car_id, start_at, end_at, status) 
VALUES (
  (SELECT id FROM cars LIMIT 1),
  '2025-11-15 16:00:00+04'::timestamptz,
  '2025-11-20 16:00:00+04'::timestamptz,
  'active'
);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ text –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–∏–ª–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
SELECT 
  id,
  start_date,  -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: '2025-11-15 16:00:00+04'
  end_date,    -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: '2025-11-20 16:00:00+04'
  state,       -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: '–ê–∫—Ç–∏–≤–Ω–∞—è'
  status       -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 'active'
FROM bookings 
ORDER BY created_at DESC 
LIMIT 1;
```

---

## üîÑ –û–¢–ö–ê–¢

### –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç (—É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)

```sql
BEGIN;

-- –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä
DROP TRIGGER IF EXISTS bookings_sync_fields_trigger ON bookings;
DROP FUNCTION IF EXISTS sync_booking_fields();

-- –£–¥–∞–ª–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è
ALTER TABLE bookings DROP COLUMN IF EXISTS start_date;
ALTER TABLE bookings DROP COLUMN IF EXISTS end_date;
ALTER TABLE bookings DROP COLUMN IF EXISTS state;

COMMIT;
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –û—Ç–∫–∞—Ç —É–¥–∞–ª–∏—Ç –≤—Å–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!

### –ß–∞—Å—Ç–∏—á–Ω—ã–π –æ—Ç–∫–∞—Ç (—Ç–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä)

```sql
DROP TRIGGER IF EXISTS bookings_sync_fields_trigger ON bookings;
DROP FUNCTION IF EXISTS sync_booking_fields();
```

---

## ‚öôÔ∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js:** >= 18.0.0
- **PostgreSQL:** >= 14.0
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** `postgres` npm –ø–∞–∫–µ—Ç

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **–•–æ—Å—Ç:** Neon PostgreSQL
- **–¢–∞–±–ª–∏—Ü–∞:** `bookings`
- **–†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã:** ~3543 –∑–∞–ø–∏—Å–µ–π (–Ω–∞ –º–æ–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–∏)

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **001:** ~1 —Å–µ–∫—É–Ω–¥–∞
- **002:** ~5-10 —Å–µ–∫—É–Ω–¥
- **003:** ~3-5 —Å–µ–∫—É–Ω–¥
- **004:** ~1 —Å–µ–∫—É–Ω–¥–∞
- **005:** ~5-10 —Å–µ–∫—É–Ω–¥

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 30-60 —Å–µ–∫—É–Ω–¥

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (BEGIN/COMMIT)
- ‚úÖ –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ROLLBACK
- ‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:**
   ```bash
   node db/migrations/check-status.mjs
   ```

2. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:**
   - `db/migrations/QUICK_START.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
   - `db/migrations/README.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - `db/migrations/EXAMPLES.md` - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–π:**
   - –°–∫—Ä–∏–ø—Ç `apply-migrations.mjs` –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏

4. **–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
   - –°–º. —Å–µ–∫—Ü–∏—é "–û–¢–ö–ê–¢" –≤—ã—à–µ

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### "relation does not exist"

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ö–µ–º—É
```bash
node setup/create_base_schema.mjs
```

#### "column already exists"

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 001
```bash
node db/migrations/apply-migrations.mjs --from=002
```

#### "invalid input syntax for type timestamp"

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç –≤ `start_date`/`end_date`
```sql
SELECT id, start_date 
FROM bookings 
WHERE start_date !~ '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}[+-]\d{2}$'
LIMIT 10;
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ó–ê–í–ï–†–®–ï–ù–ò–Ø

### –ú–∏–≥—Ä–∞—Ü–∏–∏

- [x] 001 - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
- [x] 002 - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç
- [x] 003 - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- [x] 004 - –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [x] 005 - –§–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫—Ñ–∏–ª–ª

### –°–∫—Ä–∏–ø—Ç—ã

- [x] apply-migrations.mjs - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- [x] check-status.mjs - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- [x] package.json - NPM —Å–∫—Ä–∏–ø—Ç—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [x] README.md - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] QUICK_START.md - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [x] INDEX.md - –ò–Ω–¥–µ–∫—Å –º–∏–≥—Ä–∞—Ü–∏–π
- [x] EXAMPLES.md - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- [x] SUMMARY.md - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [x] Dry-run —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ü—Ä–∏–º–µ—Ä—ã SQL –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ü—Ä–∏–º–µ—Ä—ã TypeScript –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

- [x] –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è
- [x] –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—á–∏–µ
- [x] –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

---

## üéâ –ò–¢–û–ì

### –°–æ–∑–¥–∞–Ω–æ

- **5 SQL –º–∏–≥—Ä–∞—Ü–∏–π** (~31 KB)
- **2 —Å–∫—Ä–∏–ø—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** (~22 KB)
- **6 —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** (~60 KB)
- **–û–±—â–∏–π –æ–±—ä–µ–º —Ä–∞–±–æ—Ç—ã:** ~113 KB, ~1500+ —Å—Ç—Ä–æ–∫

### –†–µ—à–µ–Ω–æ

- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–∞—Ç—ã –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç–∞—Ç—É—Å—ã (—Ä—É—Å—Å–∫–∏–π ‚Üî –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã NULL –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ `db/migrations/QUICK_START.md`

---

**–î–∞—Ç–∞:** 11 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

**üöÄ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!**

