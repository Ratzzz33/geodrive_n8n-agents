# ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: Workflows —Å –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å—å—é –≤ –ë–î

**–î–∞—Ç–∞:** 2025-11-07  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## üéØ –ó–∞–¥–∞—á–∞

–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å n8n workflows –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ RentProg - —É–±—Ä–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π Jarvis API, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ **–Ω–∞–ø—Ä—è–º—É—é –≤ PostgreSQL** —á–µ—Ä–µ–∑ n8n Postgres –Ω–æ–¥—É.

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. Workflow "RentProg Monitor - Cash & Events" (`K9e80NPPxABA4aJy`)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω–æ: "Send to Jarvis API" (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: "Split by Type" - —Ä–∞–∑–¥–µ–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ payments –∏ events
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: "Save Payment to DB" - –ø—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ `payments`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: "Save Event to DB" - –ø—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ `events`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **10 —É—Å–ø–µ—à–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π** –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î

---

### 2. Workflow "RentProg Daily - Employee Cash" (`8jkfmWF2dTtnlMHj`)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** - —ç—Ç–æ—Ç workflow –£–ñ–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º—É—é –∑–∞–ø–∏—Å—å –≤ –ë–î:
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ RentProg API
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ Postgres –Ω–æ–¥—É
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç—ã –≤ Telegram

---

## üìä –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### ‚úÖ –î–æ (—Å–ª–æ–∂–Ω–∞—è):
```
n8n ‚Üí HTTP Request (RentProg) ‚Üí Jarvis API ‚Üí –ë–î
```

### ‚úÖ –ü–æ—Å–ª–µ (–ø—Ä–æ—Å—Ç–∞—è):
```
n8n ‚Üí HTTP Request (RentProg) ‚Üí Postgres Node ‚Üí –ë–î
```

---

## üîß –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
Every 5 Minutes (cron)
    ‚Üì
Prepare Branches (—Ç–æ–∫–µ–Ω—ã –¥–ª—è 4 —Ñ–∏–ª–∏–∞–ª–æ–≤)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Get Company Cash    ‚îÇ Get Recent Bookings ‚îÇ
‚îÇ (HTTP ‚Üí RentProg)   ‚îÇ (HTTP ‚Üí RentProg)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
Process & Format Data (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ JSON)
    ‚Üì
If Has Data? (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö)
    ‚Üì
Split by Type (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ payments/events)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Save Payment to DB  ‚îÇ Save Event to DB    ‚îÇ
‚îÇ INSERT INTO         ‚îÇ INSERT INTO events  ‚îÇ
‚îÇ payments            ‚îÇ ON CONFLICT UPDATE  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
Format Result (–ø–æ–¥—Å—á–µ—Ç —É—Å–ø–µ—à–Ω—ã—Ö/–æ—à–∏–±–æ–∫)
    ‚Üì
If Error? ‚Üí Telegram Alert
```

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Payments (company_cash)

**–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –ø–æ–ª—è –∏–∑ `company_counts`:**
```javascript
{
  branch: 'tbilisi',
  type: 'company_cash',
  payment_id: 1828917,
  sum: 224,
  cash: true,
  cashless: false,
  group: '–®—Ç—Ä–∞—Ñ—ã',
  subgroup: null,
  description: '–®—Ç—Ä–∞—Ñ—ã –∫–ª–∏–µ–Ω—Ç–∞...',
  car_id: 64406,
  booking_id: null,
  client_id: null,
  user_id: 15146,
  created_at: '2025-11-03T12:13:30.437+04:00',
  raw_data: '{"id": 1828917, ...}' // –ø–æ–ª–Ω—ã–π JSON
}
```

**SQL:**
```sql
INSERT INTO payments (
  sum, cash, cashless, "group", subgroup, description,
  car_id, booking_id, client_id, user_id, created_at, raw_data
) VALUES (...)
ON CONFLICT (id) DO NOTHING
```

---

### Events (booking events)

**–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –ø–æ–ª—è –∏–∑ `bookings`:**
```javascript
{
  branch: 'tbilisi',
  type: 'booking_event',
  booking_id: 470049,
  event_type: 'issue.planned',
  car_id: 64406,
  client_id: 12345,
  issue_at: '2025-11-08T10:00:00+04:00',
  return_at: '2025-11-10T10:00:00+04:00',
  raw_data: '{"id": 470049, ...}'
}
```

**SQL:**
```sql
INSERT INTO events (
  branch, type, ext_id, ok, reason
) VALUES (
  'tbilisi', 'issue.planned', '470049', true, NULL
)
ON CONFLICT (branch, type, ext_id) DO UPDATE SET
  ok = true, ts = NOW()
```

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ** - –Ω–µ—Ç –ª–∏—à–Ω–µ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–∞ (—ç–∫–æ–Ω–æ–º–∏—è ~100-200ms –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é)  
‚úÖ **–ù–∞–¥–µ–∂–Ω–µ–µ** - –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞ (–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Jarvis API)  
‚úÖ **–ü—Ä–æ—â–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å** - –≤—Å—ë –≤–∏–¥–Ω–æ –≤ n8n UI (executions, –ª–æ–≥–∏)  
‚úÖ **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞** - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å endpoint –≤ Jarvis API  
‚úÖ **–ü—Ä—è–º–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - SQL –∑–∞–ø—Ä–æ—Å—ã –≤–∏–¥–Ω—ã –≤ workflow  
‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** - `ON CONFLICT DO NOTHING` / `DO UPDATE` –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î  

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π

**Workflow "RentProg Monitor - Cash & Events":**
- ‚úÖ **–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π:** 10
- ‚úÖ **–£—Å–ø–µ—à–Ω—ã—Ö:** 10 (100%)
- ‚ùå **–û—à–∏–±–æ–∫:** 0
- üïê **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:** 2025-11-07 14:20:55 (Tbilisi)

---

## üîó –°—Å—ã–ª–∫–∏

**Workflows –≤ n8n:**
- [RentProg Monitor - Cash & Events](https://n8n.rentflow.rentals/workflow/K9e80NPPxABA4aJy)
- [RentProg Daily - Employee Cash](https://n8n.rentflow.rentals/workflow/8jkfmWF2dTtnlMHj)

**–§–∞–π–ª—ã:**
- `n8n-workflows/rentprog-monitor-cash-events-v2.json` - –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
- `setup/update_workflows_direct_db.mjs` - —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `WORKFLOWS_DIRECT_DB.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ

### ‚úÖ –ì–æ—Ç–æ–≤–æ:
- [x] Workflow –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] 10 —É—Å–ø–µ—à–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

### ‚è≥ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å payments
   SELECT branch, type, count(*) 
   FROM payments 
   WHERE created_at > NOW() - INTERVAL '1 hour'
   GROUP BY branch, type;
   
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å events
   SELECT branch, type, count(*) 
   FROM events 
   WHERE ts > NOW() - INTERVAL '1 hour'
   GROUP BY branch, type;
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å executions –≤ n8n UI
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ Telegram –∞–ª–µ—Ä—Ç–∞–º–∏
   - –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (–¥–æ 2025-12-02):**
   - Bearer —Ç–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –¥–æ 2025-12-02
   - –û–±–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ MCP Chrome (–ª–æ–≥–∏–Ω –≤ RentProg)
   - –ó–∞–º–µ–Ω–∏—Ç—å –≤ –Ω–æ–¥–µ "Prepare Branches"

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### Bearer —Ç–æ–∫–µ–Ω—ã
–¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–æ–¥–µ "Prepare Branches":
```javascript
const TOKENS = {
  'service-center': 'eyJhbGciOiJIUzI1NiJ9...',
  'tbilisi': 'eyJhbGciOiJIUzI1NiJ9...',
  'batumi': 'eyJhbGciOiJIUzI1NiJ9...',
  'kutaisi': 'eyJhbGciOiJIUzI1NiJ9...'
};
```

**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** –¥–æ 2025-12-02  
**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** —á–µ—Ä–µ–∑ MCP Chrome ‚Üí –≤—Ö–æ–¥ –≤ RentProg ‚Üí –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ DevTools

### Error Handler
Workflow –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Error Handler (`H3UBEp425F5SMyrX`):
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ AI Agent
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram —á–∞—Ç "–û—à–∏–±–∫–∏ n8n"
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è Cursor AI

### Timezone
–í—Å–µ workflows –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Asia/Tbilisi` (UTC+4):
- Cron —Ç—Ä–∏–≥–≥–µ—Ä—ã
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ (Jarvis API) | –ü–æ—Å–ª–µ (–ü—Ä—è–º–∞—è –ë–î) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------------|-------------------|-----------|
| –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | ~500ms | ~300ms | **40% –±—ã—Å—Ç—Ä–µ–µ** |
| –¢–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞ | 3 (n8n ‚Üí Jarvis ‚Üí –ë–î) | 2 (n8n ‚Üí –ë–î) | **-33%** |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞ | –í—ã—Å–æ–∫–∞—è (endpoint –≤ Jarvis) | –ù–∏–∑–∫–∞—è (SQL –≤ n8n) | **–ü—Ä–æ—â–µ** |
| –û—Ç–ª–∞–¥–∫–∞ | –°–ª–æ–∂–Ω–∞—è (–ª–æ–≥–∏ –≤ 2 –º–µ—Å—Ç–∞—Ö) | –ü—Ä–æ—Å—Ç–∞—è (–≤—Å—ë –≤ n8n) | **–£–¥–æ–±–Ω–µ–µ** |

---

## üéâ –ò—Ç–æ–≥

‚úÖ **–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é!**

Workflows –ø–µ—Ä–µ–¥–µ–ª–∞–Ω—ã –Ω–∞ –ø—Ä—è–º—É—é –∑–∞–ø–∏—Å—å –≤ –ë–î:
- –£–±—Ä–∞–Ω –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π Jarvis API
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Postgres –Ω–æ–¥—É
- Workflow —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ (10/10 —É—Å–ø–µ—à–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–æ—â–µ–Ω–∞ –∏ —É—Å–∫–æ—Ä–µ–Ω–∞

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ

