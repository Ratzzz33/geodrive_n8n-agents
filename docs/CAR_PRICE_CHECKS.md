# üîç –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π

**–î–∞—Ç–∞:** 2025-11-09  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ  
**–í–µ—Ä—Å–∏—è:** 1.0.0

---

## üìã –û–±–∑–æ—Ä

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ü–µ–Ω –Ω–∞ —Å–µ–∑–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤ RentProg —á–µ—Ä–µ–∑ endpoint `/car_data_with_bookings`.

### –ü—Ä–æ–±–ª–µ–º–∞

–í RentProg –Ω–µ –≤—Å–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏–º–µ—é—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ —Å–µ–∑–æ–Ω—ã. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø—Ä–æ–±–ª–µ–º–∞–º:
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã
- –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–Ω–ª–∞–π–Ω-–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –†—É—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### –†–µ—à–µ–Ω–∏–µ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API:**
- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `/car_data_with_bookings`
- API endpoint –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –¢–∞–±–ª–∏—Ü–∞ –ë–î –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- n8n workflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- Telegram –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RentProg API                             ‚îÇ
‚îÇ GET /car_data_with_bookings?car_id=X     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ API: GET /check-cars-without-prices      ‚îÇ
‚îÇ Script: check_cars_without_prices.mjs    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Check Each  ‚îÇ    ‚îÇ Store Results  ‚îÇ
‚îÇ Car via     ‚îÇ    ‚îÇ in DB          ‚îÇ
‚îÇ /car_data_  ‚îÇ    ‚îÇ (car_price_    ‚îÇ
‚îÇ with_       ‚îÇ    ‚îÇ  checks)       ‚îÇ
‚îÇ bookings    ‚îÇ    ‚îÇ                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                    ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ n8n Workflow             ‚îÇ
    ‚îÇ Daily Check (4:00 AM)    ‚îÇ
    ‚îÇ + Telegram Alerts        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å–∫—Ä–∏–ø—Ç)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã
node setup/check_cars_without_prices.mjs

# –í—ã–≤–æ–¥:
# üîç –ù–∞—á–∏–Ω–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –±–µ–∑ —Ü–µ–Ω –Ω–∞ —Å–µ–∑–æ–Ω—ã...
# 
# [tbilisi] –ü–æ–ª—É—á–µ–Ω–∏–µ request token...
# [tbilisi] –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π...
# [tbilisi] –ù–∞–π–¥–µ–Ω–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: 50
# [tbilisi] ‚úÖ ABC123: –µ—Å—Ç—å —Ü–µ–Ω—ã (3/3)
# [tbilisi] ‚ùå XYZ789: –ù–ï–¢ –¶–ï–ù (—Å–µ–∑–æ–Ω–æ–≤: 3, —Ü–µ–Ω: 0)
# ...
```

### 2. –ß–µ—Ä–µ–∑ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã
curl http://46.224.17.15:3000/check-cars-without-prices

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∏–ª–∏–∞–ª
curl http://46.224.17.15:3000/check-cars-without-prices/tbilisi

# –û—Ç–≤–µ—Ç:
{
  "ok": true,
  "branches": [
    {
      "branch": "tbilisi",
      "total": 50,
      "checked": 50,
      "withoutPrices": 5,
      "withPrices": 45,
      "errors": 0,
      "cars": [...]
    }
  ],
  "summary": {
    "total": 200,
    "withoutPrices": 15,
    "withPrices": 185
  }
}
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (n8n)

Workflow **"Check Cars Without Prices"** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 4:00 —É—Ç—Ä–∞ (UTC)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `car_price_checks`

–•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫:

```sql
CREATE TABLE car_price_checks (
  id UUID PRIMARY KEY,
  branch TEXT NOT NULL,
  car_id UUID REFERENCES cars(id),
  rentprog_car_id TEXT NOT NULL,
  car_code TEXT,
  car_number TEXT,
  car_model TEXT,
  seasons_count INTEGER DEFAULT 0,
  prices_count INTEGER DEFAULT 0,
  missing_seasons JSONB,
  check_data JSONB,
  resolved BOOLEAN DEFAULT FALSE,
  resolved_at TIMESTAMPTZ,
  checked_at TIMESTAMPTZ DEFAULT NOW()
);
```

### SQL Views

**`unresolved_price_issues`** - –Ω–µ—Ä–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
```sql
SELECT * FROM unresolved_price_issues;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
id          | branch  | car_number | seasons_count | prices_count | missing_prices_count
------------|---------|------------|---------------|--------------|---------------------
uuid-1      | tbilisi | ABC123     | 3             | 0            | 3
uuid-2      | batumi  | XYZ789     | 4             | 1            | 3
```

### SQL Functions

**`get_price_issues_stats(branch)`** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º:
```sql
SELECT * FROM get_price_issues_stats();
SELECT * FROM get_price_issues_stats('tbilisi');
```

**`resolve_price_issue(check_id, resolved_by, notes)`** - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω–æ–µ:
```sql
SELECT resolve_price_issue(
  'uuid-check-id', 
  'admin', 
  '–¶–µ–Ω—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ RentProg'
);
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–ª–µ—Ä—Ç:

```
üö® –ù–∞–π–¥–µ–Ω—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –±–µ–∑ —Ü–µ–Ω –Ω–∞ —Å–µ–∑–æ–Ω—ã

–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚Ä¢ –í—Å–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: 200
‚Ä¢ –ë–µ–∑ —Ü–µ–Ω: 15
‚Ä¢ –° —Ü–µ–Ω–∞–º–∏: 185

–ü–æ —Ñ–∏–ª–∏–∞–ª–∞–º:
‚Ä¢ tbilisi: 5/50 –±–µ–∑ —Ü–µ–Ω
‚Ä¢ batumi: 3/60 –±–µ–∑ —Ü–µ–Ω
‚Ä¢ kutaisi: 4/45 –±–µ–∑ —Ü–µ–Ω
‚Ä¢ service-center: 3/45 –±–µ–∑ —Ü–µ–Ω

‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –≤ RentProg
```

### –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º

–í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏:

```
üìã –î–µ—Ç–∞–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –±–µ–∑ —Ü–µ–Ω:

1. ABC123 (Toyota Camry)
   –§–∏–ª–∏–∞–ª: tbilisi
   –°–µ–∑–æ–Ω–æ–≤: 3, –¶–µ–Ω: 0
   –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: 3 —Ü–µ–Ω

2. XYZ789 (Honda Accord)
   –§–∏–ª–∏–∞–ª: batumi
   –°–µ–∑–æ–Ω–æ–≤: 4, –¶–µ–Ω: 1
   –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: 3 —Ü–µ–Ω
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í `.env`:
```env
# RentProg —Ç–æ–∫–µ–Ω—ã —Ñ–∏–ª–∏–∞–ª–æ–≤ (company tokens)
RENTPROG_TOKEN_TBILISI=HHVxEiZJpFfWu2oDp5iZ7MxJrNXEMWLu
RENTPROG_TOKEN_BATUMI=HbIBFRY0QBVC9I0fCOdXjLjO2J1fRzUH
RENTPROG_TOKEN_KUTAISI=C8cK7w0vG3KJzVb1YRt3C6UrF7zZEH9Y
RENTPROG_TOKEN_SERVICE_CENTER=3PUAyNAGjYdU7n5wUmLe2lPMpWRwpQVZ

# Telegram (–¥–ª—è n8n –∞–ª–µ—Ä—Ç–æ–≤)
TELEGRAM_ALERT_CHAT_ID=-1001234567890
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –∏ —Ñ—É–Ω–∫—Ü–∏–∏
psql $DATABASE_URL -f setup/migrations/013_create_car_price_checks_table.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:
```bash
node setup/run_migration.mjs 013
```

### 3. –ò–º–ø–æ—Ä—Ç n8n workflow

```bash
# –ß–µ—Ä–µ–∑ PowerShell
powershell -ExecutionPolicy Bypass -File setup/import_single_workflow.ps1 -WorkflowFile "n8n-workflows/check-cars-without-prices.json"

# –ò–ª–∏ —á–µ—Ä–µ–∑ n8n UI
# Import from file: n8n-workflows/check-cars-without-prices.json
```

### 4. –ê–∫—Ç–∏–≤–∞—Ü–∏—è workflow

```bash
# –ß–µ—Ä–µ–∑ API
curl -X POST http://46.224.17.15:5678/api/v1/workflows/{workflow-id}/activate \
  -H "X-N8N-API-KEY: your-api-key"

# –ò–ª–∏ —á–µ—Ä–µ–∑ n8n UI
# Workflows ‚Üí Check Cars Without Prices ‚Üí Toggle "Active"
```

---

## üîç RentProg API Endpoint

### `/car_data_with_bookings`

**URL:** `https://rentprog.net/api/v1/public/car_data_with_bookings?car_id={id}`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** Bearer token (request token)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `car_id` (string) - ID –∞–≤—Ç–æ–º–æ–±–∏–ª—è –≤ RentProg

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 123,
  "code": "Ford Mustang 648",
  "number": "ABC123",
  "model": "Ford Mustang",
  "seasons": [
    {
      "id": 456,
      "name": "Winter 2024",
      "start_date": "2024-12-01",
      "end_date": "2025-02-28"
    }
  ],
  "prices": [
    {
      "id": 789,
      "season_id": 456,
      "values": [100, 90, 80, 70, 60]
    }
  ],
  "price_periods": ["1-3 –¥–Ω—è", "4-7 –¥–Ω–µ–π", "8-15 –¥–Ω–µ–π", "16-30 –¥–Ω–µ–π", "31+ –¥–Ω–µ–π"],
  "active_bookings": []
}
```

### –ü—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```javascript
// 1. –ü–æ–ª—É—á–∏—Ç—å request token
const tokenResponse = await fetch(
  'https://rentprog.net/api/v1/public/get_token?company_token=YOUR_COMPANY_TOKEN'
);
const { token, exp } = await tokenResponse.json();

// 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å token –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
const carResponse = await fetch(
  'https://rentprog.net/api/v1/public/car_data_with_bookings?car_id=123',
  { headers: { Authorization: `Bearer ${token}` } }
);
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:**
- Request token –∏–º–µ–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π TTL (~240 —Å–µ–∫—É–Ω–¥)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–∏ 401 –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π token

---

## üìà –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∞–≤—Ç–æ

```sql
-- –í—Å–µ –Ω–µ—Ä–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
SELECT * FROM unresolved_price_issues;

-- –ü–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ñ–∏–ª–∏–∞–ª—É
SELECT * FROM unresolved_price_issues WHERE branch = 'tbilisi';

-- –° —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ü–µ–Ω
SELECT * FROM unresolved_price_issues 
ORDER BY missing_prices_count DESC;
```

### 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

```sql
-- –ü–æ –≤—Å–µ–º —Ñ–∏–ª–∏–∞–ª–∞–º
SELECT * FROM get_price_issues_stats();

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- branch  | total_checks | cars_with_issues | resolved | unresolved | last_check_at
-- --------|--------------|------------------|----------|------------|---------------
-- tbilisi | 10           | 5                | 2        | 3          | 2025-11-09 04:00:00
```

### 3. –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—É—é

```sql
-- –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –≤ RentProg
SELECT resolve_price_issue(
  'uuid-check-id',
  'admin',
  '–î–æ–±–∞–≤–ª–µ–Ω—ã —Ü–µ–Ω—ã –Ω–∞ –≤—Å–µ —Å–µ–∑–æ–Ω—ã'
);
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API (cURL)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã
curl http://46.224.17.15:3000/check-cars-without-prices

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–¥–∏–Ω —Ñ–∏–ª–∏–∞–ª
curl http://46.224.17.15:3000/check-cars-without-prices/tbilisi

# –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª
curl http://46.224.17.15:3000/check-cars-without-prices > result.json
```

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "Failed to get token"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π company token –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å API

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ `.env`
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–æ–∫–µ–Ω—ã –Ω–µ –∏—Å—Ç–µ–∫–ª–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å RentProg API

### –û—à–∏–±–∫–∞: "Car not found in database"

**–ü—Ä–∏—á–∏–Ω–∞:** –ê–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ –Ω–∞—à—É –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `external_refs` –¥–ª—è —ç—Ç–æ–≥–æ –∞–≤—Ç–æ
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ RentProg

### Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–∞–∫—Ç–∏–≤–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å workflow –≤ n8n UI
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials (Telegram, PostgreSQL)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è n8n
4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏: `docker logs n8n --tail 100`

### –ù–µ—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π bot token –∏–ª–∏ chat ID

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `TELEGRAM_ALERT_CHAT_ID` –≤ n8n
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials Telegram –±–æ—Ç–∞
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ —á–∞—Ç–µ

---

## üìù TODO / –£–ª—É—á—à–µ–Ω–∏—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Å—Ç–∞—Ç—É—Å—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–øÔøΩÔøΩ–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∑–∞–¥–∞—á –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
- [ ] –î–∞—à–±–æ—Ä–¥ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞ –≤ Excel/Google Sheets
- [ ] Webhook –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Slack/Discord
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–≥–¥–∞ —Ü–µ–Ω—ã –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã)

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [CAR_PRICES_SYNC.md](./CAR_PRICES_SYNC.md) - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–µ–Ω
- [PRICE_SYNC_DEPLOYMENT_COMPLETE.md](../PRICE_SYNC_DEPLOYMENT_COMPLETE.md) - –î–µ–ø–ª–æ–π —Å–∏—Å—Ç–µ–º—ã —Ü–µ–Ω
- [AUTO_PRICE_UPDATE_WEBHOOK.md](./AUTO_PRICE_UPDATE_WEBHOOK.md) - –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫–∏

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –ë–î
- ‚úÖ SQL views –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ API endpoint –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- ‚úÖ n8n workflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

**–ü–æ–∫—Ä—ã—Ç–∏–µ:** 4 —Ñ–∏–ª–∏–∞–ª–∞, ~200 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π  
**–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 4:00  
**–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:** ~2-5 –º–∏–Ω—É—Ç –Ω–∞ –≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã  
**–¢–æ—á–Ω–æ—Å—Ç—å:** 100% (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è)

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-11-09  
**–ê–≤—Ç–æ—Ä:** Jarvis AI Agent  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

