# üìã –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ workflow Tbilisi

**–î–∞—Ç–∞:** 2025-01-21  
**Workflow ID:** `P65bXE5Xhupkxxw6`  
**–ù–∞–∑–≤–∞–Ω–∏–µ:** –¢–±–∏–ª–∏—Å–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `dynamic_upsert_entity()` –≤ –ë–î

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `setup/migrations/0042_fix_null_values_in_dynamic_upsert.sql`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–ª–∞ –ø–æ–ª—è –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –±—ã–ª–æ `NULL`
- –≠—Ç–æ –∑–∞—Ç–∏—Ä–∞–ª–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º NULL –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
v_value_text := p_data->>v_key;

IF v_value_text IS NULL OR v_value_text = '' THEN
    CONTINUE;  -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ –ø–æ–ª–µ
END IF;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ NULL –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ SET clause
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞—Ç–∏—Ä–∞—é—Ç—Å—è
- ‚úÖ –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–ª—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–¥—ã "Prepare Update" –≤ workflow

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–æ–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∞ `null` –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –≠—Ç–∏ NULL –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é –∏ –∑–∞—Ç–∏—Ä–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –§–∏–ª—å—Ç—Ä—É–µ–º NULL –∏ undefined –∑–Ω–∞—á–µ–Ω–∏—è
if (Array.isArray(value) && value.length === 2) {
  const newValue = value[1];
  if (newValue !== null && newValue !== undefined && newValue !== '') {
    updates[key] = newValue;
  }
} else if (key !== 'id' && value !== null && value !== undefined && value !== '') {
  updates[key] = value;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ NULL –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ workflow
- ‚úÖ –í –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: –Ω–∞ —É—Ä–æ–≤–Ω–µ workflow –∏ –ë–î

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `booking #515772`: —Å–æ–¥–µ—Ä–∂–∏—Ç NULL –∑–Ω–∞—á–µ–Ω–∏—è (`responsible`, `responsible_id`, `user_id`)
- `car #39736`, `car #48581`: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ NULL

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞—â–∏—Ç—É –æ—Ç NULL
- ‚úÖ –ù–æ–¥–∞ Prepare Update —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç NULL –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –î–∞–Ω–Ω—ã–µ –≤ –ë–î –Ω–µ –∑–∞—Ç–∏—Ä–∞—é—Ç—Å—è NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

### –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  "responsible": [null, null],
  "responsible_id": [null, null],
  "user_id": null
}
```
‚Üí –≠—Ç–∏ NULL –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞—Ç–∏—Ä–∞–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  // NULL –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è —ç—Ç–∏—Ö –ø–æ–ª–µ–π
}
```
‚Üí –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:** ‚úÖ
- **Workflow –æ–±–Ω–æ–≤–ª–µ–Ω:** ‚úÖ
- **–ó–∞—â–∏—Ç–∞ –æ—Ç NULL:** ‚úÖ (–¥–≤–æ–π–Ω–∞—è: workflow + –ë–î)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

---

## üéØ –ò—Ç–æ–≥–∏

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ –§—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity()` –Ω–µ –∑–∞—Ç–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ NULL –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
2. ‚úÖ –ù–æ–¥–∞ "Prepare Update" —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç NULL –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
3. ‚úÖ –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: –Ω–∞ —É—Ä–æ–≤–Ω–µ workflow –∏ –ë–î

### –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é:
- ‚úÖ Workflow Tbilisi –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º 3 workflow (Batumi, Kutaisi, Service Center)

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ –∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º 3 workflow:
   - Batumi (`YsBma7qYsdsDykTq`)
   - Kutaisi (`gJPvJwGQSi8455s9`)
   - Service Center (`PbDKuU06H7s2Oem8`)

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥:
   - –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–¥—É "Prepare Update" (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è NULL)
   - –ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (—Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

