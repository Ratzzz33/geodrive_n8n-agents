# üìä –ü–∞—Ä—Ç–Ω–µ—Ä—ã (Investors) - –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

**–î–∞—Ç–∞:** 2025-11-14  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ß–ê–°–¢–ò–ß–ù–û –ó–ê–í–ï–†–®–ï–ù–û  

---

## üìà –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----------|----------|--------|
| **–ü–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≤ –ë–î** | 57 | ‚úÖ |
| **External refs —Å–æ–∑–¥–∞–Ω—ã** | 57 | ‚úÖ |
| **–ú–∞—à–∏–Ω —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏** | 7 | ‚úÖ |
| **–°–≤—è–∑–∞–Ω–Ω—ã—Ö –º–∞—à–∏–Ω** | 3 | ‚ö†Ô∏è |
| **–ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–∞—à–∏–Ω** | 4 | ‚ùå |

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä—Ç–Ω–µ—Ä—ã –≤ –ë–î

**–í—Å–µ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:** 57 –≤ —Ç–∞–±–ª–∏—Ü–µ `rentprog_employees` —Å —Ä–æ–ª—å—é `'partner'`

**–ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:**
- 222 - –ê–Ω—Ç–æ–Ω –ö—Ä—ã–ª–æ–≤
- 748 - –î–µ–Ω–∏—Å –ú–∏—Ö–∞–ª–∏–Ω
- 749 - –ú–∞—Ä–∏—è –ù–∏–∫–∏—à–æ–≤–∞
- 750 - –î—É—Ä—Å—É–Ω –ö–∞—Å—É–º–æ–≤ ‚úÖ (–∏–º–µ–µ—Ç –º–∞—à–∏–Ω—ã)
- 769 - –î–∏–¥–æ–Ω–æ–≤ 2 ‚úÖ (–∏–º–µ–µ—Ç –º–∞—à–∏–Ω—ã)
- 777 - Bortsvadze Beka ‚úÖ (–∏–º–µ–µ—Ç –º–∞—à–∏–Ω—ã)
- ... –∏ –µ—â–µ 51 –ø–∞—Ä—Ç–Ω–µ—Ä

### 2. –°–æ–∑–¥–∞–Ω—ã External refs

**–°–æ–∑–¥–∞–Ω–æ:** 18 –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π  
**–£–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–æ:** 39 (–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–Ω–µ–µ –∏–∑ RentProg API)

–§–æ—Ä–º–∞—Ç:
```sql
entity_type = 'employee'
entity_id = UUID –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ rentprog_employees
system = 'rentprog'
external_id = RentProg ID –ø–∞—Ä—Ç–Ω–µ—Ä–∞
```

### 3. –°–≤—è–∑–∞–Ω—ã –º–∞—à–∏–Ω—ã —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏

**–ú–µ—Ö–∞–Ω–∏–∑–º:** –ü–æ–ª–µ `cars.investor_id` —Å–æ–¥–µ—Ä–∂–∏—Ç RentProg ID –ø–∞—Ä—Ç–Ω–µ—Ä–∞

**–°–≤—è–∑–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ:** 3 –º–∞—à–∏–Ω—ã –∏–∑ 7

---

## ‚úÖ –ú–∞—à–∏–Ω—ã —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏ (—Å–≤—è–∑–∞–Ω–Ω—ã–µ)

| –ù–æ–º–µ—Ä | –ú–æ–¥–µ–ª—å | –§–∏–ª–∏–∞–ª | –ü–∞—Ä—Ç–Ω–µ—Ä ID | –ü–∞—Ä—Ç–Ω–µ—Ä |
|-------|--------|--------|------------|---------|
| **XX950DX** | Audi Q7 | –ö—É—Ç–∞–∏—Å–∏ | 750 | ‚úÖ –î—É—Ä—Å—É–Ω –ö–∞—Å—É–º–æ–≤ |
| **UN522UN** | Buick Encore | –¢–±–∏–ª–∏—Å–∏ | 769 | ‚úÖ –î–∏–¥–æ–Ω–æ–≤ 2 |
| **PJ756PJ** | Hyundai Tucson Silver | –¢–±–∏–ª–∏—Å–∏ | 777 | ‚úÖ Bortsvadze Beka |

---

## ‚ùå –ú–∞—à–∏–Ω—ã –±–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (–Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ)

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∞—Ä—Ç–Ω–µ—Ä 739 –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –ë–î

**4 –º–∞—à–∏–Ω—ã** —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å ID **739**, –Ω–æ –æ–Ω **–ù–ï –ù–ê–ô–î–ï–ù** –≤ `rentprog_employees`:

| –ù–æ–º–µ—Ä | –ú–æ–¥–µ–ª—å | –§–∏–ª–∏–∞–ª | –ü–∞—Ä—Ç–Ω–µ—Ä ID | –°—Ç–∞—Ç—É—Å |
|-------|--------|--------|------------|--------|
| **BB681BF** | Volkswagen Tiguan | –ë–∞—Ç—É–º–∏ | 739 | ‚ùå –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω |
| **FK288FF** | Porsche Macan S | –¢–±–∏–ª–∏—Å–∏ | 739 | ‚ùå –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω |
| **GG134HG** | Toyota Prius | –¢–±–∏–ª–∏—Å–∏ | 739 | ‚ùå –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω |
| **MM207LM** | Mazda 3 | –¢–±–∏–ª–∏—Å–∏ | 739 | ‚ùå –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω |

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ü–∞—Ä—Ç–Ω–µ—Ä 739 –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ RentProg
2. –≠—Ç–æ —Å—Ç–∞—Ä–∞—è/–Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å
3. –ú–∞—à–∏–Ω—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üîç –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ù–∞–π—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ 739

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ RentProg API –Ω–∞–ø—Ä—è–º—É—é
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ Excel —Ñ–∞–π–ª–µ (–∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –≤–∏–¥–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `cars.data->>'investor'` –¥–ª—è —ç—Ç–∏—Ö –º–∞—à–∏–Ω

**–ó–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```sql
SELECT 
  plate,
  data->>'investor' as investor_data,
  data->>'investor_id' as investor_id
FROM cars
WHERE investor_id = 739;
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ 739 –≤ –ë–î

–ï—Å–ª–∏ —É–¥–∞—Å—Ç—Å—è –Ω–∞–π—Ç–∏ –∏–º—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞:
```sql
INSERT INTO rentprog_employees (rentprog_id, name, role)
VALUES ('739', '–ò–º—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞', 'partner')
RETURNING id;

-- –°–æ–∑–¥–∞—Ç—å external_ref
INSERT INTO external_refs (entity_type, entity_id, system, external_id)
VALUES ('employee', '<UUID –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞>', 'rentprog', '739');
```

### 3. –°–≤—è–∑–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ —Å –º–∞—à–∏–Ω–∞–º–∏ –∏–∑ Excel

–í Excel —Ñ–∞–π–ª–µ –µ—Å—Ç—å —Å—Ç–æ–ª–±–µ—Ü —Å –∏–º–µ–Ω–∞–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:
- –ú–∞—Ä–∏–Ω–∞ –•–∞—Ä–µ–ª–∏–Ω–∞
- –ê–ª–µ–∫—Å–µ–π –î–∏–¥–æ–Ω–æ–≤
- –ú–∏—Ö–∞–∏–ª –ü–æ–≤—Ö
- –ù—É—Ä—Å—É–ª—Ç–∞–Ω –ú–∞—Ä–∫–∞
- –∏ –¥—Ä—É–≥–∏–µ

**–ù—É–∂–Ω–æ:**
1. –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å CSV —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
2. –ò–∑–≤–ª–µ—á—å —Å—Ç–æ–ª–±–µ—Ü —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏
3. –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –º–∞—à–∏–Ω—ã ‚Üí –ø–∞—Ä—Ç–Ω–µ—Ä—ã
4. –û–±–Ω–æ–≤–∏—Ç—å `cars.investor_id` –ø–æ –¥–∞–Ω–Ω—ã–º –∏–∑ Excel

---

## üìã SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–µ–π

### –ú–∞—à–∏–Ω—ã —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏
```sql
SELECT 
  c.plate,
  c.model,
  b.name as branch,
  c.investor_id,
  rpe.name as partner_name,
  rpe.rentprog_id
FROM cars c
LEFT JOIN branches b ON b.id = c.branch_id
LEFT JOIN rentprog_employees rpe ON rpe.rentprog_id = c.investor_id::TEXT
WHERE c.investor_id IS NOT NULL
ORDER BY c.investor_id, c.plate;
```

### –ü–∞—Ä—Ç–Ω–µ—Ä—ã —Å –º–∞—à–∏–Ω–∞–º–∏
```sql
SELECT 
  rpe.rentprog_id,
  rpe.name as partner_name,
  COUNT(c.id) as cars_count,
  STRING_AGG(c.plate, ', ') as car_plates
FROM rentprog_employees rpe
LEFT JOIN cars c ON c.investor_id::TEXT = rpe.rentprog_id
WHERE rpe.role = 'partner'
GROUP BY rpe.rentprog_id, rpe.name
HAVING COUNT(c.id) > 0
ORDER BY COUNT(c.id) DESC;
```

### –ü–∞—Ä—Ç–Ω–µ—Ä—ã –±–µ–∑ –º–∞—à–∏–Ω
```sql
SELECT 
  rentprog_id,
  name
FROM rentprog_employees
WHERE role = 'partner'
  AND rentprog_id NOT IN (
    SELECT DISTINCT investor_id::TEXT 
    FROM cars 
    WHERE investor_id IS NOT NULL
  )
ORDER BY rentprog_id::INT;
```

---

## üìä View –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å view –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞—à–∏–Ω–∞–º —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏:

```sql
CREATE OR REPLACE VIEW cars_with_partners AS
SELECT 
  c.id,
  c.plate,
  c.model,
  c.vin,
  c.year,
  b.name as branch_name,
  c.investor_id,
  rpe.name as partner_name,
  rpe.role as partner_role,
  CASE 
    WHEN rpe.id IS NULL THEN '–ü–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω'
    ELSE '–°–≤—è–∑–∞–Ω–æ'
  END as link_status
FROM cars c
LEFT JOIN branches b ON b.id = c.branch_id
LEFT JOIN rentprog_employees rpe ON rpe.rentprog_id = c.investor_id::TEXT
WHERE c.investor_id IS NOT NULL
ORDER BY c.investor_id, c.plate;
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```sql
SELECT * FROM cars_with_partners;
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ù–∞–π—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ 739
- 4 –º–∞—à–∏–Ω—ã –±–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- –≠—Ç–æ 57% –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–∞—à–∏–Ω

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–∑ Excel
- –í Excel –µ—Å—Ç—å –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –ú–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –≤—Å–µ –º–∞—à–∏–Ω—ã —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å `cars.investor_id` –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏–∑ RentProg API
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–∑ RentProg API
- –°–æ–∑–¥–∞–≤–∞—Ç—å external_refs –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## ‚úÖ –ò—Ç–æ–≥

**–°–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ 57 –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≤ –ë–î
- ‚úÖ 57 external_refs —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ 3 –º–∞—à–∏–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–≤—è–∑–∞–Ω—ã —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏

**–û—Å—Ç–∞–ª–æ—Å—å:**
- ‚ùå –ù–∞–π—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ 739
- ‚ùå –°–≤—è–∑–∞—Ç—å 4 –º–∞—à–∏–Ω—ã —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º 739
- ‚ö†Ô∏è –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–∑ Excel (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~75% ‚úÖ

