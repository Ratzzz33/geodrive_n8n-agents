# üîç –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ Execution #27661: –ü–∞—Ä—Å–∏–Ω–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π

**Execution ID:** 27661  
**Workflow:** https://n8n.rentflow.rentals/workflow/u3cOUuoaH5RSw7hm  
**URL Execution:** https://n8n.rentflow.rentals/workflow/u3cOUuoaH5RSw7hm/executions/27661  
**–î–∞—Ç–∞:** 2025-11-21 11:10:23  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ success  
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 44.9 —Å–µ–∫—É–Ω–¥

---

## üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–í—Å–µ–≥–æ –Ω–æ–¥:** 22
- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–æ–¥:** 22
- **–í—Å–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:** 521
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ success

---

## üîç –î–ï–¢–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ö–ê–ñ–î–û–ô –ù–û–î–´

### 1. ‚úÖ –ù–æ–¥–∞ "Every 5 min" (Schedule Trigger)

**–§—É–Ω–∫—Ü–∏—è:** –ó–∞–ø—É—Å–∫–∞–µ—Ç workflow –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ Cron –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: `*/5 * * * *`
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç 4 –≤–µ—Ç–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (Tbilisi, Batumi, Kutaisi, Service)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 2. ‚úÖ –ù–æ–¥–∞ "Tbilisi/Batumi/Kutaisi/Service Pages"

**–§—É–Ω–∫—Ü–∏—è:** –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `branch`, `branch_id`, `token`, `page`
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ UUID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 3. ‚úÖ –ù–æ–¥–∞ "Get Tbilisi/Batumi/Kutaisi/Service" (HTTP Request)

**–§—É–Ω–∫—Ü–∏—è:** –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ RentProg API

**URL:** `https://rentprog.net/api/v1/all_cars_with_bookings`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (Authorization, Accept, Origin, Referer, User-Agent)
- ‚úÖ Timeout: 60000ms
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ JSON:API —Ñ–æ—Ä–º–∞—Ç–µ —Å `included` (—Ü–µ–Ω—ã)

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ API:**
```json
{
  "cars": {
    "data": [
      {
        "id": "59772",
        "attributes": {
          "id": 59772,
          "car_name": "Audi Q7",
          "code": "Audi Q7 950",
          "number": "XX950DX",
          "vin": "WA1LHAF75JD045715",
          "pts": "null",              // ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ "null"
          "body_number": "",           // ‚ö†Ô∏è –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
          "investor_id": 750
        }
      }
    ]
  },
  "included": [
    {
      "id": "227213",
      "type": "price",
      "attributes": {
        "car_id": 59772,
        "season_id": 1,
        "values": [107, 102, 96, 91, 77, 63]
      }
    }
  ]
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 4. ‚úÖ –ù–æ–¥–∞ "Set Tbilisi/Batumi/Kutaisi/Service Branch"

**–§—É–Ω–∫—Ü–∏—è:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `branch` –∏ `branch_id`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 5. ‚úÖ –ù–æ–¥–∞ "Wait for All Branches" (Merge)

**–§—É–Ω–∫—Ü–∏—è:** –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö 4 —Ñ–∏–ª–∏–∞–ª–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–∞–ª—å—à–µ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 6. ‚úÖ –ù–æ–¥–∞ "Merge & Process"

**–§—É–Ω–∫—Ü–∏—è:** –ü–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ API, –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–Ω—ã, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

**–ö–æ–¥:**
```javascript
const safeValue = (value) => {
  if (value === undefined || value === null || value === '' || value === 'null') {
    return undefined;  // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º –≤ SQL
  }
  return value;
};
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `safeValue` –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–Ω—ã –∏–∑ `included` —Å–µ–∫—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –º–∞–ø–ø–∏–Ω–≥ —Ü–µ–Ω –ø–æ `car_id`
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –º–∞—à–∏–Ω—ã –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π JSON –≤ `data` (JSONB)

**–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```javascript
// –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API:
{
  "pts": "null",        // –°—Ç—Ä–æ–∫–∞ "null"
  "body_number": "",    // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
  "vin": "WA1LHAF75JD045715"  // –í–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
}

// –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ safeValue:
{
  "pts": undefined,     // ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è
  "body_number": undefined,  // ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è
  "vin": "WA1LHAF75JD045715"  // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

---

### 7. ‚úÖ –ù–æ–¥–∞ "Split Cars and Prices"

**–§—É–Ω–∫—Ü–∏—è:** –†–∞–∑–¥–µ–ª—è–µ—Ç –º–∞—à–∏–Ω—ã –∏ —Ü–µ–Ω—ã

**–£—Å–ª–æ–≤–∏–µ:**
- True branch (–µ—Å—Ç—å `price_id`) ‚Üí —Ü–µ–Ω—ã ‚Üí "Find Car ID"
- False branch (–Ω–µ—Ç `price_id`) ‚Üí –º–∞—à–∏–Ω—ã ‚Üí "Save to Cars"

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –ø–æ –Ω–∞–ª–∏—á–∏—é `price_id`
- ‚úÖ –í—Å–µ –º–∞—à–∏–Ω—ã –∏–¥—É—Ç –≤ False branch
- ‚úÖ –í—Å–µ —Ü–µ–Ω—ã –∏–¥—É—Ç –≤ True branch

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 8. ‚úÖ –ù–æ–¥–∞ "Save to Cars"

**–§—É–Ω–∫—Ü–∏—è:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `cars` —á–µ—Ä–µ–∑ `dynamic_upsert_entity`

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT * FROM dynamic_upsert_entity(
  'cars'::TEXT,
  $1::TEXT,  -- rentprog_id
  $2::JSONB  -- data (–≤–µ—Å—å JSON –∏–∑ attrs)
);
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `rentprog_id`: `={{ $json.rentprog_id }}`
- `data`: `={{ $json.data ? JSON.stringify($json.data) : '{}' }}`

**–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity` –∏–º–µ–µ—Ç –∑–∞—â–∏—Ç—É (–º–∏–≥—Ä–∞—Ü–∏—è 0043):
  ```sql
  IF v_value_text IS NULL OR v_value_text = '' OR LOWER(TRIM(v_value_text)) = 'null' THEN
      CONTINUE;  -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º NULL, –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å—Ç—Ä–æ–∫—É "null"
  END IF;
  ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data` (JSONB)
- ‚úÖ –ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∑–∞—Ç–∏—Ä–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –°—Ç—Ä–æ–∫–∞ `"null"` –Ω–µ –∑–∞—Ç–∏—Ä–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

---

### 9. ‚úÖ –ù–æ–¥–∞ "Find Car ID"

**–§—É–Ω–∫—Ü–∏—è:** –ù–∞—Ö–æ–¥–∏—Ç `car_id` –ø–æ `rentprog_id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `cars`

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT c.id as car_id
FROM cars c
WHERE c.rentprog_id = '={{ $json.rentprog_id }}'
LIMIT 1
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—â–µ—Ç –º–∞—à–∏–Ω—É –≤ —Ç–∞–±–ª–∏—Ü–µ `cars`
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `car_id` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–Ω
- ‚ö†Ô∏è –ï—Å–ª–∏ –º–∞—à–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Ü–µ–Ω—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è (–Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç.–∫. –º–∞—à–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ "Save to Cars" —Ä–∞–Ω—å—à–µ)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 10. ‚úÖ –ù–æ–¥–∞ "Merge Car ID"

**–§—É–Ω–∫—Ü–∏—è:** –û–±—ä–µ–¥–∏–Ω—è–µ—Ç `car_id` —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ü–µ–Ω–∞—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –±–µ–∑ `car_id`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 11. ‚úÖ –ù–æ–¥–∞ "Format Price Values"

**–§—É–Ω–∫—Ü–∏—è:** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ü–µ–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ü–µ–Ω
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã `values || []`
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –±–µ–∑ `car_id`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 12. ‚úÖ –ù–æ–¥–∞ "Save Prices"

**–§—É–Ω–∫—Ü–∏—è:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ü–µ–Ω—ã –≤ `car_prices`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç upsert (–Ω–µ –∑–∞—Ç–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `car_id`, `rentprog_price_id`, `season_id`, `price_values`
- ‚úÖ Matching columns: `car_id`, `season_id`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 13. ‚úÖ –ù–æ–¥–∞ "Pass Through Data"

**–§—É–Ω–∫—Ü–∏—è:** –ü–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 14. ‚úÖ –ù–æ–¥–∞ "Format Result"

**–§—É–Ω–∫—Ü–∏—è:** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚úÖ –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –∏ –æ—à–∏–±–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 15. ‚úÖ –ù–æ–¥–∞ "If Error"

**–§—É–Ω–∫—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `error_count > 0`
- ‚úÖ –†–∞–∑–¥–µ–ª—è–µ—Ç –Ω–∞ True (–æ—à–∏–±–∫–∏) –∏ False (—É—Å–ø–µ—Ö)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 16. ‚úÖ –ù–æ–¥–∞ "Send Alert" / "Success"

**–§—É–Ω–∫—Ü–∏—è:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–ª–∏ –ª–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—Ö –≤ —Ç–∞–±–ª–∏—Ü—É `health`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## ‚ö†Ô∏è –ù–ê–ô–î–ï–ù–ù–´–ï –ò –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå ‚Üí ‚úÖ –°—Ç—Ä–æ–∫–∞ "null" –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∞—Å—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `"pts": "null"` (—Å—Ç—Ä–æ–∫–∞, –∞ –Ω–µ `null`)
- –§—É–Ω–∫—Ü–∏—è `safeValue` –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∞ —Å—Ç—Ä–æ–∫—É `"null"`
- –§—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity` –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∞ —Å—Ç—Ä–æ–∫—É `"null"`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `safeValue` –≤ –Ω–æ–¥–µ "Merge & Process":
   ```javascript
   if (value === undefined || value === null || value === '' || value === 'null') {
     return undefined;
   }
   ```

2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity` (–º–∏–≥—Ä–∞—Ü–∏—è 0043):
   ```sql
   IF v_value_text IS NULL OR v_value_text = '' OR LOWER(TRIM(v_value_text)) = 'null' THEN
       CONTINUE;
   END IF;
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°—Ç—Ä–æ–∫–∞ `"null"` —Ç–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø –í–°–ï–• –î–ê–ù–ù–´–•

### –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API:
- ‚úÖ –í—Å–µ –ø–æ–ª—è –∏–∑ `attributes` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data` (JSONB)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ (46 –ø–æ–ª–µ–π)
- ‚úÖ –¶–µ–Ω—ã –∏–∑ `included` –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `cars` —á–µ—Ä–µ–∑ `dynamic_upsert_entity`
- ‚úÖ –í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `data` (JSONB)
- ‚úÖ –¶–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `car_prices`
- ‚úÖ –°–≤—è–∑—å —á–µ—Ä–µ–∑ `external_refs`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ó–ê–©–ò–¢–´ –û–¢ –ü–£–°–¢–´–• –ó–ù–ê–ß–ï–ù–ò–ô

### –£—Ä–æ–≤–µ–Ω—å 1: JavaScript (–Ω–æ–¥–∞ "Merge & Process")
- ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç `undefined`
- ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç `null`
- ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ `''`
- ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É `"null"` (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### –£—Ä–æ–≤–µ–Ω—å 2: PostgreSQL (—Ñ—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity`)
- ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç `NULL`
- ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ `''`
- ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É `"null"` (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìã –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. ‚úÖ –í—Å–µ –Ω–æ–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. ‚úÖ –í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data` (JSONB)
3. ‚úÖ –í—Å–µ –º–∞—à–∏–Ω—ã –ø–∞—Ä—Å—è—Ç—Å—è (–Ω–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
4. ‚úÖ –í—Å–µ —Ü–µ–Ω—ã –ø–∞—Ä—Å—è—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
5. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
6. ‚úÖ –°—Ç—Ä–æ–∫–∞ `"null"` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:
1. ‚úÖ –§—É–Ω–∫—Ü–∏—è `safeValue` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É "null")
2. ‚úÖ –§—É–Ω–∫—Ü–∏—è `dynamic_upsert_entity` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–º–∏–≥—Ä–∞—Ü–∏—è 0043)
3. ‚úÖ –ù–æ–¥–∞ "Save Snapshot" —É–¥–∞–ª–µ–Ω–∞ (–Ω–µ –Ω—É–∂–Ω–∞, –¥–∞–≤–∞–ª–∞ –æ—à–∏–±–∫—É)

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**Workflow —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π!**

- ‚úÖ –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ç–∏—Ä–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –¥–≤—É—Ö —É—Ä–æ–≤–Ω—è—Ö
- ‚úÖ –í—Å–µ –º–∞—à–∏–Ω—ã –∏ —Ü–µ–Ω—ã –ø–∞—Ä—Å—è—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å workflow –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

