# –ö–æ–º–∞–Ω–¥—ã Telegram –±–æ—Ç–∞ Jarvis

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **External Refs Pattern** –¥–ª—è —Å–≤—è–∑–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ Telegram —Å RentProg:

```
employees (Jarvis)
    ‚Üï (—á–µ—Ä–µ–∑ tg_user_id)
Telegram User
    ‚Üï (–∫–æ–º–∞–Ω–¥–∞ /link_rentprog)
external_refs (system='rentprog', entity_type='employee')
    ‚Üï (—á–µ—Ä–µ–∑ entity_id)
RentProg Employee ID
```

### –¢–∞–±–ª–∏—Ü—ã

**employees** (–æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ Jarvis):
- `id` - UUID (primary key)
- `name` - –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- `tg_user_id` - Telegram User ID (nullable, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `tg_username` - Telegram username
- `role` - —Ä–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ
- `branch_id` - UUID —Ñ–∏–ª–∏–∞–ª–∞ (nullable)

**external_refs** (—Å–≤—è–∑–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏):
- `id` - BIGSERIAL (primary key)
- `system` - 'rentprog' | 'amocrm' | 'umnico'
- `entity_type` - 'employee' | 'car' | 'client' | 'booking'
- `entity_id` - UUID (—Å—Å—ã–ª–∫–∞ –Ω–∞ employees.id)
- `external_id` - ID –≤ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, RentProg employee ID)
- `data` - JSONB (–¥–æ–ø. –¥–∞–Ω–Ω—ã–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä –∏–º—è –∏–∑ RentProg)

---

## –õ–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### `/start` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ Jarvis

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `tg_user_id`
2. –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
3. –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `employees`:
   - `name` –±–µ—Ä–µ—Ç—Å—è –∏–∑ Telegram (first_name + last_name –∏–ª–∏ username)
   - `tg_user_id` = Telegram User ID
   - `tg_username` = Telegram username
   - `role` = 'employee' (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start

–ë–æ—Ç: 
üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É Jarvis!

üë§ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üÜî –í–∞—à ID: 123e4567-e89b-12d3-a456-426614174000

–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1Ô∏è‚É£ –°–≤—è–∂–∏—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç —Å RentProg:
   /link_rentprog <–≤–∞—à_RentProg_ID>

2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
   /myinfo

üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥
```

---

### `/link_rentprog <ID>` - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å RentProg

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤—è–∑—ã–≤–∞–Ω–∏–µ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞ —Å RentProg employee ID

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
- `<ID>` - RentProg employee ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, 14714)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Jarvis (–Ω–∞–ª–∏—á–∏–µ –≤ `employees`)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è RentProg ID –≤ `external_refs`
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ RentProg ID –Ω–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º RentProg ID
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `external_refs.entity_id` = `employees.id`

**–ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /link_rentprog 14714

–ë–æ—Ç:
‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–≤—è–∑–∞–Ω–æ!

üë§ Jarvis: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üîó RentProg: Ivane Ivanishvili (ID: 14714)

üéâ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:
‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞—à–∏—Ö –±—Ä–æ–Ω—è—Ö
‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /myinfo –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**

1. **–ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:**
```
‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ Jarvis

–°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥–æ–π:
/start
```

2. **RentProg ID –Ω–µ –Ω–∞–π–¥–µ–Ω:**
```
‚ùå –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å RentProg ID 14714 –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
‚Ä¢ –í–∞—Å –µ—â—ë –Ω–µ —É–ø–æ–º–∏–Ω–∞–ª–∏ –≤ –±—Ä–æ–Ω—è—Ö
‚Ä¢ –ù–µ–≤–µ—Ä–Ω—ã–π ID
‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –µ—â—ë –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å

üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
```

3. **ID —É–∂–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º:**
```
‚ö†Ô∏è –≠—Ç–æ—Ç RentProg ID —É–∂–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º: –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤

–ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
```

4. **–£–∂–µ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º ID:**
```
‚ö†Ô∏è –í—ã —É–∂–µ —Å–≤—è–∑–∞–Ω—ã —Å –¥—Ä—É–≥–∏–º RentProg –∞–∫–∫–∞—É–Ω—Ç–æ–º:
ID: 12345
–ò–º—è: Ivan Ivanov

–ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
```

---

### `/myinfo` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –î–∞–Ω–Ω—ã–µ –∏–∑ Jarvis (`employees`)
- –°–≤—è–∑—å —Å RentProg (—á–µ—Ä–µ–∑ `external_refs`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–≤ –±—É–¥—É—â–µ–º: –±—Ä–æ–Ω–∏, –∑–∞–¥–∞—á–∏)

**–ü—Ä–∏–º–µ—Ä (—Å–≤—è–∑–∞–Ω):**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /myinfo

–ë–æ—Ç:
üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å

Jarvis:
‚Ä¢ ID: 123e4567-e89b-12d3-a456-426614174000
‚Ä¢ –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
‚Ä¢ Telegram ID: 123456789
‚Ä¢ –†–æ–ª—å: employee
‚Ä¢ –§–∏–ª–∏–∞–ª ID: 456e7890-e89b-12d3-a456-426614174001
‚Ä¢ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: 05.11.2025

RentProg:
‚Ä¢ ‚úÖ –°–≤—è–∑–∞–Ω
‚Ä¢ ID: 14714
‚Ä¢ –ò–º—è: Ivane Ivanishvili

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
‚Ä¢ /myinfo - —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ /help - –ø–æ–º–æ—â—å
```

**–ü—Ä–∏–º–µ—Ä (–Ω–µ —Å–≤—è–∑–∞–Ω):**
```
üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å

Jarvis:
‚Ä¢ ID: 123e4567-e89b-12d3-a456-426614174000
‚Ä¢ –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
‚Ä¢ Telegram ID: 123456789
‚Ä¢ –†–æ–ª—å: employee
‚Ä¢ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: 05.11.2025

RentProg:
‚Ä¢ ‚ùå –ù–µ —Å–≤—è–∑–∞–Ω
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /link_rentprog –¥–ª—è —Å–≤—è–∑–∏

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
‚Ä¢ /myinfo - —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ /link_rentprog <ID> - —Å–≤—è–∑–∞—Ç—å —Å RentProg
‚Ä¢ /help - –ø–æ–º–æ—â—å
```

---

## –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### `/help` - –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

**–ü—Ä–∏–º–µ—Ä:**
```
üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

–õ–∏—á–Ω—ã–µ:
/start - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ
/myinfo - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å
/link_rentprog <ID> - –°–≤—è–∑–∞—Ç—å —Å RentProg –∞–∫–∫–∞—É–Ω—Ç–æ–º

–°–∏—Å—Ç–µ–º–∞:
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
/status - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
/sync_rentprog - –ü–µ—Ä–≤–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è RentProg

üí° –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (MVP).
```

### `/status` - –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –°—Ç–∞—Ç—É—Å –ë–î (Neon PostgreSQL)
- –°—Ç–∞—Ç—É—Å RentProg API (–ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–ª–∏–∞–ª—É)
- –°—Ç–∞—Ç—É—Å Umnico API
- –°—Ç–∞—Ç—É—Å Stripe API
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º

### `/sync_rentprog` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å RentProg

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç:**
- –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ (`/all_cars_full`)
- –ö–ª–∏–µ–Ω—Ç–æ–≤ (`/clients`)
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (`/all_bookings`)

**–ü–æ –≤—Å–µ–º —Ñ–∏–ª–∏–∞–ª–∞–º:**
- tbilisi
- batumi
- kutaisi
- service-center

---

## –õ–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ RentProg

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è RentProg employee ID

RentProg —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ **booking data** –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–µ–±—Ö—É–∫–æ–≤ –∏ snapshot —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ booking payload:**
1. `issue_employee_id` - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–¥–∞—á–∏
2. `return_employee_id` - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–∏–µ–º–∫–∏
3. `issue_employee_name` - –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤—ã–¥–∞—á–∏
4. `return_employee_name` - –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø—Ä–∏–µ–º–∫–∏

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ booking –∏–∑ RentProg (webhook –∏–ª–∏ snapshot)
2. –ò–∑–≤–ª–µ–∫–∞–µ–º `issue_employee_id` –∏ `return_employee_id`
3. –°–æ–∑–¥–∞–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∏—Å–∏ –≤ `external_refs`:
   ```sql
   INSERT INTO external_refs (
     system, entity_type, external_id, data
   ) VALUES (
     'rentprog', 'employee', '14714', 
     '{"name": "Ivane Ivanishvili"}'
   )
   ON CONFLICT (system, entity_type, external_id) 
   DO UPDATE SET data = EXCLUDED.data
   ```
4. `entity_id` = NULL (–ø–æ–∫–∞ –Ω–µ —Å–≤—è–∑–∞–Ω –∫–æ–º–∞–Ω–¥–æ–π `/link_rentprog`)

**–í–∞–∂–Ω–æ:**
- RentProg –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –ú—ã –∏–∑–≤–ª–µ–∫–∞–µ–º –∏—Ö –∫–æ—Å–≤–µ–Ω–Ω–æ –∏–∑ bookings
- –≠—Ç–æ –∑–Ω–∞—á–∏—Ç —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –±—É–¥–µ—Ç —É–ø–æ–º—è–Ω—É—Ç –≤ –±—Ä–æ–Ω–∏

---

## –§–ª–æ—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```
–°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí /start
Jarvis ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ employees
```

### –®–∞–≥ 2: –ü–µ—Ä–≤–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –±—Ä–æ–Ω–∏

```
RentProg ‚Üí webhook (booking —Å issue_employee_id = 14714)
n8n ‚Üí Jarvis API /process-event
Jarvis ‚Üí INSERT INTO external_refs (entity_id = NULL)
```

### –®–∞–≥ 3: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ

```
–°–æ—Ç—Ä—É–¥–Ω–∏–∫ ‚Üí /link_rentprog 14714
Jarvis ‚Üí UPDATE external_refs SET entity_id = employee.id WHERE external_id = '14714'
```

### –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±—Ä–æ–Ω—è—Ö –≥–¥–µ –æ–Ω —É–∫–∞–∑–∞–Ω –∫–∞–∫ `issue_employee` –∏–ª–∏ `return_employee`
- –ó–∞–¥–∞—á–∏ –ø–æ –¥–Ω–µ–≤–Ω–æ–º—É –ø–ª–∞–Ω—É
- –ê–ª–µ—Ä—Ç—ã –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

## SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ù–∞–π—Ç–∏ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```sql
SELECT 
  e.id,
  e.name AS jarvis_name,
  e.tg_user_id,
  e.tg_username,
  er.external_id AS rentprog_id,
  er.data->>'name' AS rentprog_name
FROM employees e
JOIN external_refs er ON er.entity_id = e.id
WHERE er.system = 'rentprog' 
  AND er.entity_type = 'employee'
ORDER BY e.name;
```

### –ù–∞–π—Ç–∏ –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö RentProg —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```sql
SELECT 
  external_id AS rentprog_id,
  data->>'name' AS rentprog_name,
  created_at
FROM external_refs
WHERE system = 'rentprog' 
  AND entity_type = 'employee'
  AND entity_id IS NULL
ORDER BY created_at DESC;
```

### –ù–∞–π—Ç–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–æ –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
SELECT 
  e.id,
  e.name,
  e.tg_user_id,
  e.tg_username,
  e.created_at
FROM employees e
WHERE e.tg_user_id IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM external_refs er
    WHERE er.entity_id = e.id
      AND er.system = 'rentprog'
      AND er.entity_type = 'employee'
  )
ORDER BY e.created_at DESC;
```

---

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –µ—Å–ª–∏:
- Telegram username —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º –≤ RentProg
- Fuzzy matching –ø–æ –∏–º–µ–Ω–∏/—Ñ–∞–º–∏–ª–∏–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞

- `admin` - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
- `manager` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–æ–º
- `employee` - –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –≤—ã–¥–∞—á/–ø—Ä–∏–µ–º–æ–∫
- –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

- `/mybookings` - –º–æ–∏ —Ç–µ–∫—É—â–∏–µ –±—Ä–æ–Ω–∏
- `/mytasks` - –º–æ–∏ –∑–∞–¥–∞—á–∏
- `/dailyplan` - –ø–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

