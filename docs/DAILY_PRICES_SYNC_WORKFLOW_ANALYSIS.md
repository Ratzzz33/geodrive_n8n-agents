# üîç –ê–Ω–∞–ª–∏–∑ workflow: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–µ–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏

**Workflow ID:** ihRLR0QCJySx319b  
**URL:** https://n8n.rentflow.rentals/workflow/ihRLR0QCJySx319b  
**–ù–∞–∑–≤–∞–Ω–∏–µ:** ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–µ–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π (RentProg) —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏  
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω (`active: false`)

---

## üìä –¢–ï–ö–£–©–ê–Ø –°–¢–†–£–ö–¢–£–†–ê WORKFLOW

### –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **Daily Trigger** (Schedule Trigger)
   - Cron: `"0 * * * *"` ‚ùå **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û** - –∫–∞–∂–¥—ã–π —á–∞—Å, –∞ –Ω–µ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏!

2. **4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–µ—Ç–∫–∏** (Tbilisi, Batumi, Kutaisi, Service Center):
   - Context ‚Üí Get Token ‚Üí Fetch Cars ‚Üí Wrap Cars

3. **Merge All Branches** - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤

4. **Normalize Cars** - –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–∞—à–∏–Ω

5. **Has Data?** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö

6. **Save Snapshot** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `rentprog_car_states_snapshot`

7. **Remove Price Values** - ‚ùå **–£–î–ê–õ–Ø–ï–¢ —Ü–µ–Ω—ã** –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ cars

8. **Save Cars** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–∞—à–∏–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—É `cars`

9. **Format Result** ‚Üí **If Error** ‚Üí **Send Alert** / **Success**

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–´

### 1. –¢—Ä–∏–≥–≥–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- **–¢–µ–∫—É—â–∏–π:** `"0 * * * *"` (–∫–∞–∂–¥—ã–π —á–∞—Å)
- **–ù—É–∂–Ω–æ:** `"0 2 * * *"` (—Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –≤ 2:00 –Ω–æ—á–∏)

### 2. –¶–µ–Ω—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –ù–æ–¥–∞ "Remove Price Values" **—É–¥–∞–ª—è–µ—Ç** –≤—Å–µ –ø–æ–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ü–µ–Ω–∞–º–∏:
  - `price_values`
  - `prices`
  - `seasons`
  - `price_periods`
- –ù–µ—Ç –Ω–æ–¥—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü—É `car_prices`

### 3. Workflow –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω
- `"active": false` - workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 4. API endpoint
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `all_cars_full` - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ –æ–Ω —Ü–µ–Ω—ã

---

## ‚úÖ –ß–¢–û –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨

### 1. –ò–∑–º–µ–Ω–∏—Ç—å cron –Ω–∞ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏
```javascript
"expression": "0 2 * * *"  // –í 2:00 –Ω–æ—á–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–Ω –∏–∑ API –æ—Ç–≤–µ—Ç–∞
- –í –Ω–æ–¥–µ "Normalize Cars" –Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å `included` (—Ü–µ–Ω—ã –∏ —Å–µ–∑–æ–Ω—ã)
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ü–µ–Ω

### 3. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–Ω
- –ü–æ—Å–ª–µ "Normalize Cars" –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É "Extract Prices"
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ü–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—É `car_prices` —á–µ—Ä–µ–∑ upsert

### 4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `active: true`

---

## üéØ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

1. ‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å cron expression –Ω–∞ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–Ω –≤ –Ω–æ–¥–µ "Normalize Cars"
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É "Extract Prices" –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –º–∞—à–∏–Ω –∏ —Ü–µ–Ω
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É "Save Prices" –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ `car_prices`
5. ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow

---

## üìã –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–• –ò–ó API

**–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ `all_cars_full`:**
```json
{
  "data": [...],  // –ú–∞—à–∏–Ω—ã
  "included": [   // –¶–µ–Ω—ã –∏ —Å–µ–∑–æ–Ω—ã
    {
      "id": "228003",
      "type": "price",
      "attributes": {
        "car_id": 59772,
        "season_id": 16694,
        "values": [151, 146, 140, 135, 116, 94]
      }
    },
    {
      "id": "16694",
      "type": "season",
      "attributes": {
        "id": 16694,
        "name": "–ù–∏–∑–∫–∏–π —Å–µ–∑–æ–Ω",
        "start_date": "2025-01-01",
        "end_date": "2025-03-31"
      }
    }
  ]
}
```

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å workflow —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É.

