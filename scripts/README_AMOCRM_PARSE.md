# –†—É—á–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ –∏–∑ AmoCRM

–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–¥–µ–ª–æ–∫ –∏–∑ AmoCRM –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Playwright Service –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   npm run dev:playwright
   # –∏–ª–∏
   npm run start:playwright
   ```

2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - `DATABASE_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (Neon)
   - `AMOCRM_PLAYWRIGHT_URL` - URL Playwright Service (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:3002`)
   - `AMOCRM_PIPELINE_ID` - ID –≤–æ—Ä–æ–Ω–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `8580102`)

## –ó–∞–ø—É—Å–∫

```bash
# –ß–µ—Ä–µ–∑ tsx (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
npx tsx scripts/amocrm-parse-all-deals.ts

# –ò–ª–∏ —á–µ—Ä–µ–∑ npm script (–µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ package.json)
npm run parse:amocrm:all
```

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–¥–µ–ª–∫–∏** –∏–∑ –≤–æ—Ä–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ Playwright Service API
2. **–î–ª—è –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏:**
   - –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (–∫–æ–Ω—Ç–∞–∫—Ç—ã, notes, scope_id)
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (—Ç–µ–ª–µ—Ñ–æ–Ω, email, RentProg IDs, custom fields)
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç upsert –≤ –ë–î:
     - –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
     - –î–æ–±–∞–≤–ª—è–µ—Ç external_refs –¥–ª—è AmoCRM –∏ RentProg
     - –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç conversation (–µ—Å–ª–∏ –µ—Å—Ç—å scope_id)
     - –ù–∞—Ö–æ–¥–∏—Ç booking –∏ car –ø–æ RentProg IDs
     - Upsert —Å–¥–µ–ª–∫–∏ —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏
   - –í—Å—Ç–∞–≤–ª—è–µ—Ç notes –∫–∞–∫ messages –≤ —Ç–∞–±–ª–∏—Ü—É `messages`
3. **–í—ã–≤–æ–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å** –≤ –∫–æ–Ω—Å–æ–ª—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. **–û–±–Ω–æ–≤–ª—è–µ—Ç sync_state** –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

## –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```
[1/150] (0.7%) –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Å–¥–µ–ª–∫—É #12345...
```

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
```
‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: 150
   –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 148
   –û—à–∏–±–æ–∫: 2
   Notes –≤—Å—Ç–∞–≤–ª–µ–Ω–æ: 342

üíæ Sync state –æ–±–Ω–æ–≤–ª–µ–Ω
```

## –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:
- –í—Å–µ —Å–¥–µ–ª–∫–∏ –±—É–¥—É—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `amocrm_deals`
- –ö–ª–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ `external_refs`
- Notes –±—É–¥—É—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `messages` –¥–ª—è RAG
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å workflow `amocrm-all-deals-parser` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## Troubleshooting

### –û—à–∏–±–∫–∞: "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–¥–µ–ª–æ–∫: 500"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Playwright Service –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ AmoCRM

### –û—à–∏–±–∫–∞: "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –°–∫—Ä–∏–ø—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É 200ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–¥–µ–ª–æ–∫ —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è
- –ú–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ rate limiting

