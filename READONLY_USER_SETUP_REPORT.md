# üìä –û—Ç—á–µ—Ç –æ —Å–æ–∑–¥–∞–Ω–∏–∏ READ-ONLY –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–∞—Ç–∞:** 2025-11-08  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω read-only –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î

- **Username:** `bot_readonly`
- **Password:** `qNMSE5wAiPKRDYxJ719DeX9nm6Y4xWr1` (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- **–ü—Ä–∞–≤–∞:** SELECT –Ω–∞ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ö–µ–º—ã `public`
- **–ó–∞–ø—Ä–µ—Ç—ã:** INSERT, UPDATE, DELETE, DROP, CREATE, ALTER

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

‚úÖ **SELECT** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚ùå **INSERT** - –∑–∞–ø—Ä–µ—â–µ–Ω (permission denied)  
‚ùå **UPDATE** - –∑–∞–ø—Ä–µ—â–µ–Ω (permission denied)  
‚ùå **DELETE** - –∑–∞–ø—Ä–µ—â–µ–Ω (permission denied)

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ü—Ä–æ—á–∏—Ç–∞–Ω–æ 3 —Ñ–∏–ª–∏–∞–ª–∞
- –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ 134 –º–∞—à–∏–Ω–∞—Ö
- –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

### 3. –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `docs/EXTERNAL_BOT_DATABASE_ACCESS.md` | üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ |
| `READONLY_USER_CREDENTIALS.md` | üîê –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ credentials (**–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!**) |
| `setup/create_readonly_user.mjs` | üõ†Ô∏è –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `setup/test_readonly_user.mjs` | üß™ –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤ |

---

## üîó Connection String –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –±–æ—Ç–∞

```
postgresql://bot_readonly:qNMSE5wAiPKRDYxJ719DeX9nm6Y4xWr1@ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require
```

**‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!**

---

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –±–æ—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

1. **`branches`** - –§–∏–ª–∏–∞–ª—ã (4 —à—Ç—É–∫–∏)
   - `code`: 'tbilisi' | 'batumi' | 'kutaisi' | 'service-center'
   - `name`: –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–∞

2. **`cars`** - –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ (134 –º–∞—à–∏–Ω—ã)
   - `state = 1` - –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∞—Ä–µ–Ω–¥—ã
   - `branch_id` - —Å–≤—è–∑—å —Å —Ñ–∏–ª–∏–∞–ª–æ–º
   - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: –º–æ–¥–µ–ª—å, –≥–æ–¥, –∫–æ—Ä–æ–±–∫–∞, —Ç–æ–ø–ª–∏–≤–æ –∏ —Ç.–¥.

3. **`car_prices`** - –¶–µ–Ω—ã
   - `price_values` (JSONB) - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Ü–µ–Ω–∞–º–∏ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
   - –í–∞–ª—é—Ç–∞: GEL (–∫—É—Ä—Å –∫ USD: 2.7)

4. **`bookings`** - –ë—Ä–æ–Ω–∏
   - `status`: 'active' | 'confirmed' | 'in_rent' = –∑–∞–Ω—è—Ç–∞
   - `start_at`, `end_at` - –¥–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã

---

## üíª –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### Node.js (–±–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç)

```javascript
import pg from 'pg';

const client = new pg.Client({
  connectionString: 'postgresql://bot_readonly:qNMSE5wAiPKRDYxJ719DeX9nm6Y4xWr1@ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require',
  ssl: { rejectUnauthorized: false }
});

await client.connect();

// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª–∏–∞–ª–æ–≤
const branches = await client.query('SELECT code, name FROM branches');
console.log('–§–∏–ª–∏–∞–ª—ã:', branches.rows);

// –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—à–∏–Ω—ã –¢–±–∏–ª–∏—Å–∏
const cars = await client.query(`
  SELECT c.model, c.plate, c.year
  FROM cars c
  JOIN branches b ON b.id = c.branch_id
  WHERE b.code = 'tbilisi' AND c.state = 1
  LIMIT 5
`);
console.log('–ú–∞—à–∏–Ω—ã:', cars.rows);

await client.end();
```

### Python (–±–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç)

```python
import psycopg2

conn = psycopg2.connect(
    "postgresql://bot_readonly:qNMSE5wAiPKRDYxJ719DeX9nm6Y4xWr1@ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require"
)
cur = conn.cursor()

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª–∏–∞–ª–æ–≤
cur.execute("SELECT code, name FROM branches")
print("–§–∏–ª–∏–∞–ª—ã:", cur.fetchall())

# –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—à–∏–Ω—ã
cur.execute("""
    SELECT c.model, c.plate, c.year
    FROM cars c
    JOIN branches b ON b.id = c.branch_id
    WHERE b.code = 'tbilisi' AND c.state = 1
    LIMIT 5
""")
print("–ú–∞—à–∏–Ω—ã:", cur.fetchall())

conn.close()
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:

‚úÖ **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ  
‚úÖ **–û—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å** - –Ω–µ —Å–≤—è–∑–∞–Ω —Å –æ—Å–Ω–æ–≤–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º  
‚úÖ **–ê—É–¥–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤** - –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é  
‚úÖ **–õ–µ–≥–∫–æ –æ—Ç–æ–∑–≤–∞—Ç—å** - –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É

### –ß—Ç–æ –ù–ï –∑–∞—â–∏—â–µ–Ω–æ:

‚ö†Ô∏è **Connection string —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–æ–ª—å** - —Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö  
‚ö†Ô∏è **–î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º** - –≤–∫–ª—é—á–∞—è –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤  
‚ö†Ô∏è **–ù–µ—Ç rate limiting** - –º–æ–∂–Ω–æ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å –ë–î —á–∞—Å—Ç—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. üîê –•—Ä–∞–Ω–∏—Ç–µ connection string –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ –∫–æ–¥–µ!)
2. üìä –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ connection pooling –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. ‚ö° –î–æ–±–∞–≤—å—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (Redis)
4. üö¶ –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞
5. üìù –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞—É–¥–∏—Ç–∞

---

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### –û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å admin credentials
node setup/revoke_readonly_access.mjs
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL:

```sql
DROP USER bot_readonly;
```

### –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å

```sql
ALTER USER bot_readonly WITH PASSWORD '–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å';
```

---

## üìû –ß—Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å—Ç–æ—Ä–æ–Ω–Ω–µ–º—É –±–æ—Ç—É

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:

1. ‚úÖ **Connection String** (–∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞)
2. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`docs/EXTERNAL_BOT_DATABASE_ACCESS.md`)
3. ‚úÖ **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤** (–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–ø–æ –∑–∞–ø—Ä–æ—Å—É):

- –°—Ö–µ–º–∞ –ë–î (ERD –¥–∏–∞–≥—Ä–∞–º–º–∞)
- –ì–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –º–∞—à–∏–Ω
- –ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ `price_values` (JSONB)
- Session ID —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–∞—Ç–æ–≤

---

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –±–æ—Ç–∞:

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Ñ–∏–ª–∏–∞–ª—ã, –º–∞—à–∏–Ω—ã)
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ –¥–∞—Ç–∞–º
4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ —Ü–µ–Ω
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è –Ω–∞—Å:

1. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–î
2. ‚úÖ –°–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∑–∞–ø—Ä–æ—Å–æ–≤
3. ‚úÖ –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
4. ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å

---

## üéØ –ì–æ—Ç–æ–≤—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

### 1. –°–ø–∏—Å–æ–∫ —Ñ–∏–ª–∏–∞–ª–æ–≤
```sql
SELECT code, name FROM branches ORDER BY code;
```

### 2. –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—à–∏–Ω—ã —Ñ–∏–ª–∏–∞–ª–∞
```sql
SELECT c.model, c.plate, c.year, c.transmission
FROM cars c
JOIN branches b ON b.id = c.branch_id
WHERE b.code = 'tbilisi' AND c.state = 1;
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –º–∞—à–∏–Ω—ã
```sql
SELECT COUNT(*) 
FROM bookings
WHERE car_id = 'uuid_–º–∞—à–∏–Ω—ã'
  AND status IN ('active', 'confirmed', 'in_rent')
  AND start_at <= '2025-11-15T12:00:00+04:00'
  AND end_at >= '2025-11-09T12:00:00+04:00';
```

### 4. –¶–µ–Ω—ã –º–∞—à–∏–Ω—ã
```sql
SELECT price_values
FROM car_prices
WHERE car_id = 'uuid_–º–∞—à–∏–Ω—ã'
ORDER BY season_id
LIMIT 1;
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω
- [x] –ü—Ä–∞–≤–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- [x] Connection string —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
- [x] –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
- [x] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- [x] .gitignore –æ–±–Ω–æ–≤–ª–µ–Ω (credentials –Ω–µ –±—É–¥—É—Ç –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-08  
**–ê–≤—Ç–æ—Ä:** GeoDrive AI Agent

