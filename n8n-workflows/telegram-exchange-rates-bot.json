{
  "name": "Telegram Exchange Rates Bot with AI Agent",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"]
      },
      "id": "telegram-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [240, 300],
      "webhookId": "telegram-exchange-bot",
      "credentials": {
        "telegramApi": {
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const message = $json.message;\nconst chatId = message.chat.id;\nconst text = message.text || '';\nconst username = message.from.username || message.from.first_name || 'Unknown';\n\nconsole.log(`Message from ${username}: ${text}`);\n\nif (text === '/start') {\n  return [{\n    json: {\n      chatId,\n      response: 'üí± –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∫—É—Ä—Å–∞–º –≤–∞–ª—é—Ç RentProg.\\n\\n–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è:\\n- –ö–∞–∫–æ–π –∫—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞?\\n- –ü–æ–∫–∞–∂–∏ –∫—É—Ä—Å—ã –ø–æ –≤—Å–µ–º —Ñ–∏–ª–∏–∞–ª–∞–º\\n- –ö–∞–∫–æ–π –±—ã–ª –∫—É—Ä—Å –µ–≤—Ä–æ –≤—á–µ—Ä–∞?',\n      isCommand: true\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    chatId,\n    text,\n    username,\n    isCommand: false\n  }\n}];"
      },
      "id": "process-message",
      "name": "Process Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "is-command",
              "leftValue": "={{ $json.isCommand }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-command",
      "name": "Is Command?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [640, 300]
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∫—É—Ä—Å–∞–º –≤–∞–ª—é—Ç –≤ —Å–∏—Å—Ç–µ–º–µ RentProg.\n\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞:\n1. –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∫—É—Ä—Å–∞—Ö –≤–∞–ª—é—Ç (GEL, USD, EUR, RUB)\n2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Query Exchange Rates –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î\n3. –î–∞–≤–∞—Ç—å —á–µ—Ç–∫–∏–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ\n\n–§–∏–ª–∏–∞–ª—ã: tbilisi, batumi, kutaisi, service-center\n\n–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:\n- –ö–∞–∫–æ–π –∫—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ —Å–µ–π—á–∞—Å?\n- –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –µ–≤—Ä–æ –≤ —Ç–±–∏–ª–∏—Å–∏?\n- –ü–æ–∫–∞–∂–∏ –∫—É—Ä—Å—ã –ø–æ –≤—Å–µ–º —Ñ–∏–ª–∏–∞–ª–∞–º\n- –ö–∞–∫–æ–π –±—ã–ª –∫—É—Ä—Å —Ä—É–±–ª—è –≤—á–µ—Ä–∞?\n\n–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:\n- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ üí± –¥–ª—è –∫—É—Ä—Å–æ–≤\n- –û–∫—Ä—É–≥–ª—è–π –¥–æ 4 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π\n- –£–∫–∞–∑—ã–≤–∞–π –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –æ–±—ä—è—Å–Ω–∏ –ø–æ—á–µ–º—É"
        }
      },
      "id": "ai-agent",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [840, 180]
    },
    {
      "parameters": {
        "name": "Query Exchange Rates",
        "description": "–ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö",
        "workflowId": {
          "__rl": true,
          "value": "CsiMxujfHQZvB8b4",
          "mode": "id"
        },
        "toolDescription": "–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç (GEL, USD, EUR, RUB) –¥–ª—è —Ñ–∏–ª–∏–∞–ª–æ–≤ RentProg. –¢—ã –û–ë–Ø–ó–ê–ù –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ª—é–±–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –æ –∫—É—Ä—Å–∞—Ö.",
        "fields": {
          "values": [
            {
              "name": "branch",
              "type": "string",
              "description": "–§–∏–ª–∏–∞–ª (tbilisi/batumi/kutaisi/service-center) –∏–ª–∏ all –¥–ª—è –≤—Å–µ—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: tbilisi"
            },
            {
              "name": "date",
              "type": "string",
              "description": "–î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ - –≤–µ—Ä–Ω–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ"
            }
          ]
        }
      },
      "id": "tool-query-rates",
      "name": "Tool: Query Exchange Rates",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [1080, 360]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "id": "openai-model",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [680, 400],
      "credentials": {
        "openAiApi": {
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": {
          "__rl": true,
          "value": "={{ $('Process Message').item.json.chatId }}",
          "mode": "expression"
        },
        "text": "={{ $json.output || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.' }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "send-response",
      "name": "Send Response",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1040, 180],
      "credentials": {
        "telegramApi": {
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": {
          "__rl": true,
          "value": "={{ $json.chatId }}",
          "mode": "expression"
        },
        "text": "={{ $json.response }}",
        "additionalFields": {}
      },
      "id": "send-command-response",
      "name": "Send Command Response",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [840, 400],
      "credentials": {
        "telegramApi": {
          "name": "Telegram account"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Process Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Message": {
      "main": [
        [
          {
            "node": "Is Command?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Command?": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Command Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Query Exchange Rates": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Tbilisi",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "executionTimeout": 3600,
    "errorWorkflow": "H3UBEp425F5SMyrX"
  }
}

