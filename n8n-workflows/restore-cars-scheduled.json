{
  "name": "Restore Cars from RentProg (Scheduled)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 8,11,14,17,20,23 * * *"
            }
          ]
        },
        "timezone": "Asia/Tbilisi"
      },
      "id": "schedule-trigger",
      "name": "Every 3 hours (8-23)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        250,
        300
      ]
    },
    {
      "parameters": {
        "url": "http://localhost:3000/restore-cars",
        "method": "POST",
        "options": {
          "timeout": 600000
        }
      },
      "id": "call-jarvis-api",
      "name": "Call Jarvis API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        450,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –¥–ª—è Telegram\nconst response = $input.first().json;\n\nif (!response || !response.ok) {\n  const errorMsg = response?.error || 'Unknown error';\n  return [{\n    json: {\n      alertText: `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞—à–∏–Ω:\\n\\n${errorMsg}\\n\\nüïê ${new Date().toLocaleString('ru-RU', { timeZone: 'Asia/Tbilisi' })}`\n    }\n  }];\n}\n\nconst { stats, branches } = response;\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ\nconst lines = [\n  'üöÄ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–∞—à–∏–Ω –∏–∑ RentProg API',\n  '',\n  'üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê',\n  '‚îÅ'.repeat(30),\n  `–í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –º–∞—à–∏–Ω: ${stats.totalCars}`,\n  `–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö: ${stats.inserted}`,\n  `–û–±–Ω–æ–≤–ª–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö: ${stats.updated}`,\n  `–ü—Ä–æ–ø—É—â–µ–Ω–æ (—Ñ–µ–π–∫–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞): ${stats.skipped}`,\n  '',\n  'üìã –ü–æ —Ñ–∏–ª–∏–∞–ª–∞–º:',\n  ''\n];\n\n// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º\nif (branches && branches.length > 0) {\n  for (const branch of branches) {\n    const branchName = branch.branch.charAt(0).toUpperCase() + branch.branch.slice(1);\n    lines.push(`${branchName}:`);\n    lines.push(`  –í—Å–µ–≥–æ –º–∞—à–∏–Ω: ${branch.total}`);\n    lines.push(`  –î–æ–±–∞–≤–ª–µ–Ω–æ: ${branch.inserted}`);\n    lines.push(`  –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${branch.updated}`);\n    lines.push(`  –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${branch.skipped}`);\n    if (branch.error) {\n      lines.push(`  ‚ùå –û—à–∏–±–∫–∞: ${branch.error}`);\n    }\n    lines.push('');\n  }\n}\n\nlines.push('‚îÅ'.repeat(30));\nlines.push(`üïê ${new Date().toLocaleString('ru-RU', { timeZone: 'Asia/Tbilisi' })}`);\n\nreturn [{\n  json: {\n    alertText: lines.join('\\n')\n  }\n}];"
      },
      "id": "format-report",
      "name": "Format Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        650,
        300
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $env.TELEGRAM_ALERT_CHAT_ID }}",
        "text": "={{ $json.alertText }}",
        "parseMode": "Markdown"
      },
      "id": "send-telegram",
      "name": "Send Telegram Alert",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        850,
        300
      ],
      "credentials": {
        "telegramApi": {
          "id": "1",
          "name": "Telegram Bot API"
        }
      }
    }
  ],
  "connections": {
    "Every 3 hours (8-23)": {
      "main": [
        [
          {
            "node": "Call Jarvis API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Jarvis API": {
      "main": [
        [
          {
            "node": "Format Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report": {
      "main": [
        [
          {
            "node": "Send Telegram Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Tbilisi",
    "saveExecutionProgress": true
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-10T12:00:00.000Z",
  "versionId": "1"
}