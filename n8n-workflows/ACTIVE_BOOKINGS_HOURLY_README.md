# –ü–∞—Ä—Å–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π —Ä–∞–∑ –≤ —á–∞—Å

**Workflow ID:** `vHDj7oRQ2rTJE2x5`  
**–°—Ç–∞—Ç—É—Å:** –°–æ–∑–¥–∞–Ω, –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω  
**–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–π —á–∞—Å

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤ RentProg —á–µ—Ä–µ–∑ Jarvis API –∫–∞–∂–¥—ã–π —á–∞—Å. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç endpoint `/sync-bookings`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î.

---

## üîÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow

### 1. **–ö–∞–∂–¥—ã–π —á–∞—Å** (Schedule Trigger)
- **–¢–∏–ø:** `n8n-nodes-base.scheduleTrigger`
- **–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–π —á–∞—Å
- **Timezone:** `Asia/Tbilisi`
- **–ó–∞–º–µ—Ç–∫–∞:** –¢—Ä–∏–≥–≥–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç workflow –∫–∞–∂–¥—ã–π —á–∞—Å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

### 2. **–í—ã–∑–æ–≤ Jarvis API** (HTTP Request)
- **–¢–∏–ø:** `n8n-nodes-base.httpRequest`
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `{{ $env.ORCHESTRATOR_URL || 'http://46.224.17.15:3000' }}/sync-bookings`
- **Timeout:** 3600000 –º—Å (1 —á–∞—Å)
- **–ó–∞–º–µ—Ç–∫–∞:** –í—ã–∑—ã–≤–∞–µ—Ç Jarvis API endpoint `/sync-bookings` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö) –∏–∑ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤ RentProg. Endpoint –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î.

### 3. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞** (Code)
- **–¢–∏–ø:** `n8n-nodes-base.code`
- **–ó–∞–º–µ—Ç–∫–∞:** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç Jarvis API –≤ —á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á–µ—Ç –¥–ª—è Telegram. –í–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º –∏ –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

**–§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞:**
```
üìä –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ë–†–û–ù–ò–†–û–í–ê–ù–ò–ô
–í—Ä–µ–º—è: [timestamp]

‚úÖ –°—Ç–∞—Ç—É—Å: –£—Å–ø–µ—à–Ω–æ
üì¶ –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: [total] –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
‚ûï –°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö: [created]
üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ: [updated]
‚ùå –û—à–∏–±–æ–∫: [errors]

üìã –ü–æ —Ñ–∏–ª–∏–∞–ª–∞–º:
‚úÖ TBILISI: [total] (—Å–æ–∑–¥–∞–Ω–æ: [created], –æ–±–Ω–æ–≤–ª–µ–Ω–æ: [updated], –æ—à–∏–±–æ–∫: [errors])
...
```

### 4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫** (IF)
- **–¢–∏–ø:** `n8n-nodes-base.if`
- **–£—Å–ª–æ–≤–∏–µ:** `errors > 0`
- **–ó–∞–º–µ—Ç–∫–∞:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —á–∞—Ç –∞–ª–µ—Ä—Ç–æ–≤, –∏–Ω–∞—á–µ - —Ç–æ–ª—å–∫–æ –≤ –æ–±—ã—á–Ω—ã–π —á–∞—Ç.

### 5. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç –∞–ª–µ—Ä—Ç–æ–≤** (Telegram)
- **–¢–∏–ø:** `n8n-nodes-base.telegram`
- **Chat ID:** `{{ $env.TELEGRAM_ALERT_CHAT_ID || '-5004140602' }}`
- **Credentials:** `Telegram Alert Bot`
- **–ó–∞–º–µ—Ç–∫–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç –≤ —á–∞—Ç –∞–ª–µ—Ä—Ç–æ–≤, –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

### 6. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç** (Telegram)
- **–¢–∏–ø:** `n8n-nodes-base.telegram`
- **Chat ID:** `{{ $env.TELEGRAM_ALERT_CHAT_ID || '-5004140602' }}`
- **Credentials:** `Telegram Alert Bot`
- **–ó–∞–º–µ—Ç–∫–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç –æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ Telegram. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞–ª–∏—á–∏—è –æ—à–∏–±–æ–∫.

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `ORCHESTRATOR_URL` - URL Jarvis API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://46.224.17.15:3000`)
- `TELEGRAM_ALERT_CHAT_ID` - ID —á–∞—Ç–∞ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `-5004140602`)

### Credentials

- **Telegram Alert Bot** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ n8n Credentials

---

## üîß –ê–∫—Ç–∏–≤–∞—Ü–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n: `https://n8n.rentflow.rentals/workflow/vHDj7oRQ2rTJE2x5`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∑–ª–æ–≤
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ credentials –¥–ª—è Telegram –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
4. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É)

---

## üìä –ß—Ç–æ –¥–µ–ª–∞–µ—Ç endpoint `/sync-bookings`

1. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** –∏–∑ –≤—Å–µ—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤ RentProg:
   - Tbilisi
   - Batumi
   - Kutaisi
   - Service Center

2. **–°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:
   - API `/all_bookings` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ 10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –ø–æ–∫–∞ –ø–æ–ª—É—á–∞–µ–º 10 –∑–∞–ø–∏—Å–µ–π
   - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ < 10 –∑–∞–ø–∏—Å–µ–π

3. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î** —á–µ—Ä–µ–∑ upsert:
   - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ FK constraint (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)

4. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—á–µ—Ç**:
   - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å–æ–∑–¥–∞–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ/–æ—à–∏–±–æ–∫)
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–ª–∏–∞–ª—É

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Timeout:** Workflow –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ timeout 1 —á–∞—Å, —Ç–∞–∫ –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π)

2. **–õ–∏–º–∏—Ç—ã RentProg API:** Endpoint `/sync-bookings` —É—á–∏—Ç—ã–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã:
   - –ó–∞–¥–µ—Ä–∂–∫–∞ 1.5 —Å–µ–∫ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (40 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ~33% –æ—Ç –ª–∏–º–∏—Ç–∞ RentProg, –æ—Å—Ç–∞–≤–ª—è—è 66% –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö FK constraint —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ RentProg API

4. **–ß–∞—Å—Ç–æ—Ç–∞:** Workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ —É–∑–ª–µ "–ö–∞–∂–¥—ã–π —á–∞—Å"

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/api/routes/syncBookings.ts` - Endpoint `/sync-bookings` –≤ Jarvis API
- `src/integrations/rentprog.ts` - –õ–æ–≥–∏–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å RentProg API
- `src/db/upsert.ts` - –õ–æ–≥–∏–∫–∞ upsert –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –≤ –ë–î

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 10.11.2025  
**–ê–≤—Ç–æ—Ä:** Cursor Agent

