# ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: Umnico & AmoCRM Workflows - –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

**–î–∞—Ç–∞:** 2025-11-09  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã  
**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~3 —á–∞—Å–∞

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–°–æ–∑–¥–∞–Ω–∞ **–ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö** –∏–∑ Umnico (—á–∞—Ç—ã) –∏ AmoCRM (—Å–¥–µ–ª–∫–∏) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö Playwright –±—Ä–∞—É–∑–µ—Ä–æ–≤** –∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π**.

---

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–§–∞–π–ª:** `sql/conversations_schema.sql`

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `conversations` - –¥–∏–∞–ª–æ–≥–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (umnico_conversation_id, amocrm_scope_id)
- `messages` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (whatsapp + amocrm_note)
- `amocrm_deals` - —Å–¥–µ–ª–∫–∏ AmoCRM (—É—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ)
- `amocrm_contacts` - –∫–æ–Ω—Ç–∞–∫—Ç—ã AmoCRM
- `sync_state` - —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ workflows

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `clients` (+telegram_username, +email, +updated_at)

**–ò–Ω–¥–µ–∫—Å—ã:**
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ vector embeddings (–¥–ª—è –±—É–¥—É—â–µ–≥–æ RAG)

---

### 2. ‚úÖ Playwright Service –¥–ª—è Umnico

**–§–∞–π–ª—ã:**
- `services/playwright-umnico.ts` - TypeScript —Å–µ—Ä–≤–∏—Å
- `services/Dockerfile.umnico` - Docker –æ–±—Ä–∞–∑

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –≤ —Ñ–∞–π–ª (`/data/umnico-session.json`)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π re-login –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω –ø—Ä–æ–≤–µ—Ä–∫–∞)
- ‚úÖ HTTP API –Ω–∞ –ø–æ—Ä—Ç—É 3001
- ‚úÖ Health check endpoint

**API:**
```http
GET  /health
GET  /api/conversations?limit=50
GET  /api/conversations/:id/messages
POST /api/relogin
```

---

### 3. ‚úÖ Playwright Service –¥–ª—è AmoCRM

**–§–∞–π–ª—ã:**
- `services/playwright-amocrm.ts` - TypeScript —Å–µ—Ä–≤–∏—Å
- `services/Dockerfile.amocrm` - Docker –æ–±—Ä–∞–∑

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –≤ —Ñ–∞–π–ª (`/data/amocrm-session.json`)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π re-login –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- ‚úÖ HTTP API –Ω–∞ –ø–æ—Ä—Ç—É 3002 + REST API —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—É—é —Å–µ—Å—Å–∏—é
- ‚úÖ Health check endpoint

**API:**
```http
GET  /health
GET  /api/pipelines/:id
GET  /api/deals?pipeline_id=8580102&status_id=142
GET  /api/deals/:id
GET  /api/deals/:id/notes
GET  /api/inbox
POST /api/relogin
```

---

### 4. ‚úÖ n8n Workflow: Umnico Chat Scraper

**–§–∞–π–ª:** `n8n-workflows/umnico-chat-scraper.json`

**–¢—Ä–∏–≥–≥–µ—Ä:** Cron (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–æ–ª—É—á–∏—Ç—å last_check timestamp –∏–∑ –ë–î
2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ –∏–∑ Playwright Service
3. –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞:
   - –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
   - Upsert –∫–ª–∏–µ–Ω—Ç–∞ (–ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É)
   - –î–æ–±–∞–≤–∏—Ç—å external_ref (umnico)
   - Upsert –¥–∏–∞–ª–æ–≥
   - Batch insert —Å–æ–æ–±—â–µ–Ω–∏–π
5. –û–±–Ω–æ–≤–∏—Ç—å sync_state

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- Incremental updates (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ external_refs

---

### 5. ‚úÖ n8n Workflow: AmoCRM Deals Scraper

**–§–∞–π–ª:** `n8n-workflows/amocrm-deals-scraper.json`

**–¢—Ä–∏–≥–≥–µ—Ä:** Cron (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–æ–ª—É—á–∏—Ç—å last_sync timestamp –∏–∑ –ë–î
2. –ü–æ–ª—É—á–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (status 142)
3. –ü–æ–ª—É—á–∏—Ç—å –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (status 143)
4. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–±–∞ —Å–ø–∏—Å–∫–∞
5. –î–ª—è –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏:
   - –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ (—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏)
   - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏—è (notes)
   - –ò–∑–≤–ª–µ—á—å custom fields (rentprog_client_id, rentprog_booking_id)
   - Upsert –∫–ª–∏–µ–Ω—Ç–∞ (–ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É)
   - –î–æ–±–∞–≤–∏—Ç—å external_refs (amocrm + rentprog)
   - Upsert —Å–¥–µ–ª–∫—É
   - Insert notes –∫–∞–∫ messages (–¥–ª—è RAG)
6. –û–±–Ω–æ–≤–∏—Ç—å sync_state

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- –°–±–æ—Ä —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- –ü–æ–ª–Ω–∞—è —Å–≤—è–∑—å: AmoCRM ‚Üî RentProg —á–µ—Ä–µ–∑ external_refs

---

### 6. ‚úÖ Docker Compose

**–§–∞–π–ª:** `docker-compose.yml` (–æ–±–Ω–æ–≤–ª–µ–Ω)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```yaml
playwright-umnico:
  - –ü–æ—Ä—Ç: 3001
  - –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫: restart: unless-stopped
  - Health check: –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
  - Volume: playwright_umnico_data (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏)

playwright-amocrm:
  - –ü–æ—Ä—Ç: 3002
  - –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫: restart: unless-stopped
  - Health check: –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
  - Volume: playwright_amocrm_data (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏)
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- n8n –∑–∞–≤–∏—Å–∏—Ç –æ—Ç playwright-umnico –∏ playwright-amocrm
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏: n8n-network

---

### 7. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

**–§–∞–π–ª—ã:**
- `services/package.json` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (express, playwright)
- `services/tsconfig.json` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript

---

### 8. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

1. **`docs/WORKFLOWS_SPEC.md`** (42 —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
   - –ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - API endpoints —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
   - SQL –∑–∞–ø—Ä–æ—Å—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
   - Troubleshooting guide

2. **`docs/QUICKSTART_WORKFLOWS.md`** (15 —Å—Ç—Ä–∞–Ω–∏—Ü)
   - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
   - –ß–µ–∫–ª–∏—Å—Ç—ã –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
   - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã
   - Troubleshooting

3. **`docs/WORKFLOWS_README.md`** (12 —Å—Ç—Ä–∞–Ω–∏—Ü)
   - –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
   - API endpoints
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

4. **`WORKFLOWS_IMPLEMENTATION_SUMMARY.md`** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
   - –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Docker Compose                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  Playwright Umnico (:3001) ‚Üê‚îÄ‚îê                          ‚îÇ
‚îÇ  - Persistent browser         ‚îÇ                          ‚îÇ
‚îÇ  - Auto-login                 ‚îÇ                          ‚îÇ
‚îÇ  - Session save/restore       ‚îÇ                          ‚îÇ
‚îÇ                               ‚îú‚Üí HTTP API                ‚îÇ
‚îÇ  Playwright AmoCRM (:3002) ‚Üê‚îÄ‚îò                          ‚îÇ
‚îÇ  - Persistent browser                                    ‚îÇ
‚îÇ  - Auto-login                                            ‚îÇ
‚îÇ  - Session save/restore                                  ‚îÇ
‚îÇ                               ‚Üì                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ           n8n :5678                       ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ                                           ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  Umnico Chat Scraper (every 5 min)      ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  AmoCRM Deals Scraper (every 30 min)    ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                 ‚îÇ                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚Üì
         Neon PostgreSQL (Cloud)
         - conversations
         - messages
         - amocrm_deals
         - clients
         - external_refs
```

---

## üîó –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (External Refs Pattern)

```
Client UUID
    ‚Üì
‚îú‚îÄ external_refs: system='umnico',   external_id='+995599001665'
‚îú‚îÄ external_refs: system='amocrm',   external_id='38638793'
‚îî‚îÄ external_refs: system='rentprog', external_id='12345'
    ‚Üì
conversations (umnico_conversation_id='61965921')
    ‚Üì
messages
‚îú‚îÄ channel='whatsapp' (–∏–∑ Umnico)
‚îî‚îÄ channel='amocrm_note' (–∏–∑ AmoCRM –ø—Ä–∏–º–µ—á–∞–Ω–∏–π)
    ‚Üì
amocrm_deals (status_label='successful' | 'unsuccessful')
```

---

## üìä –ß—Ç–æ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è

### –ò–∑ Umnico (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):
- ‚úÖ –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
- ‚úÖ –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –ö–∞–Ω–∞–ª (WhatsApp, Telegram, Instagram)
- ‚úÖ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (incoming/outgoing)
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

### –ò–∑ AmoCRM (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç):
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (status 142)
- ‚úÖ –ù–µ—É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (status 143)
- ‚úÖ –î–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–æ–∫ (—Ü–µ–Ω–∞, –¥–∞—Ç—ã)
- ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã (—Ç–µ–ª–µ—Ñ–æ–Ω, –∏–º—è)
- ‚úÖ Custom fields (rentprog_client_id, rentprog_booking_id)
- ‚úÖ –ü—Ä–∏–º–µ—á–∞–Ω–∏—è (notes) –∫–∞–∫ messages

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
psql "postgresql://neondb_owner:npg_cHIT9Kxfk1Am@ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require" -f sql/conversations_schema.sql
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env:
```bash
UMNICO_EMAIL=geodrive.ge@gmail.com
UMNICO_PASSWORD=2GeoDriveumnicopassword!!))
AMOCRM_EMAIL=geodrive.ge@gmail.com
AMOCRM_PASSWORD=wnr3c4%UqN@jY23
AMOCRM_SUBDOMAIN=geodrive
```

### 3. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
cd services && npm install && npm run build && cd ..
docker-compose build playwright-umnico playwright-amocrm
docker-compose up -d
```

### 4. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflows –≤ n8n UI

### 5. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflows

**–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `docs/QUICKSTART_WORKFLOWS.md`

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# Health checks
curl http://46.224.17.15:3001/health  # Umnico
curl http://46.224.17.15:3002/health  # AmoCRM

# –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
curl http://46.224.17.15:3001/api/conversations?limit=5
curl http://46.224.17.15:3002/api/deals?pipeline_id=8580102&status_id=142&limit=5

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
psql "..." -c "SELECT COUNT(*) FROM conversations;"
psql "..." -c "SELECT COUNT(*) FROM messages;"
psql "..." -c "SELECT COUNT(*) FROM amocrm_deals;"
```

---

## üéì –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –±—Ä–∞—É–∑–µ—Ä—ã
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑
- ‚úÖ –°–µ—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π re-login –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- ‚úÖ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞

### 2. HTTP API –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ Playwright –≤ n8n
- ‚úÖ n8n —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ—Å—Ç—ã–º HTTP Request
- ‚úÖ –ë—Ä–∞—É–∑–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
- ‚úÖ –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 3. External References Pattern
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏
- ‚úÖ –û–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å ID –≤ 3+ —Å–∏—Å—Ç–µ–º–∞—Ö
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ n-to-n —Å–≤—è–∑–µ–π

### 4. Incremental Updates
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –•—Ä–∞–Ω–∏–º last_check/last_sync timestamps
- ‚úÖ –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (< 1 –º–∏–Ω)

---

## üîÆ Roadmap (—Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–∑—ã)

### –§–∞–∑–∞ 2: Embeddings & RAG
- [ ] Chunking —Å–æ–æ–±—â–µ–Ω–∏–π (512-1024 —Ç–æ–∫–µ–Ω–∞)
- [ ] Vector embeddings —á–µ—Ä–µ–∑ bge-m3
- [ ] –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `message_embeddings` —Ç–∞–±–ª–∏—Ü—ã
- [ ] Semantic search –ø–æ —É—Å–ø–µ—à–Ω—ã–º –¥–∏–∞–ª–æ–≥–∞–º

### –§–∞–∑–∞ 3: Night Agent MVP
- [ ] –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ RAG
- [ ] –ü–æ–ª–∏—Ç–∏–∫–∏ –∏ guardrails (–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –∏–Ω—Ç–µ–Ω—Ç–æ–≤)
- [ ] –≠—Å–∫–∞–ª–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∫–µ–π—Å–æ–≤
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

---

## üìö –í—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
sql/
  conversations_schema.sql         # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

services/
  playwright-umnico.ts             # Umnico Playwright Service
  playwright-amocrm.ts             # AmoCRM Playwright Service
  Dockerfile.umnico                # Docker –¥–ª—è Umnico
  Dockerfile.amocrm                # Docker –¥–ª—è AmoCRM
  package.json                     # Dependencies
  tsconfig.json                    # TypeScript config

n8n-workflows/
  umnico-chat-scraper.json         # Workflow: Umnico
  amocrm-deals-scraper.json        # Workflow: AmoCRM

docs/
  WORKFLOWS_SPEC.md                # –ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (42 —Å—Ç—Ä)
  QUICKSTART_WORKFLOWS.md          # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (15 —Å—Ç—Ä)
  WORKFLOWS_README.md              # –û–±–∑–æ—Ä (12 —Å—Ç—Ä)

WORKFLOWS_IMPLEMENTATION_SUMMARY.md  # –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
docker-compose.yml                   # –û–±–Ω–æ–≤–ª–µ–Ω (+playwright services)
```

**–í—Å–µ–≥–æ:** 14 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ + 1 –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é**

- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞ (69 —Å—Ç—Ä–∞–Ω–∏—Ü)
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- Incremental updates —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- External refs —Å–≤—è–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏

**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:**
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: ~3 —á–∞—Å–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: ~1 —á–∞—Å
- **–ò—Ç–æ–≥–æ: ~4 —á–∞—Å–∞**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä (20 –º–∏–Ω—É—Ç –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)

---

**–ê–≤—Ç–æ—Ä:** Jarvis AI Agent  
**–î–∞—Ç–∞:** 2025-11-09  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Complete

