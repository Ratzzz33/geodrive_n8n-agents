# üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–µ–π

**5 –º–∏–Ω—É—Ç** –¥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!

---

## ‚ö° –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±

```bash
cd C:\Users\33pok\geodrive_n8n-agents

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
node db/migrations/check-status.mjs

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
node db/migrations/apply-migrations.mjs

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
node db/migrations/check-status.mjs
```

**–ì–æ—Ç–æ–≤–æ!** üéâ

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
node db/migrations/check-status.mjs
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `bookings`
- ‚úÖ –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ NULL –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –ù–∞–ª–∏—á–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**

```
üìä –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• –ë–†–û–ù–ï–ô
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

üìã –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è:
   ‚ùå start_date
   ‚ùå end_date
   ‚úÖ start_at
   ‚úÖ end_at
   ‚ùå state
   ‚úÖ status

‚ö†Ô∏è  –ù–µ –≤—Å–µ –ø–æ–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç!
üí° –í—ã–ø–æ–ª–Ω–∏—Ç–µ: node db/migrations/apply-migrations.mjs
```

---

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

#### –í–∞—Ä–∏–∞–Ω—Ç A: –í—Å–µ —Å—Ä–∞–∑—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
node db/migrations/apply-migrations.mjs
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –° –ø—Ä–æ–≤–µ—Ä–∫–æ–π (dry-run)

```bash
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
node db/migrations/apply-migrations.mjs --dry-run

# –ï—Å–ª–∏ –≤—Å–µ –û–ö - –ø—Ä–∏–º–µ–Ω–∏—Ç—å
node db/migrations/apply-migrations.mjs
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ü–æ—ç—Ç–∞–ø–Ω–æ

```bash
# –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
node db/migrations/apply-migrations.mjs --single=001

# –¢–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç
node db/migrations/apply-migrations.mjs --single=002

# –¢–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
node db/migrations/apply-migrations.mjs --single=003

# –¢–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä
node db/migrations/apply-migrations.mjs --single=004

# –¢–æ–ª—å–∫–æ –±—ç–∫—Ñ–∏–ª–ª
node db/migrations/apply-migrations.mjs --single=005
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**

```
üöÄ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ú–ò–ì–†–ê–¶–ò–ô –î–õ–Ø –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• –ë–†–û–ù–ï–ô
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìã –ë—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –º–∏–≥—Ä–∞—Ü–∏–π: 5
   1. 001_add_bookings_fields.sql
   2. 002_normalize_bookings_dates.sql
   3. 003_normalize_bookings_status.sql
   4. 004_create_bookings_sync_trigger.sql
   5. 005_backfill_bookings_data.sql

üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ü–ï–†–ï–î –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:
   –í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π: 3543
   –ë—Ä–æ–Ω–∏ —Å NULL –≤ start_date/end_date: 3000
   –ë—Ä–æ–Ω–∏ —Å NULL –≤ state: 3000
   ...

[–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π...]

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ü–û–°–õ–ï –º–∏–≥—Ä–∞—Ü–∏–π:
   –í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π: 3543
   –ë—Ä–æ–Ω–∏ —Å NULL –≤ start_date/end_date: 0
   –ë—Ä–æ–Ω–∏ —Å NULL –≤ state: 0
   ...

‚úÖ –í–°–ï –ú–ò–ì–†–ê–¶–ò–ò –ü–†–ò–ú–ï–ù–ï–ù–´ –£–°–ü–ï–®–ù–û!
üéâ –î–∞–Ω–Ω—ã–µ –±—Ä–æ–Ω–µ–π –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã!
```

---

### –®–∞–≥ 3: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
node db/migrations/check-status.mjs
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
‚úÖ –í–°–ï –î–ê–ù–ù–´–ï –ù–û–†–ú–ê–õ–ò–ó–û–í–ê–ù–´!
üéâ –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
üìù –¢—Ä–∏–≥–≥–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –±—Ä–æ–Ω—å –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:

```sql
-- –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω—å —Å timestamp
INSERT INTO bookings (car_id, start_at, end_at, status) 
VALUES (
  (SELECT id FROM cars LIMIT 1),
  NOW() + INTERVAL '1 day',
  NOW() + INTERVAL '3 days',
  'active'
);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–∏–ª–∏—Å—å
SELECT 
  start_date IS NOT NULL as has_start_date,
  end_date IS NOT NULL as has_end_date,
  state IS NOT NULL as has_state,
  state,
  status
FROM bookings 
ORDER BY created_at DESC 
LIMIT 1;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
has_start_date | has_end_date | has_state | state     | status
---------------|--------------|-----------|-----------|--------
true           | true         | true      | –ê–∫—Ç–∏–≤–Ω–∞—è  | active
```

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π?

**A:** 30-60 —Å–µ–∫—É–Ω–¥ –¥–ª—è ~3500 –∑–∞–ø–∏—Å–µ–π. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±—Ä–æ–Ω–µ–π
- –°–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- –ù–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### Q: –ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ?

**A:** –î–∞! –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (ROLLBACK –ø—Ä–∏ –æ—à–∏–±–∫–µ)
- ‚úÖ –ù–µ —É–¥–∞–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—é—Ç –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–ø–∞–ª–∞ —Å –æ—à–∏–±–∫–æ–π?

**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏ –∏:

1. **"relation does not exist"**
   ```bash
   # –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ö–µ–º—É
   node setup/create_base_schema.mjs
   ```

2. **"column already exists"**
   ```bash
   # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 001
   node db/migrations/apply-migrations.mjs --from=002
   ```

3. **"invalid input syntax"**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é
   # –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
   # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
   ```

### Q: –ù—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–¥ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π?

**A:** –î–∞, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—Ä–∞–∑—É:

- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚ö†Ô∏è –ù–æ –ª—É—á—à–µ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:**

```javascript
// –ë–´–õ–û (—Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
const booking = {
  start_at: new Date('2025-11-10T16:00:00+04:00'),
  status: 'active'
};

// –°–¢–ê–õ–û (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
const booking = {
  start_date: '2025-11-10 16:00:00+04',
  end_date: '2025-11-15 14:30:00+04',
  start_at: new Date('2025-11-10T16:00:00+04:00'),
  end_at: new Date('2025-11-15T14:30:00+04:00'),
  state: '–ê–∫—Ç–∏–≤–Ω–∞—è',
  status: 'active'
};
```

---

## üÜò –ü–æ–º–æ—â—å

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å connection string
echo $DATABASE_URL

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
export DATABASE_URL="postgresql://neondb_owner:npg_cHIT9Kxfk1Am@ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å postgres
npm install postgres
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
node db/migrations/apply-migrations.mjs
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** `BOOKINGS_DATA_NORMALIZATION.md`
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π:** `db/migrations/README.md`
- **–ü—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤:** `db/migrations/README.md` (—Å–µ–∫—Ü–∏—è "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã")

---

## ‚úÖ Checklist

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] `check-status.mjs` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "‚úÖ –í–°–ï –î–ê–ù–ù–´–ï –ù–û–†–ú–ê–õ–ò–ó–û–í–ê–ù–´"
- [ ] –¢—Ä–∏–≥–≥–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –í—Å–µ –ø–æ–ª—è (start_date, end_date, state) —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- [ ] NULL –∑–Ω–∞—á–µ–Ω–∏–π –Ω–µ—Ç (–∏–ª–∏ –º–∏–Ω–∏–º—É–º)
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –±—Ä–æ–Ω—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- [ ] –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5 –º–∏–Ω—É—Ç  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ü—Ä–æ—Å—Ç–∞—è  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

üöÄ **–£–¥–∞—á–∏!**

