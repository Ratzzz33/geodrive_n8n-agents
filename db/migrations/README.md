# üîß –ú–ò–ì–†–ê–¶–ò–ò –î–õ–Ø –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• –ë–†–û–ù–ï–ô

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 10 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

---

## üìã –û–ü–ò–°–ê–ù–ò–ï

–ù–∞–±–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ `bookings`. –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç –∏ —Å—Ç–∞—Ç—É—Å–æ–≤.

### –ü—Ä–æ–±–ª–µ–º–∞

–í —Ç–∞–±–ª–∏—Ü–µ `bookings` –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–î–í–£–• —Ñ–æ—Ä–º–∞—Ç–∞—Ö**:
- **–î–∞—Ç—ã:** `start_date`/`end_date` (text) ‚Üî `start_at`/`end_at` (timestamptz)
- **–°—Ç–∞—Ç—É—Å—ã:** `state` (—Ä—É—Å—Å–∫–∏–π) ‚Üî `status` (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- –£ –º–Ω–æ–≥–∏—Ö –∑–∞–ø–∏—Å–µ–π –æ–¥–Ω–æ –∏–∑ –ø–æ–ª–µ–π = NULL
- –≠—Ç–æ –ª–æ–º–∞–µ—Ç –ø–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π

### –†–µ—à–µ–Ω–∏–µ

5 –º–∏–≥—Ä–∞—Ü–∏–π + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π `start_date`, `end_date`, `state`
2. ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç
3. ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
4. ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
5. ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫—Ñ–∏–ª–ª

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd C:\Users\33pok\geodrive_n8n-agents
node db/migrations/apply-migrations.mjs
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ (dry-run)

```bash
node db/migrations/apply-migrations.mjs --dry-run
```

### –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é

```bash
node db/migrations/apply-migrations.mjs --single=001
```

### –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π

```bash
node db/migrations/apply-migrations.mjs --from=002 --to=004
```

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ú–ò–ì–†–ê–¶–ò–ô

### 001_add_bookings_fields.sql

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏—è:**
- ‚ûï `start_date TEXT` - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- ‚ûï `end_date TEXT` - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- ‚ûï `state TEXT` - —Å—Ç–∞—Ç—É—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- üìä –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~1 —Å–µ–∫—É–Ω–¥–∞

---

### 002_normalize_bookings_dates.sql

**–¶–µ–ª—å:** –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∞—Ç—ã –≤ –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–§–æ—Ä–º–∞—Ç:** `YYYY-MM-DD HH24:MI:SS+TZ`  
**–ü—Ä–∏–º–µ—Ä:** `2025-11-10 16:00:00+04`

**–õ–æ–≥–∏–∫–∞:**
1. –ï—Å–ª–∏ `start_date`/`end_date` = NULL, –Ω–æ `start_at`/`end_at` –∑–∞–ø–æ–ª–Ω–µ–Ω—ã  
   ‚Üí –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å timestamp ‚Üí text
2. –ï—Å–ª–∏ `start_at`/`end_at` = NULL, –Ω–æ `start_date`/`end_date` –∑–∞–ø–æ–ª–Ω–µ–Ω—ã  
   ‚Üí –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å text ‚Üí timestamptz

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-10 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π)

---

### 003_normalize_bookings_status.sql

**–¶–µ–ª—å:** –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã

**–ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤:**

| state (—Ä—É—Å—Å–∫–∏–π)     | status (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π) |
|---------------------|---------------------|
| `–ê–∫—Ç–∏–≤–Ω–∞—è`          | `active`            |
| `–ù–æ–≤–∞—è`             | `active`            |
| `–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞`      | `confirmed`         |
| `–û—Ç—ä–µ–∑–¥–∏–ª–∞`         | `completed`         |
| `–û—Ç–º–µ–Ω–∞`            | `cancelled`         |
| `–û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞`     | `cancelled`         |
| `–ù–µ–¥–æ–∑–≤–æ–Ω`          | `pending`           |
| `–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞`   | `pending`           |

**–õ–æ–≥–∏–∫–∞:**
1. –ï—Å–ª–∏ `state` = NULL, –Ω–æ `status` –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Üí –ó–∞–ø–æ–ª–Ω–∏—Ç—å `state`
2. –ï—Å–ª–∏ `status` = NULL, –Ω–æ `state` –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Üí –ó–∞–ø–æ–ª–Ω–∏—Ç—å `status`

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~3-5 —Å–µ–∫—É–Ω–¥

---

### 004_create_bookings_sync_trigger.sql

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ INSERT/UPDATE

**–¢—Ä–∏–≥–≥–µ—Ä:** `bookings_sync_fields_trigger`  
**–§—É–Ω–∫—Ü–∏—è:** `sync_booking_fields()`

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ INSERT/UPDATE –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç:
  - `start_at`/`end_at` ‚Üî `start_date`/`end_date`
  - `state` ‚Üî `status`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±–æ–∏—Ö –ø–æ–ª–µ–π
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–æ–≤ –≤—Å—Ç–∞–≤–∫–∏ (API, –∏–º–ø–æ—Ä—Ç, —Ä—É—á–Ω–æ–π INSERT)

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~1 —Å–µ–∫—É–Ω–¥–∞

---

### 005_backfill_bookings_data.sql

**–¶–µ–ª—å:** –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π

**–õ–æ–≥–∏–∫–∞:**
1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `COALESCE` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è NULL
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Å–æ–≤—Å–µ–º
3. –í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `state` = `'–ù–æ–≤–∞—è'`
- `status` = `'active'`

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-10 —Å–µ–∫—É–Ω–¥

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç

```sql
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0
SELECT COUNT(*) FROM bookings 
WHERE start_date IS NULL OR end_date IS NULL;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0
SELECT COUNT(*) FROM bookings 
WHERE start_at IS NULL OR end_at IS NULL;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0
SELECT COUNT(*) FROM bookings 
WHERE start_date::timestamptz != start_at 
   OR end_date::timestamptz != end_at;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

```sql
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 (–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
SELECT COUNT(*) FROM bookings 
WHERE state IS NULL;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0
SELECT COUNT(*) FROM bookings 
WHERE status IS NULL;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π

```sql
-- –ë—Ä–æ–Ω–∏ –∏—Å–∫–ª—é—á–∞—é—â–∏–µ –º–∞—à–∏–Ω—ã –∏–∑ –ø–æ–∏—Å–∫–∞
SELECT COUNT(*) FROM bookings
WHERE (state IN ('–ê–∫—Ç–∏–≤–Ω–∞—è', '–ù–æ–≤–∞—è', '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞')
   OR status IN ('active', 'confirmed', 'in_rent'))
  AND end_at >= NOW(); -- –ï—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –¢–†–ò–ì–ì–ï–†–ê

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä:

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏ —Å timestamp

```sql
INSERT INTO bookings (car_id, start_at, end_at, status) 
VALUES (
  'uuid-car-id',
  '2025-11-15 16:00:00+04'::timestamptz,
  '2025-11-20 16:00:00+04'::timestamptz,
  'active'
);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ start_date –∏ state –∑–∞–ø–æ–ª–Ω–∏–ª–∏—Å—å
SELECT id, start_date, end_date, start_at, end_at, state, status 
FROM bookings 
WHERE id = (SELECT id FROM bookings ORDER BY created_at DESC LIMIT 1);
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `start_date` = `'2025-11-15 16:00:00+04'`
- `end_date` = `'2025-11-20 16:00:00+04'`
- `state` = `'–ê–∫—Ç–∏–≤–Ω–∞—è'`

### –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏ —Å text –¥–∞—Ç–∞–º–∏

```sql
INSERT INTO bookings (car_id, start_date, end_date, state) 
VALUES (
  'uuid-car-id',
  '2025-11-16 10:00:00+04',
  '2025-11-18 10:00:00+04',
  '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'
);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ start_at –∏ status –∑–∞–ø–æ–ª–Ω–∏–ª–∏—Å—å
SELECT id, start_date, end_date, start_at, end_at, state, status 
FROM bookings 
WHERE id = (SELECT id FROM bookings ORDER BY created_at DESC LIMIT 1);
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `start_at` = `2025-11-16 10:00:00+04`
- `end_at` = `2025-11-18 10:00:00+04`
- `status` = `'confirmed'`

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –û–¢–ß–ï–¢–´

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```sql
DO $$
DECLARE
  total INTEGER;
  active INTEGER;
  completed INTEGER;
  cancelled INTEGER;
BEGIN
  SELECT COUNT(*) INTO total FROM bookings;
  
  SELECT COUNT(*) INTO active 
  FROM bookings 
  WHERE state IN ('–ê–∫—Ç–∏–≤–Ω–∞—è', '–ù–æ–≤–∞—è', '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞');
  
  SELECT COUNT(*) INTO completed 
  FROM bookings 
  WHERE state = '–û—Ç—ä–µ–∑–¥–∏–ª–∞';
  
  SELECT COUNT(*) INTO cancelled 
  FROM bookings 
  WHERE state IN ('–û—Ç–º–µ–Ω–∞', '–û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞');
  
  RAISE NOTICE '–í—Å–µ–≥–æ –±—Ä–æ–Ω–µ–π: %', total;
  RAISE NOTICE '–ê–∫—Ç–∏–≤–Ω—ã–µ: % (%.1f%%)', active, (active::FLOAT / total * 100);
  RAISE NOTICE '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ: % (%.1f%%)', completed, (completed::FLOAT / total * 100);
  RAISE NOTICE '–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ: % (%.1f%%)', cancelled, (cancelled::FLOAT / total * 100);
END $$;
```

### –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏

```sql
-- –ë—Ä–æ–Ω–∏ –±–µ–∑ –¥–∞—Ç
SELECT id, start_date, end_date, start_at, end_at, state, status
FROM bookings
WHERE (start_date IS NULL AND start_at IS NULL)
   OR (end_date IS NULL AND end_at IS NULL);

-- –ë—Ä–æ–Ω–∏ —Å –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
SELECT id, start_date, start_at,
  start_date::timestamptz as start_date_ts,
  (start_date::timestamptz != start_at) as mismatch
FROM bookings
WHERE start_date IS NOT NULL 
  AND start_at IS NOT NULL
  AND start_date::timestamptz != start_at;

-- –ë—Ä–æ–Ω–∏ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
SELECT id, state, status
FROM bookings
WHERE state NOT IN ('–ê–∫—Ç–∏–≤–Ω–∞—è', '–ù–æ–≤–∞—è', '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞', '–û—Ç—ä–µ–∑–¥–∏–ª–∞', 
                    '–û—Ç–º–µ–Ω–∞', '–û—Ç–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞', '–ù–µ–¥–æ–∑–≤–æ–Ω', '–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞',
                    '–û–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞', '–û–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞')
  AND status NOT IN ('active', 'confirmed', 'in_rent', 'completed', 
                     'cancelled', 'pending');
```

---

## üîÑ –û–¢–ö–ê–¢ –ú–ò–ì–†–ê–¶–ò–ô

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

### –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä

```sql
DROP TRIGGER IF EXISTS bookings_sync_fields_trigger ON bookings;
DROP FUNCTION IF EXISTS sync_booking_fields();
```

### –£–¥–∞–ª–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è

```sql
ALTER TABLE bookings DROP COLUMN IF EXISTS start_date;
ALTER TABLE bookings DROP COLUMN IF EXISTS end_date;
ALTER TABLE bookings DROP COLUMN IF EXISTS state;
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –û—Ç–∫–∞—Ç —É–¥–∞–ª–∏—Ç –≤—Å–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!

---

## üìù –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–û–î–ê –ò–ú–ü–û–†–¢–ê

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –æ–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –∏–º–ø–æ—Ä—Ç–∞:

### JavaScript/TypeScript

```typescript
// –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏–∑ RentProg
const booking = {
  // –ó–∞–ø–æ–ª–Ω—è—Ç—å –û–ë–ê —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç
  start_date: '2025-11-10 16:00:00+04',  // text
  end_date: '2025-11-15 14:30:00+04',    // text
  start_at: '2025-11-10T16:00:00+04:00', // timestamptz
  end_at: '2025-11-15T14:30:00+04:00',   // timestamptz
  
  // –ó–∞–ø–æ–ª–Ω—è—Ç—å –û–ë–ê —Å—Ç–∞—Ç—É—Å–∞
  state: '–ê–∫—Ç–∏–≤–Ω–∞—è',    // —Ä—É—Å—Å–∫–∏–π
  status: 'active'      // –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
};

// –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç, –Ω–æ –ª—É—á—à–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å —Å—Ä–∞–∑—É
```

### SQL

```sql
INSERT INTO bookings (
  car_id, client_id,
  start_date, end_date, start_at, end_at,
  state, status
) VALUES (
  uuid_car_id, uuid_client_id,
  '2025-11-10 16:00:00+04', '2025-11-15 14:30:00+04',
  '2025-11-10 16:00:00+04'::timestamptz, '2025-11-15 14:30:00+04'::timestamptz,
  '–ê–∫—Ç–∏–≤–Ω–∞—è', 'active'
);
```

---

## üêõ TROUBLESHOOTING

### –û—à–∏–±–∫–∞: "relation does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ `bookings` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ö–µ–º—É
node setup/create_base_schema.mjs
```

### –û—à–∏–±–∫–∞: "column already exists"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—è —É–∂–µ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–Ω–µ–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 001
```bash
node db/migrations/apply-migrations.mjs --from=002
```

### –û—à–∏–±–∫–∞: "invalid input syntax for type timestamp"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤ `start_date`/`end_date`

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç –≤—Ä—É—á–Ω—É—é:
```sql
UPDATE bookings 
SET start_date = NULL, end_date = NULL
WHERE start_date !~ '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}[+-]\d{2}$';

-- –ó–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 002
```

---

## üìû –ö–û–ù–¢–ê–ö–¢–´

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã:** `BOOKINGS_DATA_NORMALIZATION.md`
- **–ö–æ–¥ –ø–æ–∏—Å–∫–∞:** `src/utils/carSearchAI.js` (—Å—Ç—Ä–æ–∫–∏ 205-231)
- **GitHub Issues:** https://github.com/your-repo/issues

---

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

‚úÖ –í—Å–µ –¥–∞—Ç—ã –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ  
‚úÖ –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã  
‚úÖ –¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏  
‚úÖ –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ –ù–µ—Ç NULL –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—è—Ö

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 10 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

