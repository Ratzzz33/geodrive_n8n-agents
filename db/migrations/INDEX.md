# üìë –ò–ù–î–ï–ö–° –ú–ò–ì–†–ê–¶–ò–ô

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–µ–π.

---

## üóÇÔ∏è –°–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π

| ‚Ññ | –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ä–µ–º—è | –°—Ç–∞—Ç—É—Å |
|---|------|----------|-------|--------|
| 001 | `001_add_bookings_fields.sql` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π start_date, end_date, state | ~1s | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 002 | `002_normalize_bookings_dates.sql` | –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç –≤ –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç | ~5-10s | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 003 | `003_normalize_bookings_status.sql` | –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ (—Ä—É—Å—Å–∫–∏–π ‚Üî –∞–Ω–≥–ª–∏–π—Å–∫–∏–π) | ~3-5s | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 004 | `004_create_bookings_sync_trigger.sql` | –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | ~1s | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 005 | `005_backfill_bookings_data.sql` | –§–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫—Ñ–∏–ª–ª –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ~5-10s | ‚úÖ –ì–æ—Ç–æ–≤–æ |

**–û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 30-60 —Å–µ–∫—É–Ω–¥

---

## üìä –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```
001_add_bookings_fields.sql
    ‚Üì
002_normalize_bookings_dates.sql
    ‚Üì
003_normalize_bookings_status.sql
    ‚Üì
004_create_bookings_sync_trigger.sql
    ‚Üì
005_backfill_bookings_data.sql
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è —Å—Ç—Ä–æ–≥–æ –≤ –ø–æ—Ä—è–¥–∫–µ!

---

## üéØ –¶–µ–ª–∏

### 001: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π

**–î–æ–±–∞–≤–ª—è–µ—Ç:**
- `start_date TEXT` - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- `end_date TEXT` - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- `state TEXT` - —Å—Ç–∞—Ç—É—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_bookings_state`
- `idx_bookings_start_date`
- `idx_bookings_end_date`

**–¢—Ä–µ–±—É–µ—Ç:** –¢–∞–±–ª–∏—Ü–∞ `bookings`  
**–û—Ç–∫–∞—Ç:** –ú–æ–∂–Ω–æ

---

### 002: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç

**–§–æ—Ä–º–∞—Ç:** `YYYY-MM-DD HH24:MI:SS+TZ`

**–õ–æ–≥–∏–∫–∞:**
1. `start_at`/`end_at` ‚Üí `start_date`/`end_date`
2. `start_date`/`end_date` ‚Üí `start_at`/`end_at`

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
- NULL –∑–Ω–∞—á–µ–Ω–∏—è
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã
- Timezone —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–¢—Ä–µ–±—É–µ—Ç:** –ú–∏–≥—Ä–∞—Ü–∏—è 001  
**–û—Ç–∫–∞—Ç:** –ú–æ–∂–Ω–æ (—Å –ø–æ—Ç–µ—Ä–µ–π –¥–∞–Ω–Ω—ã—Ö)

---

### 003: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

**–ú–∞–ø–ø–∏–Ω–≥:** –†—É—Å—Å–∫–∏–π ‚Üî –ê–Ω–≥–ª–∏–π—Å–∫–∏–π

**–õ–æ–≥–∏–∫–∞:**
1. `status` ‚Üí `state` (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí —Ä—É—Å—Å–∫–∏–π)
2. `state` ‚Üí `status` (—Ä—É—Å—Å–∫–∏–π ‚Üí –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã
- Mixed —Ä–µ–≥–∏—Å—Ç—Ä

**–¢—Ä–µ–±—É–µ—Ç:** –ú–∏–≥—Ä–∞—Ü–∏—è 001  
**–û—Ç–∫–∞—Ç:** –ú–æ–∂–Ω–æ (—Å –ø–æ—Ç–µ—Ä–µ–π –¥–∞–Ω–Ω—ã—Ö)

---

### 004: –¢—Ä–∏–≥–≥–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–°–æ–∑–¥–∞–µ—Ç:**
- –§—É–Ω–∫—Ü–∏—è `sync_booking_fields()`
- –¢—Ä–∏–≥–≥–µ—Ä `bookings_sync_fields_trigger`

**–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞:**
- `INSERT`
- `UPDATE`

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç:**
- –î–∞—Ç—ã (timestamp ‚Üî text)
- –°—Ç–∞—Ç—É—Å—ã (—Ä—É—Å—Å–∫–∏–π ‚Üî –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

**–¢—Ä–µ–±—É–µ—Ç:** –ú–∏–≥—Ä–∞—Ü–∏–∏ 001, 002, 003  
**–û—Ç–∫–∞—Ç:** –ú–æ–∂–Ω–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)

---

### 005: –§–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫—Ñ–∏–ª–ª

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** `COALESCE` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è NULL

**–î–µ—Ñ–æ–ª—Ç—ã:**
- `state` = `'–ù–æ–≤–∞—è'`
- `status` = `'active'`

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ü–æ–ª–Ω–æ—Ç—É –¥–∞–Ω–Ω—ã—Ö
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

**–¢—Ä–µ–±—É–µ—Ç:** –ú–∏–≥—Ä–∞—Ü–∏–∏ 001-004  
**–û—Ç–∫–∞—Ç:** –ú–æ–∂–Ω–æ (—Å –ø–æ—Ç–µ—Ä–µ–π –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### apply-migrations.mjs

–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω
- Dry-run —Ä–µ–∂–∏–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ/–ø–æ—Å–ª–µ

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
node db/migrations/apply-migrations.mjs
node db/migrations/apply-migrations.mjs --dry-run
node db/migrations/apply-migrations.mjs --single=001
node db/migrations/apply-migrations.mjs --from=002 --to=004
```

---

### check-status.mjs

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ NULL
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- –ù–∞–ª–∏—á–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞
- –û–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–ü—Ä–∏–º–µ—Ä:**
```bash
node db/migrations/check-status.mjs
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `README.md` | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π |
| `QUICK_START.md` | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç |
| `INDEX.md` | –≠—Ç–æ—Ç —Ñ–∞–π–ª - –∏–Ω–¥–µ–∫—Å –º–∏–≥—Ä–∞—Ü–∏–π |
| `EXAMPLES.md` | –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ |

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
node db/migrations/check-status.mjs
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
‚ö†Ô∏è  –¢–†–ï–ë–£–ï–¢–°–Ø –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø
‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–∞–º–∏: 3000 –∑–∞–ø–∏—Å–µ–π –±–µ–∑ start_date/end_date
‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏: 3000 –∑–∞–ø–∏—Å–µ–π –±–µ–∑ state
‚ùå –¢—Ä–∏–≥–≥–µ—Ä –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
node db/migrations/check-status.mjs
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
‚úÖ –í–°–ï –î–ê–ù–ù–´–ï –ù–û–†–ú–ê–õ–ò–ó–û–í–ê–ù–´!
üéâ –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
üìù –¢—Ä–∏–≥–≥–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª
cd C:\Users\33pok\geodrive_n8n-agents
node db/migrations/check-status.mjs
node db/migrations/apply-migrations.mjs
node db/migrations/check-status.mjs

# –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞
node db/migrations/check-status.mjs

# –° dry-run
node db/migrations/apply-migrations.mjs --dry-run

# –û–¥–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è
node db/migrations/apply-migrations.mjs --single=004
```

---

## üîÑ –û—Ç–∫–∞—Ç

### –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç

```sql
-- –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä
DROP TRIGGER IF EXISTS bookings_sync_fields_trigger ON bookings;
DROP FUNCTION IF EXISTS sync_booking_fields();

-- –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—è
ALTER TABLE bookings DROP COLUMN IF EXISTS start_date;
ALTER TABLE bookings DROP COLUMN IF EXISTS end_date;
ALTER TABLE bookings DROP COLUMN IF EXISTS state;
```

### –ß–∞—Å—Ç–∏—á–Ω—ã–π –æ—Ç–∫–∞—Ç

```bash
# –¢–æ–ª—å–∫–æ —É–¥–∞–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä
psql $DATABASE_URL -c "DROP TRIGGER IF EXISTS bookings_sync_fields_trigger ON bookings;"
psql $DATABASE_URL -c "DROP FUNCTION IF EXISTS sync_booking_fields();"

# –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
psql $DATABASE_URL -c "UPDATE bookings SET start_date = NULL, end_date = NULL, state = NULL;"
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

- [x] –í—Å–µ –ø–æ–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- [x] –ù–µ—Ç NULL –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—è—Ö
- [x] –î–∞—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [x] –°—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [x] –¢—Ä–∏–≥–≥–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [x] –¢—Ä–∏–≥–≥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **–ü—Ä–æ–±–ª–µ–º–∞:** `BOOKINGS_DATA_NORMALIZATION.md`
- **–ö–æ–¥ –ø–æ–∏—Å–∫–∞:** `src/utils/carSearchAI.js`
- **Issues:** GitHub Issues

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 10 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

