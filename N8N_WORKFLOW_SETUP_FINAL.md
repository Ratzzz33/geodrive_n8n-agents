# –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ n8n Workflow - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ Neon (events, sync_runs, health)
- ‚úÖ 3 workflow –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Credentials —Å–æ–∑–¥–∞–Ω—ã ("Postgres account" –∏ "Telegram account")
- ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã—Ç –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ n8n

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä):

### –í–∞–∂–Ω–æ: –ò–º—è credential –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è!
–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ:
- **Postgres account** (–≤–º–µ—Å—Ç–æ PostgreSQL)
- **Telegram account** (–≤–º–µ—Å—Ç–æ Telegram Bot)

---

## 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Workflow: "RentProg Webhooks Monitor"

**URL:** http://46.224.17.15:5678/workflow/gNXRKIQpNubEazH7

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ workflow
1. –ë—Ä–∞—É–∑–µ—Ä —É–∂–µ –æ—Ç–∫—Ä—ã—Ç - –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ URL –≤—ã—à–µ –∏–ª–∏ –Ω–∞–π–¥–∏—Ç–µ workflow –≤ —Å–ø–∏—Å–∫–µ

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–æ–¥—É "Save Event" (Postgres)
1. –ù–∞–π–¥–∏—Ç–µ –Ω–∞ canvas –Ω–æ–¥—É **"Save Event"** (Postgres –∏–∫–æ–Ω–∫–∞)
2. **–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫** –Ω–∞ –Ω–æ–¥—É (–∏–ª–∏ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Üí Edit)
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–π—Å—è –ø–∞–Ω–µ–ª–∏ —Å–ø—Ä–∞–≤–∞ –Ω–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ **"Credential"**
4. –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞: **"Postgres account"**
5. –ù–∞–∂–º–∏—Ç–µ **"Save"** –∏–ª–∏ –∑–∞–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å (–∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–æ–¥—É "Telegram Alert"
1. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–¥—É **"Telegram Alert"** (Telegram –∏–∫–æ–Ω–∫–∞)
2. **–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫** –Ω–∞ –Ω–æ–¥—É
3. –í –ø–æ–ª–µ **"Credential"** –≤—ã–±–µ—Ä–∏—Ç–µ: **"Telegram account"**
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö workflow –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ:
   - `TELEGRAM_ALERT_CHAT_ID` = `<–≤–∞—à chat id>`

### –®–∞–≥ 5: –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **"Active"** –≤–∫–ª—é—á–µ–Ω (–≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞)

---

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Workflow: "Sync Progress"

**URL:** http://46.224.17.15:5678/workflow/TNg2dX78ovQrgWdL

1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow
2. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–¥—É **"Save Progress"** (Postgres)
3. –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ credential **"Postgres account"**
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ workflow –∞–∫—Ç–∏–≤–µ–Ω

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Workflow: "Health & Status"

**URL:** http://46.224.17.15:5678/workflow/vNOWh8H7o5HL7fJ3

1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow
2. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–¥—É **"Save Health"** (Postgres)
   - –í—ã–±–µ—Ä–∏—Ç–µ credential **"Postgres account"**
3. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–¥—É **"Telegram Alert"** (Telegram)
   - –í—ã–±–µ—Ä–∏—Ç–µ credential **"Telegram account"**
4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - `RENTPROG_HEALTH_URL` = `http://46.224.17.15:3000/rentprog/health`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ workflow

### –¢–µ—Å—Ç 1: RentProg Webhooks Monitor
```bash
curl -X POST "http://46.224.17.15/webhook/rentprog-webhook?branch=tbilisi" \
  -H "Content-Type: application/json" \
  -d '{
    "ts": "2025-01-15T12:00:00Z",
    "branch": "tbilisi",
    "type": "booking.issue.planned",
    "payload": {"id": "test_123"},
    "ok": true
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í n8n ‚Üí Executions ‚Üí "RentProg Webhooks Monitor" –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –í —Ç–∞–±–ª–∏—Ü–µ `events` (Neon) –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å

### –¢–µ—Å—Ç 2: Sync Progress
1. –í Telegram –±–æ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: `/sync_rentprog`
2. –í n8n –ø—Ä–æ–≤–µ—Ä—å—Ç–µ workflow "Sync Progress" ‚Üí Executions
3. –í —Ç–∞–±–ª–∏—Ü–µ `sync_runs` –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏

### –¢–µ—Å—Ç 3: Health & Status
1. –î–æ–∂–¥–∏—Ç–µ—Å—å cron (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç) –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ workflow "Health & Status" ‚Üí Executions
3. –í —Ç–∞–±–ª–∏—Ü–µ `health` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ –≤—Å–µ–º —Ñ–∏–ª–∏–∞–ª–∞–º

---

## ‚úÖ Checklist —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

- [ ] –í—Å–µ 3 workflow –∞–∫—Ç–∏–≤–Ω—ã (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å Active –≤–∫–ª—é—á–µ–Ω)
- [ ] –í—Å–µ Postgres –Ω–æ–¥—ã –∏–º–µ—é—Ç credential "Postgres account"
- [ ] –í—Å–µ Telegram –Ω–æ–¥—ã –∏–º–µ—é—Ç credential "Telegram account"
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
  - [ ] `RENTPROG_HEALTH_URL`
  - [ ] `TELEGRAM_ALERT_CHAT_ID`
- [ ] –¢–µ—Å—Ç –≤–µ–±—Ö—É–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ events)
- [ ] –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–ø–∏—Å–∏ –≤ sync_runs)
- [ ] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–ø–∏—Å–∏ –≤ health)

---

## üîß –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ credentials:**
   - Credentials –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã
   - "Postgres account" –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon
   - "Telegram account" –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ @n8n_alert_geodrive_bot

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ workflow

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –í n8n ‚Üí Executions ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Neon:**
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π

