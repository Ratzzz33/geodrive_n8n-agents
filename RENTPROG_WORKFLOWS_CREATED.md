# ‚úÖ –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ RentProg Workflows

**–î–∞—Ç–∞:** 2025-11-07  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–°–æ–∑–¥–∞–Ω—ã **2 –Ω–æ–≤—ã—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö workflow** –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ RentProg —á–µ—Ä–µ–∑ API —Å Bearer —Ç–æ–∫–µ–Ω–∞–º–∏:

---

## 1Ô∏è‚É£ RentProg Monitor - Cash & Events

**ID:** `1LOkRW4ROSx92SQO`  
**URL:** https://n8n.rentflow.rentals/workflow/1LOkRW4ROSx92SQO  
**–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–æ–∑–¥–∞–Ω (Inactive - –Ω—É–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å)

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- ‚è∞ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üîÑ –û–±—Ö–æ–¥–∏—Ç 4 —Ñ–∏–ª–∏–∞–ª–∞ (Tbilisi, Batumi, Kutaisi, Service Center)
- üç™ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Bearer —Ç–æ–∫–µ–Ω—ã (–∏–∑ `src/services/importEmployees.ts`)

### –ü–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–ª–∏–∞–ª—É:

1. **üí∞ –ü–∞—Ä—Å–∏—Ç –∫–∞—Å—Å—É –∫–æ–º–ø–∞–Ω–∏–∏:**
   - Endpoint: `https://rentprog.net/api/v1/public/company_counts`
   - –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –≤ –∫–∞—Å—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏

2. **üìã –ü–∞—Ä—Å–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (bookings):**
   - Endpoint: `https://rentprog.net/api/v1/public/bookings`
   - –§–∏–ª—å—Ç—Ä: –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
   - –ü–æ–ª—É—á–∞–µ—Ç –¥–æ 50 –∑–∞–ø–∏—Å–µ–π –∑–∞ –∑–∞–ø—Ä–æ—Å

3. **üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Jarvis API:**
   - POST `http://46.224.17.15:3000/process-rentprog-data`
   - –ë–∞—Ç—á–∏–Ω–≥ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

4. **üì± Telegram –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
   - –¢–æ–ª—å–∫–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –ß–∞—Ç: `$env.TELEGRAM_ALERT_CHAT_ID`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞:

```
Cron (5 min) 
    ‚Üì
Prepare Branches (4 —Ñ–∏–ª–∏–∞–ª–∞ + —Ç–æ–∫–µ–Ω—ã)
    ‚Üì (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
Get Company Cash (HTTP) + Get Recent Bookings (HTTP)
    ‚Üì
Process & Format Data (Code)
    ‚Üì
If Has Data?
    ‚Üì (true)
Send to Jarvis API
    ‚Üì
If Error? ‚Üí Send Telegram Alert
```

---

## 2Ô∏è‚É£ RentProg Daily - Employee Cash Reconciliation

**ID:** `8jkfmWF2dTtnlMHj`  
**URL:** https://n8n.rentflow.rentals/workflow/8jkfmWF2dTtnlMHj  
**–ß–∞—Å—Ç–æ—Ç–∞:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 04:00 (Tbilisi timezone)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–æ–∑–¥–∞–Ω (Inactive - –Ω—É–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å)

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- ‚è∞ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –¥–µ–Ω—å –≤ 04:00 –ø–æ –¢–±–∏–ª–∏—Å–∏
- üîÑ –û–±—Ö–æ–¥–∏—Ç 4 —Ñ–∏–ª–∏–∞–ª–∞
- üç™ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Bearer —Ç–æ–∫–µ–Ω—ã

### –ü–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–ª–∏–∞–ª—É:

1. **üë• –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ RentProg:**
   - Endpoint: `https://rentprog.net/api/v1/public/users`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–∞—Å—Å—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (GEL, USD, EUR)
   - –ü–∞—Ä—Å–∏—Ç `currency_accounts` (currency_id: 39=GEL, 1=USD, 2=EUR)

2. **üíæ –ü–æ–ª—É—á–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –Ω–∞—à–µ–π –ë–î:**
   - –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (`role != 'inactive'`)
   - –° –ø—Ä–∏–≤—è–∑–∫–æ–π —á–µ—Ä–µ–∑ `external_refs` (rentprog_id)

3. **‚öñÔ∏è –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å—ã:**
   - –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ > 0.01 = discrepancy
   - –ü–æ –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ

4. **üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç:**
   - UPDATE –∫–∞—Å—Å—ã –≤ –Ω–∞—à–µ–π –ë–î –∏–∑ RentProg (source of truth)
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `cash_last_synced` timestamp

5. **üì± –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Telegram –∞–ª–µ—Ä—Ç:**
   - –¢–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö
   - –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, —Ñ–∏–ª–∏–∞–ª, –≤–∞–ª—é—Ç—ã, —Ä–∞–∑–Ω–∏—Ü–∞
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞:

```
Cron (daily 04:00)
    ‚Üì
Prepare Branches (4 —Ñ–∏–ª–∏–∞–ª–∞ + —Ç–æ–∫–µ–Ω—ã)
    ‚Üì (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
Get Users from RentProg (HTTP) + Get Employees from DB (Postgres)
    ‚Üì
Compare Balances (Code)
    ‚Üì
If Has Discrepancy?
    ‚Üì (true)
Auto-Correct Cash (Postgres) + Format Alert (Code)
    ‚Üì
Send Telegram Alert
```

---

## üç™ Bearer –¢–æ–∫–µ–Ω—ã

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã –∏–∑ `src/services/importEmployees.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω—ã 2025-11-07):

```javascript
const TOKENS = {
  'service-center': 'eyJhbGciOiJIUzI1NiJ9...',  // sofia2020eliseeva@gmail.com
  'tbilisi': 'eyJhbGciOiJIUzI1NiJ9...',         // eliseevaleksei32@gmail.com
  'batumi': 'eyJhbGciOiJIUzI1NiJ9...',          // ceo@geodrive.rent
  'kutaisi': 'eyJhbGciOiJIUzI1NiJ9...'          // andreevitchass@yandex.ru
};
```

**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** –î–æ —Ñ–µ–≤—Ä–∞–ª—è 2025 (~3 –º–µ—Å—è—Ü–∞)

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –Ω—É–∂–Ω–æ:
1. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ `src/services/importEmployees.ts`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å workflows (–æ–Ω–∏ –ø–æ–¥—Ö–≤–∞—Ç—è—Ç –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –∏–∑ –∫–æ–¥–∞)

---

## üóëÔ∏è –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ workflows

| Workflow | ID | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|-----|---------|
| RentProg Events Scraper | `nZPD1AcSbLo3eSgr` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª Playwright —Å–µ—Ä–≤–∏—Å (offline), –∑–∞–º–µ–Ω–µ–Ω –Ω–æ–≤—ã–º |
| Company Cash Register Parser | `x1z3p5QMQ421UPEY` | –î—É–±–ª–∏–∫–∞—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞, –∑–∞–º–µ–Ω–µ–Ω –Ω–æ–≤—ã–º |

**–û—Å—Ç–∞–≤–ª–µ–Ω—ã:**
- ‚úÖ Cash Register Reconciliation (`9Nrec3H5j2fIQ3Ma`) - —Å—Ç–∞—Ä—ã–π Playwright –≤–∞—Ä–∏–∞–Ω—Ç, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–≥–æ
- ‚úÖ Auto Company Cash Parser (`89CRF2UXWeNgt1qX`) - —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ä–µ–∂–µ (—Ä–∞–∑ –≤ —á–∞—Å)

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤—ã—Ö workflows

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç Bearer —Ç–æ–∫–µ–Ω—ã (API):
- –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Playwright —Å–µ—Ä–≤–∏—Å–æ–≤
- –ë—ã—Å—Ç—Ä–µ–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ
- –ú–µ–Ω—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- Workflow #1: –ö–∞—Å—Å–∞ + –°–æ–±—ã—Ç–∏—è –≤ –æ–¥–Ω–æ–º
- Workflow #2: –°–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç–æ–∫–µ–Ω–æ–≤ (–∫–æ–¥)
- Error Handler –ø–æ–¥–∫–ª—é—á–µ–Ω
- –í—Å–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- Telegram –∞–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### ‚úÖ –£–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- –¢–æ–∫–µ–Ω—ã –≤ –∫–æ–¥–µ (–ª–µ–≥–∫–æ –æ–±–Ω–æ–≤–∏—Ç—å)
- –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ú–∏–Ω–∏–º—É–º –Ω–æ–¥ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

---

## üöÄ –ê–∫—Ç–∏–≤–∞—Ü–∏—è workflows

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è:
```bash
TELEGRAM_ALERT_CHAT_ID=-1003251225615  # –∏–ª–∏ –≤–∞—à —á–∞—Ç
```

### –®–∞–≥ 2: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Workflow #1 (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

```bash
# –ß–µ—Ä–µ–∑ UI:
https://n8n.rentflow.rentals/workflow/1LOkRW4ROSx92SQO
# –ù–∞–∂–∞—Ç—å "Active" toggle

# –ò–ª–∏ —á–µ—Ä–µ–∑ MCP:
mcp_n8n_n8n_update_workflow({
  id: "1LOkRW4ROSx92SQO",
  active: true
})
```

### –®–∞–≥ 3: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Workflow #2 (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ 04:00)

```bash
# –ß–µ—Ä–µ–∑ UI:
https://n8n.rentflow.rentals/workflow/8jkfmWF2dTtnlMHj
# –ù–∞–∂–∞—Ç—å "Active" toggle

# –ò–ª–∏ —á–µ—Ä–µ–∑ MCP:
mcp_n8n_n8n_update_workflow({
  id: "8jkfmWF2dTtnlMHj",
  active: true
})
```

### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–∂–¥—ã–π workflow –≤ UI
2. –ù–∞–∂–º–∏—Ç–µ "Test workflow"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Telegram

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### Jarvis API endpoint

Workflows –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞:
```
POST http://46.224.17.15:3000/process-rentprog-data
```

**–ù–£–ñ–ù–û:** –°–æ–∑–¥–∞—Ç—å —ç—Ç–æ—Ç endpoint –≤ Jarvis API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö!

Endpoint –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å:
```json
{
  "type": "company_cash" | "booking_event",
  "branch": "tbilisi" | "batumi" | "kutaisi" | "service-center",
  "data": { ... },
  "timestamp": "ISO-8601"
}
```

### Currency IDs –≤ RentProg:
- `39` = GEL (Georgian Lari)
- `1` = USD (US Dollar)
- `2` = EUR (Euro)

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è:
- RentProg API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ 50 –∑–∞–ø–∏—Å–µ–π
- –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (future)

---

## üìÅ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `n8n-workflows/rentprog-monitor-cash-events.json` - Workflow #1
- `n8n-workflows/rentprog-daily-employee-cash.json` - Workflow #2
- `setup/import_new_workflows.mjs` - –°–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞
- `RENTPROG_WORKFLOWS_CREATED.md` - –≠—Ç–æ—Ç –æ—Ç—á–µ—Ç

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] Workflow #1 —Å–æ–∑–¥–∞–Ω –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
- [x] Workflow #2 —Å–æ–∑–¥–∞–Ω –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
- [x] Bearer —Ç–æ–∫–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] Error Handler –ø–æ–¥–∫–ª—é—á–µ–Ω
- [x] Telegram –∞–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] –°—Ç–∞—Ä—ã–µ workflows —É–¥–∞–ª–µ–Ω—ã
- [ ] **TODO:** –°–æ–∑–¥–∞—Ç—å endpoint `/process-rentprog-data` –≤ Jarvis API
- [ ] **TODO:** –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflows –≤ n8n UI
- [ ] **TODO:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ workflow –≤—Ä—É—á–Ω—É—é
- [ ] **TODO:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –∞–ª–µ—Ä—Ç—ã
- [ ] **TODO:** –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π `Cash Register Reconciliation` –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

---

**–ì–æ—Ç–æ–≤–æ!** –ù–æ–≤—ã–µ workflows –≥–æ—Ç–æ–≤—ã –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ üöÄ

