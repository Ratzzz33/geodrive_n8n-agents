# ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ n8n –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 1. ‚úÖ –¢–∞–±–ª–∏—Ü—ã –≤ Neon PostgreSQL

–¢–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ TypeScript —Å–∫—Ä–∏–ø—Ç:

```bash
npx tsx setup/create_n8n_tables.ts
```

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- ‚úÖ `events` - —Å–æ–±—ã—Ç–∏—è –≤–µ–±—Ö—É–∫–æ–≤ RentProg
- ‚úÖ `sync_runs` - –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏  
- ‚úÖ `health` - health check —Å—Ç–∞—Ç—É—Å—ã

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
```
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Neon PostgreSQL
üìù –í—ã–ø–æ–ª–Ω—è—é SQL...
‚úÖ –¢–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!
   - events
   - sync_runs
   - health

üìä –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
   ‚úì events
   ‚úì health
   ‚úì sync_runs
```

### 2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ Jarvis

- ‚úÖ `src/integrations/n8n.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å branch –≤ query
- ‚úÖ `src/config/index.ts` - –¥–æ–±–∞–≤–ª–µ–Ω `N8N_BASE_WEBHOOK_URL`
- ‚úÖ `src/bot/index.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ `env.example` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `N8N_BASE_WEBHOOK_URL`

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã

- ‚úÖ `setup/create_n8n_tables.sql` - SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- ‚úÖ `setup/create_n8n_tables.ts` - TypeScript —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL
- ‚úÖ `setup/import_n8n_workflows.ts` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ workflow (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ n8n)

---

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é

### 1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow –≤ n8n

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ UI n8n**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://46.224.17.15:5678`
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. **Workflows** ‚Üí **Import from File**
4. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ –æ—á–µ—Ä–µ–¥–∏:
   - `n8n-workflows/rentprog-webhooks-monitor.json`
   - `n8n-workflows/sync-progress.json`
   - `n8n-workflows/health-status.json`

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ API (–µ—Å–ª–∏ n8n –¥–æ—Å—Ç—É–ø–µ–Ω)**
```bash
npx tsx setup/import_n8n_workflows.ts
```

### 2. –°–æ–∑–¥–∞—Ç—å Credentials –≤ n8n

#### PostgreSQL Credentials
1. **Credentials** ‚Üí **Add Credential** ‚Üí **Postgres**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Host:** `ep-rough-heart-ahnybmq0-pooler.c-3.us-east-1.aws.neon.tech`
   - **Database:** `neondb`
   - **User:** `neondb_owner`
   - **Password:** `npg_cHIT9Kxfk1Am`
   - **Port:** `5432`
   - **SSL:** –≤–∫–ª—é—á–∏—Ç—å (SSLMode: require)
3. **Name:** `PostgreSQL`
4. **Save**

#### Telegram Bot Credentials
1. **Credentials** ‚Üí **Add Credential** ‚Üí **Telegram**
2. **Access Token:** —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ `@n8n_alert_geodrive_bot`
   - –ü–æ–ª—É—á–∏—Ç–µ —É @BotFather –≤ Telegram
3. **Name:** `Telegram Bot`
4. **Save**

#### –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ workflow
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–∂–¥—ã–π –∏–∑ 3 workflow
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ **Postgres** –Ω–æ–¥–∞:
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–æ–¥
   - –í –ø–æ–ª–µ **Credential** –≤—ã–±–µ—Ä–∏—Ç–µ **PostgreSQL**
   - **Save**
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ **Telegram** –Ω–æ–¥–∞:
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–æ–¥
   - –í –ø–æ–ª–µ **Credential** –≤—ã–±–µ—Ä–∏—Ç–µ **Telegram Bot**
   - **Save**

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ n8n

–í n8n UI: **Settings** ‚Üí **Environment Variables**

–î–æ–±–∞–≤—å—Ç–µ:
```
RENTPROG_HEALTH_URL=http://46.224.17.15:3000/rentprog/health
TELEGRAM_ALERT_CHAT_ID=<–≤–∞—à_chat_id>
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å TELEGRAM_ALERT_CHAT_ID:**
- –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É @userinfobot –≤ Telegram
- –û–Ω –≤–µ—Ä–Ω–µ—Ç –≤–∞—à User ID
- –ò–ª–∏ –¥–ª—è –≥—Ä—É–ø–ø—ã: –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ID –≥—Ä—É–ø–ø—ã

### 4. –û–±–Ω–æ–≤–∏—Ç—å .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ `46.224.17.15` –µ—Å—Ç—å:

```env
N8N_BASE_WEBHOOK_URL=http://46.224.17.15/webhook
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
```bash
ssh root@46.224.17.15
cd /root/geodrive_n8n-agents
docker compose restart bot
# –∏–ª–∏
npm run dev
```

### 5. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 3 workflow:
1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow
2. –ù–∞–∂–º–∏—Ç–µ **Active** (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –Ω–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ credentials –ø—Ä–∏–≤—è–∑–∞–Ω—ã

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç –≤–µ–±—Ö—É–∫–∞

```bash
curl -X POST "https://geodrive.netlify.app/webhooks/rentprog/tbilisi" \
  -H "Content-Type: application/json" \
  -d '{"event":"booking.issue.planned","payload":{"id":"test_123"}}'
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ‚úÖ n8n ‚Üí Executions ‚Üí "RentProg Webhooks Monitor" –≤–∏–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `events` –ø–æ–ª—É—á–∏–ª–∞ –∑–∞–ø–∏—Å—å
- ‚úÖ –ü—Ä–∏ `ok:false` ‚Üí Telegram –∞–ª–µ—Ä—Ç

### 2. –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–í –±–æ—Ç–µ:
```
/sync_rentprog
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ‚úÖ n8n ‚Üí Executions ‚Üí "Sync Progress" –≤–∏–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `sync_runs` –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –∫–∞–∂–¥—ã–µ 20 –∑–∞–ø–∏—Å–µ–π

### 3. –¢–µ—Å—Ç Health Check

Health workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç.

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `health` –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø–∏—Å–∏
- ‚úÖ –ü—Ä–∏ `ok:false` ‚Üí Telegram –∞–ª–µ—Ä—Ç

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

–í –±–æ—Ç–µ:
```
/status
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ‚úÖ RentProg –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–µ–ª–µ–Ω—ã–π —Å—Ç–∞—Ç—É—Å

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
npx tsx setup/verify_tables.ts
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Neon Dashboard ‚Üí SQL Editor:

```sql
-- –°–æ–±—ã—Ç–∏—è
SELECT * FROM events ORDER BY ts DESC LIMIT 10;

-- –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
SELECT * FROM sync_runs ORDER BY ts DESC LIMIT 10;

-- Health
SELECT * FROM health ORDER BY ts DESC LIMIT 10;
```

---

## ‚úÖ Definition of Done

- ‚úÖ –¢–∞–±–ª–∏—Ü—ã `events`, `sync_runs`, `health` —Å–æ–∑–¥–∞–Ω—ã –≤ Neon
- ‚úÖ –ö–æ–¥ Jarvis –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤ n8n
- ‚è≥ Workflow –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ n8n (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ n8n)
- ‚è≥ Credentials —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ workflow
- ‚è≥ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ n8n
- ‚è≥ Workflow –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã

**–û—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é:**
1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å 3 workflow
2. –°–æ–∑–¥–∞—Ç—å 2 credentials
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow

---

## üìù –§–∞–π–ª—ã –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

- `N8N_SETUP_INSTRUCTIONS.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `N8N_INTEGRATION_COMPLETE.md` - –ø–æ–ª–Ω–∞—è —Å–≤–æ–¥–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `setup/create_n8n_tables.sql` - SQL —Å–∫—Ä–∏–ø—Ç
- `setup/create_n8n_tables.ts` - TypeScript —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- `setup/import_n8n_workflows.ts` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ workflow

---

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞!** ‚úÖ  
**–†—É—á–Ω–∞—è —á–∞—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ n8n UI.** ‚è≥

